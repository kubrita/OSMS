//angular.module("angular-img-cropper",[]).directive("imageCropper",["$document","$window","imageCropperDataShare",function(a,b,c){return{scope:{image:"=",croppedImage:"=",cropWidth:"=",cropHeight:"=",keepAspect:"=",touchRadius:"=",cropAreaBounds:"=",minWidth:"=",minHeight:"="},restrict:"A",link:function(a,b,d){function e(c,d){if(!g||c!==d){var e=b[0],h=a.cropWidth,i=a.cropHeight,j=a.keepAspect,k=a.touchRadius,l=g&&g.srcImage;g=new q(e,e.width/2-h/2,e.height/2-i/2,h,i,j,k),$(e).data("crop.angular-img-cropper",g),l?g.setImage(l):f(a.image)}}function f(b){if(b){var c=new Image;void 0!==d.cors&&"no"!==d.cors&&(c.crossOrigin="Anonymous"),c.addEventListener("load",function(){g.setImage(c),a.$apply()},!1),c.src=b}}var g,h=h||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},i=function(){function a(a,b,c){this.over=!1,this.drag=!1,this.position=new o(a,b),this.offset=new o(0,0),this.radius=c}return a.prototype.setDrag=function(a){this.drag=a,this.setOver(a)},a.prototype.draw=function(a){},a.prototype.setOver=function(a){this.over=a},a.prototype.touchInBounds=function(a,b){return a>this.position.x-this.radius&&a<this.position.x+this.radius&&b>this.position.y-this.radius&&b<this.position.y+this.radius},a.prototype.getPosition=function(){return this.position},a.prototype.setPosition=function(a,b){this.position.x=a,this.position.y=b},a}(),j=function(){function a(b){this.borrowed=0,a.instance=this;for(var c=null,d=0;b>d;d++)if(0===d)this.firstAvailable=new o,c=this.firstAvailable;else{var e=new o;c.setNext(e),c=e}}return a.prototype.borrow=function(a,b){if(null==this.firstAvailable)throw"Pool exhausted";this.borrowed++;var c=this.firstAvailable;return this.firstAvailable=c.getNext(),c.x=a,c.y=b,c},a.prototype.returnPoint=function(a){this.borrowed--,a.x=0,a.y=0,a.setNext(this.firstAvailable),this.firstAvailable=a},a}(),k=function(){function a(){}return a.init=function(a){this.canvas=a,this.ctx=this.canvas.getContext("2d")},a.DEG2RAD=.0174532925,a}(),l=function(a){function b(b,c,d){a.call(this,b,c,d),this.iconPoints=new Array,this.scaledIconPoints=new Array,this.getDragIconPoints(this.iconPoints,1),this.getDragIconPoints(this.scaledIconPoints,1.2)}return h(b,a),b.prototype.draw=function(a){this.over||this.drag?this.drawIcon(a,this.scaledIconPoints):this.drawIcon(a,this.iconPoints)},b.prototype.getDragIconPoints=function(a,b){var c=17*b,d=14*b,e=8*b,f=4*b;a.push(j.instance.borrow(-f/2,c-e)),a.push(j.instance.borrow(-d/2,c-e)),a.push(j.instance.borrow(0,c)),a.push(j.instance.borrow(d/2,c-e)),a.push(j.instance.borrow(f/2,c-e)),a.push(j.instance.borrow(f/2,f/2)),a.push(j.instance.borrow(c-e,f/2)),a.push(j.instance.borrow(c-e,d/2)),a.push(j.instance.borrow(c,0)),a.push(j.instance.borrow(c-e,-d/2)),a.push(j.instance.borrow(c-e,-f/2)),a.push(j.instance.borrow(f/2,-f/2)),a.push(j.instance.borrow(f/2,-c+e)),a.push(j.instance.borrow(d/2,-c+e)),a.push(j.instance.borrow(0,-c)),a.push(j.instance.borrow(-d/2,-c+e)),a.push(j.instance.borrow(-f/2,-c+e)),a.push(j.instance.borrow(-f/2,-f/2)),a.push(j.instance.borrow(-c+e,-f/2)),a.push(j.instance.borrow(-c+e,-d/2)),a.push(j.instance.borrow(-c,0)),a.push(j.instance.borrow(-c+e,d/2)),a.push(j.instance.borrow(-c+e,f/2)),a.push(j.instance.borrow(-f/2,f/2))},b.prototype.drawIcon=function(a,b){a.beginPath(),a.moveTo(b[0].x+this.position.x,b[0].y+this.position.y);for(var c=0;c<b.length;c++){var d=b[c];a.lineTo(d.x+this.position.x,d.y+this.position.y)}a.closePath(),a.fillStyle="rgba(255,228,0,1)",a.fill()},b.prototype.recalculatePosition=function(a){var b=a.getCentre();this.setPosition(b.x,b.y),j.instance.returnPoint(b)},b}(i),m=function(a){function b(b,c,d){a.call(this,b,c,d)}return h(b,a),b.prototype.drawCornerBorder=function(a){var b=10;(this.over||this.drag)&&(b=12);var c=1,d=1;this.horizontalNeighbour.position.x<this.position.x&&(c=-1),this.verticalNeighbour.position.y<this.position.y&&(d=-1),a.beginPath(),a.lineJoin="miter",a.moveTo(this.position.x,this.position.y),a.lineTo(this.position.x+b*c,this.position.y),a.lineTo(this.position.x+b*c,this.position.y+b*d),a.lineTo(this.position.x,this.position.y+b*d),a.lineTo(this.position.x,this.position.y),a.closePath(),a.lineWidth=2,a.strokeStyle="rgba(255,228,0,1)",a.stroke()},b.prototype.drawCornerFill=function(a){var b=10;(this.over||this.drag)&&(b=12);var c=1,d=1;this.horizontalNeighbour.position.x<this.position.x&&(c=-1),this.verticalNeighbour.position.y<this.position.y&&(d=-1),a.beginPath(),a.moveTo(this.position.x,this.position.y),a.lineTo(this.position.x+b*c,this.position.y),a.lineTo(this.position.x+b*c,this.position.y+b*d),a.lineTo(this.position.x,this.position.y+b*d),a.lineTo(this.position.x,this.position.y),a.closePath(),a.fillStyle="rgba(0,0,0,1)",a.fill()},b.prototype.moveX=function(a){this.setPosition(a,this.position.y)},b.prototype.moveY=function(a){this.setPosition(this.position.x,a)},b.prototype.move=function(a,b){this.setPosition(a,b),this.verticalNeighbour.moveX(a),this.horizontalNeighbour.moveY(b)},b.prototype.addHorizontalNeighbour=function(a){this.horizontalNeighbour=a},b.prototype.addVerticalNeighbour=function(a){this.verticalNeighbour=a},b.prototype.getHorizontalNeighbour=function(){return this.horizontalNeighbour},b.prototype.getVerticalNeighbour=function(){return this.verticalNeighbour},b.prototype.draw=function(a){this.drawCornerFill(a),this.drawCornerBorder(a)},b}(i),n=function(){function a(a,b,c,d){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=0),this.left=a,this.right=a+c,this.top=b,this.bottom=b+d}return a.prototype.getWidth=function(){return this.right-this.left},a.prototype.getHeight=function(){return this.bottom-this.top},a.prototype.getCentre=function(){var a=this.getWidth(),b=this.getHeight();return j.instance.borrow(this.left+a/2,this.top+b/2)},a}(),o=function(){function a(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this.x=a,this.y=b}return a.prototype.setNext=function(a){this.next=a},a.prototype.getNext=function(){return this.next},a}(),p=function(){function a(a,b,c){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),this.id=0,this.x=a,this.y=b,this.id=c}return a}(),q=function(){function b(a,b,c,d,e,f,g){void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=100),void 0===e&&(e=50),void 0===f&&(f=!0),void 0===g&&(g=20),this.keepAspect=!1,this.aspectRatio=0,this.currentDragTouches=new Array,this.isMouseDown=!1,this.ratioW=1,this.ratioH=1,this.fileType="png",this.imageSet=!1,this.pointPool=new j(200),k.init(a),this.buffer=document.createElement("canvas"),this.cropCanvas=document.createElement("canvas"),this.buffer.width=a.width,this.buffer.height=a.height,this.tl=new m(b,c,g),this.tr=new m(b+d,c,g),this.bl=new m(b,c+e,g),this.br=new m(b+d,c+e,g),this.tl.addHorizontalNeighbour(this.tr),this.tl.addVerticalNeighbour(this.bl),this.tr.addHorizontalNeighbour(this.tl),this.tr.addVerticalNeighbour(this.br),this.bl.addHorizontalNeighbour(this.br),this.bl.addVerticalNeighbour(this.tl),this.br.addHorizontalNeighbour(this.bl),this.br.addVerticalNeighbour(this.tr),this.markers=[this.tl,this.tr,this.bl,this.br],this.center=new l(b+d/2,c+e/2,g),this.canvas=a,this.ctx=this.canvas.getContext("2d"),this.keepAspect=f,this.aspectRatio=e/d,this.draw(this.ctx),this.croppedImage=new Image,this.currentlyInteracting=!1,angular.element(window).off("mousemove.angular-img-cropper mouseup.angular-img-cropper touchmove.angular-img-cropper touchend.angular-img-cropper").on("mousemove.angular-img-cropper",this.onMouseMove.bind(this)).on("mouseup.angular-img-cropper",this.onMouseUp.bind(this)).on("touchmove.angular-img-cropper",this.onTouchMove.bind(this)).on("touchend.angular-img-cropper",this.onTouchEnd.bind(this)),angular.element(a).off("mousedown.angular-img-cropper touchstart.angular-img-cropper").on("mousedown.angular-img-cropper",this.onMouseDown.bind(this)).on("touchstart.angular-img-cropper",this.onTouchStart.bind(this))}return b.prototype.resizeCanvas=function(a,b){this.canvas.width=a,this.canvas.height=b,this.buffer.width=a,this.buffer.height=b,this.draw(this.ctx)},b.prototype.draw=function(a){var b=this.getBounds();if(this.srcImage){a.clearRect(0,0,this.canvasWidth,this.canvasHeight);var c=this.srcImage.height/this.srcImage.width,d=this.canvasHeight/this.canvasWidth,e=this.canvasWidth,f=this.canvasHeight;d>c?(e=this.canvasWidth,f=this.canvasWidth*c):(f=this.canvasHeight,e=this.canvasHeight/c),this.ratioW=e/this.srcImage.width,this.ratioH=f/this.srcImage.height,c>d?this.drawImageIOSFix(a,this.srcImage,0,0,this.srcImage.width,this.srcImage.height,this.buffer.width/2-e/2,0,e,f):this.drawImageIOSFix(a,this.srcImage,0,0,this.srcImage.width,this.srcImage.height,0,this.buffer.height/2-f/2,e,f),this.buffer.getContext("2d").drawImage(this.canvas,0,0,this.canvasWidth,this.canvasHeight),a.fillStyle="rgba(0, 0, 0, 0.7)",a.fillRect(0,0,this.canvasWidth,this.canvasHeight),a.drawImage(this.buffer,b.left,b.top,Math.max(b.getWidth(),1),Math.max(b.getHeight(),1),b.left,b.top,b.getWidth(),b.getHeight());for(var g,h=0;h<this.markers.length;h++)g=this.markers[h],g.draw(a);this.center.draw(a),a.lineWidth=2,a.strokeStyle="rgba(255,228,0,1)",a.strokeRect(b.left,b.top,b.getWidth(),b.getHeight())}else a.fillStyle="rgba(192,192,192,1)",a.fillRect(0,0,this.canvas.width,this.canvas.height)},b.prototype.dragCrop=function(b,c,d){var e=this.getBounds(),f=b-e.getWidth()/2,g=b+e.getWidth()/2,h=c-e.getHeight()/2,i=c+e.getHeight()/2;g>=this.maxXClamp&&(b=this.maxXClamp-e.getWidth()/2),f<=this.minXClamp&&(b=e.getWidth()/2+this.minXClamp),h<this.minYClamp&&(c=e.getHeight()/2+this.minYClamp),i>=this.maxYClamp&&(c=this.maxYClamp-e.getHeight()/2),this.tl.moveX(b-e.getWidth()/2),this.tl.moveY(c-e.getHeight()/2),this.tr.moveX(b+e.getWidth()/2),this.tr.moveY(c-e.getHeight()/2),this.bl.moveX(b-e.getWidth()/2),this.bl.moveY(c+e.getHeight()/2),this.br.moveX(b+e.getWidth()/2),this.br.moveY(c+e.getHeight()/2),d.setPosition(b,c),a.cropAreaBounds&&this.imageSet&&(a.cropAreaBounds=this.getCropBounds(),a.$apply())},b.prototype.enforceMinSize=function(b,c,d){var e=b-d.getHorizontalNeighbour().getPosition().x,f=c-d.getVerticalNeighbour().getPosition().y,g=a.minWidth-Math.abs(e),h=a.minHeight-Math.abs(f);return 0==e||0==f?(b=d.getPosition().x,c=d.getPosition().y,j.instance.borrow(b,c)):(a.keepAspect?g>0&&h/this.aspectRatio>0?g>h/this.aspectRatio?0>e?(b-=g,0>f?c-=g*this.aspectRatio:c+=g*this.aspectRatio):(b+=g,0>f?c-=g*this.aspectRatio:c+=g*this.aspectRatio):0>f?(c-=h,0>e?b-=h/this.aspectRatio:b+=h/this.aspectRatio):(c+=h,0>e?b-=h/this.aspectRatio:b+=h/this.aspectRatio):g>0?0>e?(b-=g,0>f?c-=g*this.aspectRatio:c+=g*this.aspectRatio):(b+=g,0>f?c-=g*this.aspectRatio:c+=g*this.aspectRatio):h>0&&(0>f?(c-=h,0>e?b-=h/this.aspectRatio:b+=h/this.aspectRatio):(c+=h,0>e?b-=h/this.aspectRatio:b+=h/this.aspectRatio)):(g>0&&(0>e?b-=g:b+=g),h>0&&(0>f?c-=h:c+=h)),(b<this.minXClamp||b>this.maxXClamp||c<this.minYClamp||c>this.maxYClamp)&&(b=d.getPosition().x,c=d.getPosition().y),j.instance.borrow(b,c))},b.prototype.dragCorner=function(b,c,d){var e,f=0,g=0,h=0,i=0,k=0,l=0,m=0,n=0,o=0;if(a.keepAspect){if(e=d.getHorizontalNeighbour().getVerticalNeighbour(),h=e.getPosition().x,i=e.getPosition().y,b<=e.getPosition().x){if(c<=e.getPosition().y){if(f=h-100/this.aspectRatio,g=i-100/this.aspectRatio*this.aspectRatio,o=this.getSide(j.instance.borrow(f,g),e.getPosition(),j.instance.borrow(b,c)),o>0){k=Math.abs(e.getPosition().y-c),l=k/this.aspectRatio,m=e.getPosition().y-k,n=e.getPosition().x-l;var p=this.enforceMinSize(n,m,d);d.move(p.x,p.y),j.instance.returnPoint(p)}else if(0>o){l=Math.abs(e.getPosition().x-b),k=l*this.aspectRatio,m=e.getPosition().y-k,n=e.getPosition().x-l;var p=this.enforceMinSize(n,m,d);d.move(p.x,p.y),j.instance.returnPoint(p)}}else if(f=h-100/this.aspectRatio,g=i+100/this.aspectRatio*this.aspectRatio,o=this.getSide(j.instance.borrow(f,g),e.getPosition(),j.instance.borrow(b,c)),o>0){l=Math.abs(e.getPosition().x-b),k=l*this.aspectRatio,m=e.getPosition().y+k,n=e.getPosition().x-l;var p=this.enforceMinSize(n,m,d);d.move(p.x,p.y),j.instance.returnPoint(p)}else if(0>o){k=Math.abs(e.getPosition().y-c),l=k/this.aspectRatio,m=e.getPosition().y+k,n=e.getPosition().x-l;var p=this.enforceMinSize(n,m,d);d.move(p.x,p.y),j.instance.returnPoint(p)}}else if(c<=e.getPosition().y){if(f=h+100/this.aspectRatio,g=i-100/this.aspectRatio*this.aspectRatio,o=this.getSide(j.instance.borrow(f,g),e.getPosition(),j.instance.borrow(b,c)),0>o){k=Math.abs(e.getPosition().y-c),l=k/this.aspectRatio,m=e.getPosition().y-k,n=e.getPosition().x+l;var p=this.enforceMinSize(n,m,d);d.move(p.x,p.y),j.instance.returnPoint(p)}else if(o>0){l=Math.abs(e.getPosition().x-b),k=l*this.aspectRatio,m=e.getPosition().y-k,n=e.getPosition().x+l;var p=this.enforceMinSize(n,m,d);d.move(p.x,p.y),j.instance.returnPoint(p)}}else if(f=h+100/this.aspectRatio,g=i+100/this.aspectRatio*this.aspectRatio,o=this.getSide(j.instance.borrow(f,g),e.getPosition(),j.instance.borrow(b,c)),0>o){l=Math.abs(e.getPosition().x-b),k=l*this.aspectRatio,m=e.getPosition().y+k,n=e.getPosition().x+l;var p=this.enforceMinSize(n,m,d);d.move(p.x,p.y),j.instance.returnPoint(p)}else if(o>0){k=Math.abs(e.getPosition().y-c),l=k/this.aspectRatio,m=e.getPosition().y+k,n=e.getPosition().x+l;var p=this.enforceMinSize(n,m,d);d.move(p.x,p.y),j.instance.returnPoint(p)}}else{var p=this.enforceMinSize(b,c,d);d.move(p.x,p.y),j.instance.returnPoint(p)}this.center.recalculatePosition(this.getBounds()),a.cropAreaBounds&&this.imageSet&&(a.cropAreaBounds=this.getCropBounds(),a.$apply())},b.prototype.getSide=function(a,b,c){var d=this.sign((b.x-a.x)*(c.y-a.y)-(b.y-a.y)*(c.x-a.x));return j.instance.returnPoint(a),j.instance.returnPoint(c),d},b.prototype.sign=function(a){return+a===a?0===a?a:a>0?1:-1:NaN},b.prototype.handleRelease=function(a){if(null!=a){for(var b=0,c=0;c<this.currentDragTouches.length;c++)a.id==this.currentDragTouches[c].id&&(this.currentDragTouches[c].dragHandle.setDrag(!1),a.dragHandle=null,b=c);this.currentDragTouches.splice(b,1),this.draw(this.ctx)}},b.prototype.handleMove=function(a){for(var b=!1,d=0;d<this.currentDragTouches.length;d++)if(a.id==this.currentDragTouches[d].id&&null!=this.currentDragTouches[d].dragHandle){var e=this.currentDragTouches[d],f=this.clampPosition(a.x-e.dragHandle.offset.x,a.y-e.dragHandle.offset.y);a.x=f.x,a.y=f.y,j.instance.returnPoint(f),e.dragHandle instanceof m?this.dragCorner(a.x,a.y,e.dragHandle):this.dragCrop(a.x,a.y,e.dragHandle),this.currentlyInteracting=!0,b=!0,c.setPressed(this.canvas);break}if(!b){for(var g=0;g<this.markers.length;g++){var h=this.markers[g];if(h.touchInBounds(a.x,a.y)){a.dragHandle=h,this.currentDragTouches.push(a),h.setDrag(!0),a.dragHandle.offset.x=a.x-a.dragHandle.getPosition().x,a.dragHandle.offset.y=a.y-a.dragHandle.getPosition().y,this.dragCorner(a.x-a.dragHandle.offset.x,a.y-a.dragHandle.offset.y,a.dragHandle);break}}null==a.dragHandle&&this.center.touchInBounds(a.x,a.y)&&(a.dragHandle=this.center,this.currentDragTouches.push(a),a.dragHandle.setDrag(!0),a.dragHandle.offset.x=a.x-a.dragHandle.getPosition().x,a.dragHandle.offset.y=a.y-a.dragHandle.getPosition().y,this.dragCrop(a.x-a.dragHandle.offset.x,a.y-a.dragHandle.offset.y,a.dragHandle))}},b.prototype.updateClampBounds=function(){var a=this.srcImage.height/this.srcImage.width,b=this.canvas.height/this.canvas.width,c=this.canvas.width,d=this.canvas.height;b>a?(c=this.canvas.width,d=this.canvas.width*a):(d=this.canvas.height,c=this.canvas.height/a),this.minXClamp=this.canvas.width/2-c/2,this.minYClamp=this.canvas.height/2-d/2,this.maxXClamp=this.canvas.width/2+c/2,this.maxYClamp=this.canvas.height/2+d/2},b.prototype.getCropBounds=function(){var a=this.canvas.height-2*this.minYClamp,b=this.getBounds();return b.top=Math.round((a-b.top+this.minYClamp)/this.ratioH),b.bottom=Math.round((a-b.bottom+this.minYClamp)/this.ratioH),b.left=Math.round((b.left-this.minXClamp)/this.ratioW),b.right=Math.round((b.right-this.minXClamp)/this.ratioW),b},b.prototype.clampPosition=function(a,b){return a<this.minXClamp&&(a=this.minXClamp),a>this.maxXClamp&&(a=this.maxXClamp),b<this.minYClamp&&(b=this.minYClamp),b>this.maxYClamp&&(b=this.maxYClamp),j.instance.borrow(a,b)},b.prototype.isImageSet=function(){return this.imageSet},b.prototype.setImage=function(b){if(!b)throw"Image is null";this.imageSet=!0,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);var c=this.buffer.getContext("2d");c.clearRect(0,0,this.buffer.width,this.buffer.height);var e=b.src.split("."),f=e[1];("png"==f||"jpg"==f)&&(this.fileType=f),this.srcImage=b,this.updateClampBounds();var g=this.srcImage.height/this.srcImage.width,h=this.getBounds(),i=h.getHeight()/h.getWidth(),k=this.canvas.width,l=this.canvas.height;this.canvasWidth=k,this.canvasHeight=l;var m=this.canvas.width/2,o=this.canvas.height/2,p=j.instance.borrow(m-h.getWidth()/2,o+h.getHeight()/2),q=j.instance.borrow(m+h.getWidth()/2,o+h.getHeight()/2),r=j.instance.borrow(m-h.getWidth()/2,o-h.getHeight()/2),s=j.instance.borrow(m+h.getWidth()/2,o-h.getHeight()/2);if(this.tl.setPosition(p.x,p.y),this.tr.setPosition(q.x,q.y),this.bl.setPosition(r.x,r.y),this.br.setPosition(s.x,s.y),j.instance.returnPoint(p),j.instance.returnPoint(q),j.instance.returnPoint(r),j.instance.returnPoint(s),this.center.setPosition(m,o),i>g){var t=Math.min(k*g,l),u=t/i;p=j.instance.borrow(m-u/2,o+t/2),q=j.instance.borrow(m+u/2,o+t/2),r=j.instance.borrow(m-u/2,o-t/2),s=j.instance.borrow(m+u/2,o-t/2)}else if(g>i){var v=Math.min(l/g,k),w=v*i;p=j.instance.borrow(m-v/2,o+w/2),q=j.instance.borrow(m+v/2,o+w/2),r=j.instance.borrow(m-v/2,o-w/2),s=j.instance.borrow(m+v/2,o-w/2)}else{var v=Math.min(l,k),w=v*i;p=j.instance.borrow(m-v/2,o+w/2),q=j.instance.borrow(m+v/2,o+w/2),r=j.instance.borrow(m-v/2,o-w/2),s=j.instance.borrow(m+v/2,o-w/2)}if(this.tl.setPosition(p.x,p.y),this.tr.setPosition(q.x,q.y),this.bl.setPosition(r.x,r.y),this.br.setPosition(s.x,s.y),j.instance.returnPoint(p),j.instance.returnPoint(q),j.instance.returnPoint(r),j.instance.returnPoint(s),a.cropAreaBounds&&void 0!==a.cropAreaBounds.left&&void 0!==a.cropAreaBounds.top&&void 0!==a.cropAreaBounds.right&&void 0!==a.cropAreaBounds.bottom){var x=this.canvasHeight/this.canvasWidth;x>g?(k=this.canvasWidth,l=this.canvasWidth*g):(l=this.canvasHeight,k=this.canvasHeight/g),this.ratioW=k/this.srcImage.width,this.ratioH=l/this.srcImage.height;var y=new n;y.top=Math.round(l+this.minYClamp-this.ratioH*a.cropAreaBounds.top),y.bottom=Math.round(l+this.minYClamp-this.ratioH*a.cropAreaBounds.bottom),y.left=Math.round(this.ratioW*a.cropAreaBounds.left+this.minXClamp),y.right=Math.round(this.ratioW*a.cropAreaBounds.right+this.minXClamp),this.tl.setPosition(y.left,y.top),this.tr.setPosition(y.right,y.top),this.bl.setPosition(y.left,y.bottom),this.br.setPosition(y.right,y.bottom),this.center.setPosition(y.left+y.getWidth()/2,y.top+y.getHeight()/2)}this.vertSquashRatio=this.detectVerticalSquash(this.srcImage),this.draw(this.ctx);var z=this.getCroppedImage(a.cropWidth,a.cropHeight);void 0!==d.croppedImage&&(a.croppedImage=z.src),a.cropAreaBounds&&this.imageSet&&(a.cropAreaBounds=this.getCropBounds())},b.prototype.getCroppedImage=function(a,b){var c=this.getBounds();if(!this.srcImage)throw"Source image not set.";if(a&&b){var d=this.srcImage.height/this.srcImage.width,e=this.canvas.height/this.canvas.width,f=this.canvas.width,g=this.canvas.height;e>d?(f=this.canvas.width,g=this.canvas.width*d):d>e?(g=this.canvas.height,f=this.canvas.height/d):(g=this.canvas.height,f=this.canvas.width),this.ratioW=f/this.srcImage.width,this.ratioH=g/this.srcImage.height,this.cropCanvas.width=a,this.cropCanvas.height=b;var h=(this.buffer.height-g)/2/this.ratioH,i=(this.buffer.width-f)/2/this.ratioW;this.drawImageIOSFix(this.cropCanvas.getContext("2d"),this.srcImage,Math.max(Math.round(c.left/this.ratioW-i),0),Math.max(Math.round(c.top/this.ratioH-h),0),Math.max(Math.round(c.getWidth()/this.ratioW),1),Math.max(Math.round(c.getHeight()/this.ratioH),1),0,0,a,b),this.croppedImage.width=a,this.croppedImage.height=b}else this.cropCanvas.width=Math.max(c.getWidth(),1),this.cropCanvas.height=Math.max(c.getHeight(),1),this.cropCanvas.getContext("2d").drawImage(this.buffer,c.left,c.top,Math.max(c.getWidth(),1),Math.max(c.getHeight(),1),0,0,c.getWidth(),c.getHeight()),this.croppedImage.width=this.cropCanvas.width,this.croppedImage.height=this.cropCanvas.height;return this.croppedImage.src=this.cropCanvas.toDataURL("image/"+this.fileType),this.croppedImage},b.prototype.getBounds=function(){for(var a=Number.MAX_VALUE,b=Number.MAX_VALUE,c=-Number.MAX_VALUE,d=-Number.MAX_VALUE,e=0;e<this.markers.length;e++){var f=this.markers[e];f.getPosition().x<a&&(a=f.getPosition().x),f.getPosition().x>c&&(c=f.getPosition().x),f.getPosition().y<b&&(b=f.getPosition().y),f.getPosition().y>d&&(d=f.getPosition().y)}var g=new n;return g.left=a,g.right=c,g.top=b,g.bottom=d,g},b.prototype.setBounds=function(a){for(var b,c,d,e,f=this.getBounds(),g=0;g<this.markers.length;g++){var h=this.markers[g];h.getPosition().x==f.left?h.getPosition().y==f.top?b=h:d=h:h.getPosition().y==f.top?c=h:e=h}b.setPosition(a.left,a.top),c.setPosition(a.right,a.top),d.setPosition(a.left,a.bottom),e.setPosition(a.right,a.bottom),this.center.recalculatePosition(a),this.center.draw(this.ctx)},b.prototype.getMousePos=function(a,b){var c=a.getBoundingClientRect();return j.instance.borrow(b.clientX-c.left,b.clientY-c.top)},b.prototype.getTouchPos=function(a,b){var c=a.getBoundingClientRect();return j.instance.borrow(b.clientX-c.left,b.clientY-c.top)},b.prototype.onTouchMove=function(a){if(g.isImageSet()){if(a.originalEvent.touches.length>=1)for(var b=0;b<a.originalEvent.touches.length;b++){var c=a.originalEvent.touches[b],d=this.getTouchPos(this.canvas,c),e=new p(d.x,d.y,c.identifier);j.instance.returnPoint(d),this.move(e,a)}this.draw(this.ctx)}},b.prototype.onMouseMove=function(a){if(g.isImageSet()){var b=this.getMousePos(this.canvas,a);this.move(new p(b.x,b.y,0),a);var c=this.getDragTouchForID(0);c?(c.x=b.x,c.y=b.y):c=new p(b.x,b.y,0),j.instance.returnPoint(b),this.drawCursors(c,a),this.draw(this.ctx)}},b.prototype.move=function(a,b){this.isMouseDown&&this.handleMove(a)},b.prototype.getDragTouchForID=function(a){for(var b=0;b<this.currentDragTouches.length;b++)if(a==this.currentDragTouches[b].id)return this.currentDragTouches[b]},b.prototype.drawCursors=function(a,b){var d=!1;null!=a&&(a.dragHandle==this.center&&(c.setStyle(this.canvas,"move"),d=!0),null!=a.dragHandle&&a.dragHandle instanceof m&&(this.drawCornerCursor(a.dragHandle,a.dragHandle.getPosition().x,a.dragHandle.getPosition().y,b),d=!0));var e=!1;if(!d){for(var f=0;f<this.markers.length;f++)e=e||this.drawCornerCursor(this.markers[f],a.x,a.y,b);e||c.setStyle(this.canvas,"initial")}e||d||!this.center.touchInBounds(a.x,a.y)?this.center.setOver(!1):(this.center.setOver(!0),c.setOver(this.canvas),c.setStyle(this.canvas,"move"))},b.prototype.drawCornerCursor=function(a,b,d,e){return a.touchInBounds(b,d)?(a.setOver(!0),a.getHorizontalNeighbour().getPosition().x>a.getPosition().x?a.getVerticalNeighbour().getPosition().y>a.getPosition().y?(c.setOver(this.canvas),c.setStyle(this.canvas,"nwse-resize")):(c.setOver(this.canvas),c.setStyle(this.canvas,"nesw-resize")):a.getVerticalNeighbour().getPosition().y>a.getPosition().y?(c.setOver(this.canvas),c.setStyle(this.canvas,"nesw-resize")):(c.setOver(this.canvas),c.setStyle(this.canvas,"nwse-resize")),!0):(a.setOver(!1),!1)},b.prototype.onTouchStart=function(a){g.isImageSet()&&(this.isMouseDown=!0)},b.prototype.onTouchEnd=function(b){if(g.isImageSet()){for(var c=0;c<b.originalEvent.changedTouches.length;c++){var e=b.originalEvent.changedTouches[c],f=this.getDragTouchForID(e.identifier);null!=f&&((f.dragHandle instanceof m||f.dragHandle instanceof l)&&f.dragHandle.setOver(!1),this.handleRelease(f))}if(g.isImageSet()&&this.currentlyInteracting){var h=this.getCroppedImage(a.cropWidth,a.cropHeight);void 0!==d.croppedImage&&(a.croppedImage=h.src),a.$apply()}0==this.currentDragTouches.length&&(this.isMouseDown=!1,this.currentlyInteracting=!1)}},b.prototype.drawImageIOSFix=function(a,b,c,d,e,f,g,h,i,j){a.drawImage(b,c*this.vertSquashRatio,d*this.vertSquashRatio,e*this.vertSquashRatio,f*this.vertSquashRatio,g,h,i,j)},b.prototype.detectVerticalSquash=function(a){var b=(a.naturalWidth,a.naturalHeight),c=document.createElement("canvas");c.width=1,c.height=b;var d=c.getContext("2d");d.drawImage(a,0,0);for(var e=d.getImageData(0,0,1,b).data,f=0,g=b,h=b;h>f;){var i=e[4*(h-1)+3];0===i?g=h:f=h,h=g+f>>1}var j=h/b;return 0===j?1:j},b.prototype.onMouseDown=function(a){g.isImageSet()&&(this.isMouseDown=!0)},b.prototype.onMouseUp=function(b){if(g.isImageSet()){if(c.setReleased(this.canvas),this.isMouseDown=!1,this.handleRelease(new p(0,0,0)),1==this.currentlyInteracting){var e=this.getCroppedImage(a.cropWidth,a.cropHeight);void 0!==d.croppedImage&&(a.croppedImage=e.src),a.$apply()}this.currentlyInteracting=!1}},b}();a.$watch("cropWidth",e),a.$watch("cropHeight",e),a.$watch("keepAspect",e),a.$watch("touchRadius",e),a.$watch("image",f)}}}]),angular.module("angular-img-cropper").directive("imgCropperFileread",["$timeout",function(a){return{scope:{image:"="},link:function(b,c){c.bind("change",function(c){var d=new FileReader;d.onload=function(c){a(function(){b.image=c.target.result},0)},c.target.files[0]&&d.readAsDataURL(c.target.files[0])})}}}]),angular.module("angular-img-cropper").directive("imgCropperFilereadCall",function(){return{scope:{control:"="},link:function(a){a.internalControl=a.control||{},a.internalControl.load=function(a){var b=angular.element(document.querySelector(a)),c=document.createEvent("MouseEvent");c.initEvent("click",!0,!1),b[0].dispatchEvent(c)}}}}),angular.module("angular-img-cropper").factory("imageCropperDataShare",function(){var a,b,c={};return c.setPressed=function(b){a=b},c.setReleased=function(b){b===a&&(a=void 0)},c.setOver=function(a){b=a},c.setStyle=function(c,d){void 0!==a?a===c&&angular.element(document.documentElement).css("cursor",d):c===b&&angular.element(document.documentElement).css("cursor",d)},c}),function(a,b,c){function d(a,c){this.wrapper="string"==typeof a?b.querySelector(a):a,this.scroller=this.wrapper.children[0],this.scrollerStyle=this.scroller.style,this.options={mouseWheelSpeed:20,startX:0,startY:0,scrollY:!0,directionLockThreshold:5,momentum:!0,bounce:!0,bounceTime:600,bounceEasing:"",preventDefault:!0,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/},HWCompositing:!0,useTransition:!0,useTransform:!0};for(var d in c)this.options[d]=c[d];this.translateZ=this.options.HWCompositing&&f.hasPerspective?" translateZ(0)":"",this.options.useTransition=f.hasTransition&&this.options.useTransition,this.options.useTransform=f.hasTransform&&this.options.useTransform,this.options.eventPassthrough=this.options.eventPassthrough===!0?"vertical":this.options.eventPassthrough,this.options.preventDefault=!this.options.eventPassthrough&&this.options.preventDefault,this.options.scrollY="vertical"==this.options.eventPassthrough?!1:this.options.scrollY,this.options.scrollX="horizontal"==this.options.eventPassthrough?!1:this.options.scrollX,this.options.freeScroll=this.options.freeScroll&&!this.options.eventPassthrough,this.options.directionLockThreshold=this.options.eventPassthrough?0:this.options.directionLockThreshold,this.options.bounceEasing="string"==typeof this.options.bounceEasing?f.ease[this.options.bounceEasing]||f.ease.circular:this.options.bounceEasing,this.options.resizePolling=void 0===this.options.resizePolling?60:this.options.resizePolling,this.options.tap===!0&&(this.options.tap="tap"),this.options.invertWheelDirection=this.options.invertWheelDirection?-1:1,this.x=0,this.y=0,this.directionX=0,this.directionY=0,this._events={},this._init(),this.refresh(),this.scrollTo(this.options.startX,this.options.startY),this.enable()}var e=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(b){a.setTimeout(b,1e3/60)},f=function(){function d(a){return g===!1?!1:""===g?a:g+a.charAt(0).toUpperCase()+a.substr(1)}var e={},f=b.createElement("div").style,g=function(){for(var a,b=["t","webkitT","MozT","msT","OT"],c=0,d=b.length;d>c;c++)if(a=b[c]+"ransform",a in f)return b[c].substr(0,b[c].length-1);return!1}();e.getTime=Date.now||function(){return(new Date).getTime()},e.extend=function(a,b){for(var c in b)a[c]=b[c]},e.addEvent=function(a,b,c,d){a.addEventListener(b,c,!!d)},e.removeEvent=function(a,b,c,d){a.removeEventListener(b,c,!!d)},e.prefixPointerEvent=function(b){return a.MSPointerEvent?"MSPointer"+b.charAt(9).toUpperCase()+b.substr(10):b},e.momentum=function(a,b,d,e,f,g){var h,i,j=a-b,k=c.abs(j)/d;return g=void 0===g?6e-4:g,h=a+k*k/(2*g)*(0>j?-1:1),i=k/g,e>h?(h=f?e-f/2.5*(k/8):e,j=c.abs(h-a),i=j/k):h>0&&(h=f?f/2.5*(k/8):0,j=c.abs(a)+h,i=j/k),{destination:c.round(h),duration:i}};var h=d("transform");return e.extend(e,{hasTransform:h!==!1,hasPerspective:d("perspective")in f,hasTouch:"ontouchstart"in a,hasPointer:a.PointerEvent||a.MSPointerEvent,hasTransition:d("transition")in f}),e.isBadAndroid=/Android /.test(a.navigator.appVersion)&&!/Chrome\/\d/.test(a.navigator.appVersion),e.extend(e.style={},{transform:h,transitionTimingFunction:d("transitionTimingFunction"),transitionDuration:d("transitionDuration"),transitionDelay:d("transitionDelay"),transformOrigin:d("transformOrigin")}),e.hasClass=function(a,b){var c=new RegExp("(^|\\s)"+b+"(\\s|$)");return c.test(a.className)},e.addClass=function(a,b){if(!e.hasClass(a,b)){var c=a.className.split(" ");c.push(b),a.className=c.join(" ")}},e.removeClass=function(a,b){if(e.hasClass(a,b)){var c=new RegExp("(^|\\s)"+b+"(\\s|$)","g");a.className=a.className.replace(c," ")}},e.offset=function(a){for(var b=-a.offsetLeft,c=-a.offsetTop;a=a.offsetParent;)b-=a.offsetLeft,c-=a.offsetTop;return{left:b,top:c}},e.preventDefaultException=function(a,b){for(var c in b)if(b[c].test(a[c]))return!0;return!1},e.extend(e.eventType={},{touchstart:1,touchmove:1,touchend:1,mousedown:2,mousemove:2,mouseup:2,pointerdown:3,pointermove:3,pointerup:3,MSPointerDown:3,MSPointerMove:3,MSPointerUp:3}),e.extend(e.ease={},{quadratic:{style:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",fn:function(a){return a*(2-a)}},circular:{style:"cubic-bezier(0.1, 0.57, 0.1, 1)",fn:function(a){return c.sqrt(1- --a*a)}},back:{style:"cubic-bezier(0.175, 0.885, 0.32, 1.275)",fn:function(a){var b=4;return(a-=1)*a*((b+1)*a+b)+1}},bounce:{style:"",fn:function(a){return(a/=1)<1/2.75?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375}},elastic:{style:"",fn:function(a){var b=.22,d=.4;return 0===a?0:1==a?1:d*c.pow(2,-10*a)*c.sin((a-b/4)*(2*c.PI)/b)+1}}}),e.tap=function(a,c){var d=b.createEvent("Event");d.initEvent(c,!0,!0),d.pageX=a.pageX,d.pageY=a.pageY,a.target.dispatchEvent(d)},e.click=function(a){var c,d=a.target;/(SELECT|INPUT|TEXTAREA)/i.test(d.tagName)||(c=b.createEvent("MouseEvents"),c.initMouseEvent("click",!0,!0,a.view,1,d.screenX,d.screenY,d.clientX,d.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,0,null),c._constructed=!0,d.dispatchEvent(c))},e}();d.prototype={version:"5.1.3",_init:function(){this._initEvents(),this.options.mouseWheel&&this._initWheel()},destroy:function(){this._initEvents(!0),this._execEvent("destroy")},_transitionEnd:function(a){a.target==this.scroller&&this.isInTransition&&(this._transitionTime(),this.resetPosition(this.options.bounceTime)||(this.isInTransition=!1,this._execEvent("scrollEnd")))},_start:function(a){if((1==f.eventType[a.type]||0===a.button)&&this.enabled&&(!this.initiated||f.eventType[a.type]===this.initiated)){!this.options.preventDefault||f.isBadAndroid||f.preventDefaultException(a.target,this.options.preventDefaultException)||a.preventDefault();var b,d=a.touches?a.touches[0]:a;this.initiated=f.eventType[a.type],this.moved=!1,this.distX=0,this.distY=0,this.directionX=0,this.directionY=0,this.directionLocked=0,
//this._transitionTime(),this.startTime=f.getTime(),this.options.useTransition&&this.isInTransition?(this.isInTransition=!1,b=this.getComputedPosition(),this._translate(c.round(b.x),c.round(b.y)),this._execEvent("scrollEnd")):!this.options.useTransition&&this.isAnimating&&(this.isAnimating=!1,this._execEvent("scrollEnd")),this.startX=this.x,this.startY=this.y,this.absStartX=this.x,this.absStartY=this.y,this.pointX=d.pageX,this.pointY=d.pageY,this._execEvent("beforeScrollStart")}},_move:function(a){if(this.enabled&&f.eventType[a.type]===this.initiated){this.options.preventDefault&&a.preventDefault();var b,d,e,g,h=a.touches?a.touches[0]:a,i=h.pageX-this.pointX,j=h.pageY-this.pointY,k=f.getTime();if(this.pointX=h.pageX,this.pointY=h.pageY,this.distX+=i,this.distY+=j,e=c.abs(this.distX),g=c.abs(this.distY),!(k-this.endTime>300&&10>e&&10>g)){if(this.directionLocked||this.options.freeScroll||(e>g+this.options.directionLockThreshold?this.directionLocked="h":g>=e+this.options.directionLockThreshold?this.directionLocked="v":this.directionLocked="n"),"h"==this.directionLocked){if("vertical"==this.options.eventPassthrough)a.preventDefault();else if("horizontal"==this.options.eventPassthrough)return void(this.initiated=!1);j=0}else if("v"==this.directionLocked){if("horizontal"==this.options.eventPassthrough)a.preventDefault();else if("vertical"==this.options.eventPassthrough)return void(this.initiated=!1);i=0}i=this.hasHorizontalScroll?i:0,j=this.hasVerticalScroll?j:0,b=this.x+i,d=this.y+j,(b>0||b<this.maxScrollX)&&(b=this.options.bounce?this.x+i/3:b>0?0:this.maxScrollX),(d>0||d<this.maxScrollY)&&(d=this.options.bounce?this.y+j/3:d>0?0:this.maxScrollY),this.directionX=i>0?-1:0>i?1:0,this.directionY=j>0?-1:0>j?1:0,this.moved||this._execEvent("scrollStart"),this.moved=!0,this._translate(b,d),k-this.startTime>300&&(this.startTime=k,this.startX=this.x,this.startY=this.y)}}},_end:function(a){if(this.enabled&&f.eventType[a.type]===this.initiated){this.options.preventDefault&&!f.preventDefaultException(a.target,this.options.preventDefaultException)&&a.preventDefault();var b,d,e=(a.changedTouches?a.changedTouches[0]:a,f.getTime()-this.startTime),g=c.round(this.x),h=c.round(this.y),i=c.abs(g-this.startX),j=c.abs(h-this.startY),k=0,l="";if(this.isInTransition=0,this.initiated=0,this.endTime=f.getTime(),!this.resetPosition(this.options.bounceTime))return this.scrollTo(g,h),this.moved?this._events.flick&&200>e&&100>i&&100>j?void this._execEvent("flick"):(this.options.momentum&&300>e&&(b=this.hasHorizontalScroll?f.momentum(this.x,this.startX,e,this.maxScrollX,this.options.bounce?this.wrapperWidth:0,this.options.deceleration):{destination:g,duration:0},d=this.hasVerticalScroll?f.momentum(this.y,this.startY,e,this.maxScrollY,this.options.bounce?this.wrapperHeight:0,this.options.deceleration):{destination:h,duration:0},g=b.destination,h=d.destination,k=c.max(b.duration,d.duration),this.isInTransition=1),g!=this.x||h!=this.y?((g>0||g<this.maxScrollX||h>0||h<this.maxScrollY)&&(l=f.ease.quadratic),void this.scrollTo(g,h,k,l)):void this._execEvent("scrollEnd")):(this.options.tap&&f.tap(a,this.options.tap),this.options.click&&f.click(a),void this._execEvent("scrollCancel"))}},_resize:function(){var a=this;clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){a.refresh()},this.options.resizePolling)},resetPosition:function(a){var b=this.x,c=this.y;return a=a||0,!this.hasHorizontalScroll||this.x>0?b=0:this.x<this.maxScrollX&&(b=this.maxScrollX),!this.hasVerticalScroll||this.y>0?c=0:this.y<this.maxScrollY&&(c=this.maxScrollY),b==this.x&&c==this.y?!1:(this.scrollTo(b,c,a,this.options.bounceEasing),!0)},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0},refresh:function(){this.wrapper.offsetHeight;this.wrapperWidth=this.wrapper.clientWidth,this.wrapperHeight=this.wrapper.clientHeight,this.scrollerWidth=this.scroller.offsetWidth,this.scrollerHeight=this.scroller.offsetHeight,this.maxScrollX=this.wrapperWidth-this.scrollerWidth,this.maxScrollY=this.wrapperHeight-this.scrollerHeight,this.hasHorizontalScroll=this.options.scrollX&&this.maxScrollX<0,this.hasVerticalScroll=this.options.scrollY&&this.maxScrollY<0,this.hasHorizontalScroll||(this.maxScrollX=0,this.scrollerWidth=this.wrapperWidth),this.hasVerticalScroll||(this.maxScrollY=0,this.scrollerHeight=this.wrapperHeight),this.endTime=0,this.directionX=0,this.directionY=0,this.wrapperOffset=f.offset(this.wrapper),this._execEvent("refresh"),this.resetPosition()},on:function(a,b){this._events[a]||(this._events[a]=[]),this._events[a].push(b)},off:function(a,b){if(this._events[a]){var c=this._events[a].indexOf(b);c>-1&&this._events[a].splice(c,1)}},_execEvent:function(a){if(this._events[a]){var b=0,c=this._events[a].length;if(c)for(;c>b;b++)this._events[a][b].apply(this,[].slice.call(arguments,1))}},scrollBy:function(a,b,c,d){a=this.x+a,b=this.y+b,c=c||0,this.scrollTo(a,b,c,d)},scrollTo:function(a,b,c,d){d=d||f.ease.circular,this.isInTransition=this.options.useTransition&&c>0,!c||this.options.useTransition&&d.style?(this._transitionTimingFunction(d.style),this._transitionTime(c),this._translate(a,b)):this._animate(a,b,c,d.fn)},scrollToElement:function(a,b,d,e,g){if(a=a.nodeType?a:this.scroller.querySelector(a)){var h=f.offset(a);h.left-=this.wrapperOffset.left,h.top-=this.wrapperOffset.top,d===!0&&(d=c.round(a.offsetWidth/2-this.wrapper.offsetWidth/2)),e===!0&&(e=c.round(a.offsetHeight/2-this.wrapper.offsetHeight/2)),h.left-=d||0,h.top-=e||0,h.left=h.left>0?0:h.left<this.maxScrollX?this.maxScrollX:h.left,h.top=h.top>0?0:h.top<this.maxScrollY?this.maxScrollY:h.top,b=void 0===b||null===b||"auto"===b?c.max(c.abs(this.x-h.left),c.abs(this.y-h.top)):b,this.scrollTo(h.left,h.top,b,g)}},_transitionTime:function(a){a=a||0,this.scrollerStyle[f.style.transitionDuration]=a+"ms",!a&&f.isBadAndroid&&(this.scrollerStyle[f.style.transitionDuration]="0.001s")},_transitionTimingFunction:function(a){this.scrollerStyle[f.style.transitionTimingFunction]=a},_translate:function(a,b){this.options.useTransform?this.scrollerStyle[f.style.transform]="translate("+a+"px,"+b+"px)"+this.translateZ:(a=c.round(a),b=c.round(b),this.scrollerStyle.left=a+"px",this.scrollerStyle.top=b+"px"),this.x=a,this.y=b},_initEvents:function(b){var c=b?f.removeEvent:f.addEvent,d=this.options.bindToWrapper?this.wrapper:a;c(a,"orientationchange",this),c(a,"resize",this),this.options.click&&c(this.wrapper,"click",this,!0),this.options.disableMouse||(c(this.wrapper,"mousedown",this),c(d,"mousemove",this),c(d,"mousecancel",this),c(d,"mouseup",this)),f.hasPointer&&!this.options.disablePointer&&(c(this.wrapper,f.prefixPointerEvent("pointerdown"),this),c(d,f.prefixPointerEvent("pointermove"),this),c(d,f.prefixPointerEvent("pointercancel"),this),c(d,f.prefixPointerEvent("pointerup"),this)),f.hasTouch&&!this.options.disableTouch&&(c(this.wrapper,"touchstart",this),c(d,"touchmove",this),c(d,"touchcancel",this),c(d,"touchend",this)),c(this.scroller,"transitionend",this),c(this.scroller,"webkitTransitionEnd",this),c(this.scroller,"oTransitionEnd",this),c(this.scroller,"MSTransitionEnd",this)},getComputedPosition:function(){var b,c,d=a.getComputedStyle(this.scroller,null);return this.options.useTransform?(d=d[f.style.transform].split(")")[0].split(", "),b=+(d[12]||d[4]),c=+(d[13]||d[5])):(b=+d.left.replace(/[^-\d.]/g,""),c=+d.top.replace(/[^-\d.]/g,"")),{x:b,y:c}},_initWheel:function(){f.addEvent(this.wrapper,"wheel",this),f.addEvent(this.wrapper,"mousewheel",this),f.addEvent(this.wrapper,"DOMMouseScroll",this),this.on("destroy",function(){f.removeEvent(this.wrapper,"wheel",this),f.removeEvent(this.wrapper,"mousewheel",this),f.removeEvent(this.wrapper,"DOMMouseScroll",this)})},_wheel:function(a){if(this.enabled){a.preventDefault(),a.stopPropagation();var b,d,e,f,g=this;if(void 0===this.wheelTimeout&&g._execEvent("scrollStart"),clearTimeout(this.wheelTimeout),this.wheelTimeout=setTimeout(function(){g._execEvent("scrollEnd"),g.wheelTimeout=void 0},400),"deltaX"in a)1===a.deltaMode?(b=-a.deltaX*this.options.mouseWheelSpeed,d=-a.deltaY*this.options.mouseWheelSpeed):(b=-a.deltaX,d=-a.deltaY);else if("wheelDeltaX"in a)b=a.wheelDeltaX/120*this.options.mouseWheelSpeed,d=a.wheelDeltaY/120*this.options.mouseWheelSpeed;else if("wheelDelta"in a)b=d=a.wheelDelta/120*this.options.mouseWheelSpeed;else{if(!("detail"in a))return;b=d=-a.detail/3*this.options.mouseWheelSpeed}if(b*=this.options.invertWheelDirection,d*=this.options.invertWheelDirection,this.hasVerticalScroll||(b=d,d=0),this.options.snap)return e=this.currentPage.pageX,f=this.currentPage.pageY,b>0?e--:0>b&&e++,d>0?f--:0>d&&f++,void this.goToPage(e,f);e=this.x+c.round(this.hasHorizontalScroll?b:0),f=this.y+c.round(this.hasVerticalScroll?d:0),e>0?e=0:e<this.maxScrollX&&(e=this.maxScrollX),f>0?f=0:f<this.maxScrollY&&(f=this.maxScrollY),this.scrollTo(e,f,0)}},_animate:function(a,b,c,d){function g(){var m,n,o,p=f.getTime();return p>=l?(h.isAnimating=!1,h._translate(a,b),void(h.resetPosition(h.options.bounceTime)||h._execEvent("scrollEnd"))):(p=(p-k)/c,o=d(p),m=(a-i)*o+i,n=(b-j)*o+j,h._translate(m,n),void(h.isAnimating&&e(g)))}var h=this,i=this.x,j=this.y,k=f.getTime(),l=k+c;this.isAnimating=!0,g()},handleEvent:function(a){switch(a.type){case"touchstart":case"pointerdown":case"MSPointerDown":case"mousedown":this._start(a);break;case"touchmove":case"pointermove":case"MSPointerMove":case"mousemove":this._move(a);break;case"touchend":case"pointerup":case"MSPointerUp":case"mouseup":case"touchcancel":case"pointercancel":case"MSPointerCancel":case"mousecancel":this._end(a);break;case"orientationchange":case"resize":this._resize();break;case"transitionend":case"webkitTransitionEnd":case"oTransitionEnd":case"MSTransitionEnd":this._transitionEnd(a);break;case"wheel":case"DOMMouseScroll":case"mousewheel":this._wheel(a);break;case"keydown":this._key(a);break;case"click":a._constructed||(a.preventDefault(),a.stopPropagation())}}},d.utils=f,"undefined"!=typeof module&&module.exports?module.exports=d:a.IScroll=d}(window,document,Math),!function(a){"use strict";var b="drawer",c="undefined"!=typeof document.ontouchstart,d={init:function(c){return c=a.extend({mastaClass:"drawer-main",toggleClass:"drawer-toggle",upperClass:"drawer-overlay-upper",openClass:"drawer-open",closeClass:"drawer-close",apiToggleClass:"drawer-api-toggle",responsiveClass:"drawer-responsive",dropdownClass:"dropdown",dropdownShown:"shown.bs.dropdown",dropdownHidden:"hidden.bs.dropdown"},c),this.each(function(){var e=this,f=a(this),g=f.data(b),h=a("<div>").addClass(c.upperClass+" "+c.toggleClass);g||(c=a.extend({},c),f.data(b,{options:c})),f.append(h);var i=new IScroll("."+c.mastaClass,{mouseWheel:!0,preventDefault:!1});a("."+c.toggleClass+", ."+c.apiToggleClass).off("click."+b).on("click."+b,function(){d.toggle.call(e),i.refresh()}),a(window).resize(function(){d.close.call(e),i.refresh()}),a("."+c.dropdownClass).on(c.dropdownShown,function(){i.refresh()}).on(c.dropdownHidden,function(){i.refresh()})})},toggle:function(c){var e=this,f=a(this);c=f.data(b).options;var g=f.hasClass(c.openClass);g?d.close.call(e):d.open.call(e)},open:function(d){var e=a(this);d=e.data(b).options,c&&e.on("touchmove."+b,function(a){a.preventDefault()}),e.removeClass(d.closeClass).addClass(d.openClass).transitionEnd(function(){e.css({overflow:"hidden"}).trigger("drawer.opened")})},close:function(d){var e=a(this);d=e.data(b).options,c&&e.off("touchmove."+b),e.removeClass(d.openClass).addClass(d.closeClass).transitionEnd(function(){e.css({overflow:"auto"}).trigger("drawer.closed")})},destroy:function(){return this.each(function(){var c=a(this);a(window).unbind("."+b),c.removeData(b)})}};a.fn.drawer=function(c){return d[c]?d[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof c&&c?void a.error("Method "+c+" does not exist on jQuery."+b):d.init.apply(this,arguments)}}(jQuery),function(a){"use strict";a.fn.transitionEnd=function(b){var c="transitionend webkitTransitionEnd mozTransitionEnd oTransitionEnd MSTransitionEnd";return this.each(function(){a(this).bind(c,function(){return a(this).unbind(c),b.call(this)})})}}(jQuery),function(a){function b(a,b,c){this._setOption(b,c),this._setMessage(),this._setCssClass(),this._setProp(),this._setElem(a),this._setButtonAttrDefault(),this._setButtonPosition(),this._setInitRecord(),this._ehButton(),this._ehComboInput(),this._ehWhole(),this._ehTextArea(),this.option.shorten_btn&&this._findUrlToShorten(this)}a.fn.ajaxComboBox=function(c,d){var e=[];return this.each(function(){e.push(new b(this,c,d))}),void 0!=d&&void 0!=d.instance&&d.instance?a(e):this},a.extend(b.prototype,{_setOption:function(a,b){b=this._setOption1st(a,b),b=this._setOption2nd(b),this.option=b},_setOption1st:function(b,c){return a.extend({source:b,lang:"en",plugin_type:"combobox",init_record:!1,db_table:"tbl",field:"name",and_or:"AND",per_page:10,navi_num:5,primary_key:"id",button_img:"/assets/images/btn.png",bind_to:!1,navi_simple:!1,sub_info:!1,sub_as:{},show_field:"",hide_field:"",select_only:!1,tags:!1,shorten_btn:!1,shorten_src:"lib/bitly.php",shorten_min:20,shorten_reg:!1},c)},_setOption2nd:function(a){a.search_field=void 0==a.search_field?a.field:a.search_field,a.and_or=a.and_or.toUpperCase();for(var b=["hide_field","show_field","search_field"],c=0;c<b.length;c++)a[b[c]]=this._strToArray(a[b[c]]);return a.order_by=void 0==a.order_by?a.search_field:a.order_by,a.order_by=this._setOrderbyOption(a.order_by,a.field),"textarea"==a.plugin_type&&(a.shorten_reg=this._setRegExpShort(a.shorten_reg,a.shorten_min)),a.tags&&(a.tags=this._setTagPattern(a)),a},_strToArray:function(a){return a.replace(/[\s　]+/g,"").split(",")},_setRegExpShort:function(a,b){if(a)return a;var c="(?:^|[\\s|　\\[(<「『（【［＜〈《]+)";return c+="(",c+="https:\\/\\/[^\\s|　\\])>」』）】］＞〉》]{"+(b-7)+",}",c+="|",c+="http:\\/\\/[^\\s|　\\])>」』）】］＞〉》]{"+(b-6)+",}",c+="|",c+="ftp:\\/\\/[^\\s|　\\])>」』）】］＞〉》]{"+(b-5)+",}",c+=")",new RegExp(c,"g")},_setTagPattern:function(a){for(var b=0;b<a.tags.length;b++)a.tags[b]=this._setTagOptions(a,b),a.tags[b].pattern=this._setRegExpTag(a.tags[b].pattern,a.tags[b].space);return a.tags},_setTagOptions:function(b,c){b.tags[c]=a.extend({space:[!0,!0],db_table:b.db_table,field:b.field,search_field:b.search_field,primary_key:b.primary_key,sub_info:b.sub_info,sub_as:b.sub_as,show_field:b.show_field,hide_field:b.hide_field},b.tags[c]);for(var d=["hide_field","show_field","search_field"],e=0;e<d.length;e++)"object"!=typeof b.tags[c][d[e]]&&(b.tags[c][d[e]]=this._strToArray(b.tags[c][d[e]]));return b.tags[c].order_by=void 0==b.tags[c].order_by?b.order_by:this._setOrderbyOption(b.tags[c].order_by,b.tags[c].field),b.tags[c]},_setRegExpTag:function(a,b){var c=a[0].replace(/[\s\S]*/,this._escapeForReg),d=a[1].replace(/[\s\S]*/,this._escapeForReg);return{left:a[0],right:a[1],reg_left:new RegExp(c+"((?:(?!"+c+"|"+d+")[^\\s　])*)$"),reg_right:new RegExp("^((?:(?!"+c+"|"+d+")[^\\s　])+)"),space_left:new RegExp("^"+c+"$|[\\s　]+"+c+"$"),space_right:new RegExp("^$|^[\\s　]+"),comp_right:new RegExp("^"+d)}},_escapeForReg:function(a){return"\\u"+(65536+a.charCodeAt(0)).toString(16).slice(1)},_setOrderbyOption:function(b,c){var d=[];if("object"==typeof b)for(var e=0;e<b.length;e++){var f=a.trim(b[e]).split(" ");d[e]=2==f.length?f:[f[0],"ASC"]}else{var f=a.trim(b).split(" ");d[0]=2==f.length?f:f[0].match(/^(ASC|DESC)$/i)?[c,f[0]]:[f[0],"ASC"]}return d},_setMessage:function(){var a;switch(this.option.lang){case"de":a={add_btn:"Hinzufügen-Button",add_title:"Box hinzufügen",del_btn:"Löschen-Button",del_title:"Box löschen",next:"Nächsten",next_title:"Nächsten"+this.option.per_page+" (Pfeil-rechts)",prev:"Vorherigen",prev_title:"Vorherigen"+this.option.per_page+" (Pfeil-links)",first_title:"Ersten (Umschalt + Pfeil-links)",last_title:"Letzten (Umschalt + Pfeil-rechts)",get_all_btn:"alle (Pfeil-runter)",get_all_alt:"(Button)",close_btn:"Schließen (Tab)",close_alt:"(Button)",loading:"lade...",loading_alt:"(lade)",page_info:"num_page_top - num_page_end von cnt_whole",page_info_null:"New Entry",select_ng:"Achtung: Bitte wählen Sie aus der Liste aus.",select_ok:"OK : Richtig ausgewählt.",not_found:"nicht gefunden",ajax_error:"Bei der Verbindung zum Server ist ein Fehler aufgetreten. (ajax-combobox)"};break;case"en":a={add_btn:"Add button",add_title:"add a box",del_btn:"Del button",del_title:"delete a box",next:"Next",next_title:"Next"+this.option.per_page+" (Right key)",prev:"Prev",prev_title:"Prev"+this.option.per_page+" (Left key)",first_title:"First (Shift + Left key)",last_title:"Last (Shift + Right key)",get_all_btn:"Get All (Down key)",get_all_alt:"(button)",close_btn:"Close (Tab key)",close_alt:"(button)",loading:"loading...",loading_alt:"(loading)",page_info:"num_page_top - num_page_end of cnt_whole",page_info_null:"New Entry",select_ng:"Attention : Please choose from among the list.",select_ok:"OK : Correctly selected.",not_found:"not found",ajax_error:"An error occurred while connecting to server. (ajax-combobox)"};break;case"es":a={add_btn:"Agregar boton",add_title:"Agregar una opcion",del_btn:"Borrar boton",del_title:"Borrar una opcion",next:"Siguiente",next_title:"Proximas "+this.option.per_page+" (tecla derecha)",prev:"Anterior",prev_title:"Anteriores "+this.option.per_page+" (tecla izquierda)",first_title:"Primera (Shift + Left)",last_title:"Ultima (Shift + Right)",get_all_btn:"Ver todos (tecla abajo)",get_all_alt:"(boton)",close_btn:"Cerrar (tecla TAB)",close_alt:"(boton)",loading:"Cargando...",loading_alt:"(Cargando)",page_info:"num_page_top - num_page_end de cnt_whole",page_info_null:"New Entry",select_ng:"Atencion: Elija una opcion de la lista.",select_ok:"OK: Correctamente seleccionado.",not_found:"no encuentre",ajax_error:"Un error ocurrió mientras conectando al servidor. (ajax-combobox)"};break;case"pt-br":a={add_btn:"Adicionar botão",add_title:"Adicionar uma caixa",del_btn:"Apagar botão",del_title:"Apagar uma caixa",next:"Próxima",next_title:"Próxima "+this.option.per_page+" (tecla direita)",prev:"Anterior",prev_title:"Anterior "+this.option.per_page+" (tecla esquerda)",first_title:"Primeira (Shift + Left)",last_title:"Última (Shift + Right)",get_all_btn:"Ver todos (Seta para baixo)",get_all_alt:"(botão)",close_btn:"Fechar (tecla TAB)",close_alt:"(botão)",loading:"Carregando...",loading_alt:"(Carregando)",page_info:"num_page_top - num_page_end de cnt_whole",page_info_null:"New Entry",select_ng:"Atenção: Escolha uma opção da lista.",select_ok:"OK: Selecionado Corretamente.",not_found:"não encontrado",ajax_error:"Um erro aconteceu enquanto conectando a servidor. (ajax-combobox)"};break;default:a={add_btn:"追加ボタン",add_title:"入力ボックスを追加します",del_btn:"削除ボタン",del_title:"入力ボックスを削除します",next:"次へ",next_title:"次の"+this.option.per_page+"件 (右キー)",prev:"前へ",prev_title:"前の"+this.option.per_page+"件 (左キー)",first_title:"最初のページへ (Shift + 左キー)",last_title:"最後のページへ (Shift + 右キー)",get_all_btn:"全件取得 (下キー)",get_all_alt:"画像:ボタン",close_btn:"閉じる (Tabキー)",close_alt:"画像:ボタン",loading:"読み込み中...",loading_alt:"画像:読み込み中...",page_info:"num_page_top - num_page_end 件 (全 cnt_whole 件)",page_info_null:"New Entry",select_ng:"注意 : リストの中から選択してください",select_ok:"OK : 正しく選択されました。",not_found:"(0 件)",ajax_error:"サーバとの通信でエラーが発生しました。(ajax-combobox)"}}this.message=a},_setCssClass:function(){var b={container:"ac_container",container_open:"ac_container_open",selected:"ac_selected",re_area:"ac_result_area",navi:"ac_navi",results:"ac_results",re_off:"ac_results_off",select:"ac_over",sub_info:"ac_subinfo",select_ok:"ac_select_ok",select_ng:"ac_select_ng",input_off:"ac_input_off"};switch(this.option.plugin_type){case"combobox":b=a.extend(b,{button:"ac_button",btn_on:"ac_btn_on",btn_out:"ac_btn_out",input:"ac_input"});break;case"simple":b=a.extend(b,{input:"ac_s_input"});break;case"textarea":b=a.extend(b,{input:"ac_textarea",btn_short_off:"ac_btn_short_off"})}this.css_class=b},_setProp:function(){this.prop={timer_valchange:!1,is_suggest:!1,page_all:1,page_suggest:1,max_all:1,max_suggest:1,is_paging:!1,is_loading:!1,reserve_btn:!1,reserve_click:!1,xhr:!1,key_paging:!1,key_select:!1,prev_value:"",size_navi:null,size_results:null,size_li:null,size_left:null,tag:null}},_setElem:function(b){var c={};if(c.combo_input=a(b).attr("autocomplete","off").addClass(this.css_class.input).wrap("<div>"),c.container=a(c.combo_input).parent().addClass(this.css_class.container),"combobox"==this.option.plugin_type?(c.button=a("<div>").addClass(this.css_class.button),c.img=a("<img>").attr("src",this.option.button_img)):(c.button=!1,c.img=!1),c.result_area=a("<div>").addClass(this.css_class.re_area),c.navi=a("<div>").addClass(this.css_class.navi),c.navi_info=a("<div>").addClass("info"),c.navi_p=a("<p>"),c.results=a("<ul>").addClass(this.css_class.results),c.sub_info=a("<div>").addClass(this.css_class.sub_info),"textarea"==this.option.plugin_type)c.hidden=!1;else{var d=void 0!=a(c.combo_input).attr("name")?a(c.combo_input).attr("name"):a(c.combo_input).attr("id");d.match(/\]$/)?d=d.replace(/\]?$/,"_primary_key]"):d+="_primary_key",c.hidden=a('<input type="hidden" />').attr({name:d,id:d}).val("")}switch(this.option.plugin_type){case"combobox":a(c.container).append(c.button).append(c.result_area).append(c.hidden),a(c.button).append(c.img);break;case"simple":a(c.container).append(c.result_area).append(c.hidden);break;case"textarea":a(c.container).append(c.result_area)}a(c.result_area).append(c.navi).append(c.results).append(c.sub_info),a(c.navi).append(c.navi_info).append(c.navi_p),"combobox"==this.option.plugin_type&&a(c.button).height(a(c.combo_input).innerHeight()),this.elem=c},_setButtonAttrDefault:function(){this.option.select_only&&(""!=a(this.elem.combo_input).val()?"textarea"!=this.option.plugin_type&&(""!=a(this.elem.hidden).val()?a(this.elem.combo_input).attr("title",this.message.select_ok).removeClass(this.css_class.select_ng).addClass(this.css_class.select_ok):a(this.elem.combo_input).attr("title",this.message.select_ng).removeClass(this.css_class.select_ok).addClass(this.css_class.select_ng)):("textarea"!=this.option.plugin_type&&a(this.elem.hidden).val(""),a(this.elem.combo_input).removeAttr("title").removeClass(this.css_class.select_ng))),"combobox"==this.option.plugin_type&&(a(this.elem.button).attr("title",this.message.get_all_btn),a(this.elem.img).attr("src",this.option.button_img))},_setInitRecord:function(){if(this.option.init_record!==!1)if("textarea"!=this.option.plugin_type&&a(this.elem.hidden).val(this.option.init_record),"object"==typeof this.option.source){for(var b=0;b<this.option.source.length;b++)if(this.option.source[b][this.option.primary_key]==this.option.init_record){var c=this.option.source[b];break}this._afterInit(this,c)}else{var d=this;a.ajax({dataType:"json",url:d.option.source,data:{db_table:this.option.db_table,pkey_name:this.option.primary_key,pkey_val:this.option.init_record},success:function(a){d._afterInit(d,a)},error:function(a,b,c){d._ajaxErrorNotify(d,c)}})}},_afterInit:function(b,c){a(b.elem.combo_input).val(c[b.option.field]),"textarea"!=b.option.plugin_type&&a(b.elem.hidden).val(c[b.option.primary_key]),b.prop.prev_value=c[b.option.field],b.option.select_only&&a(b.elem.combo_input).attr("title",b.message.select_ok).removeClass(b.css_class.select_ng).addClass(b.css_class.select_ok)},_ehButton:function(){if("combobox"==this.option.plugin_type){var b=this;a(b.elem.button).mouseup(function(c){a(b.elem.result_area).is(":hidden")?(clearInterval(b.prop.timer_valchange),b.prop.is_suggest=!1,b._suggest(b),a(b.elem.combo_input).focus()):b._hideResults(b),c.stopPropagation()}).mouseover(function(){a(b.elem.button).addClass(b.css_class.btn_on).removeClass(b.css_class.btn_out)}).mouseout(function(){a(b.elem.button).addClass(b.css_class.btn_out).removeClass(b.css_class.btn_on)}).mouseout()}},_ehComboInput:function(){var b=this;a(b.elem.combo_input).keydown(function(a){b._processKey(b,a)}),a(b.elem.combo_input).focus(function(){b._setTimerCheckValue(b)}).click(function(){b._setCssFocusedInput(b),a(b.elem.results).children("li").removeClass(b.css_class.select)})},_ehWhole:function(){var b=this,c=!1;a(b.elem.container).mousedown(function(){c=!0}),a("html").mousedown(function(){c?c=!1:b._hideResults(b)})},_ehResults:function(){var b=this;a(b.elem.results).children("li").mouseover(function(){return b.prop.key_select?void(b.prop.key_select=!1):(b._setSubInfo(b,this),a(b.elem.results).children("li").removeClass(b.css_class.select),a(this).addClass(b.css_class.select),void b._setCssFocusedResults(b))}).click(function(a){return b.prop.key_select?void(b.prop.key_select=!1):(a.preventDefault(),a.stopPropagation(),void b._selectCurrentLine(b,!1))})},_ehNaviPaging:function(b){a(b.elem.navi).find(".navi_first").mouseup(function(c){a(b.elem.combo_input).focus(),c.preventDefault(),b._firstPage(b)}),a(b.elem.navi).find(".navi_prev").mouseup(function(c){a(b.elem.combo_input).focus(),c.preventDefault(),b._prevPage(b)}),a(b.elem.navi).find(".navi_page").mouseup(function(c){a(b.elem.combo_input).focus(),c.preventDefault(),b.prop.is_suggest?b.prop.page_suggest=parseInt(a(this).text(),10):b.prop.page_all=parseInt(a(this).text(),10),b.prop.is_paging=!0,b._suggest(b)}),a(b.elem.navi).find(".navi_next").mouseup(function(c){a(b.elem.combo_input).focus(),c.preventDefault(),b._nextPage(b)}),a(b.elem.navi).find(".navi_last").mouseup(function(c){a(b.elem.combo_input).focus(),c.preventDefault(),b._lastPage(b)})},_ehTextArea:function(){var b=this;b.option.shorten_btn&&a(b.option.shorten_btn).click(function(){b._getShortURL(b)})},_getShortURL:function(b){a(b.elem.combo_input).attr("disabled","disabled");for(var c=a(b.elem.combo_input).val(),d=[],e=null;null!=(e=b.option.shorten_reg.exec(c));)d[d.length]=e[1];if(d.length<1)return void a(b.elem.combo_input).removeAttr("disabled");for(var f={},g=0;g<d.length;g++)f["p_"+g]=d[g];a.ajax({dataType:"json",url:b.option.shorten_src,data:f,success:function(d){var e=0,f=c.replace(b.option.shorten_reg,function(){var a=arguments[0].replace(arguments[1],d[e]);return e++,a});a(b.elem.combo_input).val(f),b.prop.prev_value=f,b._disableButtonShort(b)},error:function(a,c,d){b._ajaxErrorNotify(b,d)},complete:function(){a(b.elem.combo_input).removeAttr("disabled").focus()}})},_ajaxErrorNotify:function(a,b){alert(a.message.ajax_error)},_scrollWindow:function(b,c){var d,e=b._getCurrentLine(b),f=e&&!c?e.offset().top:a(b.elem.container).offset().top;if(b.option.sub_info){var g=a(b.elem.sub_info).children("dl:visible");d=a(g).height()+parseInt(a(g).css("border-top-width"))+parseInt(a(g).css("border-bottom-width"))}else b.prop.size_li=a(b.elem.results).children("li:first").outerHeight(),d=b.prop.size_li;var h,i=a(window).height(),j=a(window).scrollTop(),k=j+i-d;if(a(e).length)if(j>f||d>i)h=f-j;else{if(!(f>k))return;h=f-k}else j>f&&(h=f-j);window.scrollBy(0,h)},_setCssFocusedInput:function(b){a(b.elem.results).addClass(b.css_class.re_off),a(b.elem.combo_input).removeClass(b.css_class.input_off),a(b.elem.sub_info).children("dl").hide()},_setCssFocusedResults:function(b){a(b.elem.results).removeClass(b.css_class.re_off),a(b.elem.combo_input).addClass(b.css_class.input_off)},_enableButtonShort:function(b){a(b.option.shorten_btn).removeClass(b.css_class.btn_short_off).removeAttr("disabled")},_disableButtonShort:function(b){a(b.option.shorten_btn).addClass(b.css_class.btn_short_off).attr("disabled","disabled")},_setTimerCheckValue:function(a){a.prop.timer_valchange=setTimeout(function(){a._checkValue(a)},500)},_checkValue:function(b){var c=a(b.elem.combo_input).val();if(c!=b.prop.prev_value)if(b.prop.prev_value=c,"textarea"==b.option.plugin_type){b._findUrlToShorten(b);var d=b._findTag(b,c);d&&(b._setTextAreaNewSearch(b,d),b._suggest(b))}else a(b.elem.combo_input).removeAttr("sub_info"),"textarea"!=b.option.plugin_type&&a(b.elem.hidden).val(""),b.option.select_only&&b._setButtonAttrDefault(),b.prop.page_suggest=1,b.prop.is_suggest=!0,b._suggest(b);else if("textarea"==b.option.plugin_type&&a(b.elem.result_area).is(":visible")){var e=b._findTag(b,c);e?(e.str!=b.prop.tag.str||e.pos_left!=b.prop.tag.pos_left)&&(b._setTextAreaNewSearch(b,e),b._suggest(b)):b._hideResults(b)}b._setTimerCheckValue(b)},_setTextAreaNewSearch:function(a,b){a.prop.tag=b,a.prop.page_suggest=1,a.option.search_field=a.option.tags[a.prop.tag.type].search_field,a.option.order_by=a.option.tags[a.prop.tag.type].order_by,a.option.primary_key=a.option.tags[a.prop.tag.type].primary_key,a.option.db_table=a.option.tags[a.prop.tag.type].db_table,a.option.field=a.option.tags[a.prop.tag.type].field,a.option.sub_info=a.option.tags[a.prop.tag.type].sub_info,a.option.sub_as=a.option.tags[a.prop.tag.type].sub_as,a.option.show_field=a.option.tags[a.prop.tag.type].show_field,a.option.hide_field=a.option.tags[a.prop.tag.type].hide_field},_findUrlToShorten:function(b){for(var c=null,d=null;null!=(d=b.option.shorten_reg.exec(a(b.elem.combo_input).val()));){c=!0,b.option.shorten_reg.lastIndex=0;break}c?b._enableButtonShort(b):b._disableButtonShort(b)},_findTag:function(b,c){for(var d=b._getCaretPosition(a(b.elem.combo_input).get(0)),e=0;e<b.option.tags.length;e++){var f=c.substring(0,d);if(f=f.match(b.option.tags[e].pattern.reg_left)){f=f[1];var g=d-f.length;0>g&&(g=0);var h=c.substring(d,c.length);if(h=h.match(b.option.tags[e].pattern.reg_right)){h=h[1];var i=d+h.length}else{h="";var i=d}var j=f+""+h;return b.prop.is_suggest=""==j?!1:!0,{type:e,str:j,pos_left:g,pos_right:i}}}return!1},_getCaretPosition:function(a){var b=0;if(document.selection){a.focus();var c=document.selection.createRange();c.moveStart("character",-a.value.length),b=c.text.length}else(a.selectionStart||"0"==a.selectionStart)&&(b=a.selectionStart);return b},_setCaretPosition:function(b,c){var d=a(b.elem.combo_input).get(0);if(d.setSelectionRange)d.focus(),d.setSelectionRange(c,c);else if(d.createTextRange){var e=d.createTextRange();e.collapse(!0),e.moveEnd("character",c),e.moveStart("character",c),e.select()}},_processKey:function(b,c){if(a.inArray(c.keyCode,[27,38,40,9])>-1&&a(b.elem.result_area).is(":visible")||a.inArray(c.keyCode,[37,39,13,9])>-1&&b._getCurrentLine(b)||40==c.keyCode&&"textarea"!=b.option.plugin_type)switch(c.preventDefault(),c.stopPropagation(),c.cancelBubble=!0,c.returnValue=!1,c.keyCode){case 37:c.shiftKey?b._firstPage(b):b._prevPage(b);break;case 38:b.prop.key_select=!0,b._prevLine(b);break;case 39:c.shiftKey?b._lastPage(b):b._nextPage(b);break;case 40:a(b.elem.results).children("li").length?(b.prop.key_select=!0,b._nextLine(b)):(b.prop.is_suggest=!1,b._suggest(b));break;case 9:b.prop.key_paging=!0,b._hideResults(b);break;case 13:b._selectCurrentLine(b,!0);break;case 27:b.prop.key_paging=!0,b._hideResults(b)}else 16!=c.keyCode&&b._setCssFocusedInput(b),b._checkValue(b)},_abortAjax:function(a){a.prop.xhr&&(a.prop.xhr.abort(),a.prop.xhr=!1)},_suggest:function(b){if("textarea"!=b.option.plugin_type){var c=b.prop.is_suggest?a.trim(a(b.elem.combo_input).val()):"";if(c.length<1&&b.prop.is_suggest)return void b._hideResults(b);c=c.split(/[\s　]+/)}else var c=[b.prop.tag.str];if(b._abortAjax(b),b._setLoading(b),a(b.elem.sub_info).children("dl").hide(),b.prop.is_paging){var d=b._getCurrentLine(b);b.prop.is_paging=d?a(b.elem.results).children("li").index(d):-1}else b.prop.is_suggest||(b.prop.is_paging=0);var e=b.prop.is_suggest?b.prop.page_suggest:b.prop.page_all;"object"==typeof b.option.source?b._searchForJson(b,c,e):b._searchForDb(b,c,e)},_setLoading:function(b){a(b.elem.navi_info).text(b.message.loading),""==a(b.elem.results).html()&&(a(b.elem.navi).children("p").empty(),b._calcWidthResults(b),a(b.elem.container).addClass(b.css_class.container_open))},_searchForDb:function(b,c,d){b.prop.xhr=a.ajax({dataType:"json",url:b.option.source,data:{q_word:c,page_num:d,per_page:b.option.per_page,search_field:b.option.search_field,and_or:b.option.and_or,order_by:b.option.order_by,db_table:b.option.db_table},success:function(e){if(e.candidate=[],e.primary_key=[],e.subinfo=[],"object"!=typeof e.result)return b.prop.xhr=null,void b._notFoundSearch(b);
//for(e.cnt_page=e.result.length,i=0;i<e.cnt_page;i++){e.subinfo[i]=[];for(key in e.result[i])if(key==b.option.primary_key&&e.primary_key.push(e.result[i][key]),key==b.option.field)e.candidate.push(e.result[i][key]);else if(-1==a.inArray(key,b.option.hide_field)){if(""!=b.option.show_field&&-1==a.inArray("*",b.option.show_field)&&-1==a.inArray(key,b.option.show_field))continue;e.subinfo[i][key]=e.result[i][key]}}delete e.result,b._prepareResults(b,e,c,d)},error:function(a,c,d){"abort"!=c&&(b._hideResults(b),b._ajaxErrorNotify(b,d))},complete:function(){b.prop.xhr=null}})},_searchForJson:function(b,c,d){var e=[],f=[],g=[],h={},i=0,j=[];do f[i]=c[i].replace(/\W/g,"\\$&").toString(),j[i]=new RegExp(f[i],"gi"),i++;while(i<c.length);for(var i=0;i<b.option.source.length;i++){for(var k=!1,l=0;l<j.length;l++)if(b.option.source[i][b.option.field].match(j[l])){if(k=!0,"OR"==b.option.and_or)break}else if(k=!1,"AND"==b.option.and_or)break;k&&e.push(b.option.source[i])}if(void 0==e.length)return void b._notFoundSearch(b);h.cnt_whole=e.length;for(var m=new RegExp("^"+f[0]+"$","gi"),n=new RegExp("^"+f[0],"gi"),o=[],p=[],q=[],i=0;i<e.length;i++)e[i][b.option.order_by[0][0]].match(m)?o.push(e[i]):e[i][b.option.order_by[0][0]].match(n)?p.push(e[i]):q.push(e[i]);b.option.order_by[0][1].match(/^asc$/i)?(o=b._sortAsc(b,o),p=b._sortAsc(b,p),q=b._sortAsc(b,q)):(o=b._sortDesc(b,o),p=b._sortDesc(b,p),q=b._sortDesc(b,q)),g=g.concat(o).concat(p).concat(q);for(var r=(d-1)*b.option.per_page,s=r+b.option.per_page,i=r,t=0;s>i&&void 0!=g[i];i++,t++)for(var u in g[i])if(u==b.option.primary_key&&(void 0==h.primary_key&&(h.primary_key=[]),h.primary_key.push(g[i][u])),u==b.option.field)void 0==h.candidate&&(h.candidate=[]),h.candidate.push(g[i][u]);else if(-1==a.inArray(u,b.option.hide_field)){if(""!=b.option.show_field&&-1==a.inArray("*",b.option.show_field)&&-1==a.inArray(u,b.option.show_field))continue;void 0==h.subinfo&&(h.subinfo=[]),void 0==h.subinfo[t]&&(h.subinfo[t]=[]),h.subinfo[t][u]=g[i][u]}void 0==h.candidate&&(h.candidate=[]),h.cnt_page=h.candidate.length,b._prepareResults(b,h,c,d)},_sortAsc:function(a,b){return b.sort(function(b,c){return b[a.option.order_by[0][0]].localeCompare(c[a.option.order_by[0][0]])}),b},_sortDesc:function(a,b){return b.sort(function(b,c){return c[a.option.order_by[0][0]].localeCompare(b[a.option.order_by[0][0]])}),b},_notFoundSearch:function(b){a(b.elem.navi_info).text(b.message.not_found),a(b.elem.navi_p).hide(),a(b.elem.results).empty(),a(b.elem.sub_info).empty(),b._calcWidthResults(b),a(b.elem.container).addClass(b.css_class.container_open),b._setCssFocusedInput(b)},_prepareResults:function(b,c,d,e){if(b._setNavi(b,c.cnt_whole,c.cnt_page,e),c.subinfo&&b.option.sub_info||(c.subinfo=!1),c.primary_key||(c.primary_key=!1),b.option.select_only&&1===c.candidate.length&&c.candidate[0]==d[0]&&("textarea"!=b.option.plugin_type&&a(b.elem.hidden).val(c.primary_key[0]),this._setButtonAttrDefault()),b._displayResults(b,c.candidate,c.subinfo,c.primary_key),b.prop.is_paging===!1)b._setCssFocusedInput(b);else{var f=b.prop.is_paging,g=a(b.elem.results).children("li").length-1;f>g&&(f=g);var h=a(b.elem.results).children("li").eq(f);a(h).addClass(b.css_class.select),b._setSubInfo(b,h),b.prop.is_paging=!1,b._setCssFocusedResults(b)}},_setNavi:function(b,c,d,e){var f=b.option.per_page*(e-1)+1,g=f+d-1,h=b.message.page_info.replace("cnt_whole",c).replace("num_page_top",f).replace("num_page_end",g),i=b.message.page_info_null;c>0?a(b.elem.navi_info).text(h):a(b.elem.navi_info).text(i);var j=Math.ceil(c/b.option.per_page);if(j>1){a(b.elem.navi_p).empty(),b.prop.is_suggest?b.prop.max_suggest=j:b.prop.max_all=j;for(var k=e-Math.ceil((b.option.navi_num-1)/2),l=e+Math.floor((b.option.navi_num-1)/2);1>k;)k++,l++;for(;l>j;)l--;for(;l-k<b.option.navi_num-1&&k>1;)k--;1==e?(b.option.navi_simple||a("<span>").text("<< 1").addClass("page_end").appendTo(b.elem.navi_p),a("<span>").text(b.message.prev).addClass("page_end").appendTo(b.elem.navi_p)):(b.option.navi_simple||a("<a>").attr({href:"javascript:void(0)","class":"navi_first"}).text("<< 1").attr("title",b.message.first_title).appendTo(b.elem.navi_p),a("<a>").attr({href:"javascript:void(0)","class":"navi_prev",title:b.message.prev_title}).text(b.message.prev).appendTo(b.elem.navi_p));for(var m=k;l>=m;m++){var n=m==e?'<span class="current">'+m+"</span>":m;a("<a>").attr({href:"javascript:void(0)","class":"navi_page"}).html(n).appendTo(b.elem.navi_p)}e==j?(a("<span>").text(b.message.next).addClass("page_end").appendTo(b.elem.navi_p),b.option.navi_simple||a("<span>").text(j+" >>").addClass("page_end").appendTo(b.elem.navi_p)):(a("<a>").attr({href:"javascript:void(0)","class":"navi_next"}).text(b.message.next).attr("title",b.message.next_title).appendTo(b.elem.navi_p),b.option.navi_simple||a("<a>").attr({href:"javascript:void(0)","class":"navi_last"}).text(j+" >>").attr("title",b.message.last_title).appendTo(b.elem.navi_p)),a(b.elem.navi_p).show(),b._ehNaviPaging(b)}else a(b.elem.navi_p).hide()},_setButtonPosition:function(){if("combobox"==this.option.plugin_type){var b=a(this.elem.button).innerWidth(),c=a(this.elem.button).innerHeight(),d=a(this.elem.img).width(),e=a(this.elem.img).height(),f=b/2-d/2,g=c/2-e/2;a(this.elem.img).css({top:g,left:f})}},_setSubInfo:function(b,c){if(b.option.sub_info){b.prop.size_results=(a(b.elem.results).outerHeight()-a(b.elem.results).height())/2,b.prop.size_navi=a(b.elem.navi).outerHeight(),b.prop.size_li=a(b.elem.results).children("li:first").outerHeight(),b.prop.size_left=a(b.elem.results).outerWidth();var d=a(b.elem.results).children("li").index(c);a(b.elem.sub_info).children("dl").hide();var e=0;"none"!=a(b.elem.navi).css("display")&&(e+=b.prop.size_navi),e+=b.prop.size_results+b.prop.size_li*d;var f=b.prop.size_left;e+="px",f+="px",a(b.elem.sub_info).children("dl").eq(d).css({position:"absolute",top:e,left:f,display:"block"})}},_displayResults:function(b,c,d,e){a(b.elem.results).empty(),a(b.elem.sub_info).empty();for(var f=0;f<c.length;f++){var g=a("<li>").text(c[f]).attr({pkey:e[f],title:c[f]});if("textarea"!=b.option.plugin_type&&e[f]==a(b.elem.hidden).val()&&a(g).addClass(b.css_class.selected),a(b.elem.results).append(g),d){var h=[],i=a("<dl>");for(key in d[f]){var j=key.replace("'","\\'");null==d[f][key]?d[f][key]="":d[f][key]+="";var k=d[f][key].replace("'","\\'");if(h.push("'"+j+"':'"+k+"'"),null!=b.option.sub_as[key])var l=b.option.sub_as[key];else var l=key;l=a("<dt>").text(l),"simple"==b.option.sub_info&&a(l).addClass("hide"),i.append(l);var m=a("<dd>").text(d[f][key]);i.append(m)}h="{"+h.join(",")+"}",a(g).attr("sub_info",h),a(b.elem.sub_info).append(i),"simple"==b.option.sub_info&&""==i.children("dd").text()&&i.addClass("ac_dl_empty")}}b._calcWidthResults(b),a(b.elem.container).addClass(b.css_class.container_open),b._ehResults(),"combobox"==b.option.plugin_type&&a(b.elem.button).attr("title",b.message.close_btn)},_calcWidthResults:function(b){if("combobox"==b.option.plugin_type){a(b.elem.combo_input).outerWidth()+a(b.elem.button).outerWidth()}else{a(b.elem.combo_input).outerWidth()}if("static"==a(b.elem.container).css("position")){var c=a(b.elem.combo_input).offset();a(b.elem.result_area).css({top:c.top+a(b.elem.combo_input).outerHeight()+"px",left:c.left+"px"})}else a(b.elem.result_area).css({top:a(b.elem.combo_input).outerHeight()+"px",left:"0px"});a(b.elem.result_area).width(a(b.elem.container).width()-(a(b.elem.result_area).outerWidth()-a(b.elem.result_area).innerWidth())).show()},_hideResults:function(b){b.prop.key_paging&&(b._scrollWindow(b,!0),b.prop.key_paging=!1),b._setCssFocusedInput(b),a(b.elem.results).empty(),a(b.elem.sub_info).empty(),a(b.elem.result_area).hide(),a(b.elem.container).removeClass(b.css_class.container_open),b._abortAjax(b),b._setButtonAttrDefault()},_firstPage:function(a){a.prop.is_suggest?a.prop.page_suggest>1&&(a.prop.page_suggest=1,a.prop.is_paging=!0,a._suggest(a)):a.prop.page_all>1&&(a.prop.page_all=1,a.prop.is_paging=!0,a._suggest(a))},_prevPage:function(a){a.prop.is_suggest?a.prop.page_suggest>1&&(a.prop.page_suggest--,a.prop.is_paging=!0,a._suggest(a)):a.prop.page_all>1&&(a.prop.page_all--,a.prop.is_paging=!0,a._suggest(a))},_nextPage:function(a){a.prop.is_suggest?a.prop.page_suggest<a.prop.max_suggest&&(a.prop.page_suggest++,a.prop.is_paging=!0,a._suggest(a)):a.prop.page_all<a.prop.max_all&&(a.prop.page_all++,a.prop.is_paging=!0,a._suggest(a))},_lastPage:function(a){a.prop.is_suggest?a.prop.page_suggest<a.prop.max_suggest&&(a.prop.page_suggest=a.prop.max_suggest,a.prop.is_paging=!0,a._suggest(a)):a.prop.page_all<a.prop.max_all&&(a.prop.page_all=a.prop.max_all,a.prop.is_paging=!0,a._suggest(a))},_selectCurrentLine:function(b,c){b._scrollWindow(b,!0);var d=b._getCurrentLine(b);if(d){if("textarea"!=b.option.plugin_type)a(b.elem.combo_input).val(a(d).text()),b.option.sub_info&&a(b.elem.combo_input).attr("sub_info",a(d).attr("sub_info")),b.option.select_only&&b._setButtonAttrDefault(),a(b.elem.hidden).val(a(d).attr("pkey"));else{var e=b.prop.prev_value.substring(0,b.prop.tag.pos_left),f=b.prop.prev_value.substring(b.prop.tag.pos_right),g=a(d).text();if(b.option.tags[b.prop.tag.type].space[0]&&!e.match(b.option.tags[b.prop.tag.type].pattern.space_left)){var h=b.option.tags[b.prop.tag.type].pattern.left.length,i=e.length;e=e.substring(0,i-h)+" "+e.substring(i-h)}if(f.match(b.option.tags[b.prop.tag.type].pattern.comp_right)||(f=b.option.tags[b.prop.tag.type].pattern.right+f),b.option.tags[b.prop.tag.type].space[1]&&!f.match(b.option.tags[b.prop.tag.type].pattern.space_right)){var h=b.option.tags[b.prop.tag.type].pattern.right.length;f=f.substring(0,h)+" "+f.substring(h)}a(b.elem.combo_input).val(e+""+g+f);var j=e.length+g.length;b._setCaretPosition(b,j)}b.prop.prev_value=a(b.elem.combo_input).val(),b._hideResults(b)}b.option.bind_to&&a(b.elem.combo_input).trigger(b.option.bind_to,c),a(b.elem.combo_input).focus(),a(b.elem.combo_input).change(),b._setCssFocusedInput(b)},_getCurrentLine:function(b){if(a(b.elem.result_area).is(":hidden"))return!1;var c=a(b.elem.results).children("li."+b.css_class.select);return a(c).length?c:!1},_nextLine:function(b){var c=b._getCurrentLine(b);if(c){var d=a(b.elem.results).children("li").index(c);a(c).removeClass(b.css_class.select)}else var d=-1;if(d++,d<a(b.elem.results).children("li").length){var e=a(b.elem.results).children("li").eq(d);b._setSubInfo(b,e),a(e).addClass(b.css_class.select),b._setCssFocusedResults(b)}else b._setCssFocusedInput(b);b._scrollWindow(b,!1)},_prevLine:function(b){var c=b._getCurrentLine(b);if(c){var d=a(b.elem.results).children("li").index(c);a(c).removeClass(b.css_class.select)}else var d=a(b.elem.results).children("li").length;if(d--,d>-1){var e=a(b.elem.results).children("li").eq(d);b._setSubInfo(b,e),a(e).addClass(b.css_class.select),b._setCssFocusedResults(b)}else b._setCssFocusedInput(b);b._scrollWindow(b,!1)}})}(jQuery),function(a){"function"==typeof define&&define.amd?define(["jquery","moment"],a):"object"==typeof exports&&"undefined"!=typeof module?module.exports=a(require("jquery"),require("moment")):a(jQuery,moment)}(function(a,b){a.dateRangePickerLanguages={"default":{selected:"Selected:",day:"Day",days:"Days",apply:"Close","week-1":"mo","week-2":"tu","week-3":"we","week-4":"th","week-5":"fr","week-6":"sa","week-7":"su","week-number":"W","month-name":["january","february","march","april","may","june","july","august","september","october","november","december"],shortcuts:"Shortcuts","custom-values":"Custom Values",past:"Past",following:"Following",previous:"Previous","prev-week":"Week","prev-month":"Month","prev-year":"Year",next:"Next","next-week":"Week","next-month":"Month","next-year":"Year","less-than":"Date range should not be more than %d days","more-than":"Date range should not be less than %d days","default-more":"Please select a date range longer than %d days","default-single":"Please select a date","default-less":"Please select a date range less than %d days","default-range":"Please select a date range between %d and %d days","default-default":"Please select a date range",time:"Time",hour:"Hour",minute:"Minute"},az:{selected:"Seçildi:",day:" gün",days:" gün",apply:"tətbiq","week-1":"1","week-2":"2","week-3":"3","week-4":"4","week-5":"5","week-6":"6","week-7":"7","month-name":["yanvar","fevral","mart","aprel","may","iyun","iyul","avqust","sentyabr","oktyabr","noyabr","dekabr"],shortcuts:"Qısayollar",past:"Keçmiş",following:"Növbəti",previous:"&nbsp;&nbsp;&nbsp;","prev-week":"Öncəki həftə","prev-month":"Öncəki ay","prev-year":"Öncəki il",next:"&nbsp;&nbsp;&nbsp;","next-week":"Növbəti həftə","next-month":"Növbəti ay","next-year":"Növbəti il","less-than":"Tarix aralığı %d gündən çox olmamalıdır","more-than":"Tarix aralığı %d gündən az olmamalıdır","default-more":"%d gündən çox bir tarix seçin","default-single":"Tarix seçin","default-less":"%d gündən az bir tarix seçin","default-range":"%d və %d gün aralığında tarixlər seçin","default-default":"Tarix aralığı seçin"},cn:{selected:"已选择:",day:"天",days:"天",apply:"确定","week-1":"一","week-2":"二","week-3":"三","week-4":"四","week-5":"五","week-6":"六","week-7":"日","week-number":"周","month-name":["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],shortcuts:"快捷选择",past:"过去",following:"将来",previous:"&nbsp;&nbsp;&nbsp;","prev-week":"上周","prev-month":"上个月","prev-year":"去年",next:"&nbsp;&nbsp;&nbsp;","next-week":"下周","next-month":"下个月","next-year":"明年","less-than":"所选日期范围不能大于%d天","more-than":"所选日期范围不能小于%d天","default-more":"请选择大于%d天的日期范围","default-less":"请选择小于%d天的日期范围","default-range":"请选择%d天到%d天的日期范围","default-single":"请选择一个日期","default-default":"请选择一个日期范围",time:"时间",hour:"小时",minute:"分钟"},cz:{selected:"Vybráno:",day:"Den",days:"Dny",apply:"Zavřít","week-1":"po","week-2":"út","week-3":"st","week-4":"čt","week-5":"pá","week-6":"so","week-7":"ne","month-name":["leden","únor","březen","duben","květen","červen","červenec","srpen","září","říjen","listopad","prosinec"],shortcuts:"Zkratky",past:"po",following:"následující",previous:"předchozí","prev-week":"týden","prev-month":"měsíc","prev-year":"rok",next:"další","next-week":"týden","next-month":"měsíc","next-year":"rok","less-than":"Rozsah data by neměl být větší než %d dnů","more-than":"Rozsah data by neměl být menší než %d dnů","default-more":"Prosím zvolte rozsah data větší než %d dnů","default-single":"Prosím zvolte datum","default-less":"Prosím zvolte rozsah data menší než %d dnů","default-range":"Prosím zvolte rozsah data mezi %d a %d dny","default-default":"Prosím zvolte rozsah data"},de:{selected:"Auswahl:",day:"Tag",days:"Tage",apply:"Schließen","week-1":"mo","week-2":"di","week-3":"mi","week-4":"do","week-5":"fr","week-6":"sa","week-7":"so","month-name":["januar","februar","märz","april","mai","juni","juli","august","september","oktober","november","dezember"],shortcuts:"Schnellwahl",past:"Vorherige",following:"Folgende",previous:"Vorherige","prev-week":"Woche","prev-month":"Monat","prev-year":"Jahr",next:"Nächste","next-week":"Woche","next-month":"Monat","next-year":"Jahr","less-than":"Datumsbereich darf nicht größer sein als %d Tage","more-than":"Datumsbereich darf nicht kleiner sein als %d Tage","default-more":"Bitte mindestens %d Tage auswählen","default-single":"Bitte ein Datum auswählen","default-less":"Bitte weniger als %d Tage auswählen","default-range":"Bitte einen Datumsbereich zwischen %d und %d Tagen auswählen","default-default":"Bitte ein Start- und Enddatum auswählen",Time:"Zeit",hour:"Stunde",minute:"Minute"},es:{selected:"Seleccionado:",day:"Dia",days:"Dias",apply:"Cerrar","week-1":"lu","week-2":"ma","week-3":"mi","week-4":"ju","week-5":"vi","week-6":"sa","week-7":"do","month-name":["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],shortcuts:"Accesos directos",past:"Pasado",following:"Siguiente",previous:"Anterior","prev-week":"Semana","prev-month":"Mes","prev-year":"Año",next:"Siguiente","next-week":"Semana","next-month":"Mes","next-year":"Año","less-than":"El rango no deberia ser mayor de %d dias","more-than":"El rango no deberia ser menor de %d dias","default-more":"Por favor selecciona un rango mayor a %d dias","default-single":"Por favor selecciona un dia","default-less":"Por favor selecciona un rango menor a %d dias","default-range":"Por favor selecciona un rango entre %d y %d dias","default-default":"Por favor selecciona un rango de fechas."},fr:{selected:"Sélection:",day:"Jour",days:"Jours",apply:"Fermer","week-1":"lu","week-2":"ma","week-3":"me","week-4":"je","week-5":"ve","week-6":"sa","week-7":"di","month-name":["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"],shortcuts:"Raccourcis",past:"Passé",following:"Suivant",previous:"Précédent","prev-week":"Semaine","prev-month":"Mois","prev-year":"Année",next:"Suivant","next-week":"Semaine","next-month":"Mois","next-year":"Année","less-than":"L'intervalle ne doit pas être supérieure à %d jours","more-than":"L'intervalle ne doit pas être inférieure à %d jours","default-more":"Merci de choisir une intervalle supérieure à %d jours","default-single":"Merci de choisir une date","default-less":"Merci de choisir une intervalle inférieure %d jours","default-range":"Merci de choisir une intervalle comprise entre %d et %d jours","default-default":"Merci de choisir une date"},hu:{selected:"Kiválasztva:",day:"Nap",days:"Nap",apply:"Ok","week-1":"h","week-2":"k","week-3":"sz","week-4":"cs","week-5":"p","week-6":"sz","week-7":"v","month-name":["január","február","március","április","május","június","július","augusztus","szeptember","október","november","december"],shortcuts:"Gyorsválasztó",past:"Múlt",following:"Következő",previous:"Előző","prev-week":"Hét","prev-month":"Hónap","prev-year":"Év",next:"Következő","next-week":"Hét","next-month":"Hónap","next-year":"Év","less-than":"A kiválasztás nem lehet több %d napnál","more-than":"A kiválasztás nem lehet több %d napnál","default-more":"Válassz ki egy időszakot ami hosszabb mint %d nap","default-single":"Válassz egy napot","default-less":"Válassz ki egy időszakot ami rövidebb mint %d nap","default-range":"Válassz ki egy %d - %d nap hosszú időszakot","default-default":"Válassz ki egy időszakot"},it:{selected:"Selezionati:",day:"Giorno",days:"Giorni",apply:"Chiudi","week-1":"lu","week-2":"ma","week-3":"me","week-4":"gi","week-5":"ve","week-6":"sa","week-7":"do","month-name":["gennaio","febbraio","marzo","aprile","maggio","giugno","luglio","agosto","settembre","ottobre","novembre","dicembre"],shortcuts:"Scorciatoie",past:"Scorso",following:"Successivo",previous:"Precedente","prev-week":"Settimana","prev-month":"Mese","prev-year":"Anno",next:"Prossimo","next-week":"Settimana","next-month":"Mese","next-year":"Anno","less-than":"L'intervallo non dev'essere maggiore di %d giorni","more-than":"L'intervallo non dev'essere minore di %d giorni","default-more":"Seleziona un intervallo maggiore di %d giorni","default-single":"Seleziona una data","default-less":"Seleziona un intervallo minore di %d giorni","default-range":"Seleziona un intervallo compreso tra i %d e i %d giorni","default-default":"Seleziona un intervallo di date"},no:{selected:"Valgt:",day:"Dag",days:"Dager",apply:"Lukk","week-1":"ma","week-2":"ti","week-3":"on","week-4":"to","week-5":"fr","week-6":"lø","week-7":"sø","month-name":["januar","februar","mars","april","mai","juni","juli","august","september","oktober","november","desember"],shortcuts:"Snarveier","custom-values":"Egendefinerte Verdier",past:"Over",following:"Følger",previous:"Forrige","prev-week":"Uke","prev-month":"Måned","prev-year":"År",next:"Neste","next-week":"Uke","next-month":"Måned","next-year":"År","less-than":"Datoperioden skal ikkje være lengre enn %d dager","more-than":"Datoperioden skal ikkje være kortere enn %d dager","default-more":"Vennligst velg ein datoperiode lengre enn %d dager","default-single":"Vennligst velg ein dato","default-less":"Vennligst velg ein datoperiode mindre enn %d dager","default-range":"Vennligst velg ein datoperiode mellom %d og %d dager","default-default":"Vennligst velg ein datoperiode",time:"Tid",hour:"Time",minute:"Minutter"},nl:{selected:"Geselecteerd:",day:"Dag",days:"Dagen",apply:"Ok","week-1":"ma","week-2":"di","week-3":"wo","week-4":"do","week-5":"vr","week-6":"za","week-7":"zo","month-name":["januari","februari","maart","april","mei","juni","juli","augustus","september","october","november","december"],shortcuts:"Snelkoppelingen","custom-values":"Aangepaste waarden",past:"Verleden",following:"Komend",previous:"Vorige","prev-week":"Week","prev-month":"Maand","prev-year":"Jaar",next:"Volgende","next-week":"Week","next-month":"Maand","next-year":"Jaar","less-than":"Interval moet langer dan %d dagen zijn","more-than":"Interval mag niet minder dan %d dagen zijn","default-more":"Selecteer een interval langer dan %dagen","default-single":"Selecteer een datum","default-less":"Selecteer een interval minder dan %d dagen","default-range":"Selecteer een interval tussen %d en %d dagen","default-default":"Selecteer een interval",time:"Tijd",hour:"Uur",minute:"Minuut"},ru:{selected:"Выбрано:",day:"День",days:"Дней",apply:"Закрыть","week-1":"пн","week-2":"вт","week-3":"ср","week-4":"чт","week-5":"пт","week-6":"сб","week-7":"вс","month-name":["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"],shortcuts:"Быстрый выбор",past:"Прошедшие",following:"Следующие",previous:"&nbsp;&nbsp;&nbsp;","prev-week":"Неделя","prev-month":"Месяц","prev-year":"Год",next:"&nbsp;&nbsp;&nbsp;","next-week":"Неделя","next-month":"Месяц","next-year":"Год","less-than":"Диапазон не может быть больше %d дней","more-than":"Диапазон не может быть меньше %d дней","default-more":"Пожалуйста выберите диапазон больше %d дней","default-single":"Пожалуйста выберите дату","default-less":"Пожалуйста выберите диапазон меньше %d дней","default-range":"Пожалуйста выберите диапазон между %d и %d днями","default-default":"Пожалуйста выберите диапазон"},pl:{selected:"Wybrany:",day:"Dzień",days:"Dni",apply:"Zamknij","week-1":"pon","week-2":"wt","week-3":"śr","week-4":"czw","week-5":"pt","week-6":"so","week-7":"nd","month-name":["styczeń","luty","marzec","kwiecień","maj","czerwiec","lipiec","sierpień","wrzesień","październik","listopad","grudzień"],shortcuts:"Skróty","custom-values":"Niestandardowe wartości",past:"Przeszłe",following:"Następne",previous:"Poprzednie","prev-week":"tydzień","prev-month":"miesiąc","prev-year":"rok",next:"Następny","next-week":"tydzień","next-month":"miesiąc","next-year":"rok","less-than":"Okres nie powinien być dłuższy niż %d dni","more-than":"Okres nie powinien być krótszy niż  %d ni","default-more":"Wybierz okres dłuższy niż %d dni","default-single":"Wybierz datę","default-less":"Wybierz okres krótszy niż %d dni","default-range":"Wybierz okres trwający od %d do %d dni","default-default":"Wybierz okres",time:"Czas",hour:"Godzina",minute:"Minuta"}},a.fn.dateRangePicker=function(c){function d(b,c){return b.target==c||void 0!=c.childNodes&&a.inArray(b.target,c.childNodes)>=0}function e(){function e(b){var d=a(b).parents("table").hasClass("month2"),e=d?c.month2:c.month1;e=M(e),!c.singleMonth&&!c.singleDate&&!d&&K(e,c.month2)>=0||S(e)||(E(e,d?"month2":"month1"),I())}function g(a){var b=M(c.month1),d=M(c.month2);S(d)||!c.singleDate&&K(b,d)>=0||(E(b,"month1"),E(d,"month2"),D())}function h(b){var d=a(b).parents("table").hasClass("month2"),e=d?c.month2:c.month1;e=N(e),d&&K(e,c.month1)<=0||S(e)||(E(e,d?"month2":"month1"),I())}function i(a){var b=N(c.month1),d=N(c.month2);S(b)||!c.singleDate&&K(d,b)<=0||(E(d,"month2"),E(b,"month1"),D())}var k=this;if(a(this).data("date-picker-opened"))return void J();a(this).data("date-picker-opened",!0),aa=P().hide(),aa.append('<div class="date-range-length-tip"></div>'),aa.delegate(".day","mouseleave",function(){aa.find(".date-range-length-tip").hide()}),a(c.container).append(aa),c.inline?aa.addClass("inline-wrapper"):f(),c.alwaysOpen&&aa.find(".apply-btn").hide();var l=c.defaultTime?c.defaultTime:new Date;c.lookBehind?(c.startDate&&K(l,c.startDate)<0&&(l=M(b(c.startDate).toDate())),c.endDate&&K(l,c.endDate)>0&&(l=b(c.endDate).toDate()),E(N(l),"month1"),E(l,"month2")):(c.startDate&&K(l,c.startDate)<0&&(l=b(c.startDate).toDate()),c.endDate&&K(M(l),c.endDate)>0&&(l=N(b(c.endDate).toDate())),E(l,"month1"),E(M(l),"month2")),c.singleDate&&(c.startDate&&K(l,c.startDate)<0&&(l=b(c.startDate).toDate()),c.endDate&&K(l,c.endDate)>0&&(l=b(c.endDate).toDate()),E(l,"month1")),c.time.enabled&&(c.startDate&&c.endDate||c.start&&c.end?(F(b(c.start||c.startDate).toDate(),"time1"),F(b(c.end||c.endDate).toDate(),"time2")):(F(l,"time1"),F(l,"time2")));var m="";m=_(c.singleDate?"default-single":c.minDays&&c.maxDays?"default-range":c.minDays?"default-more":c.maxDays?"default-less":"default-default"),aa.find(".default-top").html(m.replace(/\%d/,c.minDays).replace(/\%d/,c.maxDays)),c.singleMonth?aa.addClass("single-month"):aa.addClass("two-months"),setTimeout(function(){j(),da=!0},0),aa.click(function(a){a.stopPropagation()}),a(document).bind("click.datepicker",function(a){d(a,k[0])||aa.is(":visible")&&J()}),aa.find(".next").click(function(){c.stickyMonths?g(this):e(this)}),aa.find(".prev").click(function(){c.stickyMonths?i(this):h(this)}),aa.delegate(".day","click",function(b){r(a(this))}),aa.delegate(".day","mouseenter",function(b){v(a(this))}),aa.delegate(".week-number","click",function(b){s(a(this))}),aa.attr("unselectable","on").css("user-select","none").bind("selectstart",function(a){return a.preventDefault(),!1}),aa.find(".apply-btn").click(function(){J();var b=H(new Date(c.start))+c.separator+H(new Date(c.end));a(k).trigger("datepicker-apply",{value:b,date1:new Date(c.start),date2:new Date(c.end)})}),aa.find("[custom]").click(function(){var b=a(this).attr("custom");c.start=!1,c.end=!1,aa.find(".day.checked").removeClass("checked"),c.setValue.call(fa,b),y(),z(!0),D(),c.autoClose&&J()}),aa.find("[shortcut]").click(function(){var b=a(this).attr("shortcut"),d=new Date,e=!1;if(-1!=b.indexOf("day")){var f=parseInt(b.split(",",2)[1],10);e=new Date((new Date).getTime()+864e5*f),d=new Date(d.getTime()+864e5*(f>0?1:-1))}else if(-1!=b.indexOf("week")){var g=-1!=b.indexOf("prev,")?-1:1;if(1==g)var h="monday"==c.startOfWeek?1:0;else var h="monday"==c.startOfWeek?0:6;for(d=new Date(d.getTime()-864e5);d.getDay()!=h;)d=new Date(d.getTime()+864e5*g);e=new Date(d.getTime()+864e5*g*6)}else if(-1!=b.indexOf("month")){var g=-1!=b.indexOf("prev,")?-1:1;e=1==g?M(d):N(d),e.setDate(1),d=M(e),d.setDate(1),d=new Date(d.getTime()-864e5)}else if(-1!=b.indexOf("year")){var g=-1!=b.indexOf("prev,")?-1:1;e=new Date,e.setFullYear(d.getFullYear()+g),e.setMonth(0),e.setDate(1),d.setFullYear(d.getFullYear()+g),d.setMonth(11),d.setDate(31)}else if("custom"==b){var i=a(this).html();if(c.customShortcuts&&c.customShortcuts.length>0)for(var j=0;j<c.customShortcuts.length;j++){var k=c.customShortcuts[j];if(k.name==i){var l=[];l=k.dates.call(),l&&2==l.length&&(e=l[0],d=l[1]),l&&1==l.length&&(movetodate=l[0],E(movetodate,"month1"),E(M(movetodate),"month2"),I());break}}}e&&d&&(B(e,d),y())}),aa.find(".time1 input[type=range]").bind("change mousemove",function(b){var c=b.target,d="hour"==c.name?a(c).val().replace(/^(\d{1})$/,"0$1"):void 0,e="minute"==c.name?a(c).val().replace(/^(\d{1})$/,"0$1"):void 0;n("time1",d,e)}),aa.find(".time2 input[type=range]").bind("change mousemove",function(b){var c=b.target,d="hour"==c.name?a(c).val().replace(/^(\d{1})$/,"0$1"):void 0,e="minute"==c.name?a(c).val().replace(/^(\d{1})$/,"0$1"):void 0;n("time2",d,e)})}function f(){if(!c.inline){var b=a(ea).offset();if("relative"==a(c.container).css("position")){var d=a(c.container).offset();aa.css({top:b.top-d.top+a(ea).outerHeight()+4,left:b.left-d.left})}else b.left<460?aa.css({top:b.top+a(ea).outerHeight()+parseInt(a("body").css("border-top")||0,10),left:b.left}):aa.css({top:b.top+a(ea).outerHeight()+parseInt(a("body").css("border-top")||0,10),left:b.left+a(ea).width()-aa.width()-16})}}function g(){return aa}function h(b){f(),i(),aa.slideDown(b,function(){a(ea).trigger("datepicker-opened",{relatedTarget:aa})}),a(ea).trigger("datepicker-open",{relatedTarget:aa}),I(),j()}function i(){var a=c.getValue.call(fa),d=a?a.split(c.separator):"";if(d&&(1==d.length&&c.singleDate||d.length>=2)){var e=c.format;e.match(/Do/)&&(e=e.replace(/Do/,"D"),d[0]=d[0].replace(/(\d+)(th|nd|st)/,"$1"),d.length>=2&&(d[1]=d[1].replace(/(\d+)(th|nd|st)/,"$1"))),da=!1,d.length>=2?B(b(d[0],e,b.locale(c.language)).toDate(),b(d[1],e,b.locale(c.language)).toDate()):1==d.length&&c.singleDate&&C(b(d[0],e,b.locale(c.language)).toDate()),da=!0}}function j(){var a=aa.find(".gap").css("margin-left");a&&(a=parseInt(a));var b=aa.find(".month1").width(),c=aa.find(".gap").width()+(a?2*a:0),d=aa.find(".month2").width();aa.find(".month-wrapper").width(b+c+d)}function k(a,c){aa.find("."+a+" input[type=range].hour-range").val(b(c).hours()),aa.find("."+a+" input[type=range].minute-range").val(b(c).minutes()),n(a,b(c).format("HH"),b(c).format("mm"))}function l(a,d){c[a]=parseInt(b(parseInt(d)).startOf("day").add(b(c[a+"Time"]).format("HH"),"h").add(b(c[a+"Time"]).format("mm"),"m").valueOf())}function m(){k("time1",c.start),k("time2",c.end)}function n(a,d,e){function f(a,b){var f=b.format("HH"),g=b.format("mm");c[a]=b.startOf("day").add(d||f,"h").add(e||g,"m").valueOf()}switch(d&&aa.find("."+a+" .hour-val").text(d),e&&aa.find("."+a+" .minute-val").text(e),a){case"time1":c.start&&f("start",b(c.start)),f("startTime",b(c.startTime||b().valueOf()));break;case"time2":c.end&&f("end",b(c.end)),f("endTime",b(c.endTime||b().valueOf()))}y(),z(),D()}function o(){c.start=!1,c.end=!1,aa.find(".day.checked").removeClass("checked"),aa.find(".day.last-date-selected").removeClass("last-date-selected"),aa.find(".day.first-date-selected").removeClass("first-date-selected"),c.setValue.call(fa,""),y(),z(),D()}function p(a){var d=a;return"week-range"===c.batchMode?d="monday"===c.startOfWeek?b(parseInt(a)).startOf("isoweek").valueOf():b(parseInt(a)).startOf("week").valueOf():"month-range"===c.batchMode&&(d=b(parseInt(a)).startOf("month").valueOf()),d}function q(a){var d=a;return"week-range"===c.batchMode?d="monday"===c.startOfWeek?b(parseInt(a)).endOf("isoweek").valueOf():b(parseInt(a)).endOf("week").valueOf():"month"===c.batchMode&&(d=b(parseInt(a)).endOf("month").valueOf()),d}function r(d){if(!d.hasClass("invalid")){var e=d.attr("time");if(d.addClass("checked"),c.singleDate?(c.start=e,c.end=!1):"week"===c.batchMode?"monday"===c.startOfWeek?(c.start=b(parseInt(e)).startOf("isoweek").valueOf(),c.end=b(parseInt(e)).endOf("isoweek").valueOf()):(c.end=b(parseInt(e)).endOf("week").valueOf(),c.start=b(parseInt(e)).startOf("week").valueOf()):"workweek"===c.batchMode?(c.start=b(parseInt(e)).day(1).valueOf(),c.end=b(parseInt(e)).day(5).valueOf()):"weekend"===c.batchMode?(c.start=b(parseInt(e)).day(6).valueOf(),c.end=b(parseInt(e)).day(7).valueOf()):"month"===c.batchMode?(c.start=b(parseInt(e)).startOf("month").valueOf(),c.end=b(parseInt(e)).endOf("month").valueOf()):c.start&&c.end||!c.start&&!c.end?(c.start=p(e),c.end=!1):c.start&&(c.end=q(e),c.time.enabled&&l("end",c.end)),c.time.enabled&&(c.start&&l("start",c.start),c.end&&l("end",c.end)),!c.singleDate&&c.start&&c.end&&c.start>c.end){var f=c.end;c.end=q(c.start),c.start=p(f),c.time.enabled&&c.swapTime&&m()}c.start=parseInt(c.start),c.end=parseInt(c.end),w(),c.start&&!c.end&&(a(ea).trigger("datepicker-first-date-selected",{date1:new Date(c.start)}),v(d)),u(e),y(),z(),D(),x()}}function s(a){var d=parseInt(a.attr("data-start-time"),10);if(c.startWeek){aa.find(".week-number-selected").removeClass("week-number-selected");var e=new Date(d<c.startWeek?d:c.startWeek),f=new Date(d<c.startWeek?c.startWeek:d);c.startWeek=!1,c.start=b(e).day("monday"==c.startOfWeek?1:0).toDate(),c.end=b(f).day("monday"==c.startOfWeek?7:6).toDate()}else{c.startWeek=d,a.addClass("week-number-selected");var e=new Date(d);c.start=b(e).day("monday"==c.startOfWeek?1:0).toDate(),
//c.end=b(e).day("monday"==c.startOfWeek?7:6).toDate()}u(),y(),z(),D(),x()}function t(a){if(a=parseInt(a,10),c.startDate&&L(a,c.startDate)<0)return!1;if(c.endDate&&L(a,c.endDate)>0)return!1;if(c.start&&!c.end&&!c.singleDate){if(c.maxDays>0&&A(a,c.start)>c.maxDays)return!1;if(c.minDays>0&&A(a,c.start)<c.minDays)return!1;if(c.selectForward&&a<c.start)return!1;if(c.selectBackward&&a>c.start)return!1;if(c.beforeShowDay&&"function"==typeof c.beforeShowDay){for(var b=!0,d=a;A(d,c.start)>1;){var e=c.beforeShowDay(new Date(d));if(!e[0]){b=!1;break}d>c.start&&(d-=864e5),d<c.start&&(d+=864e5)}if(!b)return!1}}return!0}function u(){return aa.find(".day.invalid.tmp").removeClass("tmp invalid").addClass("valid"),c.start&&!c.end&&aa.find(".day.toMonth.valid").each(function(){var b=parseInt(a(this).attr("time"),10);t(b)?a(this).addClass("valid tmp").removeClass("invalid"):a(this).addClass("invalid tmp").removeClass("valid")}),!0}function v(b){var d=parseInt(b.attr("time")),e="";if(b.hasClass("has-tooltip")&&b.attr("data-tooltip"))e='<span style="white-space:nowrap">'+b.attr("data-tooltip")+"</span>";else if(!b.hasClass("invalid"))if(c.singleDate)aa.find(".day.hovering").removeClass("hovering"),b.addClass("hovering");else if(aa.find(".day").each(function(){var b=parseInt(a(this).attr("time"));c.start,c.end;b==d?a(this).addClass("hovering"):a(this).removeClass("hovering"),c.start&&!c.end&&(c.start<b&&d>=b||c.start>b&&b>=d)?a(this).addClass("hovering"):a(this).removeClass("hovering")}),c.start&&!c.end){var f=A(d,c.start);c.hoveringTooltip&&("function"==typeof c.hoveringTooltip?e=c.hoveringTooltip(f,c.start,d):c.hoveringTooltip===!0&&f>1&&(e=f+" "+_("days")))}if(e){var g=b.offset(),h=aa.offset(),i=g.left-h.left,j=g.top-h.top;i+=b.width()/2;var k=aa.find(".date-range-length-tip"),l=k.css({visibility:"hidden",display:"none"}).html(e).width(),m=k.height();i-=l/2,j-=m,setTimeout(function(){k.css({left:i,top:j,display:"block",visibility:"visible"})},10)}else aa.find(".date-range-length-tip").hide()}function w(){aa.find(".day.hovering").removeClass("hovering"),aa.find(".date-range-length-tip").hide()}function x(){c.singleDate===!0?da&&c.start&&c.autoClose&&J():da&&c.start&&c.end&&c.autoClose&&J()}function y(){var a=Math.ceil((c.end-c.start)/864e5)+1;c.singleDate?c.start&&!c.end?aa.find(".drp_top-bar").removeClass("error").addClass("normal"):aa.find(".drp_top-bar").removeClass("error").removeClass("normal"):c.maxDays&&a>c.maxDays?(c.start=!1,c.end=!1,aa.find(".day").removeClass("checked"),aa.find(".drp_top-bar").removeClass("normal").addClass("error").find(".error-top").html(_("less-than").replace("%d",c.maxDays))):c.minDays&&a<c.minDays?(c.start=!1,c.end=!1,aa.find(".day").removeClass("checked"),aa.find(".drp_top-bar").removeClass("normal").addClass("error").find(".error-top").html(_("more-than").replace("%d",c.minDays))):c.start||c.end?aa.find(".drp_top-bar").removeClass("error").addClass("normal"):aa.find(".drp_top-bar").removeClass("error").removeClass("normal"),c.singleDate&&c.start&&!c.end||!c.singleDate&&c.start&&c.end?aa.find(".apply-btn").removeClass("disabled"):aa.find(".apply-btn").addClass("disabled"),c.batchMode&&(c.start&&c.startDate&&L(c.start,c.startDate)<0||c.end&&c.endDate&&L(c.end,c.endDate)>0)&&(c.start=!1,c.end=!1,aa.find(".day").removeClass("checked"))}function z(b,d){if(aa.find(".start-day").html("..."),aa.find(".end-day").html("..."),aa.find(".selected-days").hide(),c.start&&aa.find(".start-day").html(H(new Date(parseInt(c.start)))),c.end&&aa.find(".end-day").html(H(new Date(parseInt(c.end)))),c.start&&c.singleDate){aa.find(".apply-btn").removeClass("disabled");var e=H(new Date(c.start));c.setValue.call(fa,e,H(new Date(c.start)),H(new Date(c.end))),da&&a(ea).trigger("datepicker-change",{value:e,date1:new Date(c.start)})}else if(c.start&&c.end){aa.find(".selected-days").show().find(".selected-days-num").html(A(c.end,c.start)),aa.find(".apply-btn").removeClass("disabled");var e=H(new Date(c.start))+c.separator+H(new Date(c.end));c.setValue.call(fa,e,H(new Date(c.start)),H(new Date(c.end))),da&&!d&&a(ea).trigger("datepicker-change",{value:e,date1:new Date(c.start),date2:new Date(c.end)})}else b?aa.find(".apply-btn").removeClass("disabled"):aa.find(".apply-btn").addClass("disabled")}function A(a,b){return Math.abs(W(a)-W(b))+1}function B(a,b,d){if(a.getTime()>b.getTime()){var e=b;b=a,a=e,e=null}var f=!0;return c.startDate&&L(a,c.startDate)<0&&(f=!1),c.endDate&&L(b,c.endDate)>0&&(f=!1),f?(c.start=a.getTime(),c.end=b.getTime(),c.time.enabled&&(k("time1",a),k("time2",b)),(c.stickyMonths||L(a,b)>0&&0==K(a,b))&&(c.lookBehind?a=N(b):b=M(a)),c.stickyMonths&&K(b,c.endDate)>0&&(a=N(a),b=N(b)),c.stickyMonths||0==K(a,b)&&(c.lookBehind?a=N(b):b=M(a)),E(a,"month1"),E(b,"month2"),I(),y(),z(!1,d),void x()):(E(c.startDate,"month1"),E(M(c.startDate),"month2"),void I())}function C(a){var b=!0;return c.startDate&&L(a,c.startDate)<0&&(b=!1),c.endDate&&L(a,c.endDate)>0&&(b=!1),b?(c.start=a.getTime(),c.time.enabled&&k("time1",a),E(a,"month1"),I(),z(),void x()):void E(c.startDate,"month1")}function D(){(c.start||c.end)&&(aa.find(".day").each(function(){var d=parseInt(a(this).attr("time")),e=c.start,f=c.end;c.time.enabled&&(d=b(d).startOf("day").valueOf(),e=b(e||b().valueOf()).startOf("day").valueOf(),f=b(f||b().valueOf()).startOf("day").valueOf()),c.start&&c.end&&f>=d&&d>=e||c.start&&!c.end&&b(e).format("YYYY-MM-DD")==b(d).format("YYYY-MM-DD")?a(this).addClass("checked"):a(this).removeClass("checked"),c.start&&b(e).format("YYYY-MM-DD")==b(d).format("YYYY-MM-DD")?a(this).addClass("first-date-selected"):a(this).removeClass("first-date-selected"),c.end&&b(f).format("YYYY-MM-DD")==b(d).format("YYYY-MM-DD")?a(this).addClass("last-date-selected"):a(this).removeClass("last-date-selected")}),aa.find(".week-number").each(function(){a(this).attr("data-start-time")==c.startWeek&&a(this).addClass("week-number-selected")}))}function E(a,d){a=b(a).toDate();var e=G(a.getMonth());aa.find("."+d+" .month-name").html(e+" "+a.getFullYear()),aa.find("."+d+" tbody").html(Y(a)),c[d]=a,u()}function F(a,b){aa.find("."+b).append(O()),k(b,a)}function G(a){return _("month-name")[a]}function H(a){return b(a).format(c.format)}function I(){D();var a=parseInt(b(c.month1).format("YYYYMM")),d=parseInt(b(c.month2).format("YYYYMM")),e=Math.abs(a-d),f=e>1&&89!=e;f?aa.addClass("has-gap").removeClass("no-gap").find(".gap").css("visibility","visible"):aa.removeClass("has-gap").addClass("no-gap").find(".gap").css("visibility","hidden");var g=aa.find("table.month1").height(),h=aa.find("table.month2").height();aa.find(".gap").height(Math.max(g,h)+10)}function J(){c.alwaysOpen||(a(aa).slideUp(c.duration,function(){a(ea).data("date-picker-opened",!1),a(ea).trigger("datepicker-closed",{relatedTarget:aa})}),a(ea).trigger("datepicker-close",{relatedTarget:aa}))}function K(a,c){var d=parseInt(b(a).format("YYYYMM"))-parseInt(b(c).format("YYYYMM"));return d>0?1:0==d?0:-1}function L(a,c){var d=parseInt(b(a).format("YYYYMMDD"))-parseInt(b(c).format("YYYYMMDD"));return d>0?1:0==d?0:-1}function M(a){return b(a).add(1,"months").toDate()}function N(a){return b(a).add(-1,"months").toDate()}function O(){return"<div>						<span>"+_("Time")+': <span class="hour-val">00</span>:<span class="minute-val">00</span></span>					</div>					<div class="hour">						<label>'+_("Hour")+': <input type="range" class="hour-range" name="hour" min="0" max="23"></label>					</div>					<div class="minute">						<label>'+_("Minute")+': <input type="range" class="minute-range" name="minute" min="0" max="59"></label>					</div>'}function P(){var b='<div class="date-picker-wrapper';c.extraClass&&(b+=" "+c.extraClass+" "),c.singleDate&&(b+=" single-date "),c.showShortcuts||(b+=" no-shortcuts "),c.showTopbar||(b+=" no-topbar "),c.customTopBar&&(b+=" custom-topbar "),b+='">',c.showTopbar&&(b+='<div class="drp_top-bar">',c.customTopBar?("function"==typeof c.customTopBar&&(c.customTopBar=c.customTopBar()),b+='<div class="custom-top">'+c.customTopBar+"</div>"):(b+='<div class="normal-top">							<span style="color:#333">'+_("selected")+' </span> <b class="start-day">...</b>',c.singleDate||(b+=' <span class="separator-day">'+c.separator+'</span> <b class="end-day">...</b> <i class="selected-days">(<span class="selected-days-num">3</span> '+_("days")+")</i>"),b+="</div>",b+='<div class="error-top">error</div>						<div class="default-top">default</div>'),b+='<input type="button" class="apply-btn disabled'+Q()+'" value="'+_("apply")+'" />',b+="</div>");var d=c.showWeekNumbers?6:5;if(b+='<div class="month-wrapper"><table class="month1" cellspacing="0" border="0" cellpadding="0"><thead><tr class="caption"><th style="width:27px;"><span class="prev">&lt;</span></th><th colspan="'+d+'" class="month-name"></th><th style="width:27px;">'+(c.singleDate||!c.stickyMonths?'<span class="next">&gt;</span>':"")+'</th></tr><tr class="week-name">'+R()+"</thead><tbody></tbody></table>",U()&&(b+='<div class="gap">'+T()+'</div><table class="month2" cellspacing="0" border="0" cellpadding="0"><thead><tr class="caption"><th style="width:27px;">'+(c.stickyMonths?"":'<span class="prev">&lt;</span>')+'</th><th colspan="'+d+'" class="month-name"></th><th style="width:27px;"><span class="next">&gt;</span></th></tr><tr class="week-name">'+R()+"</thead><tbody></tbody></table>"),b+='<div style="clear:both;height:0;font-size:0;"></div><div class="time"><div class="time1"></div>',c.singleDate||(b+='<div class="time2"></div>'),b+='</div><div style="clear:both;height:0;font-size:0;"></div></div>',b+='<div class="footer">',c.showShortcuts){b+='<div class="shortcuts"><b>'+_("shortcuts")+"</b>";var e=c.shortcuts;if(e){if(e["prev-days"]&&e["prev-days"].length>0){b+='&nbsp;<span class="prev-days">'+_("past");for(var f=0;f<e["prev-days"].length;f++){var g=e["prev-days"][f];g+=_(e["prev-days"][f]>1?"days":"day"),b+=' <a href="javascript:;" shortcut="day,-'+e["prev-days"][f]+'">'+g+"</a>"}b+="</span>"}if(e["next-days"]&&e["next-days"].length>0){b+='&nbsp;<span class="next-days">'+_("following");for(var f=0;f<e["next-days"].length;f++){var g=e["next-days"][f];g+=_(e["next-days"][f]>1?"days":"day"),b+=' <a href="javascript:;" shortcut="day,'+e["next-days"][f]+'">'+g+"</a>"}b+="</span>"}if(e.prev&&e.prev.length>0){b+='&nbsp;<span class="prev-buttons">'+_("previous");for(var f=0;f<e.prev.length;f++){var g=_("prev-"+e.prev[f]);b+=' <a href="javascript:;" shortcut="prev,'+e.prev[f]+'">'+g+"</a>"}b+="</span>"}if(e.next&&e.next.length>0){b+='&nbsp;<span class="next-buttons">'+_("next");for(var f=0;f<e.next.length;f++){var g=_("next-"+e.next[f]);b+=' <a href="javascript:;" shortcut="next,'+e.next[f]+'">'+g+"</a>"}b+="</span>"}}if(c.customShortcuts)for(var f=0;f<c.customShortcuts.length;f++){var h=c.customShortcuts[f];b+='&nbsp;<span class="custom-shortcut"><a href="javascript:;" shortcut="custom">'+h.name+"</a></span>"}b+="</div>"}if(c.showCustomValues&&(b+='<div class="customValues"><b>'+(c.customValueLabel||_("custom-values"))+"</b>",c.customValues))for(var f=0;f<c.customValues.length;f++){var i=c.customValues[f];b+='&nbsp;<span class="custom-value"><a href="javascript:;" custom="'+i.value+'">'+i.name+"</a></span>"}return b+="</div></div>",a(b)}function Q(){return klass="",c.autoClose===!0&&(klass+=" hide"),""!==c.applyBtnClass&&(klass+=" "+c.applyBtnClass),klass}function R(){var a=c.showWeekNumbers?"<th>"+_("week-number")+"</th>":"";return"monday"==c.startOfWeek?a+"<th>"+_("week-1")+"</th>					<th>"+_("week-2")+"</th>					<th>"+_("week-3")+"</th>					<th>"+_("week-4")+"</th>					<th>"+_("week-5")+"</th>					<th>"+_("week-6")+"</th>					<th>"+_("week-7")+"</th>":a+"<th>"+_("week-7")+"</th>					<th>"+_("week-1")+"</th>					<th>"+_("week-2")+"</th>					<th>"+_("week-3")+"</th>					<th>"+_("week-4")+"</th>					<th>"+_("week-5")+"</th>					<th>"+_("week-6")+"</th>"}function S(a){var a=b(a);return c.startDate&&a.endOf("month").isBefore(c.startDate)?!0:c.endDate&&a.startOf("month").isAfter(c.endDate)?!0:!1}function T(){for(var a=['<div class="gap-top-mask"></div><div class="gap-bottom-mask"></div><div class="gap-lines">'],b=0;20>b;b++)a.push('<div class="gap-line">					<div class="gap-1"></div>					<div class="gap-2"></div>					<div class="gap-3"></div>				</div>');return a.push("</div>"),a.join("")}function U(){return!c.singleDate&&!c.singleMonth}function V(a,b,c){var d=jQuery.extend(!0,{},a);jQuery.each(b,function(a,b){var e=b(c);for(var f in e)d.hasOwnProperty(f)?d[f]+=e[f]:d[f]=e[f]}),attrString="";for(var e in d)d.hasOwnProperty(e)&&(attrString+=e+'="'+d[e]+'" ');return attrString}function W(a){return Math.floor(X(a)/864e5)}function X(a){return b.isMoment(a)&&(a=a.toDate().getTime()),"object"==typeof a&&a.getTime&&(a=a.getTime()),"string"!=typeof a||a.match(/\d{13}/)||(a=b(a,c.format).toDate().getTime()),a=parseInt(a,10)-60*(new Date).getTimezoneOffset()*1e3}function Y(a){var d=[];a.setDate(1);var e=(new Date(a.getTime()-864e5),new Date),f=a.getDay();if(0==f&&"monday"==c.startOfWeek&&(f=7),f>0)for(var g=f;g>0;g--){var h=new Date(a.getTime()-864e5*g),i=t(h.getTime());c.startDate&&L(h,c.startDate)<0&&(i=!1),c.endDate&&L(h,c.endDate)>0&&(i=!1),d.push({date:h,type:"lastMonth",day:h.getDate(),time:h.getTime(),valid:i})}for(var j=a.getMonth(),g=0;40>g;g++){var k=b(a).add(g,"days").toDate(),i=t(k.getTime());c.startDate&&L(k,c.startDate)<0&&(i=!1),c.endDate&&L(k,c.endDate)>0&&(i=!1),d.push({date:k,type:k.getMonth()==j?"toMonth":"nextMonth",day:k.getDate(),time:k.getTime(),valid:i})}for(var l=[],m=0;6>m&&"nextMonth"!=d[7*m].type;m++){l.push("<tr>");for(var h=0;7>h;h++){var n="monday"==c.startOfWeek?h+1:h,k=d[7*m+n],o=b(k.time).format("L")==b(e).format("L");if(k.extraClass="",k.tooltip="",k.valid&&c.beforeShowDay&&"function"==typeof c.beforeShowDay){var p=c.beforeShowDay(b(k.time).toDate());k.valid=p[0],k.extraClass=p[1]||"",k.tooltip=p[2]||"",""!=k.tooltip&&(k.extraClass+=" has-tooltip ")}todayDivAttr={time:k.time,"data-tooltip":k.tooltip,"class":"day "+k.type+" "+k.extraClass+" "+(k.valid?"valid":"invalid")+" "+(o?"real-today":"")},0==h&&c.showWeekNumbers&&l.push('<td><div class="week-number" data-start-time="'+k.time+'">'+c.getWeekNumber(k.date)+"</div></td>"),l.push("<td "+V({},c.dayTdAttrs,k)+"><div "+V(todayDivAttr,c.dayDivAttrs,k)+">"+Z(k.time,k.day)+"</div></td>")}l.push("</tr>")}return l.join("")}function Z(a,b){return c.showDateFilter&&"function"==typeof c.showDateFilter?c.showDateFilter(a,b):b}function $(){if("auto"==c.language){var b=navigator.language?navigator.language:navigator.browserLanguage;if(!b)return a.dateRangePickerLanguages["default"];var b=b.toLowerCase();for(var d in a.dateRangePickerLanguages)if(-1!=b.indexOf(d))return a.dateRangePickerLanguages[d];return a.dateRangePickerLanguages["default"]}return c.language&&c.language in a.dateRangePickerLanguages?a.dateRangePickerLanguages[c.language]:a.dateRangePickerLanguages["default"]}function _(b){var c=b.toLowerCase(),d=b in ca?ca[b]:c in ca?ca[c]:null,e=a.dateRangePickerLanguages["default"];return null==d&&(d=b in e?e[b]:c in e?e[c]:""),d}c||(c={}),c=a.extend(!0,{autoClose:!1,format:"YYYY-MM-DD",separator:" to ",language:"auto",startOfWeek:"sunday",getValue:function(){return a(this).val()},setValue:function(b){a(this).attr("readonly")||a(this).is(":disabled")||b==a(this).val()||a(this).val(b)},startDate:!1,endDate:!1,time:{enabled:!1},minDays:0,maxDays:0,showShortcuts:!1,shortcuts:{},customShortcuts:[],inline:!1,container:"body",alwaysOpen:!1,singleDate:!1,lookBehind:!1,batchMode:!1,duration:200,stickyMonths:!1,dayDivAttrs:[],dayTdAttrs:[],selectForward:!1,selectBackward:!1,applyBtnClass:"",singleMonth:"auto",hoveringTooltip:function(a,b,c){return a>1?a+" "+_("days"):""},showTopbar:!0,swapTime:!1,showWeekNumbers:!1,getWeekNumber:function(a){return b(a).format("w")}},c),c.start=!1,c.end=!1,c.startWeek=!1,c.isTouchDevice="ontouchstart"in window||navigator.msMaxTouchPoints,c.isTouchDevice&&(c.hoveringTooltip=!1),"auto"==c.singleMonth&&(c.singleMonth=a(window).width()<480),c.singleMonth&&(c.stickyMonths=!1),c.singleDate&&(c.singleMonth=!0),c.showTopbar||(c.autoClose=!0),c.startDate&&"string"==typeof c.startDate&&(c.startDate=b(c.startDate,c.format).toDate()),c.endDate&&"string"==typeof c.endDate&&(c.endDate=b(c.endDate,c.format).toDate());var aa,ba,ca=$(),da=!1,ea=this,fa=a(ea).get(0);return a(this).unbind(".datepicker").bind("click.datepicker",function(a){var b=aa.is(":visible");b||h(c.duration)}).bind("change.datepicker",function(a){i()}).bind("keyup.datepicker",function(){try{clearTimeout(ba)}catch(a){}ba=setTimeout(function(){i()},2e3)}),e.call(this),c.alwaysOpen&&h(0),a(this).data("dateRangePicker",{setDateRange:function(a,d,e){"string"==typeof a&&"string"==typeof d&&(a=b(a,c.format).toDate(),d=b(d,c.format).toDate()),B(a,d,e)},clear:o,close:J,open:h,getDatePicker:g,destroy:function(){a(ea).unbind(".datepicker"),a(ea).data("dateRangePicker",""),a(ea).data("date-picker-opened",null),aa.remove(),a(window).unbind("resize.datepicker",f),a(document).unbind("click.datepicker",J)}}),a(window).bind("resize.datepicker",f),this}}),$(document).ready(function(){$(".drawer").drawer()}),angular.module("lmApp",["ngResource","ngRoute","ngCookies","selectize","ui.bootstrap","ui.bootstrap.datetimepicker","ngAnimate","uiGmapgoogle-maps","ui.mask","frapontillo.bootstrap-switch","toastr","ngFileUpload","angular-img-cropper"]),angular.module("lmApp").constant("_",window._),angular.module("lmApp").constant("moment",window.moment),angular.module("lmApp").config(["$routeProvider","$locationProvider",function(a,b){var c={GetAccount:["Account","$q",function(a,b){var c=b.defer();return a.get().$promise.then(function(a){c.resolve({current:a})}),c.promise}]},d={GetListing:["Listing","$route","$q",function(a,b,c){var d=c.defer(),e=b.current.params.id;if(e)a.get({_id:e}).$promise.then(function(a){d.resolve({current:a})});else{var f={name:{},fax:{intCode:"353"},classList:[],address:{},phoneList:[],socialMediaList:[],photoGallery:{},openingHours:{1:[],2:[],3:[],4:[],5:[],6:[],7:[]},addons:{location:!0,openingHours:!0,photoGallery:!1,serviceAreas:!1,reviews:!1,isActive:!0}};d.resolve({current:f})}return d.promise}]},e={GetListings:["Listing","$q",function(a,b){var c=b.defer();return a.query().$promise.then(function(a){c.resolve({current:a})}),c.promise}]};b.html5Mode(!0),a.when("/",{templateUrl:"views/login.html",controller:"LoginController"}).when("/account",{templateUrl:"views/account.html",controller:"AccountController",resolve:c}).when("/listings/new",{templateUrl:"views/listing.html",controller:"ListingController",resolve:d}).when("/listings/:id",{templateUrl:"views/listing.html",controller:"ListingController",resolve:d}).when("/:customerId",{templateUrl:"views/dashboard.html",controller:"DashboardController",resolve:e})}]),angular.module("lmApp").run(["toastr","$cookies","$rootScope","$location",function(a,b,c,d){c.$on("$routeChangeStart",function(a,b,c,d){window.$("#animatedFiller").show(),$("#animatedFiller").fakeLoader({timeToHide:2e6,zIndex:"999",bgColor:"#fff",imagePath:"assets/images/logo-small-pink.png"})}),c.$on("$routeChangeSuccess",function(c,d,e,f){window.$("#animatedFiller").hide();var g=b.get("notify");g&&(b.remove("notify"),a.success(g))}),c.$on("$routeChangeError",function(a,b,c,e){console.log(e),d.path("/")})}]),angular.module("lmApp").factory("Listing",["$resource","Identity",function(a,b){var c=a(window.apiUrl+"/api/v1/customers/:customerId/listings/:_id.json",{customerId:b.currentCustomer.id,_id:"@id"},{update:{method:"POST"}});return c}]),angular.module("lmApp").factory("Auth",["Identity","$q",function(a,b){return{checkForCurrentCustomer:function(){return a.isAuthenticated()?!0:b.reject("not authorized")}}}]),angular.module("lmApp").factory("Customer",["$resource",function(a){var b=a(window.apiUrl+"/api/v1/customers/:_id.json",{_id:"@id"},{update:{method:"PUT",isArray:!1}});return b}]),angular.module("lmApp").factory("Identity",["Customer","$window",function(a,b){var c;return b.bootstrappedCurrentCustomer&&(c=new a,angular.extend(c,b.bootstrappedCurrentCustomer)),{currentCustomer:c,isAuthenticated:function(){return!!this.currentCustomer}}}]),angular.module("lmApp").factory("County",["$resource",function(a){var b=a(window.apiUrl+"/api/v1/counties.json");return b}]),angular.module("lmApp").factory("Category",["$resource",function(a){var b=a(window.apiUrl+"/api/v1/classes.json");return b}]),angular.module("lmApp").factory("Neighbourhood",["$resource",function(a){var b=a(window.apiUrl+"/api/v1/neighbourhoods.json");return b}]),angular.module("lmApp").factory("Geocode",["$http",function(a){return{getLatLng:function(b){return a.get("https://maps.google.com/maps/api/geocode/json?"+window.jQuery.param(b))}}}]),angular.module("lmApp").factory("Account",["$resource","Identity",function(a,b){var c=a(window.apiUrl+"/api/v1/customers/:customerId/account.json",{customerId:b.currentCustomer.id},{update:{method:"POST"}});return c}]),angular.module("lmApp").controller("DashboardController",["GetListings","_","$modal","$scope",function(a,b,c,d){var e=a.current;d.listings=b.map(e,function(a){return a.addressString=b.compact([a.address.housename,a.address.address,a.address.locality,a.address.city,a.address.postalcode]).join(", "),a.addons={},a.addons.location=!0,a.addons.openingHours=!0,a.addons.photoGallery=a.photoGallery?!!a.photoGallery.photos&&a.photoGallery.photos.length>0:!1,a.addons.serviceAreas=a.serviceAreas?a.serviceAreas.length>0:!1,a.addons.reviews=!1,a.addons.coupons=!1,a.addons.isActive=!1,a}),d.openAddonsModal=function(a){var b=c.open({backdrop:"static",keyboard:!1,scope:d,animation:!0,controller:"ListingAddonsController",templateUrl:"views/modals/listing_addons.html",resolve:{addons:a.addons}});b.result.then(function(a){d.addons=a.params})},d.activateSlider=function(){window.$(".listing-panel").owlCarousel({nav:!0,responsiceClass:!0,responsive:{0:{items:1,nav:!0},600:{items:2,nav:!1},1e3:{items:3,nav:!0,loop:!1}}})}}]),angular.module("lmApp").controller("AccountController",["Neighbourhood","GetAccount","Account","Identity","$window","toastr","$cookies","$scope","$modal","_",function(a,b,c,d,e,f,g,h,i,j){var k,l,m,n,o,p;k=d.currentCustomer,l={},n="([a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?)",h.int_codes=["353","44","1","49","33","32","31","34","358","39","41","48","1","46","61","81","420","43","85","94","371","90","421","356","36","972","blank"],h.account=b.current,p=angular.copy(h.account),h.account.phoneList=j.map(h.account.phoneList,function(a){return a.phoneId=a.id,a}),h.customer=k,h.$watch("account.name.name",function(a,b){if(b){var c=j.find(h.customer.nameList,{name:a});b!==a&&(c?(l.name={id:c.id},h.account.name=angular.copy(c)):(l.name={id:null,name:h.account.name.name,"new":!0},h.account.name.id=null,h.account.name["new"]=!0)),console.log(h.account.name)}}),a.query(function(a){h.neighbourhoodList=a}),h.addressString=j.compact([h.account.address.housename,h.account.address.address,h.account.address.locality,h.account.address.city,h.account.address.postalcode]).join(", "),h.addressList=j.map(k.addressList,function(a){return a.address_id=a.id,a}),h.openAddress=function(a){h.showMap=!1,m=i.open({backdrop:"static",keyboard:!1,scope:h,animation:!0,size:"lg",controller:"AddressModalController",templateUrl:"views/modals/address.html",resolve:{isAddress:function(){return a},address:h.account.address}}),m.result.then(function(a){a.status&&a.updated&&(l.address=j.omit(a.params,["$order","address_id"]),h.account.address=a.params,k.addressList.push(a.params),h.map=a.params.lat+","+a.params.lng,h.addressString=j.compact([h.account.address.housename,h.account.address.address,h.account.address.locality,h.account.address.city,h.account.address.postalcode]).join(", "))})},h.$watch("account.contactPerson.name",function(a,b){if(b&&a!==b){var c=angular.copy(j.find(k.contactPersonList,{name:a}));c&&(h.account.contactPerson=c,l.contactPerson=c)}}),h.$watch("account.contactPerson.email",function(a,b){b&&a!==b&&(h.account.contactPerson.email=a,l.contactPerson?l.contactPerson.email=a:l.contactPerson=h.account.contactPerson)}),h.$watch("account.contactPerson.jobTitle",function(a,b){b&&a!==b&&(h.account.contactPerson.jobTitle=a,l.contactPerson?l.contactPerson.jobTitle=a:l.contactPerson=h.account.contactPerson)}),h.newContactPerson=function(a){if(13===a.keyCode||"blur"===a.type){var b=angular.copy(j.find(k.contactPersonList,{name:h.account.contactPerson.name}));b||(h.account.contactPerson.email=null,h.account.contactPerson.jobTitle=null,l.contactPerson={id:null,name:h.account.contactPerson.name,jobTitle:null,email:null})}},h.phoneUpdated=function(){var a=j.map(k.phoneList,function(a){return a.intCode+a.name}),b=j.map(h.account.phoneList,function(a){return a.intCode+a.name});return!j.isEqual(a,b)},h.phoneOptions=j.map(angular.copy(k.phoneList),function(a){return a.phoneId=a.id,a}),h.phoneKey=k.phoneList.length,h.addPhoneNumber=function(){var a=h.phoneKey=h.phoneKey+10;return h.account.phoneList.push({id:null,phoneId:a,intCode:"353",name:null,"new":!1}),!0},h.deleteNumber=function(a){return j.pullAt(h.account.phoneList,a),!0},h.account.fax=p.fax||{name:null},h.account.fax.intCode=p.fax.intCode||"353",h.$watch("account.fax.name",function(a,b){if(b&&b!==a){var c=j.find(k.faxList,{name:a});if(c)return h.account.fax=angular.copy(c),l.fax={id:c.id},!0}}),h.$watch("account.fax.intCode",function(a,b){if(b&&a!==b){var c=j.find(k.faxList,{id:parseInt(h.account.fax.id)});if(c.intCode!==a)return l.fax={id:null,name:h.account.fax.name,intCode:a},!0}}),h.newFaxNumber=function(a){if(13===a.keyCode||"blur"===a.type){var b=angular.copy(h.account.fax);b.id=null,b["new"]=!0,l.fax=b}},h.openDeleteInfo=function(){o=i.open({scope:h,animation:!0,templateUrl:"views/modals/delete_info.html"})},h.closeDeleteInfoModal=function(){o.close()},h.saveAccount=function(){if(l.contactPerson&&(l.contactPerson.id===l.contactPerson.name&&(l.contactPerson=angular.copy(l.contactPerson),l.contactPerson.id=null),l.contactPerson=j.omit(l.contactPerson,["active","$order","main"])),h.phoneUpdated()){var a=[];j.each(h.account.phoneList,function(b){var c=j.find(k.phoneList,{intCode:b.intCode,name:b.name});c?a.push(c):a.push({id:null,intCode:b.intCode,name:b.name,"new":!0})}),l.phoneList=a}console.log(l),(h.account.address.housename||h.account.address.address||h.account.address.locality||h.account.address.city||h.account.address.postalcode)&&h.account.address.county&&h.account.address.neighbourhood&&h.account.name.name?c.update(l).$promise.then(function(a){a.$resolved&&(g.put("notify","Account saved."),e.location.reload())},function(a){f.error(a),setTimeout(function(){e.location.reload()},5e3)}):f.warning("Name and Address fields are required!","Warning")}}]),angular.module("lmApp").controller("ListingController",["Neighbourhood","Identity","Category","ServiceArea","Geocode","GetListing","toastr","$q","$timeout","$routeParams","$scope","$http","$modal","$filter","selectMainFilter","_","moment","Coupon",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s,t,u,v,w,x,y,z,A,B,C,D,E,F;k.coupons={deals:{},isActive:!1},y="([a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?)",k.int_codes=["44","353","1","49","33","32","31","34","358","39","41","48","1","46","61","81","420","43","85","94","371","90","421","356","36","972","blank"],k.socialMediaUrlTypes={facebook:{title:"Facebook",url:"facebook.com/UserName"},twitter:{title:"Twitter",url:"twitter.com/UserName"},linkedin:{title:"Linkedin",url:"linkedin.com/in/UserName"},"google-plus":{title:"Google+",url:"plus.google.com/+UserName"},youtube:{title:"YouTube",url:"youtube.com/user/UserName"},pinterest:{title:"Pinterest",url:"pinterest.com/UserName"},apple:{title:"Apple App Store",url:"itunes.apple.com/app/id000000000"},android:{title:"Google Play Store",url:"play.google.com/store/apps/details?id=com.example"}},F=k.listingChanges={},D=k.isNew=!j.id,A=f.current,k.listing=angular.copy(A),k.customer=b.currentCustomer,z=b.currentCustomer,r.getListingCoupons(A.listingCouponsKey).success(function(a){var b=p.values(a.deal_data);!p.isEmpty(a.deal_data)&&b.length<10&&(k.coupons.deals=b,k.coupons.isActive=!0)}),k.isNewBusiness=!1,k.nameModalClosed=!0,k.nameUpdated=!1,k.nameIsChanged=!1,k.newName=function(a){13===a.keyCode?($("#listingName").blur(),$(".ac_result_area").hide()):"blur"===a.type&&(k.nameUpdated=!0,0===$(".ac_input_off").length&&!D&&k.nameModalClosed&&k.nameIsChanged&&(k.nameModalClosed=!1,s=m.open({animation:!0,scope:k,controller:"ListingNameCtrl",templateUrl:"views/modals/name_confirm.html"}),s.result.then(function(a){k.nameModalClosed=!0,k.isNewBusiness=a})))},k.$watch("listing.name.name",function(a,b){var c=p.find(k.customer.nameList,{name:a});b&&a!==b&&!c&&(k.nameIsChanged=!0)}),k.categories=p.map(k.listing.classList,function(a){return a.id}),k.$watch("categories",function(a,b){var c=p.map(a,function(a){return parseInt(a)}),d=p.map(b,function(a){return parseInt(a)});b&&!p.isEqual(c,d)&&(F.categories=a,k.listing.classList=a)}),k.categoryConfig={maxOptions:4e3,valueField:"id",labelField:"name",placeholder:"Choose a category",sortField:"name",plugins:["remove_button"],searchField:["name"]},c.query(function(a){k.categoriesList=a}),k.$watch("listing.email.name",function(a,b){if(b||a){var c=p.find(k.customer.emailList,{name:a});c&&a!==b?F.email={id:c.id}:c||(a?F.email={id:null,name:a,"new":!0}:k.listing.email.isDeleted||delete F.email)}}),k.deleteEmail=function(){return F.email={id:0},k.listing.email={isDeleted:!0},!0},k.$watch("listing.website.name",function(a,b){if(b||a){var c=p.find(k.customer.websiteList,{name:a});c&&a!==b?F.website={id:c.id}:c||(a?F.website={id:null,name:a,"new":!0}:k.listing.website.isDeleted||delete F.website)}}),k.deleteWebsite=function(){return F.website={id:0},k.listing.website={isDeleted:!0},!0},k.$watch("listing.description.name",function(a,b){if("undefined"!=typeof b){if(null===b)return F.description={name:a},!0;if(p.isString(b)&&a!==b)return F.description={name:a},!0}else if(a!==b)return F.description={name:a},!0}),k.phoneUpdated=function(){var a=p.map(A.phoneList,function(a){return a.intCode+a.name}),b=p.map(k.listing.phoneList,function(a){return a.intCode+a.name});return!p.isEqual(a,b)||D},k.phoneOptions=p.map(k.customer.phoneList,function(a){return a.phoneId=a.id,a}),k.phoneKey=k.customer.phoneList.length,k.addPhoneNumber=function(){var a=k.phoneKey=k.phoneKey+10;return k.listing.phoneList.push({id:null,phoneId:a,intCode:"353",name:null,"new":!1}),!0},k.newPhoneNumber=function(a){(13===event.keyCode||"blur"===event.type)&&$(".ac_result_area").hide()},k.deleteNumber=function(a){return p.pullAt(k.listing.phoneList,a),!0},k.listing.fax.intCode=A.fax.intCode||"353",k.listing.fax.name=A.fax.name||null,k.$watch("listing.fax",function(a,b){var c,d=p.values(a).join(),e=p.find(k.customer.faxList,{name:a.name});e&&(c=p.values([e.intCode,e.name]).join()),p.values(b).join()!==p.values(a).join()&&(a.name&&a.name!==b.name?e&&a!==b?(F.fax={id:e.id},k.listing.fax.intCode=e.intCode):e||(a?F.fax={id:null,name:a.name,intCode:k.listing.fax.intCode,"new":!0}:k.listing.website.isDeleted||delete F.fax):a.intCode&&d!==c&&a.name&&a.intCode&&(F.fax={id:null,name:a.name,intCode:a.intCode,"new":!0}))},!0),k.deleteFax=function(){return F.fax={id:0},k.listing.fax={isDeleted:!0},!0},k.addressString=p.compact([k.listing.address.housename,k.listing.address.address,k.listing.address.locality,k.listing.address.city,k.listing.address.postalcode]).join(", "),a.query(function(a){k.neighbourhoodList=a}),k.addressList=p.map(k.customer.addressList,function(a){return a.address_id=a.id,a}),k.openAddress=function(a){k.showMap=!1,t=m.open({backdrop:"static",keyboard:!1,scope:k,animation:!0,size:"lg",controller:"AddressModalController",templateUrl:"views/modals/address.html",resolve:{isAddress:function(){return a},address:angular.copy(k.listing.address)}}),t.result.then(function(a){
//a.status&&a.updated&&(F.address=p.omit(a.params,["$order","address_id"]),k.listing.address=a.params,z.addressList.push(a.params),k.map=a.params.lat+","+a.params.lng,k.addressString=p.compact([k.listing.address.housename,k.listing.address.address,k.listing.address.locality,k.listing.address.city,k.listing.address.postalcode]).join(", ")),i(function(){k.showMap=!0},500)})},k.socialLinks=[],k.$watch("listing.socialMediaList",function(a,b){p.forEach(k.socialMediaUrlTypes,function(a,b){var c=p.find(k.listing.socialMediaList,{type:b});c?k.socialLinks.push({type:b,name:c.name,url:a.url,title:a.title}):k.socialLinks.push({type:b,name:null,url:a.url,title:a.title})})}),k.openSocialLinksEditor=function(){v=m.open({scope:k,animation:!0,controller:"SocialLinksController",templateUrl:"views/modals/social_links.html"}),v.result.then(function(a){a&&(F.socialMediaList=a)})},k.showMap=!1,k.$watch("listing.address",function(a,b){if(a){var c={};if(a.lat&&a.lng)c.lat=a.lat,c.lng=a.lng,k.map=c.lat+","+c.lng,k.showMap=!0;else{var d=p.values(p.pick(a,["address","locality","city","countryCode"])).join(",");d&&e.getLatLng({address:d}).success(function(a){if("OK"===a.status){var b=a.results[0].geometry.location;p.assign(k.listing.address,b),c.lat=b.lat,c.lng=b.lng,k.listing.address.lat=b.lat,k.listing.address.lng=b.lng,k.listing.address.geoconfirmed=!1,k.map=c.lat+","+c.lng,k.showMap=!0}else console.log(a)})}}}),B={},k.openingHours=B,k.currentHours=function(a){return q().weekday()===parseInt(a)},C=function(){var a=p.flattenDeep(p.map(A.openingHours,function(a,b){return a.ohHours})),b=p.map(p.flattenDeep(p.map(B,function(a,b){return a.ohHours})),function(a){return{end:q(a.end).format("HH:mm"),start:q(a.start).format("HH:mm")}}),c=p.map(A.openingHours,function(a,b){return a.isclosed}),d=p.map(B,function(a,b){return a.isclosed});return!p.isEqual(a,b)||!p.isEqual(c,d)},k.$watch("listing.openingHours",function(a,b){a&&p.forEach(a,function(a,b){B[b]={ohHours:[],isclosed:a.isclosed},B[b].ohHours=p.map(a.ohHours,function(a){return{start:q().day(b).hour(a.start.split(":")[0]).minute(a.start.split(":")[1]).toISOString(),end:q().day(b).hour(a.end.split(":")[0]).minute(a.end.split(":")[1]).toISOString()}})})}),k.openCalendar=function(a,b,c){a.preventDefault(),a.stopPropagation(),p.forEach(B,function(a,b){p.forEach(a.ohHours,function(a){a.open_start&&(a.open_start=!1),a.open_end&&(a.open_end=!1)})}),b[c]=!b[c],b[c.split("_")[1]]=new Date},k.addOpeningHoursTime=function(a){return B[a].ohHours.push({}),!0},k.removeOpeningHoursTime=function(a,b){return p.pullAt(B[a].ohHours,b),!0},k.changeOpeningHours=function(a,b){return b?B[a].ohHours=[]:(B[a].ohHours.push({}),B[a].isclosed=!1),!0},k.$watch("holidays",function(a,b){if(a){var c=a.split("to");F.closedBetween={start:p.trim(c[0]),end:p.trim(c[1])},k.listing.closedBetween={start:p.trim(c[0]),end:p.trim(c[1])},console.log(F.closedBetween)}}),k.deleteHolidays=function(){F=p.omit(F,"closedBetween"),k.listing.closedBetween={start:null,end:null},k.holidays=null},k.serviceAreas=p.map(k.listing.serviceAreaList,function(a){return a.id}),k.$watch("serviceAreas",function(a,b){var c=p.map(a,function(a){return parseInt(a)}),d=p.map(b,function(a){return parseInt(a)});b&&!p.isEqual(c,d)&&(F.serviceAreaList=a)}),k.serviceAreaConfig={maxOptions:4e3,valueField:"id",labelField:"name",placeholder:"Choose a Service Area",sortField:"name",plugins:["remove_button"],searchField:["name"]},d.query(function(a){k.serviceAreaList=a}),k.openAddonsModal=function(){w=m.open({backdrop:"static",keyboard:!1,scope:k,animation:!0,controller:"ListingAddonsController",templateUrl:"views/modals/listing_addons.html"}),w.result.then(function(a){a&&(F.addons=angular.copy(k.listing.addons))})},k.photoGallery={},k.photoGallery.photos=[],k.$watch("listing.photoGallery.title",function(a,b){b&&a!==b&&(F.photoGallery||(F.photoGallery={}),F.photoGallery.title=a)}),k.addPhoto=function(){k.photoGallery.photos.push({})},k.removePhoto=function(a){k.photoGallery.photos.splice(a,1)},k.deletePhoto=function(a){F.photoGallery||(F.photoGallery={}),p.remove(k.listing.photoGallery.photos,function(b){return b.id===a}),F.photoGallery.photos?F.photoGallery.photos.push({id:a}):F.photoGallery.photos=[{id:a}]},k.logo={},k.listing.logo=A.logo||{},k.cropImage=null,k.openCrop=function(){E=m.open({animation:!0,scope:k,controller:"LogoCropController",templateUrl:"views/modals/logo_crop.html"}),E.result.then(function(a){a.params&&p.assign(k.logo,a.params)})},k.deleteLogo=function(){F.photoGallery||(F.photoGallery={photos:[]}),F.photoGallery.photos&&!D&&F.photoGallery.photos.push({id:A.logo.id}),k.listing.logo={},k.logo={}},k.verifiedListing=function(){l.get(window.apiUrl+"/api/v1/listings/"+k.listing.id+"/verifylisting.json").then(function(a){k.listing.verification.verified=!0})},k.saveListing=function(){if((k.listing.address.housename||k.listing.address.address||k.listing.address.locality||k.listing.address.city||k.listing.address.postalcode)&&k.listing.address.county&&k.listing.address.neighbourhood&&k.listing.name.name&&k.listing.classList.length>0){if(k.nameUpdated){var a=p.find(k.customer.nameList,{name:k.listing.name.name});D?a?F.name={id:a.id}:F.name={id:null,name:k.listing.name.name,"new":!0}:k.isNewBusiness?a?F.name={id:a.id}:F.name={id:null,name:k.listing.name.name,"new":!0}:F.name={id:A.name.id,name:k.listing.name.name,"new":!1}}if(C()){var b={};p.forEach(B,function(a,c){b[c]=a}),p.forEach(b,function(a,c){var d=n("toDateName")(c);b[d]={isclosed:b[c].isclosed},b[d].ohHours=p.map(a.ohHours,function(a){return a.start&&a.end?{end:q(a.end).format("HH:mm"),start:q(a.start).format("HH:mm")}:void 0}),delete b[c]}),F.openingHours=[b]}if(k.phoneUpdated()){var c=[];p.each(k.listing.phoneList,function(a){var b=p.find(z.phoneList,{intCode:a.intCode,name:a.name});b?c.push(b):c.push({id:null,intCode:a.intCode,name:a.name,"new":!0})}),F.phoneList=c}console.log(F),x=m.open({animation:!0,scope:k,controller:"ListingSaveController",templateUrl:"views/modals/save.html"})}else g.warning("Name, Categories and Address (including County and Neighbourhood) fields are required!","Warning")},k.deleteListing=function(){u=m.open({animation:!0,scope:k,controller:"ListingDeleteController",templateUrl:"views/modals/delete.html"})}}]),angular.module("lmApp").controller("AddressModalController",["County","Geocode","isAddress","address","$timeout","$q","$scope","$modalInstance","_","$filter",function(a,b,c,d,e,f,g,h,i,j){var k,l;g.address=d,g.address["public"]=d["public"]===!1?!1:!0,g.isAdress=c,e(function(){g.showMap=!c},200),g.isUpdated=!1,g.firstAddress=angular.copy(d),g.addressVals=i.drop(i.values(d)),g.counties=[],a.query(function(a){return g.counties=a,!0}),g.$watch("address.id",function(a,b){if(b&&a!==b||g.isNew){var c=i.find(g.addressList,{id:parseInt(a)});if(c)return g.address=angular.copy(c),g.address["public"]=c["public"]===!1?!1:!0,!0}}),g.$watch("address.county.id",function(a,b){g.selectedNeighbourList=j("filter")(g.neighbourhoodList,{parentId:a})}),g.$watch("address.neighbourhood.id",function(a,b){(a!==b||g.isNew)&&(console.log(a),console.log(b),k=!0)}),g.$watch("address",function(a,b){a&&(i.isEqual(g.addressVals,i.drop(i.values(a)))||(l=i.values(i.pick(g.address,["address","locality","city","countryCode","postalcode"])).join(","),k=!0),g.addressString=i.compact([g.address.housename,g.address.address,g.address.locality,g.address.city,g.address.postalcode]).join(", "))},!0),g.createNewAddress=function(){var a=g.addressList.length,b={address_id:a,id:null,ismain:!0,address:"",housename:"",postalcode:"",city:"",locality:"",county:{id:""},"public":!0,lat:null,lng:null,candelete:!1,countryCode:"IE",geoconfirmed:!1,canupdate:!1,local:"",createDate:"",createdBy:"",createdByProc:"",updateDate:"",updatedBy:"",updatedByProc:"",geoLevel:null,geoMatch:null,"new":!0};return g.addressList.push(b),g.addressList[0].push(b),g.address=b,b},g.addressConfig={valueField:"address_id",labelField:"fullAddress",placeholder:"Choose an address",maxItems:1},g.countyConfig={valueField:"id",labelField:"text",placeholder:"Choose a county",sortField:"text",searchField:["text"],maxItems:1},g.neighbourhoodConfig={valueField:"id",labelField:"name",placeholder:"Select nhood",sortField:"name",searchField:["name"],maxItems:1},g.openLocationEditor=function(){g.isAdress=!1,g.address.lat||g.address.lng||g.getLatLng(),e(function(){g.showMap=!0},200)},g.getLatLng=function(){l?b.getLatLng({address:l}).success(function(a){if("OK"===a.status){var b=a.results[0].geometry.location;g.address.lat=b.lat,g.address.lng=b.lng}else console.log(a)}):(g.address.lat=null,g.address.lng=null)},g.address.lat&&g.address.lng||(l=i.values(i.pick(g.address,["address","locality","city","countryCode","postalcode"])).join(","),g.getLatLng()),g.map={center:{latitude:g.address.lat,longitude:g.address.lng},draggable:!0,zoom:16},g.options={scrollwheel:!1},g.marker={id:0,coords:{latitude:g.address.lat,longitude:g.address.lng},options:{draggable:!0,title:"Drop a location"}},g.$watch("marker.coords.latitude",function(a,b){g.address.lat=a}),g.$watch("marker.coords.longitude",function(a,b){g.address.lng=a}),g.$watch("address.lat",function(a,b){g.marker.coords.latitude=a,g.map.center.latitude=a}),g.$watch("address.lng",function(a,b){g.marker.coords.longitude=a,g.map.center.longitude=a}),g.openAddressEditor=function(){g.isAdress=!0},g.saveAddress=function(){h.close({status:!0,updated:k||g.isNew,params:angular.copy(g.address)})},g.dismissChanges=function(){g.address=g.firstAddress,h.close({status:!1,updated:null})}}]),angular.module("lmApp").controller("LoginController",["Identity","$location",function(a,b){b.path("/"+a.currentCustomer.customerRefNo)}]),angular.module("lmApp").controller("LocationController",["$scope","$modalInstance",function(a,b){a.close=function(){b.close()}}]),angular.module("lmApp").controller("ListingNameCtrl",["$scope","$modalInstance",function(a,b){a.newName=function(){b.close(!0)},a.updateName=function(){b.close(!1)}}]),angular.module("lmApp").controller("ListingSaveController",["Listing","Upload","toastr","$q","$cookies","$window","$http","$timeout","$interval","$scope","$modalInstance","_",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(a,c,d){var e=a[c];return e?void b.upload({url:window.apiUrl+"/api/v1/upload",data:e}).then(function(b){m(a,c+1,d)}):d.resolve("loop completed")}function n(a,b){var d=l.result(b,"data.operationMessage")||"We see that you are experiencing some difficulties in saving your changes - we are working on it and will be in contact with you shortly. Thank you for your patience!";c.error(d),setTimeout(function(){a?f.location.reload():f.location.href="/"+j.customer.customerRefNo},5e3)}function o(a){e.put("notify","Listing saved."),f.location.href="/listings/"+a}function p(){var a=d.defer(),b=[],c=j.customer.id||null,e=j.listing.id||null,f=j.logo;if(l.forEach(j.photoGallery.photos,function(a){b.push({file:a.file,customerId:c,listingId:e})}),f.file){var g={};g.file=f.file,g.top=f.top||!1,g.bottom=f.bottom||!1,g.left=f.left||!1,g.right=f.right||!1,g.customerId=c,g.listingId=e,b.push(g)}return b.length>0?m(b,0,a):a.resolve("No image"),a.promise}function q(a,b){if(a.$resolved)if(j.listing.id=a.listingId,200===a.operationCode){var d=p();d.then(function(a){b?(g.get(window.apiUrl+"/fcrfeeding?customerId="+j.customer.customerRefNo).then(function(a){o(j.listing.id)},function(a){n(j.listing.id,a)}),g.get(window.apiUrl+"/fcrfeedingbc?customerId="+j.customer.customerRefNo).then(function(a){o(j.listing.id)},function(a){n(j.listing.id,a)})):o(j.listing.id)},function(a){n(j.listing.id,a)})}else{var e=l.result(error,a.operationMessage);c.error(e),setTimeout(function(){listingId?f.location.reload():f.location.href="/"+j.customer.customerRefNo},5e3)}}j.saveOnly=function(b){c.warning("Saving...",{timeOut:0}),j.listing.id?a.update({_id:j.listing.id},j.listingChanges).$promise.then(function(a){q(a,b)},function(a){n(j.listing.id,a)}):a.save(j.listingChanges).$promise.then(function(a){q(a,b)},function(a){n(j.listing.id,a)}),k.close()},j.closeModal=function(){k.close()}}]),angular.module("lmApp").controller("ListingAddonsController",["$scope","$modalInstance","_",function(a,b,c){var d;a.$watch("listing.addons",function(a,b){b&&!c.isEqual(a,b)&&(d=!0)},!0),a.closeAddonsModal=function(){b.close({result:d})}}]),angular.module("lmApp").controller("SocialLinksController",["$scope","$modalInstance","_",function(a,b,c){a.sLinksUpdated=!1,a.changeSocialLink=function(){a.sLinksUpdated=!0},a.dismissSocialLinks=function(){b.close()},a.saveSocialLinks=function(){var d;a.sLinksUpdated&&(d=c.compact(c.map(a.socialLinks,function(a){return a.name?{type:a.type,name:a.name}:void 0}))),b.close(d)}}]),angular.module("lmApp").controller("ListingDeleteController",["Listing","$q","$cookies","$scope","$window","$modalInstance",function(a,b,c,d,e,f){d.Listing=a,d.deleteCheck=function(a){return"DELETE"===a},d.deleteConfirm=function(){a["delete"]({_id:d.listing.id}).$promise.then(function(a){c.put("notify","Listing deleted successfully."),e.location.href="/"+d.customer.customerRefNo},function(a){c.put("notify","Something went wrong!"),console.log(a),e.location.reload()}),f.close()},d.closeDeleteModal=function(){f.close()}}]),angular.module("lmApp").controller("LogoCropController",["$scope","$modalInstance","_",function(a,b,c){var d=Math.max(document.documentElement.clientWidth,window.innerWidth||0);320>=d?a.canvasWidth=200:a.canvasWidth=500,a.cropper={},a.cropper.sourceImage=null,a.cropper.croppedImage=null,a.bounds={},a.bounds.left=0,a.bounds.right=0,a.bounds.top=0,a.bounds.bottom=0,a.saveLogo=function(){b.close({params:angular.copy(a.bounds)})},a.closeLogoCrop=function(){b.close({params:null})}}]),angular.module("lmApp").filter("selectMain",["_",function(a){return function(b){return a.find(b,function(a){return 1===a.ismain})}}]),angular.module("lmApp").filter("capitalize",function(){return function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}}),angular.module("lmApp").directive("combobox",["_",function(a){return{restrict:"A",replace:!0,transclude:!0,link:function(b,c,d){var e,f,g,h={primary_key:"id"};d.comboname?(b.listing?f=a.result(b.listing,d.comboname):b.account&&(f=a.result(b.account,d.comboname)),f&&(e=f.id)):e=parseInt(d.defaultVal),e&&(h.init_record=[e]),"phoneOptions"===d.options&&(h.primary_key="phoneId"),g=angular.copy(a.result(b,d.options)),c.ajaxComboBox(g,h),c.keyup(function(a){13===a.keyCode&&$(".ac_result_area").hide()})}}}]),angular.module("lmApp").directive("daterangepicker",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.dateRangePicker({autoClose:!0,singleMonth:!0,showShortcuts:!0,shortcuts:{"next-days":[3,5,7]},format:"DD-MM-YYYY",setValue:function(b){a.$apply(function(){d.$setViewValue(b),d.$render()})}})}}}),angular.module("lmApp").directive("staticgooglemap",function(){return{template:'<div class="static-map"><img src="{{ gmapStaticUrl }}?{{ urlParams }}" /></div>',restrict:"E",scope:!1,link:function(a,b,c){var d=c.mapCoords,e={center:d,zoom:16,size:"550x300",markers:"color:red%7C"+d,key:"AIzaSyA-BD465yhF0iaxB8fLGLg87GjhU1ksPqQ"};a.gmapStaticUrl="https://maps.googleapis.com/maps/api/staticmap",a.urlParams=decodeURIComponent($.param(e))}}}),angular.module("lmApp").factory("ServiceArea",["$resource",function(a){var b=a(window.apiUrl+"/api/v1/service_areas.json");return b}]),angular.module("lmApp").filter("toDateName",[function(){var a={1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri",6:"Sat",7:"Sun"};return function(b){var c=b.toString();return a[c]}}]),angular.module("lmApp").factory("Coupon",["$http",function(a){return{getListingCoupons:function(b){return a.get("https://customer.getcoupons.ie/api/deals/in?listing="+b)}}}]),angular.module("lmApp").run(["$templateCache",function(a){"use strict";a.put("views/account.html",'<div class="container drawer-overlay dashboard-main"><div class="row bc-main"><form name=accountForm role=form id=myaccount class=form-horizontal><div class=row><div class=col-md-6 br><div class="panel panel-default"><div class=panel-heading>Your Business</div><input name=accountId value="" type=hidden><div class=form-group><label class="col-md-4 control-label">Business Name *</label><div class=col-md-8><div class=row><div class=col-md-12><div class=input-group><input ng-model=account.name.name comboname=name options=customer.nameList ng-keypress=newName($event) ng-blur=newName($event) combobox id=accountName></div></div></div></div></div><div class=form-group><label class="col-md-4 control-label">Main Address *</label><div class=col-md-8><div class=row><div class=col-md-12><div class="input-group input-group-sm"><input ng-click=openAddress(true) class="form-control input-sm addr" name=address id=bc_address readonly placeholder="{{ addressString }}"></div></div></div></div></div><div class=form-group><label class="col-md-4 control-label">Contact Name</label><div class=col-md-8><div class=row><div class=col-md-12><div class=input-group><input ng-model=account.contactPerson.name comboname=contactPerson options=customer.contactPersonList ng-blur=newContactPerson($event) ng-keypress=newContactPerson($event) combobox id=contactPersonName></div></div></div></div></div><div class=form-group><label class="col-md-4 control-label">Job Title</label><div class=col-md-8><div class=row><div class=col-md-12><div class="input-group input-group-sm"><input autocomplete=off class="form-control input-sm addr" ng-model=account.contactPerson.jobTitle placeholder="example (Owner, Manager, Sales Asssitant)"></div></div></div></div></div><div class=form-group><label class="col-md-4 control-label">Contact Email</label><div class=col-md-8><div class=row><div class=col-md-12><div class=input-group><input type=email autocomplete=off name=email class="form-control input-sm addr" ng-model=account.contactPerson.email placeholder="Add your email address"> <span class=form-error ng-show=accountForm.$error.email>Please enter a valid email.</span></div></div></div></div></div><div class="form-group phone-field phone-fields"><label class="col-md-4 control-label">Phone</label><div class=col-md-8><div class=row><div ng-repeat="phoneNumber in account.phoneList" class="col-md-12 phone-number"><div class=input-group><select class="form-control input-sm" ng-model=phoneNumber.intCode ng-options="int_code as int_code for int_code in int_codes" name="code-{{ $index }}"></select><input ng-model=phoneNumber.name default-val="{{ phoneNumber.id }}" options=phoneOptions ng-change="changePhone($index, phoneNumber.id)" ng-keypress=newPhoneNumber($event.keyCode) combobox id="phoneVal_{{ $index }}"> <span class=input-group-btn><a class="btn btn-default" ng-click=deleteNumber($index)><i class="fa fa-trash-o fa-lg"></i></a></span></div></div><div class="col-md-12 add-phone"><a class="btn btn-primary btn-sm" ng-click=addPhoneNumber()><i class="fa fa-plus fa-custom"></i>Add number</a></div></div></div></div><div class="form-group phone-field"><label class="col-md-4 control-label">Fax</label><div class=col-md-8><div class=row><div class=col-md-12><div class="input-group input-group-sm phone-number"><select class="form-control input-sm" ng-model=account.fax.intCode ng-options="int_code as int_code for int_code in int_codes"></select><input ng-model=account.fax.name comboname=fax options=customer.faxList ng-blur=newFaxNumber($event) ng-keypress=newFaxNumber($event) combobox id=faxVal></div></div></div></div></div></div></div><div class=col-md-6><div class="panel panel-default"><div class=panel-heading>Your Account</div></div><div class="form-group meta"><span class="col-md-4 metalabel">Your Account ID</span><div class=col-md-8><div class=row><div class=col-md-12><span class=metadata>{{ account.customerRefNo }}</span></div></div></div></div><div class="form-group meta"><span class="col-md-4 metalabel">Account Created</span><div class=col-md-8><div class=row><div class=col-md-12><span class=metadata>{{ account.createDate | date:"MM/dd/yyyy \'at\' h:mma" }}</span></div></div></div></div><div class="form-group meta"><span class="col-md-4 metalabel">Status (Type)</span><div class=col-md-8><div class=row><div class=col-md-12><span class=metadata>Verified (Starter)</span></div></div></div></div><div class="form-group meta"><span class="col-md-4 metalabel"></span><div class=col-md-8><div class=row><div class=col-md-12><span class=metadata><a href=# ng-click=openDeleteInfo()>delete this account</a></span></div></div></div></div><hr><div class="col-md-8 col-md-offset-4"><p class=small><strong>Support<br></strong> Please call <a href=tel:+35316188000>+353 1 618 8000</a> to chat to one of our team about your account, alternatively you can email <a href=mailto:info@goldenpages.ie>sales@goldenpages.ie</a><br><br><a href=http://goldenpages.ie>Goldenpages.ie</a> is an <a href=http://fcrmedia.ie>FCR Media</a> company, we are a specialised digital agency, sales and marketing company in Ireland providing local search and advertising products for SMEs across mobile, online and print platforms.</p></div></div></div></form></div><div class=panel-footer><div class=row><div class="col-md-2 col-md-offset-4 col-xs-5"></div><div class="col-md-6 col-xs-7"><button class="btn btn-main btn-block btn-disable" type=submit ng-click=saveAccount()>Save Changes</button></div></div></div></div>'),a.put("views/dashboard.html",'<div class="container drawer-overlay dashboard-main"><div class="row bc-main"><div class="panel panel-default listing-panel"><div class="litem litem-{{ listings.length }}" ng-repeat="listing in listings" ng-init="$last ? activateSlider() : angular.noop()"><div class=ldetail><h2>{{ listing.name.name }}</h2><p>{{ listing.addressString }}</p></div><ul class=laction><li><a target=_blank href="{{ listing.listing_view_url }}">view</a></li><li><a href=javascript: ng-click="showSocialButtons=!showSocialButtons">share</a></li><li><a href="/listings/{{ listing.id }}">edit</a></li></ul><div class=socialrow ng-init="showSocialButtons=false"><a ng-show=showSocialButtons href="https://www.facebook.com/sharer/sharer.php?u={{ listing.listing_view_url }}" onclick="window.open(this.href, \'\', \'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600\');return false" target=_blank title="Share on Facebook"><i class="fa fa-facebook fa-2x"></i></a> <a ng-show=showSocialButtons href="https://twitter.com/share?url={{ listing.listing_view_url }}&text={{ listing.name.name }}" onclick="window.open(this.href, \'\', \'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600\');return false" target=_blank title="Share on Twitter"><i class="fa fa-twitter fa-2x"></i></a> <a ng-show=showSocialButtons href="https://plus.google.com/share?url={{ listing.listing_view_url }}" onclick="window.open(this.href, \'\', \'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=350,width=530\');return false" target=_blank title="Share on Google+"><i class="fa fa-google-plus fa-2x"></i></a> <a ng-show=showSocialButtons href="mailto:?&subject={{ listing.name.name }}%20details&body=Here%20are%20the%20details%20for%20{{ listing.name.name }}%3A%20%20{{ listing.listing_view_url }}"><i class="fa fa-envelope-o fa-2x"></i></a></div><div class="lmeta row"><div class=col-xs-4>Categories</div><div class=col-xs-8><span ng-class={latest:$last} class=service ng-repeat="service in listing.classList">{{ service.name }}</span></div><div class=col-xs-4>Status</div><div class=col-xs-8>{{listing.status.name}}</div><div class=col-xs-4>Verified</div><div class=col-xs-8><a ng-show=!listing.verification.verified class=list-group-item-warning href="/listings/{{ listing.id }}">No, Please Verify Listing</a> <span ng-show=listing.verification.verified>Yes</span></div><div class=col-xs-4>Last Edit</div><div class=col-xs-8>{{ listing.status.lastEdit | date:"dd/MM/yyyy \'at\' h:mma" }}</div><div class=col-xs-4><button type=button class="btn btn-xs btn-info" ng-click=openAddonsModal(listing)>Add Ons</button></div><div class=col-xs-8>Location, Opening Hours (<a class=addonS href=# ng-click=openAddonsModal(listing)>6 available</a>)</div></div></div></div><div class=clearfix></div><a class="addmore btn" href=/listings/new><i class="fa fa-plus fa-custom"></i>Add another location to<br>goldenpages.ie</a></div><div class="row bc-main"><h3 class=newfcr><span>What\'s new from FCR Media</span></h3><div class="panel panel-default col-md-4 sponsor-panel"><span><img class=dashlogos src=assets/images/sayhi-logo.png style="margin:0 auto"></span><p class=small>SayHi WiFi is a little box which connects to your business\'s existing broadband, allowing you to offer your customers free WiFi while in your premises. In turn, they share with you their contact information so you can stay in touch with them and \'SayHi\' long after their visit!</p><div class=panel-footer><a class="btn btn-block btn-primary btn-sm" role=button href="http://getcoupons.ie/" target=_blank>more info</a></div></div><div class="panel panel-default col-md-4 sponsor-panel"><span><img class=dashlogos src=assets/images/image001_srcset-large.png style="margin:0 auto"></span><p class=small>SnapSync insures your business information is correctly listed on Ireland\'s top directories and social platforms like goldenpages.ie and Facebook. The SnapSync network includes 14 directories with more to come and it also includes Google Plus and GPS Networks such as Here, NavFree, TomTom in addition to the powerful review site Yelp.</p><div class=panel-footer><a class="btn btn-block btn-primary btn-sm" role=button href="http://getcoupons.ie/" target=_blank>more info</a></div></div><div class="panel panel-default col-md-4 sponsor-panel"><span><img class=dashlogos src=assets/images/sayhi-logo.png style="margin:0 auto"></span><p class=small>SayHi WiFi is a little box which connects to your business\'s existing broadband, allowing you to offer your customers free WiFi while in your premises. In turn, they share with you their contact information so you can stay in touch with them and \'SayHi\' long after their visit!</p><div class=panel-footer><a class="btn btn-block btn-primary btn-sm" role=button href="http://getcoupons.ie/" target=_blank>more info</a></div></div></div></div><script>$(document).ready(function(){\n    $(".drawer").drawer();\n  });</script>'),a.put("views/listing.html",'<div ng-if="!listing.verification.verified && !isNew" class=verify-info><h5>Click <a ng-click=verifiedListing() type=button href=# id=verify-listing class="btn btn-sm btn-warning">Verify</a> To Confirm This Listing Is Correct</h5></div><div ng-class="{notVerified: !listing.verification.verified && !isNew}" class="container drawer-overlay dashboard-main"><div class="row bc-main"><form name=listingForm role=form id=mylisting class=form-horizontal><div class=row><div class=col-md-6 br><div class="panel panel-default"><div class=panel-heading>Your Business</div><input name=listingId value="" type=hidden><div class=form-group><label class="col-md-4 control-label">Business Name *</label><div class=col-md-8><div class=row><div class=col-md-12><div class=input-group><input ng-model=listing.name.name comboname=name options=customer.nameList ng-keypress=newName($event) ng-blur=newName($event) combobox id=listingName></div></div></div></div></div><div class=form-group><label class="col-md-4 control-label">Main Categories *</label><div class=col-md-8><div class=row><div class=col-md-12><div class=input-group><selectize ng-model=categories options=categoriesList config=categoryConfig></selectize></div></div></div></div></div><div class="form-group email-fields phone-field phone-fields"><label class="col-md-4 control-label">Business Email</label><div class=col-md-8><div class=row><div class="col-md-12 phone-number"><div class=input-group><input ng-model=listing.email.name comboname=email options=customer.emailList ng-keypress=newEmail($event) ng-blur=newEmail($event) combobox id=emailVal type=email> <span class=input-group-btn><a class="btn btn-default" ng-click=deleteEmail()><i class="fa fa-trash-o fa-lg"></i></a></span></div></div></div></div></div><div class=form-group><label class="col-md-4 control-label">Logo</label><div class=col-md-8><div class=row><div class=col-md-12><div class="input-group input-group-sm"><div class=file-preview><div ng-show=logo.file class=thumb-view style="width: 50%; height: 100px; line-height: 100px"><img class=img-thumbnail ngf-src=logo.file data-holder-rendered=true style="width: 150px; height: 100px"></div><div ng-show=!logo.file class=thumb-view style="width: 50%; height: 100px; line-height: 100px"><img class=img-thumbnail src="{{ listing.logo.path }}" data-holder-rendered=true style="width: 150px; height: 100px"></div><div class=logo-buttons><span class="btn btn-xs btn-default btn-file"><span ng-hide="logo.file || listing.logo.path">Select image</span> <span ng-show="logo.file || listing.logo.path">Change</span> <input type=file ngf-select="" img-cropper-fileread ng-model=logo.file image=cropImage accept="image/*"></span> <a ng-show=logo.file ng-click=openCrop() href=# class="btn btn-xs btn-default btn-info">Edit</a> <a ng-show="logo.file || listing.logo.path" href=# ng-click=deleteLogo() class="btn btn-xs btn-default btn-danger">X</a></div></div></div></div></div></div></div><div class=form-group><label class="col-md-4 control-label">Website</label><div class=col-md-8><div class=row><div class=col-md-12><div class="input-group input-group-sm"><input ng-model=listing.website.name name=website comboname=website options=customer.websiteList ng-keypress=newWebsite($event) ng-blur=newWebsite($event) combobox id=websiteVal> <span class=input-group-btn><a class="btn btn-default" ng-click=deleteWebsite()><i class="fa fa-trash-o fa-lg"></i></a></span></div><span class=form-error ng-show=listingForm.website.$error.pattern>Please enter a valid URL.</span></div></div></div></div><div class=form-group><label class="col-md-4 control-label">Description</label><div class=col-md-8><div class=row><div class=col-md-12><div class="input-group input-group-sm"><textarea rows=3 ng-model=listing.description.name class="form-control ac_textarea" ng-maxlength=1024 maxlength=1024 placeholder="Add a description"></textarea></div></div></div></div></div><div class="form-group phone-field phone-fields"><label class="col-md-4 control-label">Phone</label><div class=col-md-8><div class=row><div ng-repeat="phoneNumber in listing.phoneList" class="col-md-12 phone-number"><div class=input-group><select class="form-control input-sm" ng-model=phoneNumber.intCode ng-options="int_code as int_code for int_code in int_codes" name="code-{{ $index }}"></select><input ng-model=phoneNumber.name default-val="{{ phoneNumber.id }}" options=phoneOptions ng-change="changePhone($index, phoneNumber.id)" ng-keypress=newPhoneNumber($event.keyCode) combobox id="phoneVal_{{ $index }}"> <span class=input-group-btn><a class="btn btn-default" ng-click=deleteNumber($index)><i class="fa fa-trash-o fa-lg"></i></a></span></div></div><div class="col-md-12 add-phone"><a class="btn btn-primary btn-sm" ng-click=addPhoneNumber()><i class="fa fa-plus fa-custom"></i>Add number</a></div></div></div></div><div class="form-group phone-field"><label class="col-md-4 control-label">Fax</label><div class=col-md-8><div class=row><div class=col-md-12><div class="input-group input-group-sm phone-number"><select class="form-control input-sm" ng-model=listing.fax.intCode ng-options="int_code as int_code for int_code in int_codes"></select><input combobox ng-model=listing.fax.name comboname=fax options=customer.faxList ng-keypress=newFaxNumber($event) ng-blur=newFaxNumber($event) id=faxVal> <span class=input-group-btn><a class="btn btn-default" ng-click=deleteFax()><i class="fa fa-trash-o fa-lg"></i></a></span></div></div></div></div></div><div class=form-group><label class="col-md-4 control-label">Main Address *</label><div class=col-md-8><div class=row><div class=col-md-12><div class="input-group input-group-sm"><a ng-click=openAddress(true) class="form-control input-sm addr" id=bc_address>{{ addressString }}</a></div></div></div></div></div><div class=form-group><label class="col-md-4 control-label">Social Media and Apps</label><div class=col-md-8><div class=row><div class=col-md-12><div class="input-group input-group-sm"><div class="social btn-group" role=group aria-label="apps and social media links"><a ng-click=openSocialLinksEditor() type=button class="btn btn-sm btn-default" ng-repeat="(logo, socialLink) in socialMediaUrlTypes"><i class="fa fa-{{ logo }}"></i></a></div></div></div></div></div></div><div class="form-group listing-map"><div class=col-md-12 ng-if=showMap><div class=panel-heading><span>Add-On -</span> Location &amp; Directions</div><staticgooglemap map-coords="{{ map }}" ng-if=showMap></staticgooglemap><br><a class="btn btn-xs btn-primary" style=margin-bottom:10px ng-click=openAddress(false)>Edit Geo Locations</a></div></div><div class="panel panel-default oh-panel"><div class=panel-heading><span>Add-On -</span> Opening Hours</div><div class=panel-body><table class="hours table" ng-show=showOhEditor><tbody><tr ng-repeat="(day, times) in openingHours" ng-class="{\'status-opened\': currentHours(day)}"><td>{{ day | toDateName | capitalize }}</td><td ng-repeat="time in times.ohHours">{{ time.start | date:"HH:mm" }} - {{ time.end | date:"HH:mm" }}</td><td ng-if="times.isclosed === null || times.isclosed === undefined">No Opening Hours</td><td ng-if="times.isclosed === true">Closed</td><td ng-show="times.ohHours.length < 2"></td></tr></tbody></table><table ng-show=showOhEditor class="hours table" ng-if="listing.closedBetween.start && listing.closedBetween.end"><tbody><tr><td class=col-md-4>Closed Between</td><td class=col-md-8>{{ listing.closedBetween.start}} to {{ listing.closedBetween.end }}</td></tr></tbody></table><div class=edit-hours ng-hide=showOhEditor><div class="row day-row" ng-repeat="(day, time_vals) in openingHours"><div class="col-xs-12 col-sm-12 col-md-3"><div class="input-group input-group-sm"><label for=inlinecheckbox><input type=checkbox ng-model=time_vals.isclosed ng-change="changeOpeningHours(day, time_vals.isclosed)"> {{ day | toDateName | capitalize }} <span ng-if="time_vals.isclosed === false">Open</span></label></div></div><div class="col-xs-12 col-sm-12 col-md-9"><span class=add-oh-label ng-if="time_vals.isclosed === true">Closed</span> <span class=add-oh-label ng-if="time_vals.isclosed === null || time_vals.isclosed === undefined"><a href=# ng-click="changeOpeningHours(day, time_vals.isclosed)">Add Opening Hours</a></span><div class=row ng-repeat="time in time_vals.ohHours"><div class="col-xs-5 col-sm-4 col-md-3"><div class="input-group input-group-sm"><span class=input-group-addon><span ng-click="openCalendar($event, time, \'open_start\')" class="glyphicon glyphicon-time"></span></span> <a type=text ng-click="openCalendar($event, time, \'open_start\')" class="form-control input-sm time-input" datetime-picker="hh:mm a" date-format="hh:mm a" ng-model=time.start is-open=time.open_start enable-date=false show-button-bar=false close-on-selection=true>{{ time.start | date:"hh:mm a" }}</a></div></div><div class="col-xs-2 col-sm-1 col-md-2 to-text"><div class="input-group input-group-sm"><p>to</p></div></div><div class="col-xs-5 col-sm-4 col-md-3"><div class="input-group input-group-sm"><span class=input-group-addon><span ng-click="openCalendar($event, time, \'open_end\')" class="glyphicon glyphicon-time"></span></span> <a type=text ng-click="openCalendar($event, time, \'open_end\')" class="form-control input-sm time-input" datetime-picker="hh:mm a" date-format="hh:mm a" ng-model=time.end is-open=time.open_end enable-date=false show-button-bar=false close-on-selection=true>{{ time.end | date:"hh:mm a" }}</a></div></div><div class="col-xs-12 col-sm-3 col-md-4"><div class="input-group input-group-sm"><p><a href=javascript:void(0) ng-click="" ng-if="$index == 0 && time_vals.ohHours.length > 1">and</a> <a href=javascript:void(0) ng-click="removeOpeningHoursTime(day, $index)" ng-if="$index == 1 && time_vals.ohHours.length > 1">remove</a> <a href=javascript:void(0) ng-click=addOpeningHoursTime(day) ng-if="time_vals.ohHours.length == 1">split hours</a></p></div></div></div></div></div><div class="row holiday-row"><div class="col-xs-12 col-sm-12 col-md-3"><label>Holidays</label></div><div class="col-xs-12 col-sm-12 col-md-9"><div class=input-group><span class=input-group-addon><i class="glyphicon glyphicon-time"></i></span> <input ng-model=holidays daterangepicker id=closedbetween size=40 start-date="{{ closedBetween.start }}" end-date="{{ closedBetween.end }}" name=closedbetween readonly class=form-control> <span class=input-group-btn><a class="btn btn-default" ng-click=deleteHolidays() tooltip="Delete holidays" tooltip-placement=right><i class="fa fa-trash-o fa-lg"></i></a></span></div></div></div></div></div><a class="btn btn-xs btn-primary" style=margin-bottom:10px ng-click="showOhEditor = !showOhEditor" ng-show=showOhEditor ng-init="showOhEditor=true">Edit Opening Hours</a> <a class="btn btn-xs btn-main" style=margin-bottom:10px ng-click="showOhEditor = !showOhEditor" ng-hide=showOhEditor ng-init="showOhEditor=true">Confirm</a></div></div></div><div class=col-md-6><div id=addondiv class="panel panel-default"><p style=text-align:center><strong>Add-on\'s</strong> allow you to enhance your goldenpages.ie listing, showcase your company and improve your searchablity</p><a class="btn btn-addon btn-block" type=button ng-click=openAddonsModal()>View Add-ons</a></div><div ng-show=listing.addons.photoGallery class=addoncontainer id=collapsiblephoto aria-expanded=true><div class=panel-heading><span>Add-On -</span> Photo Gallery</div><div class=form-group><label class="col-md-4 control-label">Album Title</label><div class=col-md-8><div class=row><div class=col-md-12><div class="input-group input-group-sm"><input ng-model=listing.photoGallery.title autocomplete=off class="form-control input-sm" name=photoGallery[title] placeholder="Photo Album Title"></div></div></div></div></div><div class=form-group><div class="photo-box col-sm-4 col-xs-6" ng-repeat="photo in listing.photoGallery.photos"><div class="fileinput fileinput-exists"><div class="fileinput-preview thumbnail" style="width: 100%; height: 100px; line-height: 100px"><img src="{{ photo.path }}"></div><div><a class="btn btn-danger btn-sm" ng-click=deletePhoto(photo.id)><i class="fa fa-trash-o"></i> Delete Photo</a></div></div></div><div class="photo-box col-sm-4 col-xs-6" ng-repeat="photo in photoGallery.photos"><div class=fileinput-preview style="height: 100px; line-height: 100px"><img ng-show=photo.file class=img-thumbnail ngf-src=photo.file data-holder-rendered=true style="width: 150px; height: 100px"> <img ng-hide=photo.file class=img-thumbnail src="" data-holder-rendered=true style="width: 150px; height: 100px"></div><div class=logo-buttons><span ng-hide=photo.file class="btn btn-xs btn-default btn-file"><span>Select image</span> <input type=file ngf-select="" ng-model=photo.file accept="image/*"></span><div ng-show=photo.file><a class="btn btn-danger btn-sm" ng-click=removePhoto($index)><i class="fa fa-trash-o"></i> Delete Photo</a></div></div></div><div class="col-md-12 add-phone"><a class="btn btn-primary btn-sm" ng-click=addPhoto()><i class="fa fa-plus fa-custom"></i>Add photo</a></div></div></div><div ng-show=listing.addons.serviceAreas class=addoncontainer id=collapsiblelockeyword><div class=panel-heading><span>Add-On -</span>All Area\'s You Serve</div><p><small>Make your business visible to more customers searching for your service in their counties, cities, towns, or neighbourhood\'s that you select below</small></p><div class=form-group><label class="col-md-4 control-label">Areas Your Serve</label><div class=col-md-8><div class=row><div class=col-md-12><div class="input-group input-group-sm"><selectize ng-model=serviceAreas options=serviceAreaList config=serviceAreaConfig></selectize></div></div></div></div></div></div><div ng-show=listing.addons.reviews class="panel panel-default" id=collapsiblereview style="border:1px solid #3AABD5; padding:15px"><div class=row><div class=col-sm-4><img class=addonlogo src=assets/images/sayso.png width="100%"></div><p>Reviews are now turned on. Reviews of your services or products will show on your listing when people search and view it online. Research shows that customers are significantly more likely to contact you after reading a review.</p></div><hr><p class=small style=text-align:center;margin-top:5px>Log into your <a href=http://getcoupons.ie>business centre</a> account to see all reviews for your business.</p></div><div ng-show=listing.addons.coupons id=collapsiblecoupon><div class="panel panel-default" style="border:1px solid #F45A31; padding:15px"><div class=row><div class=col-sm-4><img class=addonlogo src="assets/images/getcoupons.png"></div><div class=col-sm-8>Show your active getcoupons when people search and view this listing online.</div></div><hr><div class="form-group coupon"><span class="col-md-4 couponlabel">Currently Active Coupons</span><div class=col-md-8><div class=row><div class=col-md-12><ul><li ng-repeat="coupon in coupons.deals">{{ coupon.title }}</li></ul><a ng-if=coupons.isActive href=http://getcoupons.ie target=_blank>add more coupons</a> <a ng-if=!coupons.isActive class="btn btn-block btn-coupon" role=button href=http://getcoupons.ie target=_blank>View All Coupons</a></div></div></div></div><p class=small style=text-align:center;margin-top:5px>Log into your <a href=http://businesscentre.goldenpages.ie target=_blank>business centre</a> account to create a getcoupon. It will be included on getcoupons.ie, and across the goldenpages.ie platform when people search for your service, product, or company.</p></div></div></div></div></form><div class=panel-footer><div class=row><div class="col-md-3 col-xs-6"><a class="btn btn-delete btn-block delete" type=button ng-click=deleteListing()>Delete Listing</a></div><div class="col-md-6 col-xs-6"><a class="btn btn-main btn-block btn-disable" type=submit ng-click=saveListing()>Save Changes</a></div></div></div></div></div>'),
//a.put("views/login.html",""),a.put("views/modals/address.html",'<form id=addressEditor class=form-horizontal><div class=modal-header><button type=button class=close ng-click=dismissChanges() aria-label=Close><span aria-hidden=true>&times;</span></button><div class=modal-title><h4 id=addonslLabel>Address</h4><small>You can create or edit your address and location</small></div></div><div class=modal-body><div class=aditem ng-show=isAdress><div class="row existingaddr"><div class=form-group style=margin-top:20px><label class="col-md-4 control-label">Edit or Choose From An Existing Address</label><div class=col-md-4><div class="input-group input-group-sm"><selectize ng-model=address.id options=addressList config=addressConfig></selectize></div></div><label class="col-md-2 control-label address-create">Or Create New One</label><div class=col-md-2><a class="btn btn-info btn-sm create-button" ng-click=createNewAddress()>Create Address</a></div></div></div><div class="row modalbg enteraddr"><div class=row><div class="col-sm-4 col-md-4"><div class=form-group><label for=housename class="control-label col-sm-12 col-md-4">House#</label><div class="col-sm-12 col-md-8"><input autocomplete=off ng-model=address.housename class="form-control input-sm" value="{{ address.housename }}"></div></div></div><div class="col-sm-8 col-md-8"><div class=form-group><label for=address class="control-label col-sm-12 col-md-2">Address&nbsp;1</label><div class="col-sm-12 col-md-10"><input autocomplete=off ng-model=address.address name=address class="form-control input-sm" value="{{ address.address }}"></div></div></div></div><div class=row><div class="col-sm-4 col-md-4"><div class=form-group><label for=locality class="control-label col-sm-12 col-md-4">Address&nbsp;2</label><div class="col-sm-12 col-md-8"><input autocomplete=off ng-model=address.locality class="form-control input-sm" value="{{ address.locality }}"></div></div></div><div class="col-sm-4 col-md-4"><div class=form-group><label for=city class="control-label col-sm-12 col-md-4">City</label><div class="col-sm-12 col-md-8"><input autocomplete=off ng-model=address.city class="form-control input-sm" value="{{ address.city }}"></div></div></div><div class="col-sm-4 col-md-4"><div class=form-group><label class="control-label col-sm-12 col-md-4">Postal Code</label><div class="col-sm-12 col-md-8"><input autocomplete=off id=postalcode ng-model=address.postalcode name=postalcode class="form-control input-sm" value="{{ address.postalcode }}"></div></div></div></div><div class=row><div class="col-sm-4 col-md-4"><div class=form-group><label class="control-label col-sm-12 col-md-4">County *</label><div class="col-sm-12 col-md-8"><selectize ng-model=address.county.id options=counties config=countyConfig></selectize></div></div></div><div class="col-sm-4 col-md-4"><div class=form-group><label class="control-label col-sm-12 col-md-4">Neighbourhood *</label><div id=neighbourhood class="col-sm-12 col-md-8"><selectize ng-model=address.neighbourhood.id options=selectedNeighbourList config=neighbourhoodConfig></selectize></div></div></div><div class="col-sm-4 col-md-4"><div class=form-group><label class="control-label col-xs-6 col-sm-6">Make Address Public</label><div class="col-xs-6 col-sm-6"><div class="input-group input-group-sm"><div class="radio radio-primary radio-inline"><input id=inlineRadio1 ng-model=address.public ng-value=true value=true name=radioInline type=radio><label for=inlineRadio1>Yes</label></div><div class="radio radio-inline"><input id=inlineRadio2 ng-model=address.public ng-value=false value=false name=radioInline type=radio><label for=inlineRadio2>No</label></div></div></div></div></div></div></div></div><div class=aditem ng-hide=isAdress><div class=row><small>Please reset/confirm your geo-location by dragging the pin and clicking confirm.</small><hr><div class=col-md-12 ng-if=showMap id=mapEditor><ui-gmap-google-map center=map.center zoom=map.zoom draggable=true options=options><ui-gmap-marker coords=marker.coords options=marker.options idkey=marker.id></ui-gmap-marker></ui-gmap-google-map></div><div class=clearfix></div><hr><div class=col-lg-6><div class=input-group><label class=address-content>Address</label><input class="form-control input-sm" name=addressText value="{{ addressString }}" disabled> <span class="input-group-btn find-here"><button tooltip="Find location from address" ng-click=getLatLng() tooltip-placement=bottom class="btn btn-info" type=button><i class="fa fa-crosshairs fa-lg"></i></button></span></div></div><div class=col-md-3><div class=form-group><label class=latitude>Latitude</label><input class="form-control input-sm" name=lat ng-model=address.lat></div></div><div class=col-md-3><div class=form-group><label class=longitude>Longitude</label><input class="form-control input-sm" name=lng ng-model=address.lng></div></div></div></div></div></form><div class="modal-footer text-right"><button class="btn btn-delete pull-left" type=button data-toggle=modal data-dismiss=modal ng-click=dismissChanges()>Cancel</button> <button class="btn btn-success" ng-hide=isAdress store=bc_address ng-click=saveAddress()>Confirm</button> <button class="btn btn-success" store=bc_address ng-show=isAdress ng-click=openLocationEditor()>Next <i class="fa fa-chevron-right"></i></button></div>'),a.put("views/modals/delete.html",'<div class=modal-header><button type=button class=close data-dismiss=modal aria-label=Close><span aria-hidden=true ng-click=closeDeleteModal()>×</span></button><h4 class=modal-title id=myModalLabel>Delete</h4></div><div class=modal-body><div class=form-group><label for=recipient-name class=control-label>Type \'DELETE\' in UPPERCASE in the box below, then click on Delete Listing to confirm your request.</label><input ng-model=deleteValidation class=form-control id=deleteok></div></div><div class=modal-footer><div class=col-md-12><button type=button class="btn btn-default" ng-click=closeDeleteModal() data-dismiss=modal>Cancel</button> <button type=button class="btn btn-danger" ng-click=deleteConfirm() ng-disabled=!deleteCheck(deleteValidation)>Delete Listing</button></div></div>'),a.put("views/modals/delete_info.html","<div class=modal-header><button type=button class=close data-dismiss=modal aria-label=Close><span ng-click=closeDeleteInfoModal() aria-hidden=true>×</span></button><h4 class=modal-title id=myModalLabel>Close Account</h4></div><div class=modal-body><div class=form-group><p style=text-align:center>Please contact <a href=tel:+35316188000>000 0000000</a> to chat to one of our team about closing your account and deleting your listings, alternatively you can email <a href=mailto:sales@goldenpages.ie>sales@goldenpages.ie</a><br></p></div></div>"),a.put("views/modals/listing_addons.html",'<div class=modal-header><button type=button class=close ng-click=closeAddonsModal()><span aria-hidden=true>×</span></button><h4 class=modal-title id=addonslLabel>Goldenpages.ie Listing Add-Ons</h4></div><div class=modal-body><ul class=list-group><li class=list-group-item><span class=switch><div class="btn-group btn-locked-toggle"><input bs-switch type=checkbox switch-active=false ng-model=listing.addons.location switch-size="mini"></div></span> Location / Directions</li><li class=list-group-item><span class=switch><div class="btn-group btn-locked-toggle"><input bs-switch type=checkbox switch-active=false ng-model=listing.addons.openingHours switch-size="mini"></div></span> Opening Hours</li><li class=list-group-item><span class=switch><div class="btn-group btn-locked-toggle"><input bs-switch type=checkbox switch-active=false ng-model=listing.addons.photoGallery switch-size="mini"></div></span> Photo Gallery</li><li class=list-group-item><span class=switch><div class="btn-group btn-toggle"><input bs-switch type=checkbox switch-active="{{ listing.addons.isActive }}" ng-model=listing.addons.serviceAreas switch-size="mini"></div></span> All Area\'s You Serve</li><li class=list-group-item><span class=switch><div class="btn-group btn-locked-toggle"><input bs-switch type=checkbox switch-active=false ng-model=listing.addons.reviews switch-size="mini"></div></span> Reviews</li><li class=list-group-item><span class=switch><div class="btn-group btn-toggle"><input bs-switch type=checkbox switch-active="{{ listing.addons.isActive }}" ng-model=listing.addons.coupons switch-size="mini"></div></span> Coupons</li><li class=list-group-item><a role=button target=_blank class="btn btn-block btn-info" href=http://fcrmedia.ie><span aria-hidden=true>See All Add-On\'s From FCR Media</span></a></li></ul><div class=text-right><button type=button ng-click=closeAddonsModal() class="btn btn-success" data-dismiss=modal aria-label=Close><span aria-hidden=true>Done</span></button></div></div>'),a.put("views/modals/location.html",'<div id=editorContent class=modal-content><div id=modal-content class=modal-body><div class="panel panel-default"><div class=litem><div class=panel-heading><h2 class=panel-title>Edit Geo Locations</h2></div><div class=panel-body>Please reset/confirm your geo-location by dragging the pin and clicking confirm.<div id=exp_map></div><input name=isModifyGeo value=false type=hidden></div><table class="table table-condensed table-striped"><thead><th class=address-content>Address</th><th class=latitude>Latitude</th><th class=longitude>Longitude</th></thead><tbody id=addressList><tr><td><input class="form-control input-sm" name=addressText value="2, Brabazon Square, 8, Co. Dublin"></td><td><input class="form-control input-sm geoconfirm" id=lat10 name=lat onkeydown=switchConfirmed(event) value=53.3404416></td><td><input class="form-control input-sm geoconfirm" id=lng10 name=lng onkeydown=switchConfirmed(event) value=-6.280177699999999></td></tr></tbody></table><div class="panel-footer text-right no-gutter"><button class="btn btn-delete pull-left" data-dismiss=modal type=button>Close Editor</button> <button type=button class="btn btn-success geoconfirm" id=confirm10 name=confirm onclick=placeMarker(event) ng-click=close()>Confirm</button></div></div></div></div></div>'),a.put("views/modals/logo_crop.html",'<div class=modal-body><div class=form-group style=text-align:center><canvas width="{{ canvasWidth }}" height=300 image-cropper image=cropImage cropped-image=cropper.croppedImage crop-width=400 crop-height=200 keep-aspect=true></canvas></div></div><div class=modal-footer><div class=col-md-12><button type=button class="btn btn-default" ng-click=closeLogoCrop() data-dismiss=modal>Cancel</button> <button type=button class="btn btn-danger" ng-click=saveLogo()>Save logo</button></div></div>'),a.put("views/modals/name_confirm.html",'<div class=modal-body><h3>Is this a new business?</h3></div><div class=modal-footer><button class="btn btn-primary" ng-click=newName()>Yes</button> <button class="btn btn-warning" ng-click=updateName()>No</button></div>'),a.put("views/modals/save.html",'<div class=modal-header><button type=button class=close aria-label=Close ng-click=closeModal()><span aria-hidden=true>&times;</span></button><h4 class=modal-title id=myModalLabel>Save or Verify and Publish Your Listing</h4></div><div class=modal-body>When you have reviewed your listing informationand wish to queue for publishing on goldenpages.ie please click Verify and Queue button below.<br><br>If you wish to save your edits until your listing is complete and <strong>not</strong> send for publishing then click on Save Only</div><div class=modal-footer><div class=col-md-6><button type=button class="btn btn-default" ng-click=saveOnly(false)>Save Only (not published)</button></div><div class=col-md-6><button type=button class="btn btn-main btn-block" ng-click=saveOnly(true)>Verify and Queue for Publishing</button></div></div>'),a.put("views/modals/social_links.html",'<div class=modal-header><form class=form-horizontal><div class=panel-heading><button type=button class="close pull-right" ng-click=dismissSocialLinks()>×</button><h3 class=panel-title>You can edit your social media links below.</h3></div><div class=panel-body>Please add your social media and applications URLs. If you have none, leave the related field blank.<div class=form-group ng-repeat="socialLink in socialLinks"><label class="col-md-4 control-label">{{ socialLink.title }}</label><div class=col-md-8><div class=row><div class=col-md-12><div class="input-group input-group-sm"><span class=input-group-addon><i class="fa fa-{{ socialLink.type }}"></i></span> <input class="form-control input-sm" autocomplete=off ng-change=changeSocialLink() ng-model=socialLink.name ng-model-options="{ updateOn: \'blur\' }" placeholder="{{ socialLink.url }}"></div></div></div></div></div></div><div class="panel-footer text-right"><button type=button class="btn btn-delete pull-left" data-dismiss=modal aria-label=Close ng-click=dismissSocialLinks()>Cancel</button> <button class="btn btn-success" type=button ng-click=saveSocialLinks();>Confirm</button></div></form></div>')}]);

//1504
angular.module("angular-img-cropper",[]).directive("imageCropper",["$document","$window","imageCropperDataShare",function(a,b,c){return{scope:{image:"=",croppedImage:"=",cropWidth:"=",cropHeight:"=",keepAspect:"=",touchRadius:"=",cropAreaBounds:"=",minWidth:"=",minHeight:"="},restrict:"A",link:function(a,b,d){function e(c,d){if(!g||c!==d){var e=b[0],h=a.cropWidth,i=a.cropHeight,j=a.keepAspect,k=a.touchRadius,l=g&&g.srcImage;g=new q(e,e.width/2-h/2,e.height/2-i/2,h,i,j,k),$(e).data("crop.angular-img-cropper",g),l?g.setImage(l):f(a.image)}}function f(b){if(b){var c=new Image;void 0!==d.cors&&"no"!==d.cors&&(c.crossOrigin="Anonymous"),c.addEventListener("load",function(){g.setImage(c),a.$apply()},!1),c.src=b}}var g,h=h||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},i=function(){function a(a,b,c){this.over=!1,this.drag=!1,this.position=new o(a,b),this.offset=new o(0,0),this.radius=c}return a.prototype.setDrag=function(a){this.drag=a,this.setOver(a)},a.prototype.draw=function(a){},a.prototype.setOver=function(a){this.over=a},a.prototype.touchInBounds=function(a,b){return a>this.position.x-this.radius&&a<this.position.x+this.radius&&b>this.position.y-this.radius&&b<this.position.y+this.radius},a.prototype.getPosition=function(){return this.position},a.prototype.setPosition=function(a,b){this.position.x=a,this.position.y=b},a}(),j=function(){function a(b){this.borrowed=0,a.instance=this;for(var c=null,d=0;b>d;d++)if(0===d)this.firstAvailable=new o,c=this.firstAvailable;else{var e=new o;c.setNext(e),c=e}}return a.prototype.borrow=function(a,b){if(null==this.firstAvailable)throw"Pool exhausted";this.borrowed++;var c=this.firstAvailable;return this.firstAvailable=c.getNext(),c.x=a,c.y=b,c},a.prototype.returnPoint=function(a){this.borrowed--,a.x=0,a.y=0,a.setNext(this.firstAvailable),this.firstAvailable=a},a}(),k=function(){function a(){}return a.init=function(a){this.canvas=a,this.ctx=this.canvas.getContext("2d")},a.DEG2RAD=.0174532925,a}(),l=function(a){function b(b,c,d){a.call(this,b,c,d),this.iconPoints=new Array,this.scaledIconPoints=new Array,this.getDragIconPoints(this.iconPoints,1),this.getDragIconPoints(this.scaledIconPoints,1.2)}return h(b,a),b.prototype.draw=function(a){this.over||this.drag?this.drawIcon(a,this.scaledIconPoints):this.drawIcon(a,this.iconPoints)},b.prototype.getDragIconPoints=function(a,b){var c=17*b,d=14*b,e=8*b,f=4*b;a.push(j.instance.borrow(-f/2,c-e)),a.push(j.instance.borrow(-d/2,c-e)),a.push(j.instance.borrow(0,c)),a.push(j.instance.borrow(d/2,c-e)),a.push(j.instance.borrow(f/2,c-e)),a.push(j.instance.borrow(f/2,f/2)),a.push(j.instance.borrow(c-e,f/2)),a.push(j.instance.borrow(c-e,d/2)),a.push(j.instance.borrow(c,0)),a.push(j.instance.borrow(c-e,-d/2)),a.push(j.instance.borrow(c-e,-f/2)),a.push(j.instance.borrow(f/2,-f/2)),a.push(j.instance.borrow(f/2,-c+e)),a.push(j.instance.borrow(d/2,-c+e)),a.push(j.instance.borrow(0,-c)),a.push(j.instance.borrow(-d/2,-c+e)),a.push(j.instance.borrow(-f/2,-c+e)),a.push(j.instance.borrow(-f/2,-f/2)),a.push(j.instance.borrow(-c+e,-f/2)),a.push(j.instance.borrow(-c+e,-d/2)),a.push(j.instance.borrow(-c,0)),a.push(j.instance.borrow(-c+e,d/2)),a.push(j.instance.borrow(-c+e,f/2)),a.push(j.instance.borrow(-f/2,f/2))},b.prototype.drawIcon=function(a,b){a.beginPath(),a.moveTo(b[0].x+this.position.x,b[0].y+this.position.y);for(var c=0;c<b.length;c++){var d=b[c];a.lineTo(d.x+this.position.x,d.y+this.position.y)}a.closePath(),a.fillStyle="rgba(255,228,0,1)",a.fill()},b.prototype.recalculatePosition=function(a){var b=a.getCentre();this.setPosition(b.x,b.y),j.instance.returnPoint(b)},b}(i),m=function(a){function b(b,c,d){a.call(this,b,c,d)}return h(b,a),b.prototype.drawCornerBorder=function(a){var b=10;(this.over||this.drag)&&(b=12);var c=1,d=1;this.horizontalNeighbour.position.x<this.position.x&&(c=-1),this.verticalNeighbour.position.y<this.position.y&&(d=-1),a.beginPath(),a.lineJoin="miter",a.moveTo(this.position.x,this.position.y),a.lineTo(this.position.x+b*c,this.position.y),a.lineTo(this.position.x+b*c,this.position.y+b*d),a.lineTo(this.position.x,this.position.y+b*d),a.lineTo(this.position.x,this.position.y),a.closePath(),a.lineWidth=2,a.strokeStyle="rgba(255,228,0,1)",a.stroke()},b.prototype.drawCornerFill=function(a){var b=10;(this.over||this.drag)&&(b=12);var c=1,d=1;this.horizontalNeighbour.position.x<this.position.x&&(c=-1),this.verticalNeighbour.position.y<this.position.y&&(d=-1),a.beginPath(),a.moveTo(this.position.x,this.position.y),a.lineTo(this.position.x+b*c,this.position.y),a.lineTo(this.position.x+b*c,this.position.y+b*d),a.lineTo(this.position.x,this.position.y+b*d),a.lineTo(this.position.x,this.position.y),a.closePath(),a.fillStyle="rgba(0,0,0,1)",a.fill()},b.prototype.moveX=function(a){this.setPosition(a,this.position.y)},b.prototype.moveY=function(a){this.setPosition(this.position.x,a)},b.prototype.move=function(a,b){this.setPosition(a,b),this.verticalNeighbour.moveX(a),this.horizontalNeighbour.moveY(b)},b.prototype.addHorizontalNeighbour=function(a){this.horizontalNeighbour=a},b.prototype.addVerticalNeighbour=function(a){this.verticalNeighbour=a},b.prototype.getHorizontalNeighbour=function(){return this.horizontalNeighbour},b.prototype.getVerticalNeighbour=function(){return this.verticalNeighbour},b.prototype.draw=function(a){this.drawCornerFill(a),this.drawCornerBorder(a)},b}(i),n=function(){function a(a,b,c,d){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=0),this.left=a,this.right=a+c,this.top=b,this.bottom=b+d}return a.prototype.getWidth=function(){return this.right-this.left},a.prototype.getHeight=function(){return this.bottom-this.top},a.prototype.getCentre=function(){var a=this.getWidth(),b=this.getHeight();return j.instance.borrow(this.left+a/2,this.top+b/2)},a}(),o=function(){function a(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this.x=a,this.y=b}return a.prototype.setNext=function(a){this.next=a},a.prototype.getNext=function(){return this.next},a}(),p=function(){function a(a,b,c){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),this.id=0,this.x=a,this.y=b,this.id=c}return a}(),q=function(){function b(a,b,c,d,e,f,g){void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=100),void 0===e&&(e=50),void 0===f&&(f=!0),void 0===g&&(g=20),this.keepAspect=!1,this.aspectRatio=0,this.currentDragTouches=new Array,this.isMouseDown=!1,this.ratioW=1,this.ratioH=1,this.fileType="png",this.imageSet=!1,this.pointPool=new j(200),k.init(a),this.buffer=document.createElement("canvas"),this.cropCanvas=document.createElement("canvas"),this.buffer.width=a.width,this.buffer.height=a.height,this.tl=new m(b,c,g),this.tr=new m(b+d,c,g),this.bl=new m(b,c+e,g),this.br=new m(b+d,c+e,g),this.tl.addHorizontalNeighbour(this.tr),this.tl.addVerticalNeighbour(this.bl),this.tr.addHorizontalNeighbour(this.tl),this.tr.addVerticalNeighbour(this.br),this.bl.addHorizontalNeighbour(this.br),this.bl.addVerticalNeighbour(this.tl),this.br.addHorizontalNeighbour(this.bl),this.br.addVerticalNeighbour(this.tr),this.markers=[this.tl,this.tr,this.bl,this.br],this.center=new l(b+d/2,c+e/2,g),this.canvas=a,this.ctx=this.canvas.getContext("2d"),this.keepAspect=f,this.aspectRatio=e/d,this.draw(this.ctx),this.croppedImage=new Image,this.currentlyInteracting=!1,angular.element(window).off("mousemove.angular-img-cropper mouseup.angular-img-cropper touchmove.angular-img-cropper touchend.angular-img-cropper").on("mousemove.angular-img-cropper",this.onMouseMove.bind(this)).on("mouseup.angular-img-cropper",this.onMouseUp.bind(this)).on("touchmove.angular-img-cropper",this.onTouchMove.bind(this)).on("touchend.angular-img-cropper",this.onTouchEnd.bind(this)),angular.element(a).off("mousedown.angular-img-cropper touchstart.angular-img-cropper").on("mousedown.angular-img-cropper",this.onMouseDown.bind(this)).on("touchstart.angular-img-cropper",this.onTouchStart.bind(this))}return b.prototype.resizeCanvas=function(a,b){this.canvas.width=a,this.canvas.height=b,this.buffer.width=a,this.buffer.height=b,this.draw(this.ctx)},b.prototype.draw=function(a){var b=this.getBounds();if(this.srcImage){a.clearRect(0,0,this.canvasWidth,this.canvasHeight);var c=this.srcImage.height/this.srcImage.width,d=this.canvasHeight/this.canvasWidth,e=this.canvasWidth,f=this.canvasHeight;d>c?(e=this.canvasWidth,f=this.canvasWidth*c):(f=this.canvasHeight,e=this.canvasHeight/c),this.ratioW=e/this.srcImage.width,this.ratioH=f/this.srcImage.height,c>d?this.drawImageIOSFix(a,this.srcImage,0,0,this.srcImage.width,this.srcImage.height,this.buffer.width/2-e/2,0,e,f):this.drawImageIOSFix(a,this.srcImage,0,0,this.srcImage.width,this.srcImage.height,0,this.buffer.height/2-f/2,e,f),this.buffer.getContext("2d").drawImage(this.canvas,0,0,this.canvasWidth,this.canvasHeight),a.fillStyle="rgba(0, 0, 0, 0.7)",a.fillRect(0,0,this.canvasWidth,this.canvasHeight),a.drawImage(this.buffer,b.left,b.top,Math.max(b.getWidth(),1),Math.max(b.getHeight(),1),b.left,b.top,b.getWidth(),b.getHeight());for(var g,h=0;h<this.markers.length;h++)g=this.markers[h],g.draw(a);this.center.draw(a),a.lineWidth=2,a.strokeStyle="rgba(255,228,0,1)",a.strokeRect(b.left,b.top,b.getWidth(),b.getHeight())}else a.fillStyle="rgba(192,192,192,1)",a.fillRect(0,0,this.canvas.width,this.canvas.height)},b.prototype.dragCrop=function(b,c,d){var e=this.getBounds(),f=b-e.getWidth()/2,g=b+e.getWidth()/2,h=c-e.getHeight()/2,i=c+e.getHeight()/2;g>=this.maxXClamp&&(b=this.maxXClamp-e.getWidth()/2),f<=this.minXClamp&&(b=e.getWidth()/2+this.minXClamp),h<this.minYClamp&&(c=e.getHeight()/2+this.minYClamp),i>=this.maxYClamp&&(c=this.maxYClamp-e.getHeight()/2),this.tl.moveX(b-e.getWidth()/2),this.tl.moveY(c-e.getHeight()/2),this.tr.moveX(b+e.getWidth()/2),this.tr.moveY(c-e.getHeight()/2),this.bl.moveX(b-e.getWidth()/2),this.bl.moveY(c+e.getHeight()/2),this.br.moveX(b+e.getWidth()/2),this.br.moveY(c+e.getHeight()/2),d.setPosition(b,c),a.cropAreaBounds&&this.imageSet&&(a.cropAreaBounds=this.getCropBounds(),a.$apply())},b.prototype.enforceMinSize=function(b,c,d){var e=b-d.getHorizontalNeighbour().getPosition().x,f=c-d.getVerticalNeighbour().getPosition().y,g=a.minWidth-Math.abs(e),h=a.minHeight-Math.abs(f);return 0==e||0==f?(b=d.getPosition().x,c=d.getPosition().y,j.instance.borrow(b,c)):(a.keepAspect?g>0&&h/this.aspectRatio>0?g>h/this.aspectRatio?0>e?(b-=g,0>f?c-=g*this.aspectRatio:c+=g*this.aspectRatio):(b+=g,0>f?c-=g*this.aspectRatio:c+=g*this.aspectRatio):0>f?(c-=h,0>e?b-=h/this.aspectRatio:b+=h/this.aspectRatio):(c+=h,0>e?b-=h/this.aspectRatio:b+=h/this.aspectRatio):g>0?0>e?(b-=g,0>f?c-=g*this.aspectRatio:c+=g*this.aspectRatio):(b+=g,0>f?c-=g*this.aspectRatio:c+=g*this.aspectRatio):h>0&&(0>f?(c-=h,0>e?b-=h/this.aspectRatio:b+=h/this.aspectRatio):(c+=h,0>e?b-=h/this.aspectRatio:b+=h/this.aspectRatio)):(g>0&&(0>e?b-=g:b+=g),h>0&&(0>f?c-=h:c+=h)),(b<this.minXClamp||b>this.maxXClamp||c<this.minYClamp||c>this.maxYClamp)&&(b=d.getPosition().x,c=d.getPosition().y),j.instance.borrow(b,c))},b.prototype.dragCorner=function(b,c,d){var e,f=0,g=0,h=0,i=0,k=0,l=0,m=0,n=0,o=0;if(a.keepAspect){if(e=d.getHorizontalNeighbour().getVerticalNeighbour(),h=e.getPosition().x,i=e.getPosition().y,b<=e.getPosition().x){if(c<=e.getPosition().y){if(f=h-100/this.aspectRatio,g=i-100/this.aspectRatio*this.aspectRatio,o=this.getSide(j.instance.borrow(f,g),e.getPosition(),j.instance.borrow(b,c)),o>0){k=Math.abs(e.getPosition().y-c),l=k/this.aspectRatio,m=e.getPosition().y-k,n=e.getPosition().x-l;var p=this.enforceMinSize(n,m,d);d.move(p.x,p.y),j.instance.returnPoint(p)}else if(0>o){l=Math.abs(e.getPosition().x-b),k=l*this.aspectRatio,m=e.getPosition().y-k,n=e.getPosition().x-l;var p=this.enforceMinSize(n,m,d);d.move(p.x,p.y),j.instance.returnPoint(p)}}else if(f=h-100/this.aspectRatio,g=i+100/this.aspectRatio*this.aspectRatio,o=this.getSide(j.instance.borrow(f,g),e.getPosition(),j.instance.borrow(b,c)),o>0){l=Math.abs(e.getPosition().x-b),k=l*this.aspectRatio,m=e.getPosition().y+k,n=e.getPosition().x-l;var p=this.enforceMinSize(n,m,d);d.move(p.x,p.y),j.instance.returnPoint(p)}else if(0>o){k=Math.abs(e.getPosition().y-c),l=k/this.aspectRatio,m=e.getPosition().y+k,n=e.getPosition().x-l;var p=this.enforceMinSize(n,m,d);d.move(p.x,p.y),j.instance.returnPoint(p)}}else if(c<=e.getPosition().y){if(f=h+100/this.aspectRatio,g=i-100/this.aspectRatio*this.aspectRatio,o=this.getSide(j.instance.borrow(f,g),e.getPosition(),j.instance.borrow(b,c)),0>o){k=Math.abs(e.getPosition().y-c),l=k/this.aspectRatio,m=e.getPosition().y-k,n=e.getPosition().x+l;var p=this.enforceMinSize(n,m,d);d.move(p.x,p.y),j.instance.returnPoint(p)}else if(o>0){l=Math.abs(e.getPosition().x-b),k=l*this.aspectRatio,m=e.getPosition().y-k,n=e.getPosition().x+l;var p=this.enforceMinSize(n,m,d);d.move(p.x,p.y),j.instance.returnPoint(p)}}else if(f=h+100/this.aspectRatio,g=i+100/this.aspectRatio*this.aspectRatio,o=this.getSide(j.instance.borrow(f,g),e.getPosition(),j.instance.borrow(b,c)),0>o){l=Math.abs(e.getPosition().x-b),k=l*this.aspectRatio,m=e.getPosition().y+k,n=e.getPosition().x+l;var p=this.enforceMinSize(n,m,d);d.move(p.x,p.y),j.instance.returnPoint(p)}else if(o>0){k=Math.abs(e.getPosition().y-c),l=k/this.aspectRatio,m=e.getPosition().y+k,n=e.getPosition().x+l;var p=this.enforceMinSize(n,m,d);d.move(p.x,p.y),j.instance.returnPoint(p)}}else{var p=this.enforceMinSize(b,c,d);d.move(p.x,p.y),j.instance.returnPoint(p)}this.center.recalculatePosition(this.getBounds()),a.cropAreaBounds&&this.imageSet&&(a.cropAreaBounds=this.getCropBounds(),a.$apply())},b.prototype.getSide=function(a,b,c){var d=this.sign((b.x-a.x)*(c.y-a.y)-(b.y-a.y)*(c.x-a.x));return j.instance.returnPoint(a),j.instance.returnPoint(c),d},b.prototype.sign=function(a){return+a===a?0===a?a:a>0?1:-1:NaN},b.prototype.handleRelease=function(a){if(null!=a){for(var b=0,c=0;c<this.currentDragTouches.length;c++)a.id==this.currentDragTouches[c].id&&(this.currentDragTouches[c].dragHandle.setDrag(!1),a.dragHandle=null,b=c);this.currentDragTouches.splice(b,1),this.draw(this.ctx)}},b.prototype.handleMove=function(a){for(var b=!1,d=0;d<this.currentDragTouches.length;d++)if(a.id==this.currentDragTouches[d].id&&null!=this.currentDragTouches[d].dragHandle){var e=this.currentDragTouches[d],f=this.clampPosition(a.x-e.dragHandle.offset.x,a.y-e.dragHandle.offset.y);a.x=f.x,a.y=f.y,j.instance.returnPoint(f),e.dragHandle instanceof m?this.dragCorner(a.x,a.y,e.dragHandle):this.dragCrop(a.x,a.y,e.dragHandle),this.currentlyInteracting=!0,b=!0,c.setPressed(this.canvas);break}if(!b){for(var g=0;g<this.markers.length;g++){var h=this.markers[g];if(h.touchInBounds(a.x,a.y)){a.dragHandle=h,this.currentDragTouches.push(a),h.setDrag(!0),a.dragHandle.offset.x=a.x-a.dragHandle.getPosition().x,a.dragHandle.offset.y=a.y-a.dragHandle.getPosition().y,this.dragCorner(a.x-a.dragHandle.offset.x,a.y-a.dragHandle.offset.y,a.dragHandle);break}}null==a.dragHandle&&this.center.touchInBounds(a.x,a.y)&&(a.dragHandle=this.center,this.currentDragTouches.push(a),a.dragHandle.setDrag(!0),a.dragHandle.offset.x=a.x-a.dragHandle.getPosition().x,a.dragHandle.offset.y=a.y-a.dragHandle.getPosition().y,this.dragCrop(a.x-a.dragHandle.offset.x,a.y-a.dragHandle.offset.y,a.dragHandle))}},b.prototype.updateClampBounds=function(){var a=this.srcImage.height/this.srcImage.width,b=this.canvas.height/this.canvas.width,c=this.canvas.width,d=this.canvas.height;b>a?(c=this.canvas.width,d=this.canvas.width*a):(d=this.canvas.height,c=this.canvas.height/a),this.minXClamp=this.canvas.width/2-c/2,this.minYClamp=this.canvas.height/2-d/2,this.maxXClamp=this.canvas.width/2+c/2,this.maxYClamp=this.canvas.height/2+d/2},b.prototype.getCropBounds=function(){var a=this.canvas.height-2*this.minYClamp,b=this.getBounds();return b.top=Math.round((a-b.top+this.minYClamp)/this.ratioH),b.bottom=Math.round((a-b.bottom+this.minYClamp)/this.ratioH),b.left=Math.round((b.left-this.minXClamp)/this.ratioW),b.right=Math.round((b.right-this.minXClamp)/this.ratioW),b},b.prototype.clampPosition=function(a,b){return a<this.minXClamp&&(a=this.minXClamp),a>this.maxXClamp&&(a=this.maxXClamp),b<this.minYClamp&&(b=this.minYClamp),b>this.maxYClamp&&(b=this.maxYClamp),j.instance.borrow(a,b)},b.prototype.isImageSet=function(){return this.imageSet},b.prototype.setImage=function(b){if(!b)throw"Image is null";this.imageSet=!0,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);var c=this.buffer.getContext("2d");c.clearRect(0,0,this.buffer.width,this.buffer.height);var e=b.src.split("."),f=e[1];("png"==f||"jpg"==f)&&(this.fileType=f),this.srcImage=b,this.updateClampBounds();var g=this.srcImage.height/this.srcImage.width,h=this.getBounds(),i=h.getHeight()/h.getWidth(),k=this.canvas.width,l=this.canvas.height;this.canvasWidth=k,this.canvasHeight=l;var m=this.canvas.width/2,o=this.canvas.height/2,p=j.instance.borrow(m-h.getWidth()/2,o+h.getHeight()/2),q=j.instance.borrow(m+h.getWidth()/2,o+h.getHeight()/2),r=j.instance.borrow(m-h.getWidth()/2,o-h.getHeight()/2),s=j.instance.borrow(m+h.getWidth()/2,o-h.getHeight()/2);if(this.tl.setPosition(p.x,p.y),this.tr.setPosition(q.x,q.y),this.bl.setPosition(r.x,r.y),this.br.setPosition(s.x,s.y),j.instance.returnPoint(p),j.instance.returnPoint(q),j.instance.returnPoint(r),j.instance.returnPoint(s),this.center.setPosition(m,o),i>g){var t=Math.min(k*g,l),u=t/i;p=j.instance.borrow(m-u/2,o+t/2),q=j.instance.borrow(m+u/2,o+t/2),r=j.instance.borrow(m-u/2,o-t/2),s=j.instance.borrow(m+u/2,o-t/2)}else if(g>i){var v=Math.min(l/g,k),w=v*i;p=j.instance.borrow(m-v/2,o+w/2),q=j.instance.borrow(m+v/2,o+w/2),r=j.instance.borrow(m-v/2,o-w/2),s=j.instance.borrow(m+v/2,o-w/2)}else{var v=Math.min(l,k),w=v*i;p=j.instance.borrow(m-v/2,o+w/2),q=j.instance.borrow(m+v/2,o+w/2),r=j.instance.borrow(m-v/2,o-w/2),s=j.instance.borrow(m+v/2,o-w/2)}if(this.tl.setPosition(p.x,p.y),this.tr.setPosition(q.x,q.y),this.bl.setPosition(r.x,r.y),this.br.setPosition(s.x,s.y),j.instance.returnPoint(p),j.instance.returnPoint(q),j.instance.returnPoint(r),j.instance.returnPoint(s),a.cropAreaBounds&&void 0!==a.cropAreaBounds.left&&void 0!==a.cropAreaBounds.top&&void 0!==a.cropAreaBounds.right&&void 0!==a.cropAreaBounds.bottom){var x=this.canvasHeight/this.canvasWidth;x>g?(k=this.canvasWidth,l=this.canvasWidth*g):(l=this.canvasHeight,k=this.canvasHeight/g),this.ratioW=k/this.srcImage.width,this.ratioH=l/this.srcImage.height;var y=new n;y.top=Math.round(l+this.minYClamp-this.ratioH*a.cropAreaBounds.top),y.bottom=Math.round(l+this.minYClamp-this.ratioH*a.cropAreaBounds.bottom),y.left=Math.round(this.ratioW*a.cropAreaBounds.left+this.minXClamp),y.right=Math.round(this.ratioW*a.cropAreaBounds.right+this.minXClamp),this.tl.setPosition(y.left,y.top),this.tr.setPosition(y.right,y.top),this.bl.setPosition(y.left,y.bottom),this.br.setPosition(y.right,y.bottom),this.center.setPosition(y.left+y.getWidth()/2,y.top+y.getHeight()/2)}this.vertSquashRatio=this.detectVerticalSquash(this.srcImage),this.draw(this.ctx);var z=this.getCroppedImage(a.cropWidth,a.cropHeight);void 0!==d.croppedImage&&(a.croppedImage=z.src),a.cropAreaBounds&&this.imageSet&&(a.cropAreaBounds=this.getCropBounds())},b.prototype.getCroppedImage=function(a,b){var c=this.getBounds();if(!this.srcImage)throw"Source image not set.";if(a&&b){var d=this.srcImage.height/this.srcImage.width,e=this.canvas.height/this.canvas.width,f=this.canvas.width,g=this.canvas.height;e>d?(f=this.canvas.width,g=this.canvas.width*d):d>e?(g=this.canvas.height,f=this.canvas.height/d):(g=this.canvas.height,f=this.canvas.width),this.ratioW=f/this.srcImage.width,this.ratioH=g/this.srcImage.height,this.cropCanvas.width=a,this.cropCanvas.height=b;var h=(this.buffer.height-g)/2/this.ratioH,i=(this.buffer.width-f)/2/this.ratioW;this.drawImageIOSFix(this.cropCanvas.getContext("2d"),this.srcImage,Math.max(Math.round(c.left/this.ratioW-i),0),Math.max(Math.round(c.top/this.ratioH-h),0),Math.max(Math.round(c.getWidth()/this.ratioW),1),Math.max(Math.round(c.getHeight()/this.ratioH),1),0,0,a,b),this.croppedImage.width=a,this.croppedImage.height=b}else this.cropCanvas.width=Math.max(c.getWidth(),1),this.cropCanvas.height=Math.max(c.getHeight(),1),this.cropCanvas.getContext("2d").drawImage(this.buffer,c.left,c.top,Math.max(c.getWidth(),1),Math.max(c.getHeight(),1),0,0,c.getWidth(),c.getHeight()),this.croppedImage.width=this.cropCanvas.width,this.croppedImage.height=this.cropCanvas.height;return this.croppedImage.src=this.cropCanvas.toDataURL("image/"+this.fileType),this.croppedImage},b.prototype.getBounds=function(){for(var a=Number.MAX_VALUE,b=Number.MAX_VALUE,c=-Number.MAX_VALUE,d=-Number.MAX_VALUE,e=0;e<this.markers.length;e++){var f=this.markers[e];f.getPosition().x<a&&(a=f.getPosition().x),f.getPosition().x>c&&(c=f.getPosition().x),f.getPosition().y<b&&(b=f.getPosition().y),f.getPosition().y>d&&(d=f.getPosition().y)}var g=new n;return g.left=a,g.right=c,g.top=b,g.bottom=d,g},b.prototype.setBounds=function(a){for(var b,c,d,e,f=this.getBounds(),g=0;g<this.markers.length;g++){var h=this.markers[g];h.getPosition().x==f.left?h.getPosition().y==f.top?b=h:d=h:h.getPosition().y==f.top?c=h:e=h}b.setPosition(a.left,a.top),c.setPosition(a.right,a.top),d.setPosition(a.left,a.bottom),e.setPosition(a.right,a.bottom),this.center.recalculatePosition(a),this.center.draw(this.ctx)},b.prototype.getMousePos=function(a,b){var c=a.getBoundingClientRect();return j.instance.borrow(b.clientX-c.left,b.clientY-c.top)},b.prototype.getTouchPos=function(a,b){var c=a.getBoundingClientRect();return j.instance.borrow(b.clientX-c.left,b.clientY-c.top)},b.prototype.onTouchMove=function(a){if(g.isImageSet()){if(a.originalEvent.touches.length>=1)for(var b=0;b<a.originalEvent.touches.length;b++){var c=a.originalEvent.touches[b],d=this.getTouchPos(this.canvas,c),e=new p(d.x,d.y,c.identifier);j.instance.returnPoint(d),this.move(e,a)}this.draw(this.ctx)}},b.prototype.onMouseMove=function(a){if(g.isImageSet()){var b=this.getMousePos(this.canvas,a);this.move(new p(b.x,b.y,0),a);var c=this.getDragTouchForID(0);c?(c.x=b.x,c.y=b.y):c=new p(b.x,b.y,0),j.instance.returnPoint(b),this.drawCursors(c,a),this.draw(this.ctx)}},b.prototype.move=function(a,b){this.isMouseDown&&this.handleMove(a)},b.prototype.getDragTouchForID=function(a){for(var b=0;b<this.currentDragTouches.length;b++)if(a==this.currentDragTouches[b].id)return this.currentDragTouches[b]},b.prototype.drawCursors=function(a,b){var d=!1;null!=a&&(a.dragHandle==this.center&&(c.setStyle(this.canvas,"move"),d=!0),null!=a.dragHandle&&a.dragHandle instanceof m&&(this.drawCornerCursor(a.dragHandle,a.dragHandle.getPosition().x,a.dragHandle.getPosition().y,b),d=!0));var e=!1;if(!d){for(var f=0;f<this.markers.length;f++)e=e||this.drawCornerCursor(this.markers[f],a.x,a.y,b);e||c.setStyle(this.canvas,"initial")}e||d||!this.center.touchInBounds(a.x,a.y)?this.center.setOver(!1):(this.center.setOver(!0),c.setOver(this.canvas),c.setStyle(this.canvas,"move"))},b.prototype.drawCornerCursor=function(a,b,d,e){return a.touchInBounds(b,d)?(a.setOver(!0),a.getHorizontalNeighbour().getPosition().x>a.getPosition().x?a.getVerticalNeighbour().getPosition().y>a.getPosition().y?(c.setOver(this.canvas),c.setStyle(this.canvas,"nwse-resize")):(c.setOver(this.canvas),c.setStyle(this.canvas,"nesw-resize")):a.getVerticalNeighbour().getPosition().y>a.getPosition().y?(c.setOver(this.canvas),c.setStyle(this.canvas,"nesw-resize")):(c.setOver(this.canvas),c.setStyle(this.canvas,"nwse-resize")),!0):(a.setOver(!1),!1)},b.prototype.onTouchStart=function(a){g.isImageSet()&&(this.isMouseDown=!0)},b.prototype.onTouchEnd=function(b){if(g.isImageSet()){for(var c=0;c<b.originalEvent.changedTouches.length;c++){var e=b.originalEvent.changedTouches[c],f=this.getDragTouchForID(e.identifier);null!=f&&((f.dragHandle instanceof m||f.dragHandle instanceof l)&&f.dragHandle.setOver(!1),this.handleRelease(f))}if(g.isImageSet()&&this.currentlyInteracting){var h=this.getCroppedImage(a.cropWidth,a.cropHeight);void 0!==d.croppedImage&&(a.croppedImage=h.src),a.$apply()}0==this.currentDragTouches.length&&(this.isMouseDown=!1,this.currentlyInteracting=!1)}},b.prototype.drawImageIOSFix=function(a,b,c,d,e,f,g,h,i,j){a.drawImage(b,c*this.vertSquashRatio,d*this.vertSquashRatio,e*this.vertSquashRatio,f*this.vertSquashRatio,g,h,i,j)},b.prototype.detectVerticalSquash=function(a){var b=(a.naturalWidth,a.naturalHeight),c=document.createElement("canvas");c.width=1,c.height=b;var d=c.getContext("2d");d.drawImage(a,0,0);for(var e=d.getImageData(0,0,1,b).data,f=0,g=b,h=b;h>f;){var i=e[4*(h-1)+3];0===i?g=h:f=h,h=g+f>>1}var j=h/b;return 0===j?1:j},b.prototype.onMouseDown=function(a){g.isImageSet()&&(this.isMouseDown=!0)},b.prototype.onMouseUp=function(b){if(g.isImageSet()){if(c.setReleased(this.canvas),this.isMouseDown=!1,this.handleRelease(new p(0,0,0)),1==this.currentlyInteracting){var e=this.getCroppedImage(a.cropWidth,a.cropHeight);void 0!==d.croppedImage&&(a.croppedImage=e.src),a.$apply()}this.currentlyInteracting=!1}},b}();a.$watch("cropWidth",e),a.$watch("cropHeight",e),a.$watch("keepAspect",e),a.$watch("touchRadius",e),a.$watch("image",f)}}}]),angular.module("angular-img-cropper").directive("imgCropperFileread",["$timeout",function(a){return{scope:{image:"="},link:function(b,c){c.bind("change",function(c){var d=new FileReader;d.onload=function(c){a(function(){b.image=c.target.result},0)},c.target.files[0]&&d.readAsDataURL(c.target.files[0])})}}}]),angular.module("angular-img-cropper").directive("imgCropperFilereadCall",function(){return{scope:{control:"="},link:function(a){a.internalControl=a.control||{},a.internalControl.load=function(a){var b=angular.element(document.querySelector(a)),c=document.createEvent("MouseEvent");c.initEvent("click",!0,!1),b[0].dispatchEvent(c)}}}}),angular.module("angular-img-cropper").factory("imageCropperDataShare",function(){var a,b,c={};return c.setPressed=function(b){a=b},c.setReleased=function(b){b===a&&(a=void 0)},c.setOver=function(a){b=a},c.setStyle=function(c,d){void 0!==a?a===c&&angular.element(document.documentElement).css("cursor",d):c===b&&angular.element(document.documentElement).css("cursor",d)},c}),function(a,b,c){function d(a,c){this.wrapper="string"==typeof a?b.querySelector(a):a,this.scroller=this.wrapper.children[0],this.scrollerStyle=this.scroller.style,this.options={mouseWheelSpeed:20,startX:0,startY:0,scrollY:!0,directionLockThreshold:5,momentum:!0,bounce:!0,bounceTime:600,bounceEasing:"",preventDefault:!0,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/},HWCompositing:!0,useTransition:!0,useTransform:!0};for(var d in c)this.options[d]=c[d];this.translateZ=this.options.HWCompositing&&f.hasPerspective?" translateZ(0)":"",this.options.useTransition=f.hasTransition&&this.options.useTransition,this.options.useTransform=f.hasTransform&&this.options.useTransform,this.options.eventPassthrough=this.options.eventPassthrough===!0?"vertical":this.options.eventPassthrough,this.options.preventDefault=!this.options.eventPassthrough&&this.options.preventDefault,this.options.scrollY="vertical"==this.options.eventPassthrough?!1:this.options.scrollY,this.options.scrollX="horizontal"==this.options.eventPassthrough?!1:this.options.scrollX,this.options.freeScroll=this.options.freeScroll&&!this.options.eventPassthrough,this.options.directionLockThreshold=this.options.eventPassthrough?0:this.options.directionLockThreshold,this.options.bounceEasing="string"==typeof this.options.bounceEasing?f.ease[this.options.bounceEasing]||f.ease.circular:this.options.bounceEasing,this.options.resizePolling=void 0===this.options.resizePolling?60:this.options.resizePolling,this.options.tap===!0&&(this.options.tap="tap"),this.options.invertWheelDirection=this.options.invertWheelDirection?-1:1,this.x=0,this.y=0,this.directionX=0,this.directionY=0,this._events={},this._init(),this.refresh(),this.scrollTo(this.options.startX,this.options.startY),this.enable()}var e=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(b){a.setTimeout(b,1e3/60)},f=function(){function d(a){return g===!1?!1:""===g?a:g+a.charAt(0).toUpperCase()+a.substr(1)}var e={},f=b.createElement("div").style,g=function(){for(var a,b=["t","webkitT","MozT","msT","OT"],c=0,d=b.length;d>c;c++)if(a=b[c]+"ransform",a in f)return b[c].substr(0,b[c].length-1);return!1}();e.getTime=Date.now||function(){return(new Date).getTime()},e.extend=function(a,b){for(var c in b)a[c]=b[c]},e.addEvent=function(a,b,c,d){a.addEventListener(b,c,!!d)},e.removeEvent=function(a,b,c,d){a.removeEventListener(b,c,!!d)},e.prefixPointerEvent=function(b){return a.MSPointerEvent?"MSPointer"+b.charAt(9).toUpperCase()+b.substr(10):b},e.momentum=function(a,b,d,e,f,g){var h,i,j=a-b,k=c.abs(j)/d;return g=void 0===g?6e-4:g,h=a+k*k/(2*g)*(0>j?-1:1),i=k/g,e>h?(h=f?e-f/2.5*(k/8):e,j=c.abs(h-a),i=j/k):h>0&&(h=f?f/2.5*(k/8):0,j=c.abs(a)+h,i=j/k),{destination:c.round(h),duration:i}};var h=d("transform");return e.extend(e,{hasTransform:h!==!1,hasPerspective:d("perspective")in f,hasTouch:"ontouchstart"in a,hasPointer:a.PointerEvent||a.MSPointerEvent,hasTransition:d("transition")in f}),e.isBadAndroid=/Android /.test(a.navigator.appVersion)&&!/Chrome\/\d/.test(a.navigator.appVersion),e.extend(e.style={},{transform:h,transitionTimingFunction:d("transitionTimingFunction"),transitionDuration:d("transitionDuration"),transitionDelay:d("transitionDelay"),transformOrigin:d("transformOrigin")}),e.hasClass=function(a,b){var c=new RegExp("(^|\\s)"+b+"(\\s|$)");return c.test(a.className)},e.addClass=function(a,b){if(!e.hasClass(a,b)){var c=a.className.split(" ");c.push(b),a.className=c.join(" ")}},e.removeClass=function(a,b){if(e.hasClass(a,b)){var c=new RegExp("(^|\\s)"+b+"(\\s|$)","g");a.className=a.className.replace(c," ")}},e.offset=function(a){for(var b=-a.offsetLeft,c=-a.offsetTop;a=a.offsetParent;)b-=a.offsetLeft,c-=a.offsetTop;return{left:b,top:c}},e.preventDefaultException=function(a,b){for(var c in b)if(b[c].test(a[c]))return!0;return!1},e.extend(e.eventType={},{touchstart:1,touchmove:1,touchend:1,mousedown:2,mousemove:2,mouseup:2,pointerdown:3,pointermove:3,pointerup:3,MSPointerDown:3,MSPointerMove:3,MSPointerUp:3}),e.extend(e.ease={},{quadratic:{style:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",fn:function(a){return a*(2-a)}},circular:{style:"cubic-bezier(0.1, 0.57, 0.1, 1)",fn:function(a){return c.sqrt(1- --a*a)}},back:{style:"cubic-bezier(0.175, 0.885, 0.32, 1.275)",fn:function(a){var b=4;return(a-=1)*a*((b+1)*a+b)+1}},bounce:{style:"",fn:function(a){return(a/=1)<1/2.75?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375}},elastic:{style:"",fn:function(a){var b=.22,d=.4;return 0===a?0:1==a?1:d*c.pow(2,-10*a)*c.sin((a-b/4)*(2*c.PI)/b)+1}}}),e.tap=function(a,c){var d=b.createEvent("Event");d.initEvent(c,!0,!0),d.pageX=a.pageX,d.pageY=a.pageY,a.target.dispatchEvent(d)},e.click=function(a){var c,d=a.target;/(SELECT|INPUT|TEXTAREA)/i.test(d.tagName)||(c=b.createEvent("MouseEvents"),c.initMouseEvent("click",!0,!0,a.view,1,d.screenX,d.screenY,d.clientX,d.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,0,null),c._constructed=!0,d.dispatchEvent(c))},e}();d.prototype={version:"5.1.3",_init:function(){this._initEvents(),this.options.mouseWheel&&this._initWheel()},destroy:function(){this._initEvents(!0),this._execEvent("destroy")},_transitionEnd:function(a){a.target==this.scroller&&this.isInTransition&&(this._transitionTime(),this.resetPosition(this.options.bounceTime)||(this.isInTransition=!1,this._execEvent("scrollEnd")))},_start:function(a){if((1==f.eventType[a.type]||0===a.button)&&this.enabled&&(!this.initiated||f.eventType[a.type]===this.initiated)){!this.options.preventDefault||f.isBadAndroid||f.preventDefaultException(a.target,this.options.preventDefaultException)||a.preventDefault();var b,d=a.touches?a.touches[0]:a;this.initiated=f.eventType[a.type],this.moved=!1,this.distX=0,this.distY=0,this.directionX=0,this.directionY=0,this.directionLocked=0,
this._transitionTime(),this.startTime=f.getTime(),this.options.useTransition&&this.isInTransition?(this.isInTransition=!1,b=this.getComputedPosition(),this._translate(c.round(b.x),c.round(b.y)),this._execEvent("scrollEnd")):!this.options.useTransition&&this.isAnimating&&(this.isAnimating=!1,this._execEvent("scrollEnd")),this.startX=this.x,this.startY=this.y,this.absStartX=this.x,this.absStartY=this.y,this.pointX=d.pageX,this.pointY=d.pageY,this._execEvent("beforeScrollStart")}},_move:function(a){if(this.enabled&&f.eventType[a.type]===this.initiated){this.options.preventDefault&&a.preventDefault();var b,d,e,g,h=a.touches?a.touches[0]:a,i=h.pageX-this.pointX,j=h.pageY-this.pointY,k=f.getTime();if(this.pointX=h.pageX,this.pointY=h.pageY,this.distX+=i,this.distY+=j,e=c.abs(this.distX),g=c.abs(this.distY),!(k-this.endTime>300&&10>e&&10>g)){if(this.directionLocked||this.options.freeScroll||(e>g+this.options.directionLockThreshold?this.directionLocked="h":g>=e+this.options.directionLockThreshold?this.directionLocked="v":this.directionLocked="n"),"h"==this.directionLocked){if("vertical"==this.options.eventPassthrough)a.preventDefault();else if("horizontal"==this.options.eventPassthrough)return void(this.initiated=!1);j=0}else if("v"==this.directionLocked){if("horizontal"==this.options.eventPassthrough)a.preventDefault();else if("vertical"==this.options.eventPassthrough)return void(this.initiated=!1);i=0}i=this.hasHorizontalScroll?i:0,j=this.hasVerticalScroll?j:0,b=this.x+i,d=this.y+j,(b>0||b<this.maxScrollX)&&(b=this.options.bounce?this.x+i/3:b>0?0:this.maxScrollX),(d>0||d<this.maxScrollY)&&(d=this.options.bounce?this.y+j/3:d>0?0:this.maxScrollY),this.directionX=i>0?-1:0>i?1:0,this.directionY=j>0?-1:0>j?1:0,this.moved||this._execEvent("scrollStart"),this.moved=!0,this._translate(b,d),k-this.startTime>300&&(this.startTime=k,this.startX=this.x,this.startY=this.y)}}},_end:function(a){if(this.enabled&&f.eventType[a.type]===this.initiated){this.options.preventDefault&&!f.preventDefaultException(a.target,this.options.preventDefaultException)&&a.preventDefault();var b,d,e=(a.changedTouches?a.changedTouches[0]:a,f.getTime()-this.startTime),g=c.round(this.x),h=c.round(this.y),i=c.abs(g-this.startX),j=c.abs(h-this.startY),k=0,l="";if(this.isInTransition=0,this.initiated=0,this.endTime=f.getTime(),!this.resetPosition(this.options.bounceTime))return this.scrollTo(g,h),this.moved?this._events.flick&&200>e&&100>i&&100>j?void this._execEvent("flick"):(this.options.momentum&&300>e&&(b=this.hasHorizontalScroll?f.momentum(this.x,this.startX,e,this.maxScrollX,this.options.bounce?this.wrapperWidth:0,this.options.deceleration):{destination:g,duration:0},d=this.hasVerticalScroll?f.momentum(this.y,this.startY,e,this.maxScrollY,this.options.bounce?this.wrapperHeight:0,this.options.deceleration):{destination:h,duration:0},g=b.destination,h=d.destination,k=c.max(b.duration,d.duration),this.isInTransition=1),g!=this.x||h!=this.y?((g>0||g<this.maxScrollX||h>0||h<this.maxScrollY)&&(l=f.ease.quadratic),void this.scrollTo(g,h,k,l)):void this._execEvent("scrollEnd")):(this.options.tap&&f.tap(a,this.options.tap),this.options.click&&f.click(a),void this._execEvent("scrollCancel"))}},_resize:function(){var a=this;clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){a.refresh()},this.options.resizePolling)},resetPosition:function(a){var b=this.x,c=this.y;return a=a||0,!this.hasHorizontalScroll||this.x>0?b=0:this.x<this.maxScrollX&&(b=this.maxScrollX),!this.hasVerticalScroll||this.y>0?c=0:this.y<this.maxScrollY&&(c=this.maxScrollY),b==this.x&&c==this.y?!1:(this.scrollTo(b,c,a,this.options.bounceEasing),!0)},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0},refresh:function(){this.wrapper.offsetHeight;this.wrapperWidth=this.wrapper.clientWidth,this.wrapperHeight=this.wrapper.clientHeight,this.scrollerWidth=this.scroller.offsetWidth,this.scrollerHeight=this.scroller.offsetHeight,this.maxScrollX=this.wrapperWidth-this.scrollerWidth,this.maxScrollY=this.wrapperHeight-this.scrollerHeight,this.hasHorizontalScroll=this.options.scrollX&&this.maxScrollX<0,this.hasVerticalScroll=this.options.scrollY&&this.maxScrollY<0,this.hasHorizontalScroll||(this.maxScrollX=0,this.scrollerWidth=this.wrapperWidth),this.hasVerticalScroll||(this.maxScrollY=0,this.scrollerHeight=this.wrapperHeight),this.endTime=0,this.directionX=0,this.directionY=0,this.wrapperOffset=f.offset(this.wrapper),this._execEvent("refresh"),this.resetPosition()},on:function(a,b){this._events[a]||(this._events[a]=[]),this._events[a].push(b)},off:function(a,b){if(this._events[a]){var c=this._events[a].indexOf(b);c>-1&&this._events[a].splice(c,1)}},_execEvent:function(a){if(this._events[a]){var b=0,c=this._events[a].length;if(c)for(;c>b;b++)this._events[a][b].apply(this,[].slice.call(arguments,1))}},scrollBy:function(a,b,c,d){a=this.x+a,b=this.y+b,c=c||0,this.scrollTo(a,b,c,d)},scrollTo:function(a,b,c,d){d=d||f.ease.circular,this.isInTransition=this.options.useTransition&&c>0,!c||this.options.useTransition&&d.style?(this._transitionTimingFunction(d.style),this._transitionTime(c),this._translate(a,b)):this._animate(a,b,c,d.fn)},scrollToElement:function(a,b,d,e,g){if(a=a.nodeType?a:this.scroller.querySelector(a)){var h=f.offset(a);h.left-=this.wrapperOffset.left,h.top-=this.wrapperOffset.top,d===!0&&(d=c.round(a.offsetWidth/2-this.wrapper.offsetWidth/2)),e===!0&&(e=c.round(a.offsetHeight/2-this.wrapper.offsetHeight/2)),h.left-=d||0,h.top-=e||0,h.left=h.left>0?0:h.left<this.maxScrollX?this.maxScrollX:h.left,h.top=h.top>0?0:h.top<this.maxScrollY?this.maxScrollY:h.top,b=void 0===b||null===b||"auto"===b?c.max(c.abs(this.x-h.left),c.abs(this.y-h.top)):b,this.scrollTo(h.left,h.top,b,g)}},_transitionTime:function(a){a=a||0,this.scrollerStyle[f.style.transitionDuration]=a+"ms",!a&&f.isBadAndroid&&(this.scrollerStyle[f.style.transitionDuration]="0.001s")},_transitionTimingFunction:function(a){this.scrollerStyle[f.style.transitionTimingFunction]=a},_translate:function(a,b){this.options.useTransform?this.scrollerStyle[f.style.transform]="translate("+a+"px,"+b+"px)"+this.translateZ:(a=c.round(a),b=c.round(b),this.scrollerStyle.left=a+"px",this.scrollerStyle.top=b+"px"),this.x=a,this.y=b},_initEvents:function(b){var c=b?f.removeEvent:f.addEvent,d=this.options.bindToWrapper?this.wrapper:a;c(a,"orientationchange",this),c(a,"resize",this),this.options.click&&c(this.wrapper,"click",this,!0),this.options.disableMouse||(c(this.wrapper,"mousedown",this),c(d,"mousemove",this),c(d,"mousecancel",this),c(d,"mouseup",this)),f.hasPointer&&!this.options.disablePointer&&(c(this.wrapper,f.prefixPointerEvent("pointerdown"),this),c(d,f.prefixPointerEvent("pointermove"),this),c(d,f.prefixPointerEvent("pointercancel"),this),c(d,f.prefixPointerEvent("pointerup"),this)),f.hasTouch&&!this.options.disableTouch&&(c(this.wrapper,"touchstart",this),c(d,"touchmove",this),c(d,"touchcancel",this),c(d,"touchend",this)),c(this.scroller,"transitionend",this),c(this.scroller,"webkitTransitionEnd",this),c(this.scroller,"oTransitionEnd",this),c(this.scroller,"MSTransitionEnd",this)},getComputedPosition:function(){var b,c,d=a.getComputedStyle(this.scroller,null);return this.options.useTransform?(d=d[f.style.transform].split(")")[0].split(", "),b=+(d[12]||d[4]),c=+(d[13]||d[5])):(b=+d.left.replace(/[^-\d.]/g,""),c=+d.top.replace(/[^-\d.]/g,"")),{x:b,y:c}},_initWheel:function(){f.addEvent(this.wrapper,"wheel",this),f.addEvent(this.wrapper,"mousewheel",this),f.addEvent(this.wrapper,"DOMMouseScroll",this),this.on("destroy",function(){f.removeEvent(this.wrapper,"wheel",this),f.removeEvent(this.wrapper,"mousewheel",this),f.removeEvent(this.wrapper,"DOMMouseScroll",this)})},_wheel:function(a){if(this.enabled){a.preventDefault(),a.stopPropagation();var b,d,e,f,g=this;if(void 0===this.wheelTimeout&&g._execEvent("scrollStart"),clearTimeout(this.wheelTimeout),this.wheelTimeout=setTimeout(function(){g._execEvent("scrollEnd"),g.wheelTimeout=void 0},400),"deltaX"in a)1===a.deltaMode?(b=-a.deltaX*this.options.mouseWheelSpeed,d=-a.deltaY*this.options.mouseWheelSpeed):(b=-a.deltaX,d=-a.deltaY);else if("wheelDeltaX"in a)b=a.wheelDeltaX/120*this.options.mouseWheelSpeed,d=a.wheelDeltaY/120*this.options.mouseWheelSpeed;else if("wheelDelta"in a)b=d=a.wheelDelta/120*this.options.mouseWheelSpeed;else{if(!("detail"in a))return;b=d=-a.detail/3*this.options.mouseWheelSpeed}if(b*=this.options.invertWheelDirection,d*=this.options.invertWheelDirection,this.hasVerticalScroll||(b=d,d=0),this.options.snap)return e=this.currentPage.pageX,f=this.currentPage.pageY,b>0?e--:0>b&&e++,d>0?f--:0>d&&f++,void this.goToPage(e,f);e=this.x+c.round(this.hasHorizontalScroll?b:0),f=this.y+c.round(this.hasVerticalScroll?d:0),e>0?e=0:e<this.maxScrollX&&(e=this.maxScrollX),f>0?f=0:f<this.maxScrollY&&(f=this.maxScrollY),this.scrollTo(e,f,0)}},_animate:function(a,b,c,d){function g(){var m,n,o,p=f.getTime();return p>=l?(h.isAnimating=!1,h._translate(a,b),void(h.resetPosition(h.options.bounceTime)||h._execEvent("scrollEnd"))):(p=(p-k)/c,o=d(p),m=(a-i)*o+i,n=(b-j)*o+j,h._translate(m,n),void(h.isAnimating&&e(g)))}var h=this,i=this.x,j=this.y,k=f.getTime(),l=k+c;this.isAnimating=!0,g()},handleEvent:function(a){switch(a.type){case"touchstart":case"pointerdown":case"MSPointerDown":case"mousedown":this._start(a);break;case"touchmove":case"pointermove":case"MSPointerMove":case"mousemove":this._move(a);break;case"touchend":case"pointerup":case"MSPointerUp":case"mouseup":case"touchcancel":case"pointercancel":case"MSPointerCancel":case"mousecancel":this._end(a);break;case"orientationchange":case"resize":this._resize();break;case"transitionend":case"webkitTransitionEnd":case"oTransitionEnd":case"MSTransitionEnd":this._transitionEnd(a);break;case"wheel":case"DOMMouseScroll":case"mousewheel":this._wheel(a);break;case"keydown":this._key(a);break;case"click":a._constructed||(a.preventDefault(),a.stopPropagation())}}},d.utils=f,"undefined"!=typeof module&&module.exports?module.exports=d:a.IScroll=d}(window,document,Math),!function(a){"use strict";var b="drawer",c="undefined"!=typeof document.ontouchstart,d={init:function(c){return c=a.extend({mastaClass:"drawer-main",toggleClass:"drawer-toggle",upperClass:"drawer-overlay-upper",openClass:"drawer-open",closeClass:"drawer-close",apiToggleClass:"drawer-api-toggle",responsiveClass:"drawer-responsive",dropdownClass:"dropdown",dropdownShown:"shown.bs.dropdown",dropdownHidden:"hidden.bs.dropdown"},c),this.each(function(){var e=this,f=a(this),g=f.data(b),h=a("<div>").addClass(c.upperClass+" "+c.toggleClass);g||(c=a.extend({},c),f.data(b,{options:c})),f.append(h);var i=new IScroll("."+c.mastaClass,{mouseWheel:!0,preventDefault:!1});a("."+c.toggleClass+", ."+c.apiToggleClass).off("click."+b).on("click."+b,function(){d.toggle.call(e),i.refresh()}),a(window).resize(function(){d.close.call(e),i.refresh()}),a("."+c.dropdownClass).on(c.dropdownShown,function(){i.refresh()}).on(c.dropdownHidden,function(){i.refresh()})})},toggle:function(c){var e=this,f=a(this);c=f.data(b).options;var g=f.hasClass(c.openClass);g?d.close.call(e):d.open.call(e)},open:function(d){var e=a(this);d=e.data(b).options,c&&e.on("touchmove."+b,function(a){a.preventDefault()}),e.removeClass(d.closeClass).addClass(d.openClass).transitionEnd(function(){e.css({overflow:"hidden"}).trigger("drawer.opened")})},close:function(d){var e=a(this);d=e.data(b).options,c&&e.off("touchmove."+b),e.removeClass(d.openClass).addClass(d.closeClass).transitionEnd(function(){e.css({overflow:"auto"}).trigger("drawer.closed")})},destroy:function(){return this.each(function(){var c=a(this);a(window).unbind("."+b),c.removeData(b)})}};a.fn.drawer=function(c){return d[c]?d[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof c&&c?void a.error("Method "+c+" does not exist on jQuery."+b):d.init.apply(this,arguments)}}(jQuery),function(a){"use strict";a.fn.transitionEnd=function(b){var c="transitionend webkitTransitionEnd mozTransitionEnd oTransitionEnd MSTransitionEnd";return this.each(function(){a(this).bind(c,function(){return a(this).unbind(c),b.call(this)})})}}(jQuery),function(a){function b(a,b,c){this._setOption(b,c),this._setMessage(),this._setCssClass(),this._setProp(),this._setElem(a),this._setButtonAttrDefault(),this._setButtonPosition(),this._setInitRecord(),this._ehButton(),this._ehComboInput(),this._ehWhole(),this._ehTextArea(),this.option.shorten_btn&&this._findUrlToShorten(this)}a.fn.ajaxComboBox=function(c,d){var e=[];return this.each(function(){e.push(new b(this,c,d))}),void 0!=d&&void 0!=d.instance&&d.instance?a(e):this},a.extend(b.prototype,{_setOption:function(a,b){b=this._setOption1st(a,b),b=this._setOption2nd(b),this.option=b},_setOption1st:function(b,c){return a.extend({source:b,lang:"en",plugin_type:"combobox",init_record:!1,db_table:"tbl",field:"name",and_or:"AND",per_page:10,navi_num:5,primary_key:"id",button_img:"http://hibeam.co/listingmanager/html/assets/combo-lib/btn.png",bind_to:!1,navi_simple:!1,sub_info:!1,sub_as:{},show_field:"",hide_field:"",select_only:!1,tags:!1,shorten_btn:!1,shorten_src:"lib/bitly.php",shorten_min:20,shorten_reg:!1},c)},_setOption2nd:function(a){a.search_field=void 0==a.search_field?a.field:a.search_field,a.and_or=a.and_or.toUpperCase();for(var b=["hide_field","show_field","search_field"],c=0;c<b.length;c++)a[b[c]]=this._strToArray(a[b[c]]);return a.order_by=void 0==a.order_by?a.search_field:a.order_by,a.order_by=this._setOrderbyOption(a.order_by,a.field),"textarea"==a.plugin_type&&(a.shorten_reg=this._setRegExpShort(a.shorten_reg,a.shorten_min)),a.tags&&(a.tags=this._setTagPattern(a)),a},_strToArray:function(a){return a.replace(/[\s　]+/g,"").split(",")},_setRegExpShort:function(a,b){if(a)return a;var c="(?:^|[\\s|　\\[(<「『（【［＜〈《]+)";return c+="(",c+="https:\\/\\/[^\\s|　\\])>」』）】］＞〉》]{"+(b-7)+",}",c+="|",c+="http:\\/\\/[^\\s|　\\])>」』）】］＞〉》]{"+(b-6)+",}",c+="|",c+="ftp:\\/\\/[^\\s|　\\])>」』）】］＞〉》]{"+(b-5)+",}",c+=")",new RegExp(c,"g")},_setTagPattern:function(a){for(var b=0;b<a.tags.length;b++)a.tags[b]=this._setTagOptions(a,b),a.tags[b].pattern=this._setRegExpTag(a.tags[b].pattern,a.tags[b].space);return a.tags},_setTagOptions:function(b,c){b.tags[c]=a.extend({space:[!0,!0],db_table:b.db_table,field:b.field,search_field:b.search_field,primary_key:b.primary_key,sub_info:b.sub_info,sub_as:b.sub_as,show_field:b.show_field,hide_field:b.hide_field},b.tags[c]);for(var d=["hide_field","show_field","search_field"],e=0;e<d.length;e++)"object"!=typeof b.tags[c][d[e]]&&(b.tags[c][d[e]]=this._strToArray(b.tags[c][d[e]]));return b.tags[c].order_by=void 0==b.tags[c].order_by?b.order_by:this._setOrderbyOption(b.tags[c].order_by,b.tags[c].field),b.tags[c]},_setRegExpTag:function(a,b){var c=a[0].replace(/[\s\S]*/,this._escapeForReg),d=a[1].replace(/[\s\S]*/,this._escapeForReg);return{left:a[0],right:a[1],reg_left:new RegExp(c+"((?:(?!"+c+"|"+d+")[^\\s　])*)$"),reg_right:new RegExp("^((?:(?!"+c+"|"+d+")[^\\s　])+)"),space_left:new RegExp("^"+c+"$|[\\s　]+"+c+"$"),space_right:new RegExp("^$|^[\\s　]+"),comp_right:new RegExp("^"+d)}},_escapeForReg:function(a){return"\\u"+(65536+a.charCodeAt(0)).toString(16).slice(1)},_setOrderbyOption:function(b,c){var d=[];if("object"==typeof b)for(var e=0;e<b.length;e++){var f=a.trim(b[e]).split(" ");d[e]=2==f.length?f:[f[0],"ASC"]}else{var f=a.trim(b).split(" ");d[0]=2==f.length?f:f[0].match(/^(ASC|DESC)$/i)?[c,f[0]]:[f[0],"ASC"]}return d},_setMessage:function(){var a;switch(this.option.lang){case"de":a={add_btn:"Hinzufügen-Button",add_title:"Box hinzufügen",del_btn:"Löschen-Button",del_title:"Box löschen",next:"Nächsten",next_title:"Nächsten"+this.option.per_page+" (Pfeil-rechts)",prev:"Vorherigen",prev_title:"Vorherigen"+this.option.per_page+" (Pfeil-links)",first_title:"Ersten (Umschalt + Pfeil-links)",last_title:"Letzten (Umschalt + Pfeil-rechts)",get_all_btn:"alle (Pfeil-runter)",get_all_alt:"(Button)",close_btn:"Schließen (Tab)",close_alt:"(Button)",loading:"lade...",loading_alt:"(lade)",page_info:"num_page_top - num_page_end von cnt_whole",page_info_null:"New Entry",select_ng:"Achtung: Bitte wählen Sie aus der Liste aus.",select_ok:"OK : Richtig ausgewählt.",not_found:"nicht gefunden",ajax_error:"Bei der Verbindung zum Server ist ein Fehler aufgetreten. (ajax-combobox)"};break;case"en":a={add_btn:"Add button",add_title:"add a box",del_btn:"Del button",del_title:"delete a box",next:"Next",next_title:"Next"+this.option.per_page+" (Right key)",prev:"Prev",prev_title:"Prev"+this.option.per_page+" (Left key)",first_title:"First (Shift + Left key)",last_title:"Last (Shift + Right key)",get_all_btn:"Get All (Down key)",get_all_alt:"(button)",close_btn:"Close (Tab key)",close_alt:"(button)",loading:"loading...",loading_alt:"(loading)",page_info:"num_page_top - num_page_end of cnt_whole",page_info_null:"New Entry",select_ng:"Attention : Please choose from among the list.",select_ok:"OK : Correctly selected.",not_found:"not found",ajax_error:"An error occurred while connecting to server. (ajax-combobox)"};break;case"es":a={add_btn:"Agregar boton",add_title:"Agregar una opcion",del_btn:"Borrar boton",del_title:"Borrar una opcion",next:"Siguiente",next_title:"Proximas "+this.option.per_page+" (tecla derecha)",prev:"Anterior",prev_title:"Anteriores "+this.option.per_page+" (tecla izquierda)",first_title:"Primera (Shift + Left)",last_title:"Ultima (Shift + Right)",get_all_btn:"Ver todos (tecla abajo)",get_all_alt:"(boton)",close_btn:"Cerrar (tecla TAB)",close_alt:"(boton)",loading:"Cargando...",loading_alt:"(Cargando)",page_info:"num_page_top - num_page_end de cnt_whole",page_info_null:"New Entry",select_ng:"Atencion: Elija una opcion de la lista.",select_ok:"OK: Correctamente seleccionado.",not_found:"no encuentre",ajax_error:"Un error ocurrió mientras conectando al servidor. (ajax-combobox)"};break;case"pt-br":a={add_btn:"Adicionar botão",add_title:"Adicionar uma caixa",del_btn:"Apagar botão",del_title:"Apagar uma caixa",next:"Próxima",next_title:"Próxima "+this.option.per_page+" (tecla direita)",prev:"Anterior",prev_title:"Anterior "+this.option.per_page+" (tecla esquerda)",first_title:"Primeira (Shift + Left)",last_title:"Última (Shift + Right)",get_all_btn:"Ver todos (Seta para baixo)",get_all_alt:"(botão)",close_btn:"Fechar (tecla TAB)",close_alt:"(botão)",loading:"Carregando...",loading_alt:"(Carregando)",page_info:"num_page_top - num_page_end de cnt_whole",page_info_null:"New Entry",select_ng:"Atenção: Escolha uma opção da lista.",select_ok:"OK: Selecionado Corretamente.",not_found:"não encontrado",ajax_error:"Um erro aconteceu enquanto conectando a servidor. (ajax-combobox)"};break;default:a={add_btn:"追加ボタン",add_title:"入力ボックスを追加します",del_btn:"削除ボタン",del_title:"入力ボックスを削除します",next:"次へ",next_title:"次の"+this.option.per_page+"件 (右キー)",prev:"前へ",prev_title:"前の"+this.option.per_page+"件 (左キー)",first_title:"最初のページへ (Shift + 左キー)",last_title:"最後のページへ (Shift + 右キー)",get_all_btn:"全件取得 (下キー)",get_all_alt:"画像:ボタン",close_btn:"閉じる (Tabキー)",close_alt:"画像:ボタン",loading:"読み込み中...",loading_alt:"画像:読み込み中...",page_info:"num_page_top - num_page_end 件 (全 cnt_whole 件)",page_info_null:"New Entry",select_ng:"注意 : リストの中から選択してください",select_ok:"OK : 正しく選択されました。",not_found:"(0 件)",ajax_error:"サーバとの通信でエラーが発生しました。(ajax-combobox)"}}this.message=a},_setCssClass:function(){var b={container:"ac_container",container_open:"ac_container_open",selected:"ac_selected",re_area:"ac_result_area",navi:"ac_navi",results:"ac_results",re_off:"ac_results_off",select:"ac_over",sub_info:"ac_subinfo",select_ok:"ac_select_ok",select_ng:"ac_select_ng",input_off:"ac_input_off"};switch(this.option.plugin_type){case"combobox":b=a.extend(b,{button:"ac_button",btn_on:"ac_btn_on",btn_out:"ac_btn_out",input:"ac_input"});break;case"simple":b=a.extend(b,{input:"ac_s_input"});break;case"textarea":b=a.extend(b,{input:"ac_textarea",btn_short_off:"ac_btn_short_off"})}this.css_class=b},_setProp:function(){this.prop={timer_valchange:!1,is_suggest:!1,page_all:1,page_suggest:1,max_all:1,max_suggest:1,is_paging:!1,is_loading:!1,reserve_btn:!1,reserve_click:!1,xhr:!1,key_paging:!1,key_select:!1,prev_value:"",size_navi:null,size_results:null,size_li:null,size_left:null,tag:null}},_setElem:function(b){var c={};if(c.combo_input=a(b).attr("autocomplete","off").addClass(this.css_class.input).wrap("<div>"),c.container=a(c.combo_input).parent().addClass(this.css_class.container),"combobox"==this.option.plugin_type?(c.button=a("<div>").addClass(this.css_class.button),c.img=a("<img>").attr("src",this.option.button_img)):(c.button=!1,c.img=!1),c.result_area=a("<div>").addClass(this.css_class.re_area),c.navi=a("<div>").addClass(this.css_class.navi),c.navi_info=a("<div>").addClass("info"),c.navi_p=a("<p>"),c.results=a("<ul>").addClass(this.css_class.results),c.sub_info=a("<div>").addClass(this.css_class.sub_info),"textarea"==this.option.plugin_type)c.hidden=!1;else{var d=void 0!=a(c.combo_input).attr("name")?a(c.combo_input).attr("name"):a(c.combo_input).attr("id");d.match(/\]$/)?d=d.replace(/\]?$/,"_primary_key]"):d+="_primary_key",c.hidden=a('<input type="hidden" />').attr({name:d,id:d}).val("")}switch(this.option.plugin_type){case"combobox":a(c.container).append(c.button).append(c.result_area).append(c.hidden),a(c.button).append(c.img);break;case"simple":a(c.container).append(c.result_area).append(c.hidden);break;case"textarea":a(c.container).append(c.result_area)}a(c.result_area).append(c.navi).append(c.results).append(c.sub_info),a(c.navi).append(c.navi_info).append(c.navi_p),"combobox"==this.option.plugin_type&&a(c.button).height(a(c.combo_input).innerHeight()),this.elem=c},_setButtonAttrDefault:function(){this.option.select_only&&(""!=a(this.elem.combo_input).val()?"textarea"!=this.option.plugin_type&&(""!=a(this.elem.hidden).val()?a(this.elem.combo_input).attr("title",this.message.select_ok).removeClass(this.css_class.select_ng).addClass(this.css_class.select_ok):a(this.elem.combo_input).attr("title",this.message.select_ng).removeClass(this.css_class.select_ok).addClass(this.css_class.select_ng)):("textarea"!=this.option.plugin_type&&a(this.elem.hidden).val(""),a(this.elem.combo_input).removeAttr("title").removeClass(this.css_class.select_ng))),"combobox"==this.option.plugin_type&&(a(this.elem.button).attr("title",this.message.get_all_btn),a(this.elem.img).attr("src",this.option.button_img))},_setInitRecord:function(){if(this.option.init_record!==!1)if("textarea"!=this.option.plugin_type&&a(this.elem.hidden).val(this.option.init_record),"object"==typeof this.option.source){for(var b=0;b<this.option.source.length;b++)if(this.option.source[b][this.option.primary_key]==this.option.init_record){var c=this.option.source[b];break}this._afterInit(this,c)}else{var d=this;a.ajax({dataType:"json",url:d.option.source,data:{db_table:this.option.db_table,pkey_name:this.option.primary_key,pkey_val:this.option.init_record},success:function(a){d._afterInit(d,a)},error:function(a,b,c){d._ajaxErrorNotify(d,c)}})}},_afterInit:function(b,c){a(b.elem.combo_input).val(c[b.option.field]),"textarea"!=b.option.plugin_type&&a(b.elem.hidden).val(c[b.option.primary_key]),b.prop.prev_value=c[b.option.field],b.option.select_only&&a(b.elem.combo_input).attr("title",b.message.select_ok).removeClass(b.css_class.select_ng).addClass(b.css_class.select_ok)},_ehButton:function(){if("combobox"==this.option.plugin_type){var b=this;a(b.elem.button).mouseup(function(c){a(b.elem.result_area).is(":hidden")?(clearInterval(b.prop.timer_valchange),b.prop.is_suggest=!1,b._suggest(b),a(b.elem.combo_input).focus()):b._hideResults(b),c.stopPropagation()}).mouseover(function(){a(b.elem.button).addClass(b.css_class.btn_on).removeClass(b.css_class.btn_out)}).mouseout(function(){a(b.elem.button).addClass(b.css_class.btn_out).removeClass(b.css_class.btn_on)}).mouseout()}},_ehComboInput:function(){var b=this;a(b.elem.combo_input).keydown(function(a){b._processKey(b,a)}),a(b.elem.combo_input).focus(function(){b._setTimerCheckValue(b)}).click(function(){b._setCssFocusedInput(b),a(b.elem.results).children("li").removeClass(b.css_class.select)})},_ehWhole:function(){var b=this,c=!1;a(b.elem.container).mousedown(function(){c=!0}),a("html").mousedown(function(){c?c=!1:b._hideResults(b)})},_ehResults:function(){var b=this;a(b.elem.results).children("li").mouseover(function(){return b.prop.key_select?void(b.prop.key_select=!1):(b._setSubInfo(b,this),a(b.elem.results).children("li").removeClass(b.css_class.select),a(this).addClass(b.css_class.select),void b._setCssFocusedResults(b))}).click(function(a){return b.prop.key_select?void(b.prop.key_select=!1):(a.preventDefault(),a.stopPropagation(),void b._selectCurrentLine(b,!1))})},_ehNaviPaging:function(b){a(b.elem.navi).find(".navi_first").mouseup(function(c){a(b.elem.combo_input).focus(),c.preventDefault(),b._firstPage(b)}),a(b.elem.navi).find(".navi_prev").mouseup(function(c){a(b.elem.combo_input).focus(),c.preventDefault(),b._prevPage(b)}),a(b.elem.navi).find(".navi_page").mouseup(function(c){a(b.elem.combo_input).focus(),c.preventDefault(),b.prop.is_suggest?b.prop.page_suggest=parseInt(a(this).text(),10):b.prop.page_all=parseInt(a(this).text(),10),b.prop.is_paging=!0,b._suggest(b)}),a(b.elem.navi).find(".navi_next").mouseup(function(c){a(b.elem.combo_input).focus(),c.preventDefault(),b._nextPage(b)}),a(b.elem.navi).find(".navi_last").mouseup(function(c){a(b.elem.combo_input).focus(),c.preventDefault(),b._lastPage(b)})},_ehTextArea:function(){var b=this;b.option.shorten_btn&&a(b.option.shorten_btn).click(function(){b._getShortURL(b)})},_getShortURL:function(b){a(b.elem.combo_input).attr("disabled","disabled");for(var c=a(b.elem.combo_input).val(),d=[],e=null;null!=(e=b.option.shorten_reg.exec(c));)d[d.length]=e[1];if(d.length<1)return void a(b.elem.combo_input).removeAttr("disabled");for(var f={},g=0;g<d.length;g++)f["p_"+g]=d[g];a.ajax({dataType:"json",url:b.option.shorten_src,data:f,success:function(d){var e=0,f=c.replace(b.option.shorten_reg,function(){var a=arguments[0].replace(arguments[1],d[e]);return e++,a});a(b.elem.combo_input).val(f),b.prop.prev_value=f,b._disableButtonShort(b)},error:function(a,c,d){b._ajaxErrorNotify(b,d)},complete:function(){a(b.elem.combo_input).removeAttr("disabled").focus()}})},_ajaxErrorNotify:function(a,b){alert(a.message.ajax_error)},_scrollWindow:function(b,c){var d,e=b._getCurrentLine(b),f=e&&!c?e.offset().top:a(b.elem.container).offset().top;if(b.option.sub_info){var g=a(b.elem.sub_info).children("dl:visible");d=a(g).height()+parseInt(a(g).css("border-top-width"))+parseInt(a(g).css("border-bottom-width"))}else b.prop.size_li=a(b.elem.results).children("li:first").outerHeight(),d=b.prop.size_li;var h,i=a(window).height(),j=a(window).scrollTop(),k=j+i-d;if(a(e).length)if(j>f||d>i)h=f-j;else{if(!(f>k))return;h=f-k}else j>f&&(h=f-j);window.scrollBy(0,h)},_setCssFocusedInput:function(b){a(b.elem.results).addClass(b.css_class.re_off),a(b.elem.combo_input).removeClass(b.css_class.input_off),a(b.elem.sub_info).children("dl").hide()},_setCssFocusedResults:function(b){a(b.elem.results).removeClass(b.css_class.re_off),a(b.elem.combo_input).addClass(b.css_class.input_off)},_enableButtonShort:function(b){a(b.option.shorten_btn).removeClass(b.css_class.btn_short_off).removeAttr("disabled")},_disableButtonShort:function(b){a(b.option.shorten_btn).addClass(b.css_class.btn_short_off).attr("disabled","disabled")},_setTimerCheckValue:function(a){a.prop.timer_valchange=setTimeout(function(){a._checkValue(a)},500)},_checkValue:function(b){var c=a(b.elem.combo_input).val();if(c!=b.prop.prev_value)if(b.prop.prev_value=c,"textarea"==b.option.plugin_type){b._findUrlToShorten(b);var d=b._findTag(b,c);d&&(b._setTextAreaNewSearch(b,d),b._suggest(b))}else a(b.elem.combo_input).removeAttr("sub_info"),"textarea"!=b.option.plugin_type&&a(b.elem.hidden).val(""),b.option.select_only&&b._setButtonAttrDefault(),b.prop.page_suggest=1,b.prop.is_suggest=!0,b._suggest(b);else if("textarea"==b.option.plugin_type&&a(b.elem.result_area).is(":visible")){var e=b._findTag(b,c);e?(e.str!=b.prop.tag.str||e.pos_left!=b.prop.tag.pos_left)&&(b._setTextAreaNewSearch(b,e),b._suggest(b)):b._hideResults(b)}b._setTimerCheckValue(b)},_setTextAreaNewSearch:function(a,b){a.prop.tag=b,a.prop.page_suggest=1,a.option.search_field=a.option.tags[a.prop.tag.type].search_field,a.option.order_by=a.option.tags[a.prop.tag.type].order_by,a.option.primary_key=a.option.tags[a.prop.tag.type].primary_key,a.option.db_table=a.option.tags[a.prop.tag.type].db_table,a.option.field=a.option.tags[a.prop.tag.type].field,a.option.sub_info=a.option.tags[a.prop.tag.type].sub_info,a.option.sub_as=a.option.tags[a.prop.tag.type].sub_as,a.option.show_field=a.option.tags[a.prop.tag.type].show_field,a.option.hide_field=a.option.tags[a.prop.tag.type].hide_field},_findUrlToShorten:function(b){for(var c=null,d=null;null!=(d=b.option.shorten_reg.exec(a(b.elem.combo_input).val()));){c=!0,b.option.shorten_reg.lastIndex=0;break}c?b._enableButtonShort(b):b._disableButtonShort(b)},_findTag:function(b,c){for(var d=b._getCaretPosition(a(b.elem.combo_input).get(0)),e=0;e<b.option.tags.length;e++){var f=c.substring(0,d);if(f=f.match(b.option.tags[e].pattern.reg_left)){f=f[1];var g=d-f.length;0>g&&(g=0);var h=c.substring(d,c.length);if(h=h.match(b.option.tags[e].pattern.reg_right)){h=h[1];var i=d+h.length}else{h="";var i=d}var j=f+""+h;return b.prop.is_suggest=""==j?!1:!0,{type:e,str:j,pos_left:g,pos_right:i}}}return!1},_getCaretPosition:function(a){var b=0;if(document.selection){a.focus();var c=document.selection.createRange();c.moveStart("character",-a.value.length),b=c.text.length}else(a.selectionStart||"0"==a.selectionStart)&&(b=a.selectionStart);return b},_setCaretPosition:function(b,c){var d=a(b.elem.combo_input).get(0);if(d.setSelectionRange)d.focus(),d.setSelectionRange(c,c);else if(d.createTextRange){var e=d.createTextRange();e.collapse(!0),e.moveEnd("character",c),e.moveStart("character",c),e.select()}},_processKey:function(b,c){if(a.inArray(c.keyCode,[27,38,40,9])>-1&&a(b.elem.result_area).is(":visible")||a.inArray(c.keyCode,[37,39,13,9])>-1&&b._getCurrentLine(b)||40==c.keyCode&&"textarea"!=b.option.plugin_type)switch(c.preventDefault(),c.stopPropagation(),c.cancelBubble=!0,c.returnValue=!1,c.keyCode){case 37:c.shiftKey?b._firstPage(b):b._prevPage(b);break;case 38:b.prop.key_select=!0,b._prevLine(b);break;case 39:c.shiftKey?b._lastPage(b):b._nextPage(b);break;case 40:a(b.elem.results).children("li").length?(b.prop.key_select=!0,b._nextLine(b)):(b.prop.is_suggest=!1,b._suggest(b));break;case 9:b.prop.key_paging=!0,b._hideResults(b);break;case 13:b._selectCurrentLine(b,!0);break;case 27:b.prop.key_paging=!0,b._hideResults(b)}else 16!=c.keyCode&&b._setCssFocusedInput(b),b._checkValue(b)},_abortAjax:function(a){a.prop.xhr&&(a.prop.xhr.abort(),a.prop.xhr=!1)},_suggest:function(b){if("textarea"!=b.option.plugin_type){var c=b.prop.is_suggest?a.trim(a(b.elem.combo_input).val()):"";if(c.length<1&&b.prop.is_suggest)return void b._hideResults(b);c=c.split(/[\s　]+/)}else var c=[b.prop.tag.str];if(b._abortAjax(b),b._setLoading(b),a(b.elem.sub_info).children("dl").hide(),b.prop.is_paging){var d=b._getCurrentLine(b);b.prop.is_paging=d?a(b.elem.results).children("li").index(d):-1}else b.prop.is_suggest||(b.prop.is_paging=0);var e=b.prop.is_suggest?b.prop.page_suggest:b.prop.page_all;"object"==typeof b.option.source?b._searchForJson(b,c,e):b._searchForDb(b,c,e)},_setLoading:function(b){a(b.elem.navi_info).text(b.message.loading),""==a(b.elem.results).html()&&(a(b.elem.navi).children("p").empty(),b._calcWidthResults(b),a(b.elem.container).addClass(b.css_class.container_open))},_searchForDb:function(b,c,d){b.prop.xhr=a.ajax({dataType:"json",url:b.option.source,data:{q_word:c,page_num:d,per_page:b.option.per_page,search_field:b.option.search_field,and_or:b.option.and_or,order_by:b.option.order_by,db_table:b.option.db_table},success:function(e){if(e.candidate=[],e.primary_key=[],e.subinfo=[],"object"!=typeof e.result)return b.prop.xhr=null,void b._notFoundSearch(b);
for(e.cnt_page=e.result.length,i=0;i<e.cnt_page;i++){e.subinfo[i]=[];for(key in e.result[i])if(key==b.option.primary_key&&e.primary_key.push(e.result[i][key]),key==b.option.field)e.candidate.push(e.result[i][key]);else if(-1==a.inArray(key,b.option.hide_field)){if(""!=b.option.show_field&&-1==a.inArray("*",b.option.show_field)&&-1==a.inArray(key,b.option.show_field))continue;e.subinfo[i][key]=e.result[i][key]}}delete e.result,b._prepareResults(b,e,c,d)},error:function(a,c,d){"abort"!=c&&(b._hideResults(b),b._ajaxErrorNotify(b,d))},complete:function(){b.prop.xhr=null}})},_searchForJson:function(b,c,d){var e=[],f=[],g=[],h={},i=0,j=[];do f[i]=c[i].replace(/\W/g,"\\$&").toString(),j[i]=new RegExp(f[i],"gi"),i++;while(i<c.length);for(var i=0;i<b.option.source.length;i++){for(var k=!1,l=0;l<j.length;l++)if(b.option.source[i][b.option.field].match(j[l])){if(k=!0,"OR"==b.option.and_or)break}else if(k=!1,"AND"==b.option.and_or)break;k&&e.push(b.option.source[i])}if(void 0==e.length)return void b._notFoundSearch(b);h.cnt_whole=e.length;for(var m=new RegExp("^"+f[0]+"$","gi"),n=new RegExp("^"+f[0],"gi"),o=[],p=[],q=[],i=0;i<e.length;i++)e[i][b.option.order_by[0][0]].match(m)?o.push(e[i]):e[i][b.option.order_by[0][0]].match(n)?p.push(e[i]):q.push(e[i]);b.option.order_by[0][1].match(/^asc$/i)?(o=b._sortAsc(b,o),p=b._sortAsc(b,p),q=b._sortAsc(b,q)):(o=b._sortDesc(b,o),p=b._sortDesc(b,p),q=b._sortDesc(b,q)),g=g.concat(o).concat(p).concat(q);for(var r=(d-1)*b.option.per_page,s=r+b.option.per_page,i=r,t=0;s>i&&void 0!=g[i];i++,t++)for(var u in g[i])if(u==b.option.primary_key&&(void 0==h.primary_key&&(h.primary_key=[]),h.primary_key.push(g[i][u])),u==b.option.field)void 0==h.candidate&&(h.candidate=[]),h.candidate.push(g[i][u]);else if(-1==a.inArray(u,b.option.hide_field)){if(""!=b.option.show_field&&-1==a.inArray("*",b.option.show_field)&&-1==a.inArray(u,b.option.show_field))continue;void 0==h.subinfo&&(h.subinfo=[]),void 0==h.subinfo[t]&&(h.subinfo[t]=[]),h.subinfo[t][u]=g[i][u]}void 0==h.candidate&&(h.candidate=[]),h.cnt_page=h.candidate.length,b._prepareResults(b,h,c,d)},_sortAsc:function(a,b){return b.sort(function(b,c){return b[a.option.order_by[0][0]].localeCompare(c[a.option.order_by[0][0]])}),b},_sortDesc:function(a,b){return b.sort(function(b,c){return c[a.option.order_by[0][0]].localeCompare(b[a.option.order_by[0][0]])}),b},_notFoundSearch:function(b){a(b.elem.navi_info).text(b.message.not_found),a(b.elem.navi_p).hide(),a(b.elem.results).empty(),a(b.elem.sub_info).empty(),b._calcWidthResults(b),a(b.elem.container).addClass(b.css_class.container_open),b._setCssFocusedInput(b)},_prepareResults:function(b,c,d,e){if(b._setNavi(b,c.cnt_whole,c.cnt_page,e),c.subinfo&&b.option.sub_info||(c.subinfo=!1),c.primary_key||(c.primary_key=!1),b.option.select_only&&1===c.candidate.length&&c.candidate[0]==d[0]&&("textarea"!=b.option.plugin_type&&a(b.elem.hidden).val(c.primary_key[0]),this._setButtonAttrDefault()),b._displayResults(b,c.candidate,c.subinfo,c.primary_key),b.prop.is_paging===!1)b._setCssFocusedInput(b);else{var f=b.prop.is_paging,g=a(b.elem.results).children("li").length-1;f>g&&(f=g);var h=a(b.elem.results).children("li").eq(f);a(h).addClass(b.css_class.select),b._setSubInfo(b,h),b.prop.is_paging=!1,b._setCssFocusedResults(b)}},_setNavi:function(b,c,d,e){var f=b.option.per_page*(e-1)+1,g=f+d-1,h=b.message.page_info.replace("cnt_whole",c).replace("num_page_top",f).replace("num_page_end",g),i=b.message.page_info_null;c>0?a(b.elem.navi_info).text(h):a(b.elem.navi_info).text(i);var j=Math.ceil(c/b.option.per_page);if(j>1){a(b.elem.navi_p).empty(),b.prop.is_suggest?b.prop.max_suggest=j:b.prop.max_all=j;for(var k=e-Math.ceil((b.option.navi_num-1)/2),l=e+Math.floor((b.option.navi_num-1)/2);1>k;)k++,l++;for(;l>j;)l--;for(;l-k<b.option.navi_num-1&&k>1;)k--;1==e?(b.option.navi_simple||a("<span>").text("<< 1").addClass("page_end").appendTo(b.elem.navi_p),a("<span>").text(b.message.prev).addClass("page_end").appendTo(b.elem.navi_p)):(b.option.navi_simple||a("<a>").attr({href:"javascript:void(0)","class":"navi_first"}).text("<< 1").attr("title",b.message.first_title).appendTo(b.elem.navi_p),a("<a>").attr({href:"javascript:void(0)","class":"navi_prev",title:b.message.prev_title}).text(b.message.prev).appendTo(b.elem.navi_p));for(var m=k;l>=m;m++){var n=m==e?'<span class="current">'+m+"</span>":m;a("<a>").attr({href:"javascript:void(0)","class":"navi_page"}).html(n).appendTo(b.elem.navi_p)}e==j?(a("<span>").text(b.message.next).addClass("page_end").appendTo(b.elem.navi_p),b.option.navi_simple||a("<span>").text(j+" >>").addClass("page_end").appendTo(b.elem.navi_p)):(a("<a>").attr({href:"javascript:void(0)","class":"navi_next"}).text(b.message.next).attr("title",b.message.next_title).appendTo(b.elem.navi_p),b.option.navi_simple||a("<a>").attr({href:"javascript:void(0)","class":"navi_last"}).text(j+" >>").attr("title",b.message.last_title).appendTo(b.elem.navi_p)),a(b.elem.navi_p).show(),b._ehNaviPaging(b)}else a(b.elem.navi_p).hide()},_setButtonPosition:function(){if("combobox"==this.option.plugin_type){var b=a(this.elem.button).innerWidth(),c=a(this.elem.button).innerHeight(),d=a(this.elem.img).width(),e=a(this.elem.img).height(),f=b/2-d/2,g=c/2-e/2;a(this.elem.img).css({top:g,left:f})}},_setSubInfo:function(b,c){if(b.option.sub_info){b.prop.size_results=(a(b.elem.results).outerHeight()-a(b.elem.results).height())/2,b.prop.size_navi=a(b.elem.navi).outerHeight(),b.prop.size_li=a(b.elem.results).children("li:first").outerHeight(),b.prop.size_left=a(b.elem.results).outerWidth();var d=a(b.elem.results).children("li").index(c);a(b.elem.sub_info).children("dl").hide();var e=0;"none"!=a(b.elem.navi).css("display")&&(e+=b.prop.size_navi),e+=b.prop.size_results+b.prop.size_li*d;var f=b.prop.size_left;e+="px",f+="px",a(b.elem.sub_info).children("dl").eq(d).css({position:"absolute",top:e,left:f,display:"block"})}},_displayResults:function(b,c,d,e){a(b.elem.results).empty(),a(b.elem.sub_info).empty();for(var f=0;f<c.length;f++){var g=a("<li>").text(c[f]).attr({pkey:e[f],title:c[f]});if("textarea"!=b.option.plugin_type&&e[f]==a(b.elem.hidden).val()&&a(g).addClass(b.css_class.selected),a(b.elem.results).append(g),d){var h=[],i=a("<dl>");for(key in d[f]){var j=key.replace("'","\\'");null==d[f][key]?d[f][key]="":d[f][key]+="";var k=d[f][key].replace("'","\\'");if(h.push("'"+j+"':'"+k+"'"),null!=b.option.sub_as[key])var l=b.option.sub_as[key];else var l=key;l=a("<dt>").text(l),"simple"==b.option.sub_info&&a(l).addClass("hide"),i.append(l);var m=a("<dd>").text(d[f][key]);i.append(m)}h="{"+h.join(",")+"}",a(g).attr("sub_info",h),a(b.elem.sub_info).append(i),"simple"==b.option.sub_info&&""==i.children("dd").text()&&i.addClass("ac_dl_empty")}}b._calcWidthResults(b),a(b.elem.container).addClass(b.css_class.container_open),b._ehResults(),"combobox"==b.option.plugin_type&&a(b.elem.button).attr("title",b.message.close_btn)},_calcWidthResults:function(b){if("combobox"==b.option.plugin_type){a(b.elem.combo_input).outerWidth()+a(b.elem.button).outerWidth()}else{a(b.elem.combo_input).outerWidth()}if("static"==a(b.elem.container).css("position")){var c=a(b.elem.combo_input).offset();a(b.elem.result_area).css({top:c.top+a(b.elem.combo_input).outerHeight()+"px",left:c.left+"px"})}else a(b.elem.result_area).css({top:a(b.elem.combo_input).outerHeight()+"px",left:"0px"});a(b.elem.result_area).width(a(b.elem.container).width()-(a(b.elem.result_area).outerWidth()-a(b.elem.result_area).innerWidth())).show()},_hideResults:function(b){b.prop.key_paging&&(b._scrollWindow(b,!0),b.prop.key_paging=!1),b._setCssFocusedInput(b),a(b.elem.results).empty(),a(b.elem.sub_info).empty(),a(b.elem.result_area).hide(),a(b.elem.container).removeClass(b.css_class.container_open),b._abortAjax(b),b._setButtonAttrDefault()},_firstPage:function(a){a.prop.is_suggest?a.prop.page_suggest>1&&(a.prop.page_suggest=1,a.prop.is_paging=!0,a._suggest(a)):a.prop.page_all>1&&(a.prop.page_all=1,a.prop.is_paging=!0,a._suggest(a))},_prevPage:function(a){a.prop.is_suggest?a.prop.page_suggest>1&&(a.prop.page_suggest--,a.prop.is_paging=!0,a._suggest(a)):a.prop.page_all>1&&(a.prop.page_all--,a.prop.is_paging=!0,a._suggest(a))},_nextPage:function(a){a.prop.is_suggest?a.prop.page_suggest<a.prop.max_suggest&&(a.prop.page_suggest++,a.prop.is_paging=!0,a._suggest(a)):a.prop.page_all<a.prop.max_all&&(a.prop.page_all++,a.prop.is_paging=!0,a._suggest(a))},_lastPage:function(a){a.prop.is_suggest?a.prop.page_suggest<a.prop.max_suggest&&(a.prop.page_suggest=a.prop.max_suggest,a.prop.is_paging=!0,a._suggest(a)):a.prop.page_all<a.prop.max_all&&(a.prop.page_all=a.prop.max_all,a.prop.is_paging=!0,a._suggest(a))},_selectCurrentLine:function(b,c){b._scrollWindow(b,!0);var d=b._getCurrentLine(b);if(d){if("textarea"!=b.option.plugin_type)a(b.elem.combo_input).val(a(d).text()),b.option.sub_info&&a(b.elem.combo_input).attr("sub_info",a(d).attr("sub_info")),b.option.select_only&&b._setButtonAttrDefault(),a(b.elem.hidden).val(a(d).attr("pkey"));else{var e=b.prop.prev_value.substring(0,b.prop.tag.pos_left),f=b.prop.prev_value.substring(b.prop.tag.pos_right),g=a(d).text();if(b.option.tags[b.prop.tag.type].space[0]&&!e.match(b.option.tags[b.prop.tag.type].pattern.space_left)){var h=b.option.tags[b.prop.tag.type].pattern.left.length,i=e.length;e=e.substring(0,i-h)+" "+e.substring(i-h)}if(f.match(b.option.tags[b.prop.tag.type].pattern.comp_right)||(f=b.option.tags[b.prop.tag.type].pattern.right+f),b.option.tags[b.prop.tag.type].space[1]&&!f.match(b.option.tags[b.prop.tag.type].pattern.space_right)){var h=b.option.tags[b.prop.tag.type].pattern.right.length;f=f.substring(0,h)+" "+f.substring(h)}a(b.elem.combo_input).val(e+""+g+f);var j=e.length+g.length;b._setCaretPosition(b,j)}b.prop.prev_value=a(b.elem.combo_input).val(),b._hideResults(b)}b.option.bind_to&&a(b.elem.combo_input).trigger(b.option.bind_to,c),a(b.elem.combo_input).focus(),a(b.elem.combo_input).change(),b._setCssFocusedInput(b)},_getCurrentLine:function(b){if(a(b.elem.result_area).is(":hidden"))return!1;var c=a(b.elem.results).children("li."+b.css_class.select);return a(c).length?c:!1},_nextLine:function(b){var c=b._getCurrentLine(b);if(c){var d=a(b.elem.results).children("li").index(c);a(c).removeClass(b.css_class.select)}else var d=-1;if(d++,d<a(b.elem.results).children("li").length){var e=a(b.elem.results).children("li").eq(d);b._setSubInfo(b,e),a(e).addClass(b.css_class.select),b._setCssFocusedResults(b)}else b._setCssFocusedInput(b);b._scrollWindow(b,!1)},_prevLine:function(b){var c=b._getCurrentLine(b);if(c){var d=a(b.elem.results).children("li").index(c);a(c).removeClass(b.css_class.select)}else var d=a(b.elem.results).children("li").length;if(d--,d>-1){var e=a(b.elem.results).children("li").eq(d);b._setSubInfo(b,e),a(e).addClass(b.css_class.select),b._setCssFocusedResults(b)}else b._setCssFocusedInput(b);b._scrollWindow(b,!1)}})}(jQuery),function(a){"function"==typeof define&&define.amd?define(["jquery","moment"],a):"object"==typeof exports&&"undefined"!=typeof module?module.exports=a(require("jquery"),require("moment")):a(jQuery,moment)}(function(a,b){a.dateRangePickerLanguages={"default":{selected:"Selected:",day:"Day",days:"Days",apply:"Close","week-1":"mo","week-2":"tu","week-3":"we","week-4":"th","week-5":"fr","week-6":"sa","week-7":"su","week-number":"W","month-name":["january","february","march","april","may","june","july","august","september","october","november","december"],shortcuts:"Shortcuts","custom-values":"Custom Values",past:"Past",following:"Following",previous:"Previous","prev-week":"Week","prev-month":"Month","prev-year":"Year",next:"Next","next-week":"Week","next-month":"Month","next-year":"Year","less-than":"Date range should not be more than %d days","more-than":"Date range should not be less than %d days","default-more":"Please select a date range longer than %d days","default-single":"Please select a date","default-less":"Please select a date range less than %d days","default-range":"Please select a date range between %d and %d days","default-default":"Please select a date range",time:"Time",hour:"Hour",minute:"Minute"},az:{selected:"Seçildi:",day:" gün",days:" gün",apply:"tətbiq","week-1":"1","week-2":"2","week-3":"3","week-4":"4","week-5":"5","week-6":"6","week-7":"7","month-name":["yanvar","fevral","mart","aprel","may","iyun","iyul","avqust","sentyabr","oktyabr","noyabr","dekabr"],shortcuts:"Qısayollar",past:"Keçmiş",following:"Növbəti",previous:"&nbsp;&nbsp;&nbsp;","prev-week":"Öncəki həftə","prev-month":"Öncəki ay","prev-year":"Öncəki il",next:"&nbsp;&nbsp;&nbsp;","next-week":"Növbəti həftə","next-month":"Növbəti ay","next-year":"Növbəti il","less-than":"Tarix aralığı %d gündən çox olmamalıdır","more-than":"Tarix aralığı %d gündən az olmamalıdır","default-more":"%d gündən çox bir tarix seçin","default-single":"Tarix seçin","default-less":"%d gündən az bir tarix seçin","default-range":"%d və %d gün aralığında tarixlər seçin","default-default":"Tarix aralığı seçin"},cn:{selected:"已选择:",day:"天",days:"天",apply:"确定","week-1":"一","week-2":"二","week-3":"三","week-4":"四","week-5":"五","week-6":"六","week-7":"日","week-number":"周","month-name":["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],shortcuts:"快捷选择",past:"过去",following:"将来",previous:"&nbsp;&nbsp;&nbsp;","prev-week":"上周","prev-month":"上个月","prev-year":"去年",next:"&nbsp;&nbsp;&nbsp;","next-week":"下周","next-month":"下个月","next-year":"明年","less-than":"所选日期范围不能大于%d天","more-than":"所选日期范围不能小于%d天","default-more":"请选择大于%d天的日期范围","default-less":"请选择小于%d天的日期范围","default-range":"请选择%d天到%d天的日期范围","default-single":"请选择一个日期","default-default":"请选择一个日期范围",time:"时间",hour:"小时",minute:"分钟"},cz:{selected:"Vybráno:",day:"Den",days:"Dny",apply:"Zavřít","week-1":"po","week-2":"út","week-3":"st","week-4":"čt","week-5":"pá","week-6":"so","week-7":"ne","month-name":["leden","únor","březen","duben","květen","červen","červenec","srpen","září","říjen","listopad","prosinec"],shortcuts:"Zkratky",past:"po",following:"následující",previous:"předchozí","prev-week":"týden","prev-month":"měsíc","prev-year":"rok",next:"další","next-week":"týden","next-month":"měsíc","next-year":"rok","less-than":"Rozsah data by neměl být větší než %d dnů","more-than":"Rozsah data by neměl být menší než %d dnů","default-more":"Prosím zvolte rozsah data větší než %d dnů","default-single":"Prosím zvolte datum","default-less":"Prosím zvolte rozsah data menší než %d dnů","default-range":"Prosím zvolte rozsah data mezi %d a %d dny","default-default":"Prosím zvolte rozsah data"},de:{selected:"Auswahl:",day:"Tag",days:"Tage",apply:"Schließen","week-1":"mo","week-2":"di","week-3":"mi","week-4":"do","week-5":"fr","week-6":"sa","week-7":"so","month-name":["januar","februar","märz","april","mai","juni","juli","august","september","oktober","november","dezember"],shortcuts:"Schnellwahl",past:"Vorherige",following:"Folgende",previous:"Vorherige","prev-week":"Woche","prev-month":"Monat","prev-year":"Jahr",next:"Nächste","next-week":"Woche","next-month":"Monat","next-year":"Jahr","less-than":"Datumsbereich darf nicht größer sein als %d Tage","more-than":"Datumsbereich darf nicht kleiner sein als %d Tage","default-more":"Bitte mindestens %d Tage auswählen","default-single":"Bitte ein Datum auswählen","default-less":"Bitte weniger als %d Tage auswählen","default-range":"Bitte einen Datumsbereich zwischen %d und %d Tagen auswählen","default-default":"Bitte ein Start- und Enddatum auswählen",Time:"Zeit",hour:"Stunde",minute:"Minute"},es:{selected:"Seleccionado:",day:"Dia",days:"Dias",apply:"Cerrar","week-1":"lu","week-2":"ma","week-3":"mi","week-4":"ju","week-5":"vi","week-6":"sa","week-7":"do","month-name":["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],shortcuts:"Accesos directos",past:"Pasado",following:"Siguiente",previous:"Anterior","prev-week":"Semana","prev-month":"Mes","prev-year":"Año",next:"Siguiente","next-week":"Semana","next-month":"Mes","next-year":"Año","less-than":"El rango no deberia ser mayor de %d dias","more-than":"El rango no deberia ser menor de %d dias","default-more":"Por favor selecciona un rango mayor a %d dias","default-single":"Por favor selecciona un dia","default-less":"Por favor selecciona un rango menor a %d dias","default-range":"Por favor selecciona un rango entre %d y %d dias","default-default":"Por favor selecciona un rango de fechas."},fr:{selected:"Sélection:",day:"Jour",days:"Jours",apply:"Fermer","week-1":"lu","week-2":"ma","week-3":"me","week-4":"je","week-5":"ve","week-6":"sa","week-7":"di","month-name":["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"],shortcuts:"Raccourcis",past:"Passé",following:"Suivant",previous:"Précédent","prev-week":"Semaine","prev-month":"Mois","prev-year":"Année",next:"Suivant","next-week":"Semaine","next-month":"Mois","next-year":"Année","less-than":"L'intervalle ne doit pas être supérieure à %d jours","more-than":"L'intervalle ne doit pas être inférieure à %d jours","default-more":"Merci de choisir une intervalle supérieure à %d jours","default-single":"Merci de choisir une date","default-less":"Merci de choisir une intervalle inférieure %d jours","default-range":"Merci de choisir une intervalle comprise entre %d et %d jours","default-default":"Merci de choisir une date"},hu:{selected:"Kiválasztva:",day:"Nap",days:"Nap",apply:"Ok","week-1":"h","week-2":"k","week-3":"sz","week-4":"cs","week-5":"p","week-6":"sz","week-7":"v","month-name":["január","február","március","április","május","június","július","augusztus","szeptember","október","november","december"],shortcuts:"Gyorsválasztó",past:"Múlt",following:"Következő",previous:"Előző","prev-week":"Hét","prev-month":"Hónap","prev-year":"Év",next:"Következő","next-week":"Hét","next-month":"Hónap","next-year":"Év","less-than":"A kiválasztás nem lehet több %d napnál","more-than":"A kiválasztás nem lehet több %d napnál","default-more":"Válassz ki egy időszakot ami hosszabb mint %d nap","default-single":"Válassz egy napot","default-less":"Válassz ki egy időszakot ami rövidebb mint %d nap","default-range":"Válassz ki egy %d - %d nap hosszú időszakot","default-default":"Válassz ki egy időszakot"},it:{selected:"Selezionati:",day:"Giorno",days:"Giorni",apply:"Chiudi","week-1":"lu","week-2":"ma","week-3":"me","week-4":"gi","week-5":"ve","week-6":"sa","week-7":"do","month-name":["gennaio","febbraio","marzo","aprile","maggio","giugno","luglio","agosto","settembre","ottobre","novembre","dicembre"],shortcuts:"Scorciatoie",past:"Scorso",following:"Successivo",previous:"Precedente","prev-week":"Settimana","prev-month":"Mese","prev-year":"Anno",next:"Prossimo","next-week":"Settimana","next-month":"Mese","next-year":"Anno","less-than":"L'intervallo non dev'essere maggiore di %d giorni","more-than":"L'intervallo non dev'essere minore di %d giorni","default-more":"Seleziona un intervallo maggiore di %d giorni","default-single":"Seleziona una data","default-less":"Seleziona un intervallo minore di %d giorni","default-range":"Seleziona un intervallo compreso tra i %d e i %d giorni","default-default":"Seleziona un intervallo di date"},no:{selected:"Valgt:",day:"Dag",days:"Dager",apply:"Lukk","week-1":"ma","week-2":"ti","week-3":"on","week-4":"to","week-5":"fr","week-6":"lø","week-7":"sø","month-name":["januar","februar","mars","april","mai","juni","juli","august","september","oktober","november","desember"],shortcuts:"Snarveier","custom-values":"Egendefinerte Verdier",past:"Over",following:"Følger",previous:"Forrige","prev-week":"Uke","prev-month":"Måned","prev-year":"År",next:"Neste","next-week":"Uke","next-month":"Måned","next-year":"År","less-than":"Datoperioden skal ikkje være lengre enn %d dager","more-than":"Datoperioden skal ikkje være kortere enn %d dager","default-more":"Vennligst velg ein datoperiode lengre enn %d dager","default-single":"Vennligst velg ein dato","default-less":"Vennligst velg ein datoperiode mindre enn %d dager","default-range":"Vennligst velg ein datoperiode mellom %d og %d dager","default-default":"Vennligst velg ein datoperiode",time:"Tid",hour:"Time",minute:"Minutter"},nl:{selected:"Geselecteerd:",day:"Dag",days:"Dagen",apply:"Ok","week-1":"ma","week-2":"di","week-3":"wo","week-4":"do","week-5":"vr","week-6":"za","week-7":"zo","month-name":["januari","februari","maart","april","mei","juni","juli","augustus","september","october","november","december"],shortcuts:"Snelkoppelingen","custom-values":"Aangepaste waarden",past:"Verleden",following:"Komend",previous:"Vorige","prev-week":"Week","prev-month":"Maand","prev-year":"Jaar",next:"Volgende","next-week":"Week","next-month":"Maand","next-year":"Jaar","less-than":"Interval moet langer dan %d dagen zijn","more-than":"Interval mag niet minder dan %d dagen zijn","default-more":"Selecteer een interval langer dan %dagen","default-single":"Selecteer een datum","default-less":"Selecteer een interval minder dan %d dagen","default-range":"Selecteer een interval tussen %d en %d dagen","default-default":"Selecteer een interval",time:"Tijd",hour:"Uur",minute:"Minuut"},ru:{selected:"Выбрано:",day:"День",days:"Дней",apply:"Закрыть","week-1":"пн","week-2":"вт","week-3":"ср","week-4":"чт","week-5":"пт","week-6":"сб","week-7":"вс","month-name":["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"],shortcuts:"Быстрый выбор",past:"Прошедшие",following:"Следующие",previous:"&nbsp;&nbsp;&nbsp;","prev-week":"Неделя","prev-month":"Месяц","prev-year":"Год",next:"&nbsp;&nbsp;&nbsp;","next-week":"Неделя","next-month":"Месяц","next-year":"Год","less-than":"Диапазон не может быть больше %d дней","more-than":"Диапазон не может быть меньше %d дней","default-more":"Пожалуйста выберите диапазон больше %d дней","default-single":"Пожалуйста выберите дату","default-less":"Пожалуйста выберите диапазон меньше %d дней","default-range":"Пожалуйста выберите диапазон между %d и %d днями","default-default":"Пожалуйста выберите диапазон"},pl:{selected:"Wybrany:",day:"Dzień",days:"Dni",apply:"Zamknij","week-1":"pon","week-2":"wt","week-3":"śr","week-4":"czw","week-5":"pt","week-6":"so","week-7":"nd","month-name":["styczeń","luty","marzec","kwiecień","maj","czerwiec","lipiec","sierpień","wrzesień","październik","listopad","grudzień"],shortcuts:"Skróty","custom-values":"Niestandardowe wartości",past:"Przeszłe",following:"Następne",previous:"Poprzednie","prev-week":"tydzień","prev-month":"miesiąc","prev-year":"rok",next:"Następny","next-week":"tydzień","next-month":"miesiąc","next-year":"rok","less-than":"Okres nie powinien być dłuższy niż %d dni","more-than":"Okres nie powinien być krótszy niż  %d ni","default-more":"Wybierz okres dłuższy niż %d dni","default-single":"Wybierz datę","default-less":"Wybierz okres krótszy niż %d dni","default-range":"Wybierz okres trwający od %d do %d dni","default-default":"Wybierz okres",time:"Czas",hour:"Godzina",minute:"Minuta"}},a.fn.dateRangePicker=function(c){function d(b,c){return b.target==c||void 0!=c.childNodes&&a.inArray(b.target,c.childNodes)>=0}function e(){function e(b){var d=a(b).parents("table").hasClass("month2"),e=d?c.month2:c.month1;e=M(e),!c.singleMonth&&!c.singleDate&&!d&&K(e,c.month2)>=0||S(e)||(E(e,d?"month2":"month1"),I())}function g(a){var b=M(c.month1),d=M(c.month2);S(d)||!c.singleDate&&K(b,d)>=0||(E(b,"month1"),E(d,"month2"),D())}function h(b){var d=a(b).parents("table").hasClass("month2"),e=d?c.month2:c.month1;e=N(e),d&&K(e,c.month1)<=0||S(e)||(E(e,d?"month2":"month1"),I())}function i(a){var b=N(c.month1),d=N(c.month2);S(b)||!c.singleDate&&K(d,b)<=0||(E(d,"month2"),E(b,"month1"),D())}var k=this;if(a(this).data("date-picker-opened"))return void J();a(this).data("date-picker-opened",!0),aa=P().hide(),aa.append('<div class="date-range-length-tip"></div>'),aa.delegate(".day","mouseleave",function(){aa.find(".date-range-length-tip").hide()}),a(c.container).append(aa),c.inline?aa.addClass("inline-wrapper"):f(),c.alwaysOpen&&aa.find(".apply-btn").hide();var l=c.defaultTime?c.defaultTime:new Date;c.lookBehind?(c.startDate&&K(l,c.startDate)<0&&(l=M(b(c.startDate).toDate())),c.endDate&&K(l,c.endDate)>0&&(l=b(c.endDate).toDate()),E(N(l),"month1"),E(l,"month2")):(c.startDate&&K(l,c.startDate)<0&&(l=b(c.startDate).toDate()),c.endDate&&K(M(l),c.endDate)>0&&(l=N(b(c.endDate).toDate())),E(l,"month1"),E(M(l),"month2")),c.singleDate&&(c.startDate&&K(l,c.startDate)<0&&(l=b(c.startDate).toDate()),c.endDate&&K(l,c.endDate)>0&&(l=b(c.endDate).toDate()),E(l,"month1")),c.time.enabled&&(c.startDate&&c.endDate||c.start&&c.end?(F(b(c.start||c.startDate).toDate(),"time1"),F(b(c.end||c.endDate).toDate(),"time2")):(F(l,"time1"),F(l,"time2")));var m="";m=_(c.singleDate?"default-single":c.minDays&&c.maxDays?"default-range":c.minDays?"default-more":c.maxDays?"default-less":"default-default"),aa.find(".default-top").html(m.replace(/\%d/,c.minDays).replace(/\%d/,c.maxDays)),c.singleMonth?aa.addClass("single-month"):aa.addClass("two-months"),setTimeout(function(){j(),da=!0},0),aa.click(function(a){a.stopPropagation()}),a(document).bind("click.datepicker",function(a){d(a,k[0])||aa.is(":visible")&&J()}),aa.find(".next").click(function(){c.stickyMonths?g(this):e(this)}),aa.find(".prev").click(function(){c.stickyMonths?i(this):h(this)}),aa.delegate(".day","click",function(b){r(a(this))}),aa.delegate(".day","mouseenter",function(b){v(a(this))}),aa.delegate(".week-number","click",function(b){s(a(this))}),aa.attr("unselectable","on").css("user-select","none").bind("selectstart",function(a){return a.preventDefault(),!1}),aa.find(".apply-btn").click(function(){J();var b=H(new Date(c.start))+c.separator+H(new Date(c.end));a(k).trigger("datepicker-apply",{value:b,date1:new Date(c.start),date2:new Date(c.end)})}),aa.find("[custom]").click(function(){var b=a(this).attr("custom");c.start=!1,c.end=!1,aa.find(".day.checked").removeClass("checked"),c.setValue.call(fa,b),y(),z(!0),D(),c.autoClose&&J()}),aa.find("[shortcut]").click(function(){var b=a(this).attr("shortcut"),d=new Date,e=!1;if(-1!=b.indexOf("day")){var f=parseInt(b.split(",",2)[1],10);e=new Date((new Date).getTime()+864e5*f),d=new Date(d.getTime()+864e5*(f>0?1:-1))}else if(-1!=b.indexOf("week")){var g=-1!=b.indexOf("prev,")?-1:1;if(1==g)var h="monday"==c.startOfWeek?1:0;else var h="monday"==c.startOfWeek?0:6;for(d=new Date(d.getTime()-864e5);d.getDay()!=h;)d=new Date(d.getTime()+864e5*g);e=new Date(d.getTime()+864e5*g*6)}else if(-1!=b.indexOf("month")){var g=-1!=b.indexOf("prev,")?-1:1;e=1==g?M(d):N(d),e.setDate(1),d=M(e),d.setDate(1),d=new Date(d.getTime()-864e5)}else if(-1!=b.indexOf("year")){var g=-1!=b.indexOf("prev,")?-1:1;e=new Date,e.setFullYear(d.getFullYear()+g),e.setMonth(0),e.setDate(1),d.setFullYear(d.getFullYear()+g),d.setMonth(11),d.setDate(31)}else if("custom"==b){var i=a(this).html();if(c.customShortcuts&&c.customShortcuts.length>0)for(var j=0;j<c.customShortcuts.length;j++){var k=c.customShortcuts[j];if(k.name==i){var l=[];l=k.dates.call(),l&&2==l.length&&(e=l[0],d=l[1]),l&&1==l.length&&(movetodate=l[0],E(movetodate,"month1"),E(M(movetodate),"month2"),I());break}}}e&&d&&(B(e,d),y())}),aa.find(".time1 input[type=range]").bind("change mousemove",function(b){var c=b.target,d="hour"==c.name?a(c).val().replace(/^(\d{1})$/,"0$1"):void 0,e="minute"==c.name?a(c).val().replace(/^(\d{1})$/,"0$1"):void 0;n("time1",d,e)}),aa.find(".time2 input[type=range]").bind("change mousemove",function(b){var c=b.target,d="hour"==c.name?a(c).val().replace(/^(\d{1})$/,"0$1"):void 0,e="minute"==c.name?a(c).val().replace(/^(\d{1})$/,"0$1"):void 0;n("time2",d,e)})}function f(){if(!c.inline){var b=a(ea).offset();if("relative"==a(c.container).css("position")){var d=a(c.container).offset();aa.css({top:b.top-d.top+a(ea).outerHeight()+4,left:b.left-d.left})}else b.left<460?aa.css({top:b.top+a(ea).outerHeight()+parseInt(a("body").css("border-top")||0,10),left:b.left}):aa.css({top:b.top+a(ea).outerHeight()+parseInt(a("body").css("border-top")||0,10),left:b.left+a(ea).width()-aa.width()-16})}}function g(){return aa}function h(b){f(),i(),aa.slideDown(b,function(){a(ea).trigger("datepicker-opened",{relatedTarget:aa})}),a(ea).trigger("datepicker-open",{relatedTarget:aa}),I(),j()}function i(){var a=c.getValue.call(fa),d=a?a.split(c.separator):"";if(d&&(1==d.length&&c.singleDate||d.length>=2)){var e=c.format;e.match(/Do/)&&(e=e.replace(/Do/,"D"),d[0]=d[0].replace(/(\d+)(th|nd|st)/,"$1"),d.length>=2&&(d[1]=d[1].replace(/(\d+)(th|nd|st)/,"$1"))),da=!1,d.length>=2?B(b(d[0],e,b.locale(c.language)).toDate(),b(d[1],e,b.locale(c.language)).toDate()):1==d.length&&c.singleDate&&C(b(d[0],e,b.locale(c.language)).toDate()),da=!0}}function j(){var a=aa.find(".gap").css("margin-left");a&&(a=parseInt(a));var b=aa.find(".month1").width(),c=aa.find(".gap").width()+(a?2*a:0),d=aa.find(".month2").width();aa.find(".month-wrapper").width(b+c+d)}function k(a,c){aa.find("."+a+" input[type=range].hour-range").val(b(c).hours()),aa.find("."+a+" input[type=range].minute-range").val(b(c).minutes()),n(a,b(c).format("HH"),b(c).format("mm"))}function l(a,d){c[a]=parseInt(b(parseInt(d)).startOf("day").add(b(c[a+"Time"]).format("HH"),"h").add(b(c[a+"Time"]).format("mm"),"m").valueOf())}function m(){k("time1",c.start),k("time2",c.end)}function n(a,d,e){function f(a,b){var f=b.format("HH"),g=b.format("mm");c[a]=b.startOf("day").add(d||f,"h").add(e||g,"m").valueOf()}switch(d&&aa.find("."+a+" .hour-val").text(d),e&&aa.find("."+a+" .minute-val").text(e),a){case"time1":c.start&&f("start",b(c.start)),f("startTime",b(c.startTime||b().valueOf()));break;case"time2":c.end&&f("end",b(c.end)),f("endTime",b(c.endTime||b().valueOf()))}y(),z(),D()}function o(){c.start=!1,c.end=!1,aa.find(".day.checked").removeClass("checked"),aa.find(".day.last-date-selected").removeClass("last-date-selected"),aa.find(".day.first-date-selected").removeClass("first-date-selected"),c.setValue.call(fa,""),y(),z(),D()}function p(a){var d=a;return"week-range"===c.batchMode?d="monday"===c.startOfWeek?b(parseInt(a)).startOf("isoweek").valueOf():b(parseInt(a)).startOf("week").valueOf():"month-range"===c.batchMode&&(d=b(parseInt(a)).startOf("month").valueOf()),d}function q(a){var d=a;return"week-range"===c.batchMode?d="monday"===c.startOfWeek?b(parseInt(a)).endOf("isoweek").valueOf():b(parseInt(a)).endOf("week").valueOf():"month"===c.batchMode&&(d=b(parseInt(a)).endOf("month").valueOf()),d}function r(d){if(!d.hasClass("invalid")){var e=d.attr("time");if(d.addClass("checked"),c.singleDate?(c.start=e,c.end=!1):"week"===c.batchMode?"monday"===c.startOfWeek?(c.start=b(parseInt(e)).startOf("isoweek").valueOf(),c.end=b(parseInt(e)).endOf("isoweek").valueOf()):(c.end=b(parseInt(e)).endOf("week").valueOf(),c.start=b(parseInt(e)).startOf("week").valueOf()):"workweek"===c.batchMode?(c.start=b(parseInt(e)).day(1).valueOf(),c.end=b(parseInt(e)).day(5).valueOf()):"weekend"===c.batchMode?(c.start=b(parseInt(e)).day(6).valueOf(),c.end=b(parseInt(e)).day(7).valueOf()):"month"===c.batchMode?(c.start=b(parseInt(e)).startOf("month").valueOf(),c.end=b(parseInt(e)).endOf("month").valueOf()):c.start&&c.end||!c.start&&!c.end?(c.start=p(e),c.end=!1):c.start&&(c.end=q(e),c.time.enabled&&l("end",c.end)),c.time.enabled&&(c.start&&l("start",c.start),c.end&&l("end",c.end)),!c.singleDate&&c.start&&c.end&&c.start>c.end){var f=c.end;c.end=q(c.start),c.start=p(f),c.time.enabled&&c.swapTime&&m()}c.start=parseInt(c.start),c.end=parseInt(c.end),w(),c.start&&!c.end&&(a(ea).trigger("datepicker-first-date-selected",{date1:new Date(c.start)}),v(d)),u(e),y(),z(),D(),x()}}function s(a){var d=parseInt(a.attr("data-start-time"),10);if(c.startWeek){aa.find(".week-number-selected").removeClass("week-number-selected");var e=new Date(d<c.startWeek?d:c.startWeek),f=new Date(d<c.startWeek?c.startWeek:d);c.startWeek=!1,c.start=b(e).day("monday"==c.startOfWeek?1:0).toDate(),c.end=b(f).day("monday"==c.startOfWeek?7:6).toDate()}else{c.startWeek=d,a.addClass("week-number-selected");var e=new Date(d);c.start=b(e).day("monday"==c.startOfWeek?1:0).toDate(),
c.end=b(e).day("monday"==c.startOfWeek?7:6).toDate()}u(),y(),z(),D(),x()}function t(a){if(a=parseInt(a,10),c.startDate&&L(a,c.startDate)<0)return!1;if(c.endDate&&L(a,c.endDate)>0)return!1;if(c.start&&!c.end&&!c.singleDate){if(c.maxDays>0&&A(a,c.start)>c.maxDays)return!1;if(c.minDays>0&&A(a,c.start)<c.minDays)return!1;if(c.selectForward&&a<c.start)return!1;if(c.selectBackward&&a>c.start)return!1;if(c.beforeShowDay&&"function"==typeof c.beforeShowDay){for(var b=!0,d=a;A(d,c.start)>1;){var e=c.beforeShowDay(new Date(d));if(!e[0]){b=!1;break}d>c.start&&(d-=864e5),d<c.start&&(d+=864e5)}if(!b)return!1}}return!0}function u(){return aa.find(".day.invalid.tmp").removeClass("tmp invalid").addClass("valid"),c.start&&!c.end&&aa.find(".day.toMonth.valid").each(function(){var b=parseInt(a(this).attr("time"),10);t(b)?a(this).addClass("valid tmp").removeClass("invalid"):a(this).addClass("invalid tmp").removeClass("valid")}),!0}function v(b){var d=parseInt(b.attr("time")),e="";if(b.hasClass("has-tooltip")&&b.attr("data-tooltip"))e='<span style="white-space:nowrap">'+b.attr("data-tooltip")+"</span>";else if(!b.hasClass("invalid"))if(c.singleDate)aa.find(".day.hovering").removeClass("hovering"),b.addClass("hovering");else if(aa.find(".day").each(function(){var b=parseInt(a(this).attr("time"));c.start,c.end;b==d?a(this).addClass("hovering"):a(this).removeClass("hovering"),c.start&&!c.end&&(c.start<b&&d>=b||c.start>b&&b>=d)?a(this).addClass("hovering"):a(this).removeClass("hovering")}),c.start&&!c.end){var f=A(d,c.start);c.hoveringTooltip&&("function"==typeof c.hoveringTooltip?e=c.hoveringTooltip(f,c.start,d):c.hoveringTooltip===!0&&f>1&&(e=f+" "+_("days")))}if(e){var g=b.offset(),h=aa.offset(),i=g.left-h.left,j=g.top-h.top;i+=b.width()/2;var k=aa.find(".date-range-length-tip"),l=k.css({visibility:"hidden",display:"none"}).html(e).width(),m=k.height();i-=l/2,j-=m,setTimeout(function(){k.css({left:i,top:j,display:"block",visibility:"visible"})},10)}else aa.find(".date-range-length-tip").hide()}function w(){aa.find(".day.hovering").removeClass("hovering"),aa.find(".date-range-length-tip").hide()}function x(){c.singleDate===!0?da&&c.start&&c.autoClose&&J():da&&c.start&&c.end&&c.autoClose&&J()}function y(){var a=Math.ceil((c.end-c.start)/864e5)+1;c.singleDate?c.start&&!c.end?aa.find(".drp_top-bar").removeClass("error").addClass("normal"):aa.find(".drp_top-bar").removeClass("error").removeClass("normal"):c.maxDays&&a>c.maxDays?(c.start=!1,c.end=!1,aa.find(".day").removeClass("checked"),aa.find(".drp_top-bar").removeClass("normal").addClass("error").find(".error-top").html(_("less-than").replace("%d",c.maxDays))):c.minDays&&a<c.minDays?(c.start=!1,c.end=!1,aa.find(".day").removeClass("checked"),aa.find(".drp_top-bar").removeClass("normal").addClass("error").find(".error-top").html(_("more-than").replace("%d",c.minDays))):c.start||c.end?aa.find(".drp_top-bar").removeClass("error").addClass("normal"):aa.find(".drp_top-bar").removeClass("error").removeClass("normal"),c.singleDate&&c.start&&!c.end||!c.singleDate&&c.start&&c.end?aa.find(".apply-btn").removeClass("disabled"):aa.find(".apply-btn").addClass("disabled"),c.batchMode&&(c.start&&c.startDate&&L(c.start,c.startDate)<0||c.end&&c.endDate&&L(c.end,c.endDate)>0)&&(c.start=!1,c.end=!1,aa.find(".day").removeClass("checked"))}function z(b,d){if(aa.find(".start-day").html("..."),aa.find(".end-day").html("..."),aa.find(".selected-days").hide(),c.start&&aa.find(".start-day").html(H(new Date(parseInt(c.start)))),c.end&&aa.find(".end-day").html(H(new Date(parseInt(c.end)))),c.start&&c.singleDate){aa.find(".apply-btn").removeClass("disabled");var e=H(new Date(c.start));c.setValue.call(fa,e,H(new Date(c.start)),H(new Date(c.end))),da&&a(ea).trigger("datepicker-change",{value:e,date1:new Date(c.start)})}else if(c.start&&c.end){aa.find(".selected-days").show().find(".selected-days-num").html(A(c.end,c.start)),aa.find(".apply-btn").removeClass("disabled");var e=H(new Date(c.start))+c.separator+H(new Date(c.end));c.setValue.call(fa,e,H(new Date(c.start)),H(new Date(c.end))),da&&!d&&a(ea).trigger("datepicker-change",{value:e,date1:new Date(c.start),date2:new Date(c.end)})}else b?aa.find(".apply-btn").removeClass("disabled"):aa.find(".apply-btn").addClass("disabled")}function A(a,b){return Math.abs(W(a)-W(b))+1}function B(a,b,d){if(a.getTime()>b.getTime()){var e=b;b=a,a=e,e=null}var f=!0;return c.startDate&&L(a,c.startDate)<0&&(f=!1),c.endDate&&L(b,c.endDate)>0&&(f=!1),f?(c.start=a.getTime(),c.end=b.getTime(),c.time.enabled&&(k("time1",a),k("time2",b)),(c.stickyMonths||L(a,b)>0&&0==K(a,b))&&(c.lookBehind?a=N(b):b=M(a)),c.stickyMonths&&K(b,c.endDate)>0&&(a=N(a),b=N(b)),c.stickyMonths||0==K(a,b)&&(c.lookBehind?a=N(b):b=M(a)),E(a,"month1"),E(b,"month2"),I(),y(),z(!1,d),void x()):(E(c.startDate,"month1"),E(M(c.startDate),"month2"),void I())}function C(a){var b=!0;return c.startDate&&L(a,c.startDate)<0&&(b=!1),c.endDate&&L(a,c.endDate)>0&&(b=!1),b?(c.start=a.getTime(),c.time.enabled&&k("time1",a),E(a,"month1"),I(),z(),void x()):void E(c.startDate,"month1")}function D(){(c.start||c.end)&&(aa.find(".day").each(function(){var d=parseInt(a(this).attr("time")),e=c.start,f=c.end;c.time.enabled&&(d=b(d).startOf("day").valueOf(),e=b(e||b().valueOf()).startOf("day").valueOf(),f=b(f||b().valueOf()).startOf("day").valueOf()),c.start&&c.end&&f>=d&&d>=e||c.start&&!c.end&&b(e).format("YYYY-MM-DD")==b(d).format("YYYY-MM-DD")?a(this).addClass("checked"):a(this).removeClass("checked"),c.start&&b(e).format("YYYY-MM-DD")==b(d).format("YYYY-MM-DD")?a(this).addClass("first-date-selected"):a(this).removeClass("first-date-selected"),c.end&&b(f).format("YYYY-MM-DD")==b(d).format("YYYY-MM-DD")?a(this).addClass("last-date-selected"):a(this).removeClass("last-date-selected")}),aa.find(".week-number").each(function(){a(this).attr("data-start-time")==c.startWeek&&a(this).addClass("week-number-selected")}))}function E(a,d){a=b(a).toDate();var e=G(a.getMonth());aa.find("."+d+" .month-name").html(e+" "+a.getFullYear()),aa.find("."+d+" tbody").html(Y(a)),c[d]=a,u()}function F(a,b){aa.find("."+b).append(O()),k(b,a)}function G(a){return _("month-name")[a]}function H(a){return b(a).format(c.format)}function I(){D();var a=parseInt(b(c.month1).format("YYYYMM")),d=parseInt(b(c.month2).format("YYYYMM")),e=Math.abs(a-d),f=e>1&&89!=e;f?aa.addClass("has-gap").removeClass("no-gap").find(".gap").css("visibility","visible"):aa.removeClass("has-gap").addClass("no-gap").find(".gap").css("visibility","hidden");var g=aa.find("table.month1").height(),h=aa.find("table.month2").height();aa.find(".gap").height(Math.max(g,h)+10)}function J(){c.alwaysOpen||(a(aa).slideUp(c.duration,function(){a(ea).data("date-picker-opened",!1),a(ea).trigger("datepicker-closed",{relatedTarget:aa})}),a(ea).trigger("datepicker-close",{relatedTarget:aa}))}function K(a,c){var d=parseInt(b(a).format("YYYYMM"))-parseInt(b(c).format("YYYYMM"));return d>0?1:0==d?0:-1}function L(a,c){var d=parseInt(b(a).format("YYYYMMDD"))-parseInt(b(c).format("YYYYMMDD"));return d>0?1:0==d?0:-1}function M(a){return b(a).add(1,"months").toDate()}function N(a){return b(a).add(-1,"months").toDate()}function O(){return"<div>						<span>"+_("Time")+': <span class="hour-val">00</span>:<span class="minute-val">00</span></span>					</div>					<div class="hour">						<label>'+_("Hour")+': <input type="range" class="hour-range" name="hour" min="0" max="23"></label>					</div>					<div class="minute">						<label>'+_("Minute")+': <input type="range" class="minute-range" name="minute" min="0" max="59"></label>					</div>'}function P(){var b='<div class="date-picker-wrapper';c.extraClass&&(b+=" "+c.extraClass+" "),c.singleDate&&(b+=" single-date "),c.showShortcuts||(b+=" no-shortcuts "),c.showTopbar||(b+=" no-topbar "),c.customTopBar&&(b+=" custom-topbar "),b+='">',c.showTopbar&&(b+='<div class="drp_top-bar">',c.customTopBar?("function"==typeof c.customTopBar&&(c.customTopBar=c.customTopBar()),b+='<div class="custom-top">'+c.customTopBar+"</div>"):(b+='<div class="normal-top">							<span style="color:#333">'+_("selected")+' </span> <b class="start-day">...</b>',c.singleDate||(b+=' <span class="separator-day">'+c.separator+'</span> <b class="end-day">...</b> <i class="selected-days">(<span class="selected-days-num">3</span> '+_("days")+")</i>"),b+="</div>",b+='<div class="error-top">error</div>						<div class="default-top">default</div>'),b+='<input type="button" class="apply-btn disabled'+Q()+'" value="'+_("apply")+'" />',b+="</div>");var d=c.showWeekNumbers?6:5;if(b+='<div class="month-wrapper"><table class="month1" cellspacing="0" border="0" cellpadding="0"><thead><tr class="caption"><th style="width:27px;"><span class="prev">&lt;</span></th><th colspan="'+d+'" class="month-name"></th><th style="width:27px;">'+(c.singleDate||!c.stickyMonths?'<span class="next">&gt;</span>':"")+'</th></tr><tr class="week-name">'+R()+"</thead><tbody></tbody></table>",U()&&(b+='<div class="gap">'+T()+'</div><table class="month2" cellspacing="0" border="0" cellpadding="0"><thead><tr class="caption"><th style="width:27px;">'+(c.stickyMonths?"":'<span class="prev">&lt;</span>')+'</th><th colspan="'+d+'" class="month-name"></th><th style="width:27px;"><span class="next">&gt;</span></th></tr><tr class="week-name">'+R()+"</thead><tbody></tbody></table>"),b+='<div style="clear:both;height:0;font-size:0;"></div><div class="time"><div class="time1"></div>',c.singleDate||(b+='<div class="time2"></div>'),b+='</div><div style="clear:both;height:0;font-size:0;"></div></div>',b+='<div class="footer">',c.showShortcuts){b+='<div class="shortcuts"><b>'+_("shortcuts")+"</b>";var e=c.shortcuts;if(e){if(e["prev-days"]&&e["prev-days"].length>0){b+='&nbsp;<span class="prev-days">'+_("past");for(var f=0;f<e["prev-days"].length;f++){var g=e["prev-days"][f];g+=_(e["prev-days"][f]>1?"days":"day"),b+=' <a href="javascript:;" shortcut="day,-'+e["prev-days"][f]+'">'+g+"</a>"}b+="</span>"}if(e["next-days"]&&e["next-days"].length>0){b+='&nbsp;<span class="next-days">'+_("following");for(var f=0;f<e["next-days"].length;f++){var g=e["next-days"][f];g+=_(e["next-days"][f]>1?"days":"day"),b+=' <a href="javascript:;" shortcut="day,'+e["next-days"][f]+'">'+g+"</a>"}b+="</span>"}if(e.prev&&e.prev.length>0){b+='&nbsp;<span class="prev-buttons">'+_("previous");for(var f=0;f<e.prev.length;f++){var g=_("prev-"+e.prev[f]);b+=' <a href="javascript:;" shortcut="prev,'+e.prev[f]+'">'+g+"</a>"}b+="</span>"}if(e.next&&e.next.length>0){b+='&nbsp;<span class="next-buttons">'+_("next");for(var f=0;f<e.next.length;f++){var g=_("next-"+e.next[f]);b+=' <a href="javascript:;" shortcut="next,'+e.next[f]+'">'+g+"</a>"}b+="</span>"}}if(c.customShortcuts)for(var f=0;f<c.customShortcuts.length;f++){var h=c.customShortcuts[f];b+='&nbsp;<span class="custom-shortcut"><a href="javascript:;" shortcut="custom">'+h.name+"</a></span>"}b+="</div>"}if(c.showCustomValues&&(b+='<div class="customValues"><b>'+(c.customValueLabel||_("custom-values"))+"</b>",c.customValues))for(var f=0;f<c.customValues.length;f++){var i=c.customValues[f];b+='&nbsp;<span class="custom-value"><a href="javascript:;" custom="'+i.value+'">'+i.name+"</a></span>"}return b+="</div></div>",a(b)}function Q(){return klass="",c.autoClose===!0&&(klass+=" hide"),""!==c.applyBtnClass&&(klass+=" "+c.applyBtnClass),klass}function R(){var a=c.showWeekNumbers?"<th>"+_("week-number")+"</th>":"";return"monday"==c.startOfWeek?a+"<th>"+_("week-1")+"</th>					<th>"+_("week-2")+"</th>					<th>"+_("week-3")+"</th>					<th>"+_("week-4")+"</th>					<th>"+_("week-5")+"</th>					<th>"+_("week-6")+"</th>					<th>"+_("week-7")+"</th>":a+"<th>"+_("week-7")+"</th>					<th>"+_("week-1")+"</th>					<th>"+_("week-2")+"</th>					<th>"+_("week-3")+"</th>					<th>"+_("week-4")+"</th>					<th>"+_("week-5")+"</th>					<th>"+_("week-6")+"</th>"}function S(a){var a=b(a);return c.startDate&&a.endOf("month").isBefore(c.startDate)?!0:c.endDate&&a.startOf("month").isAfter(c.endDate)?!0:!1}function T(){for(var a=['<div class="gap-top-mask"></div><div class="gap-bottom-mask"></div><div class="gap-lines">'],b=0;20>b;b++)a.push('<div class="gap-line">					<div class="gap-1"></div>					<div class="gap-2"></div>					<div class="gap-3"></div>				</div>');return a.push("</div>"),a.join("")}function U(){return!c.singleDate&&!c.singleMonth}function V(a,b,c){var d=jQuery.extend(!0,{},a);jQuery.each(b,function(a,b){var e=b(c);for(var f in e)d.hasOwnProperty(f)?d[f]+=e[f]:d[f]=e[f]}),attrString="";for(var e in d)d.hasOwnProperty(e)&&(attrString+=e+'="'+d[e]+'" ');return attrString}function W(a){return Math.floor(X(a)/864e5)}function X(a){return b.isMoment(a)&&(a=a.toDate().getTime()),"object"==typeof a&&a.getTime&&(a=a.getTime()),"string"!=typeof a||a.match(/\d{13}/)||(a=b(a,c.format).toDate().getTime()),a=parseInt(a,10)-60*(new Date).getTimezoneOffset()*1e3}function Y(a){var d=[];a.setDate(1);var e=(new Date(a.getTime()-864e5),new Date),f=a.getDay();if(0==f&&"monday"==c.startOfWeek&&(f=7),f>0)for(var g=f;g>0;g--){var h=new Date(a.getTime()-864e5*g),i=t(h.getTime());c.startDate&&L(h,c.startDate)<0&&(i=!1),c.endDate&&L(h,c.endDate)>0&&(i=!1),d.push({date:h,type:"lastMonth",day:h.getDate(),time:h.getTime(),valid:i})}for(var j=a.getMonth(),g=0;40>g;g++){var k=b(a).add(g,"days").toDate(),i=t(k.getTime());c.startDate&&L(k,c.startDate)<0&&(i=!1),c.endDate&&L(k,c.endDate)>0&&(i=!1),d.push({date:k,type:k.getMonth()==j?"toMonth":"nextMonth",day:k.getDate(),time:k.getTime(),valid:i})}for(var l=[],m=0;6>m&&"nextMonth"!=d[7*m].type;m++){l.push("<tr>");for(var h=0;7>h;h++){var n="monday"==c.startOfWeek?h+1:h,k=d[7*m+n],o=b(k.time).format("L")==b(e).format("L");if(k.extraClass="",k.tooltip="",k.valid&&c.beforeShowDay&&"function"==typeof c.beforeShowDay){var p=c.beforeShowDay(b(k.time).toDate());k.valid=p[0],k.extraClass=p[1]||"",k.tooltip=p[2]||"",""!=k.tooltip&&(k.extraClass+=" has-tooltip ")}todayDivAttr={time:k.time,"data-tooltip":k.tooltip,"class":"day "+k.type+" "+k.extraClass+" "+(k.valid?"valid":"invalid")+" "+(o?"real-today":"")},0==h&&c.showWeekNumbers&&l.push('<td><div class="week-number" data-start-time="'+k.time+'">'+c.getWeekNumber(k.date)+"</div></td>"),l.push("<td "+V({},c.dayTdAttrs,k)+"><div "+V(todayDivAttr,c.dayDivAttrs,k)+">"+Z(k.time,k.day)+"</div></td>")}l.push("</tr>")}return l.join("")}function Z(a,b){return c.showDateFilter&&"function"==typeof c.showDateFilter?c.showDateFilter(a,b):b}function $(){if("auto"==c.language){var b=navigator.language?navigator.language:navigator.browserLanguage;if(!b)return a.dateRangePickerLanguages["default"];var b=b.toLowerCase();for(var d in a.dateRangePickerLanguages)if(-1!=b.indexOf(d))return a.dateRangePickerLanguages[d];return a.dateRangePickerLanguages["default"]}return c.language&&c.language in a.dateRangePickerLanguages?a.dateRangePickerLanguages[c.language]:a.dateRangePickerLanguages["default"]}function _(b){var c=b.toLowerCase(),d=b in ca?ca[b]:c in ca?ca[c]:null,e=a.dateRangePickerLanguages["default"];return null==d&&(d=b in e?e[b]:c in e?e[c]:""),d}c||(c={}),c=a.extend(!0,{autoClose:!1,format:"YYYY-MM-DD",separator:" to ",language:"auto",startOfWeek:"sunday",getValue:function(){return a(this).val()},setValue:function(b){a(this).attr("readonly")||a(this).is(":disabled")||b==a(this).val()||a(this).val(b)},startDate:!1,endDate:!1,time:{enabled:!1},minDays:0,maxDays:0,showShortcuts:!1,shortcuts:{},customShortcuts:[],inline:!1,container:"body",alwaysOpen:!1,singleDate:!1,lookBehind:!1,batchMode:!1,duration:200,stickyMonths:!1,dayDivAttrs:[],dayTdAttrs:[],selectForward:!1,selectBackward:!1,applyBtnClass:"",singleMonth:"auto",hoveringTooltip:function(a,b,c){return a>1?a+" "+_("days"):""},showTopbar:!0,swapTime:!1,showWeekNumbers:!1,getWeekNumber:function(a){return b(a).format("w")}},c),c.start=!1,c.end=!1,c.startWeek=!1,c.isTouchDevice="ontouchstart"in window||navigator.msMaxTouchPoints,c.isTouchDevice&&(c.hoveringTooltip=!1),"auto"==c.singleMonth&&(c.singleMonth=a(window).width()<480),c.singleMonth&&(c.stickyMonths=!1),c.singleDate&&(c.singleMonth=!0),c.showTopbar||(c.autoClose=!0),c.startDate&&"string"==typeof c.startDate&&(c.startDate=b(c.startDate,c.format).toDate()),c.endDate&&"string"==typeof c.endDate&&(c.endDate=b(c.endDate,c.format).toDate());var aa,ba,ca=$(),da=!1,ea=this,fa=a(ea).get(0);return a(this).unbind(".datepicker").bind("click.datepicker",function(a){var b=aa.is(":visible");b||h(c.duration)}).bind("change.datepicker",function(a){i()}).bind("keyup.datepicker",function(){try{clearTimeout(ba)}catch(a){}ba=setTimeout(function(){i()},2e3)}),e.call(this),c.alwaysOpen&&h(0),a(this).data("dateRangePicker",{setDateRange:function(a,d,e){"string"==typeof a&&"string"==typeof d&&(a=b(a,c.format).toDate(),d=b(d,c.format).toDate()),B(a,d,e)},clear:o,close:J,open:h,getDatePicker:g,destroy:function(){a(ea).unbind(".datepicker"),a(ea).data("dateRangePicker",""),a(ea).data("date-picker-opened",null),aa.remove(),a(window).unbind("resize.datepicker",f),a(document).unbind("click.datepicker",J)}}),a(window).bind("resize.datepicker",f),this}}),$(document).ready(function(){$(".drawer").drawer()}),angular.module("lmApp",["ngResource","ngRoute","ngCookies","selectize","ui.bootstrap","ui.bootstrap.datetimepicker","ngAnimate","uiGmapgoogle-maps","ui.mask","frapontillo.bootstrap-switch","toastr","ngFileUpload","angular-img-cropper"]),angular.module("lmApp").constant("_",window._),angular.module("lmApp").constant("moment",window.moment),angular.module("lmApp").config(["$routeProvider","$locationProvider",function(a,b){var c={GetAccount:["Account","$q",function(a,b){var c=b.defer();return a.get().$promise.then(function(a){c.resolve({current:a})}),c.promise}]},d={GetListing:["Listing","$route","$q",function(a,b,c){var d=c.defer(),e=b.current.params.id;if(e)a.get({_id:e}).$promise.then(function(a){d.resolve({current:a})});else{var f={name:{},fax:{intCode:"353"},classList:[],address:{},phoneList:[],socialMediaList:[],photoGallery:{},openingHours:{1:[],2:[],3:[],4:[],5:[],6:[],7:[]},addons:{location:!0,openingHours:!0,photoGallery:!1,serviceAreas:!1,reviews:!1,isActive:!0}};d.resolve({current:f})}return d.promise}]},e={GetListings:["Listing","$q",function(a,b){var c=b.defer();return a.query().$promise.then(function(a){c.resolve({current:a})}),c.promise}]};b.html5Mode(!0),a.when("/",{templateUrl:"views/login.html",controller:"LoginController"}).when("/account",{templateUrl:"views/account.html",controller:"AccountController",resolve:c}).when("/listings/new",{templateUrl:"views/listing.html",controller:"ListingController",resolve:d}).when("/listings/:id",{templateUrl:"views/listing.html",controller:"ListingController",resolve:d}).when("/:customerId",{templateUrl:"views/dashboard.html",controller:"DashboardController",resolve:e})}]),angular.module("lmApp").run(["toastr","$cookies","$rootScope","$location",function(a,b,c,d){c.$on("$routeChangeStart",function(a,b,c,d){window.$("#animatedFiller").show(),$("#animatedFiller").fakeLoader({timeToHide:2e6,zIndex:"999",bgColor:"#fff",imagePath:"assets/images/logo-small-pink.png"})}),c.$on("$routeChangeSuccess",function(c,d,e,f){window.$("#animatedFiller").hide();var g=b.get("notify");g&&(b.remove("notify"),a.success(g))}),c.$on("$routeChangeError",function(a,b,c,e){console.log(e),d.path("/")})}]),angular.module("lmApp").factory("Listing",["$resource","Identity",function(a,b){var c=a(window.apiUrl+"/api/v1/customers/:customerId/listings/:_id.json",{customerId:b.currentCustomer.id,_id:"@id"},{update:{method:"POST"}});return c}]),angular.module("lmApp").factory("Auth",["Identity","$q",function(a,b){return{checkForCurrentCustomer:function(){return a.isAuthenticated()?!0:b.reject("not authorized")}}}]),angular.module("lmApp").factory("Customer",["$resource",function(a){var b=a(window.apiUrl+"/api/v1/customers/:_id.json",{_id:"@id"},{update:{method:"PUT",isArray:!1}});return b}]),angular.module("lmApp").factory("Identity",["Customer","$window",function(a,b){var c;return b.bootstrappedCurrentCustomer&&(c=new a,angular.extend(c,b.bootstrappedCurrentCustomer)),{currentCustomer:c,isAuthenticated:function(){return!!this.currentCustomer}}}]),angular.module("lmApp").factory("County",["$resource",function(a){var b=a(window.apiUrl+"/api/v1/counties.json");return b}]),angular.module("lmApp").factory("Category",["$resource",function(a){var b=a(window.apiUrl+"/api/v1/classes.json");return b}]),angular.module("lmApp").factory("Neighbourhood",["$resource",function(a){var b=a(window.apiUrl+"/api/v1/neighbourhoods.json");return b}]),angular.module("lmApp").factory("Geocode",["$http",function(a){return{getLatLng:function(b){return a.get("https://maps.google.com/maps/api/geocode/json?"+window.jQuery.param(b))}}}]),angular.module("lmApp").factory("Account",["$resource","Identity",function(a,b){var c=a(window.apiUrl+"/api/v1/customers/:customerId/account.json",{customerId:b.currentCustomer.id},{update:{method:"POST"}});return c}]),angular.module("lmApp").controller("DashboardController",["GetListings","_","$modal","$scope",function(a,b,c,d){function e(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)?!0:!1}var f=a.current;d.listings=b.map(f,function(a){return a.addressString=b.compact([a.address.housename,a.address.address,a.address.locality,a.address.city,a.address.postalcode]).join(", "),a.addons={},a.addons.location=!0,a.addons.openingHours=!0,a.addons.photoGallery=a.photoGallery?!!a.photoGallery.photos&&a.photoGallery.photos.length>0:!1,a.addons.serviceAreas=a.serviceAreas?a.serviceAreas.length>0:!1,a.addons.reviews=!1,a.addons.coupons=!1,a.addons.isActive=!1,e()&&(a.listing_view_url=a.mobile_listing_view_url),a}),d.openAddonsModal=function(a){var b=c.open({backdrop:"static",keyboard:!1,scope:d,animation:!0,controller:"ListingAddonsController",templateUrl:"views/modals/listing_addons.html",resolve:{addons:a.addons}});b.result.then(function(a){d.addons=a.params})},d.activateSlider=function(){window.$(".listing-panel").owlCarousel({nav:!0,responsiceClass:!0,responsive:{0:{items:1,nav:!0},600:{items:2,nav:!1},1e3:{items:3,nav:!0,loop:!1}}})}}]),angular.module("lmApp").controller("AccountController",["Neighbourhood","GetAccount","Account","Identity","$window","toastr","$cookies","$scope","$modal","_",function(a,b,c,d,e,f,g,h,i,j){var k,l,m,n,o,p;k=d.currentCustomer,l={},n="([a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?)",h.int_codes=["353","44","1","49","33","32","31","34","358","39","41","48","1","46","61","81","420","43","85","94","371","90","421","356","36","972","blank"],h.account=b.current,p=angular.copy(h.account),h.account.phoneList=j.map(h.account.phoneList,function(a){return a.phoneId=a.id,a}),h.customer=k,h.$watch("account.name.name",function(a,b){if(b){var c=j.find(h.customer.nameList,{name:a});b!==a&&(c?(l.name={id:c.id},h.account.name=angular.copy(c)):(l.name={id:null,name:h.account.name.name,"new":!0},h.account.name.id=null,h.account.name["new"]=!0)),console.log(h.account.name)}}),a.query(function(a){h.neighbourhoodList=a}),h.addressString=j.compact([h.account.address.housename,h.account.address.address,h.account.address.locality,h.account.address.city,h.account.address.postalcode]).join(", "),h.addressList=j.map(k.addressList,function(a){return a.address_id=a.id,a}),h.openAddress=function(a){h.showMap=!1,m=i.open({backdrop:"static",keyboard:!1,scope:h,animation:!0,size:"lg",controller:"AddressModalController",templateUrl:"views/modals/address.html",resolve:{isAddress:function(){return a},address:h.account.address}}),m.result.then(function(a){a.status&&a.updated&&(l.address=j.omit(a.params,["$order","address_id"]),h.account.address=a.params,k.addressList.push(a.params),h.map=a.params.lat+","+a.params.lng,h.addressString=j.compact([h.account.address.housename,h.account.address.address,h.account.address.locality,h.account.address.city,h.account.address.postalcode]).join(", "))})},h.$watch("account.contactPerson.name",function(a,b){if(b&&a!==b){var c=angular.copy(j.find(k.contactPersonList,{name:a}));c&&(h.account.contactPerson=c,l.contactPerson=c)}}),h.$watch("account.contactPerson.email",function(a,b){b&&a!==b&&(h.account.contactPerson.email=a,l.contactPerson?l.contactPerson.email=a:l.contactPerson=h.account.contactPerson)}),h.$watch("account.contactPerson.jobTitle",function(a,b){b&&a!==b&&(h.account.contactPerson.jobTitle=a,l.contactPerson?l.contactPerson.jobTitle=a:l.contactPerson=h.account.contactPerson)}),h.newContactPerson=function(a){if(13===a.keyCode||"blur"===a.type){var b=angular.copy(j.find(k.contactPersonList,{name:h.account.contactPerson.name}));b||(h.account.contactPerson.email=null,h.account.contactPerson.jobTitle=null,l.contactPerson={id:null,name:h.account.contactPerson.name,jobTitle:null,email:null})}},h.phoneUpdated=function(){var a=j.map(k.phoneList,function(a){return a.intCode+a.name}),b=j.map(h.account.phoneList,function(a){return a.intCode+a.name});return!j.isEqual(a,b)},h.phoneOptions=j.map(angular.copy(k.phoneList),function(a){return a.phoneId=a.id,a}),h.phoneKey=k.phoneList.length,h.addPhoneNumber=function(){var a=h.phoneKey=h.phoneKey+10;return h.account.phoneList.push({id:null,phoneId:a,intCode:"353",name:null,"new":!1}),!0},h.deleteNumber=function(a){return j.pullAt(h.account.phoneList,a),!0},h.account.fax=p.fax||{name:null},h.account.fax.intCode=p.fax.intCode||"353",h.$watch("account.fax.name",function(a,b){if(b&&b!==a){var c=j.find(k.faxList,{name:a});if(c)return h.account.fax=angular.copy(c),l.fax={id:c.id},!0}}),h.$watch("account.fax.intCode",function(a,b){if(b&&a!==b){var c=j.find(k.faxList,{id:parseInt(h.account.fax.id)});if(c.intCode!==a)return l.fax={id:null,name:h.account.fax.name,intCode:a},!0}}),h.newFaxNumber=function(a){if(13===a.keyCode||"blur"===a.type){var b=angular.copy(h.account.fax);b.id=null,b["new"]=!0,l.fax=b}},h.openDeleteInfo=function(){o=i.open({scope:h,animation:!0,templateUrl:"views/modals/delete_info.html"})},h.closeDeleteInfoModal=function(){o.close()},h.saveAccount=function(){if(l.contactPerson&&(l.contactPerson.id===l.contactPerson.name&&(l.contactPerson=angular.copy(l.contactPerson),l.contactPerson.id=null),l.contactPerson=j.omit(l.contactPerson,["active","$order","main"])),h.phoneUpdated()){var a=[];j.each(h.account.phoneList,function(b){var c=j.find(k.phoneList,{intCode:b.intCode,name:b.name});c?a.push(c):a.push({id:null,intCode:b.intCode,name:b.name,"new":!0})}),l.phoneList=a}console.log(l),(h.account.address.housename||h.account.address.address||h.account.address.locality||h.account.address.city||h.account.address.postalcode)&&h.account.address.county&&h.account.address.neighbourhood&&h.account.name.name?c.update(l).$promise.then(function(a){a.$resolved&&(g.put("notify","Account saved."),e.location.reload())},function(a){f.error(a),setTimeout(function(){e.location.reload()},5e3)}):f.warning("Name and Address fields are required!","Warning")}}]),angular.module("lmApp").controller("ListingController",["Neighbourhood","Identity","Category","ServiceArea","Geocode","GetListing","toastr","$q","$timeout","$routeParams","$scope","$http","$modal","$filter","selectMainFilter","_","moment","Coupon",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s,t,u,v,w,x,y,z,A,B,C,D,E,F;k.coupons={deals:{},isActive:!1},y="([a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?)",k.int_codes=["44","353","1","49","33","32","31","34","358","39","41","48","1","46","61","81","420","43","85","94","371","90","421","356","36","972","blank"],k.socialMediaUrlTypes={facebook:{title:"Facebook",url:"facebook.com/UserName"},twitter:{title:"Twitter",url:"twitter.com/UserName"},linkedin:{title:"Linkedin",url:"linkedin.com/in/UserName"},"google-plus":{title:"Google+",url:"plus.google.com/+UserName"},youtube:{title:"YouTube",url:"youtube.com/user/UserName"},pinterest:{title:"Pinterest",url:"pinterest.com/UserName"},apple:{title:"Apple App Store",url:"itunes.apple.com/app/id000000000"},android:{title:"Google Play Store",url:"play.google.com/store/apps/details?id=com.example"}},F=k.listingChanges={},D=k.isNew=!j.id,A=f.current,k.listing=angular.copy(A),k.customer=b.currentCustomer,z=b.currentCustomer,r.getListingCoupons(A.listingCouponsKey).success(function(a){var b=p.values(a.deal_data);!p.isEmpty(a.deal_data)&&b.length<10&&(k.coupons.deals=b,k.coupons.isActive=!0)}),k.isNewBusiness=!1,k.nameModalClosed=!0,k.nameUpdated=!1,k.nameIsChanged=!1,k.newName=function(a){13===a.keyCode?($("#listingName").blur(),$(".ac_result_area").hide()):"blur"===a.type&&(k.nameUpdated=!0,0===$(".ac_input_off").length&&!D&&k.nameModalClosed&&k.nameIsChanged&&(k.nameModalClosed=!1,s=m.open({animation:!0,scope:k,controller:"ListingNameCtrl",templateUrl:"views/modals/name_confirm.html"}),s.result.then(function(a){k.nameModalClosed=!0,k.isNewBusiness=a})))},k.$watch("listing.name.name",function(a,b){var c=p.find(k.customer.nameList,{name:a});b&&a!==b&&!c&&(k.nameIsChanged=!0)}),k.categories=p.map(k.listing.classList,function(a){return a.id}),k.$watch("categories",function(a,b){var c=p.map(a,function(a){return parseInt(a)}),d=p.map(b,function(a){return parseInt(a)});b&&!p.isEqual(c,d)&&(F.categories=a,k.listing.classList=a)}),k.categoryConfig={maxOptions:4e3,valueField:"id",labelField:"name",placeholder:"Choose a category",sortField:"name",plugins:["remove_button"],searchField:["name"]},c.query(function(a){k.categoriesList=a}),k.$watch("listing.email.name",function(a,b){if(b||a){var c=p.find(k.customer.emailList,{name:a});c&&a!==b?F.email={id:c.id}:c||(a?F.email={id:null,name:a,"new":!0}:k.listing.email.isDeleted||delete F.email)}}),k.deleteEmail=function(){return F.email={id:0},k.listing.email={isDeleted:!0},!0},k.$watch("listing.website.name",function(a,b){if(b||a){var c=p.find(k.customer.websiteList,{name:a});c&&a!==b?F.website={id:c.id}:c||(a?F.website={id:null,name:a,"new":!0}:k.listing.website.isDeleted||delete F.website)}}),k.deleteWebsite=function(){return F.website={id:0},k.listing.website={isDeleted:!0},!0},k.$watch("listing.description.name",function(a,b){if("undefined"!=typeof b){if(null===b)return F.description={name:a},!0;if(p.isString(b)&&a!==b)return F.description={name:a},!0}else if(a!==b)return F.description={name:a},!0}),k.phoneUpdated=function(){var a=p.map(A.phoneList,function(a){return a.intCode+a.name}),b=p.map(k.listing.phoneList,function(a){return a.intCode+a.name});return!p.isEqual(a,b)||D},k.phoneOptions=p.map(k.customer.phoneList,function(a){return a.phoneId=a.id,a}),k.phoneKey=k.customer.phoneList.length,k.addPhoneNumber=function(){var a=k.phoneKey=k.phoneKey+10;return k.listing.phoneList.push({id:null,phoneId:a,intCode:"353",name:null,"new":!1}),!0},k.newPhoneNumber=function(a){(13===event.keyCode||"blur"===event.type)&&$(".ac_result_area").hide()},k.deleteNumber=function(a){return p.pullAt(k.listing.phoneList,a),!0},k.listing.fax.intCode=A.fax.intCode||"353",k.listing.fax.name=A.fax.name||null,k.$watch("listing.fax",function(a,b){var c,d=p.values(a).join(),e=p.find(k.customer.faxList,{name:a.name});e&&(c=p.values([e.intCode,e.name]).join()),p.values(b).join()!==p.values(a).join()&&(a.name&&a.name!==b.name?e&&a!==b?(F.fax={id:e.id},k.listing.fax.intCode=e.intCode):e||(a?F.fax={id:null,name:a.name,intCode:k.listing.fax.intCode,"new":!0}:k.listing.website.isDeleted||delete F.fax):a.intCode&&d!==c&&a.name&&a.intCode&&(F.fax={id:null,name:a.name,intCode:a.intCode,"new":!0}))},!0),k.deleteFax=function(){return F.fax={id:0},k.listing.fax={isDeleted:!0},!0},k.addressString=p.compact([k.listing.address.housename,k.listing.address.address,k.listing.address.locality,k.listing.address.city,k.listing.address.postalcode]).join(", "),a.query(function(a){k.neighbourhoodList=a}),k.addressList=p.map(k.customer.addressList,function(a){
return a.address_id=a.id,a}),k.openAddress=function(a){k.showMap=!1,t=m.open({backdrop:"static",keyboard:!1,scope:k,animation:!0,size:"lg",controller:"AddressModalController",templateUrl:"views/modals/address.html",resolve:{isAddress:function(){return a},address:angular.copy(k.listing.address)}}),t.result.then(function(a){a.status&&a.updated&&(F.address=p.omit(a.params,["$order","address_id"]),k.listing.address=a.params,z.addressList.push(a.params),k.map=a.params.lat+","+a.params.lng,k.addressString=p.compact([k.listing.address.housename,k.listing.address.address,k.listing.address.locality,k.listing.address.city,k.listing.address.postalcode]).join(", ")),i(function(){k.showMap=!0},500)})},k.socialLinks=[],k.$watch("listing.socialMediaList",function(a,b){p.forEach(k.socialMediaUrlTypes,function(a,b){var c=p.find(k.listing.socialMediaList,{type:b});c?k.socialLinks.push({type:b,name:c.name,url:a.url,title:a.title}):k.socialLinks.push({type:b,name:null,url:a.url,title:a.title})})}),k.openSocialLinksEditor=function(){v=m.open({scope:k,animation:!0,controller:"SocialLinksController",templateUrl:"views/modals/social_links.html"}),v.result.then(function(a){a&&(F.socialMediaList=a)})},k.showMap=!1,k.$watch("listing.address",function(a,b){if(a){var c={};if(a.lat&&a.lng)c.lat=a.lat,c.lng=a.lng,k.map=c.lat+","+c.lng,k.showMap=!0;else{var d=p.values(p.pick(a,["address","locality","city","countryCode"])).join(",");d&&e.getLatLng({address:d}).success(function(a){if("OK"===a.status){var b=a.results[0].geometry.location;p.assign(k.listing.address,b),c.lat=b.lat,c.lng=b.lng,k.listing.address.lat=b.lat,k.listing.address.lng=b.lng,k.listing.address.geoconfirmed=!1,k.map=c.lat+","+c.lng,k.showMap=!0}else console.log(a)})}}}),B={},k.openingHours=B,k.currentHours=function(a){return q().weekday()===parseInt(a)},C=function(){var a=p.flattenDeep(p.map(A.openingHours,function(a,b){return a.ohHours})),b=p.map(p.flattenDeep(p.map(B,function(a,b){return a.ohHours})),function(a){return{end:q(a.end).format("HH:mm"),start:q(a.start).format("HH:mm")}}),c=p.map(A.openingHours,function(a,b){return a.isclosed}),d=p.map(B,function(a,b){return a.isclosed});return!p.isEqual(a,b)||!p.isEqual(c,d)},k.$watch("listing.openingHours",function(a,b){a&&p.forEach(a,function(a,b){B[b]={ohHours:[],isclosed:a.isclosed},B[b].ohHours=p.map(a.ohHours,function(a){return{start:q().day(b).hour(a.start.split(":")[0]).minute(a.start.split(":")[1]).toISOString(),end:q().day(b).hour(a.end.split(":")[0]).minute(a.end.split(":")[1]).toISOString()}})})}),k.openCalendar=function(a,b,c){a.preventDefault(),a.stopPropagation(),p.forEach(B,function(a,b){p.forEach(a.ohHours,function(a){a.open_start&&(a.open_start=!1),a.open_end&&(a.open_end=!1)})}),b[c]=!b[c],b[c.split("_")[1]]=new Date},k.addOpeningHoursTime=function(a){return B[a].ohHours.push({}),!0},k.removeOpeningHoursTime=function(a,b){return p.pullAt(B[a].ohHours,b),!0},k.changeOpeningHours=function(a,b){return b?B[a].ohHours=[]:(B[a].ohHours.push({}),B[a].isclosed=!1),!0},k.$watch("holidays",function(a,b){if(a){var c=a.split("to");F.closedBetween={start:p.trim(c[0]),end:p.trim(c[1])},k.listing.closedBetween={start:p.trim(c[0]),end:p.trim(c[1])},console.log(F.closedBetween)}}),k.deleteHolidays=function(){F=p.omit(F,"closedBetween"),k.listing.closedBetween={start:null,end:null},k.holidays=null},k.serviceAreas=p.map(k.listing.serviceAreaList,function(a){return a.id}),k.$watch("serviceAreas",function(a,b){var c=p.map(a,function(a){return parseInt(a)}),d=p.map(b,function(a){return parseInt(a)});b&&!p.isEqual(c,d)&&(F.serviceAreaList=a)}),k.serviceAreaConfig={maxOptions:4e3,valueField:"id",labelField:"name",placeholder:"Choose a Service Area",sortField:"name",plugins:["remove_button"],searchField:["name"]},d.query(function(a){k.serviceAreaList=a}),k.openAddonsModal=function(){w=m.open({backdrop:"static",keyboard:!1,scope:k,animation:!0,controller:"ListingAddonsController",templateUrl:"views/modals/listing_addons.html"}),w.result.then(function(a){a&&(F.addons=angular.copy(k.listing.addons))})},k.photoGallery={},k.photoGallery.photos=[],k.$watch("listing.photoGallery.title",function(a,b){b&&a!==b&&(F.photoGallery||(F.photoGallery={}),F.photoGallery.title=a)}),k.addPhoto=function(){k.photoGallery.photos.push({})},k.removePhoto=function(a){k.photoGallery.photos.splice(a,1)},k.deletePhoto=function(a){F.photoGallery||(F.photoGallery={}),p.remove(k.listing.photoGallery.photos,function(b){return b.id===a}),F.photoGallery.photos?F.photoGallery.photos.push({id:a}):F.photoGallery.photos=[{id:a}]},k.logo={},k.listing.logo=A.logo||{},k.cropImage=null,k.openCrop=function(){E=m.open({animation:!0,scope:k,controller:"LogoCropController",templateUrl:"views/modals/logo_crop.html"}),E.result.then(function(a){a.params&&p.assign(k.logo,a.params)})},k.deleteLogo=function(){F.photoGallery||(F.photoGallery={photos:[]}),F.photoGallery.photos&&!D&&F.photoGallery.photos.push({id:A.logo.id}),k.listing.logo={},k.logo={}},k.verifiedListing=function(){l.get(window.apiUrl+"/api/v1/listings/"+k.listing.id+"/verifylisting.json").then(function(a){k.listing.verification.verified=!0})},k.saveListing=function(){if((k.listing.address.housename||k.listing.address.address||k.listing.address.locality||k.listing.address.city||k.listing.address.postalcode)&&k.listing.address.county&&k.listing.address.neighbourhood&&k.listing.name.name&&k.listing.classList.length>0){if(k.nameUpdated){var a=p.find(k.customer.nameList,{name:k.listing.name.name});D?a?F.name={id:a.id}:F.name={id:null,name:k.listing.name.name,"new":!0}:k.isNewBusiness?a?F.name={id:a.id}:F.name={id:null,name:k.listing.name.name,"new":!0}:F.name={id:A.name.id,name:k.listing.name.name,"new":!1}}if(C()){var b={};p.forEach(B,function(a,c){b[c]=a}),p.forEach(b,function(a,c){var d=n("toDateName")(c);b[d]={isclosed:b[c].isclosed},b[d].ohHours=p.map(a.ohHours,function(a){return a.start&&a.end?{end:q(a.end).format("HH:mm"),start:q(a.start).format("HH:mm")}:void 0}),delete b[c]}),F.openingHours=[b]}if(k.phoneUpdated()){var c=[];p.each(k.listing.phoneList,function(a){var b=p.find(z.phoneList,{intCode:a.intCode,name:a.name});b?c.push(b):c.push({id:null,intCode:a.intCode,name:a.name,"new":!0})}),F.phoneList=c}console.log(F),x=m.open({animation:!0,scope:k,controller:"ListingSaveController",templateUrl:"views/modals/save.html"})}else g.warning("Name, Categories and Address (including County and Neighbourhood) fields are required!","Warning")},k.deleteListing=function(){u=m.open({animation:!0,scope:k,controller:"ListingDeleteController",templateUrl:"views/modals/delete.html"})}}]),angular.module("lmApp").controller("AddressModalController",["County","Geocode","isAddress","address","$timeout","$q","$scope","$modalInstance","_","$filter",function(a,b,c,d,e,f,g,h,i,j){var k,l;g.address=d,g.address["public"]=d["public"]===!1?!1:!0,g.isAdress=c,e(function(){g.showMap=!c},200),g.isUpdated=!1,g.firstAddress=angular.copy(d),g.addressVals=i.drop(i.values(d)),g.counties=[],a.query(function(a){return g.counties=a,!0}),g.$watch("address.id",function(a,b){if(b&&a!==b||g.isNew){var c=i.find(g.addressList,{id:parseInt(a)});if(c)return g.address=angular.copy(c),g.address["public"]=c["public"]===!1?!1:!0,!0}}),g.$watch("address.county.id",function(a,b){g.selectedNeighbourList=j("filter")(g.neighbourhoodList,{parentId:a})}),g.$watch("address.neighbourhood.id",function(a,b){(a!==b||g.isNew)&&(console.log(a),console.log(b),k=!0)}),g.$watch("address",function(a,b){a&&(i.isEqual(g.addressVals,i.drop(i.values(a)))||(l=i.values(i.pick(g.address,["address","locality","city","countryCode","postalcode"])).join(","),k=!0),g.addressString=i.compact([g.address.housename,g.address.address,g.address.locality,g.address.city,g.address.postalcode]).join(", "))},!0),g.createNewAddress=function(){var a=g.addressList.length,b={address_id:a,id:null,ismain:!0,address:"",housename:"",postalcode:"",city:"",locality:"",county:{id:""},"public":!0,lat:null,lng:null,candelete:!1,countryCode:"IE",geoconfirmed:!1,canupdate:!1,local:"",createDate:"",createdBy:"",createdByProc:"",updateDate:"",updatedBy:"",updatedByProc:"",geoLevel:null,geoMatch:null,"new":!0};return g.addressList.push(b),g.addressList[0].push(b),g.address=b,b},g.addressConfig={valueField:"address_id",labelField:"fullAddress",placeholder:"Choose an address",maxItems:1},g.countyConfig={valueField:"id",labelField:"text",placeholder:"Choose a county",sortField:"text",searchField:["text"],maxItems:1},g.neighbourhoodConfig={valueField:"id",labelField:"name",placeholder:"Select nhood",sortField:"name",searchField:["name"],maxItems:1},g.openLocationEditor=function(){g.isAdress=!1,g.address.lat||g.address.lng||g.getLatLng(),e(function(){g.showMap=!0},200)},g.getLatLng=function(){l?b.getLatLng({address:l}).success(function(a){if("OK"===a.status){var b=a.results[0].geometry.location;g.address.lat=b.lat,g.address.lng=b.lng}else console.log(a)}):(g.address.lat=null,g.address.lng=null)},g.address.lat&&g.address.lng||(l=i.values(i.pick(g.address,["address","locality","city","countryCode","postalcode"])).join(","),g.getLatLng()),g.map={center:{latitude:g.address.lat,longitude:g.address.lng},draggable:!0,zoom:16},g.options={scrollwheel:!1},g.marker={id:0,coords:{latitude:g.address.lat,longitude:g.address.lng},options:{draggable:!0,title:"Drop a location"}},g.$watch("marker.coords.latitude",function(a,b){g.address.lat=a}),g.$watch("marker.coords.longitude",function(a,b){g.address.lng=a}),g.$watch("address.lat",function(a,b){g.marker.coords.latitude=a,g.map.center.latitude=a}),g.$watch("address.lng",function(a,b){g.marker.coords.longitude=a,g.map.center.longitude=a}),g.openAddressEditor=function(){g.isAdress=!0},g.saveAddress=function(){h.close({status:!0,updated:k||g.isNew,params:angular.copy(g.address)})},g.dismissChanges=function(){g.address=g.firstAddress,h.close({status:!1,updated:null})}}]),angular.module("lmApp").controller("LoginController",["Identity","$location",function(a,b){b.path("/"+a.currentCustomer.customerRefNo)}]),angular.module("lmApp").controller("LocationController",["$scope","$modalInstance",function(a,b){a.close=function(){b.close()}}]),angular.module("lmApp").controller("ListingNameCtrl",["$scope","$modalInstance",function(a,b){a.newName=function(){b.close(!0)},a.updateName=function(){b.close(!1)}}]),angular.module("lmApp").controller("ListingSaveController",["Listing","Upload","toastr","$q","$cookies","$window","$http","$timeout","$interval","$scope","$modalInstance","_",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(a,c,d){var e=a[c];return e?void b.upload({url:window.apiUrl+"/api/v1/upload",data:e}).then(function(b){m(a,c+1,d)}):d.resolve("loop completed")}function n(a,b){var d=l.result(b,"data.operationMessage")||"We see that you are experiencing some difficulties in saving your changes - we are working on it and will be in contact with you shortly. Thank you for your patience!";c.error(d),setTimeout(function(){a?f.location.reload():f.location.href="/"+j.customer.customerRefNo},5e3)}function o(a){e.put("notify","Listing saved."),f.location.href="/listings/"+a}function p(){var a=d.defer(),b=[],c=j.customer.id||null,e=j.listing.id||null,f=j.logo;if(l.forEach(j.photoGallery.photos,function(a){b.push({file:a.file,customerId:c,listingId:e})}),f.file){var g={};g.file=f.file,g.top=f.top||!1,g.bottom=f.bottom||!1,g.left=f.left||!1,g.right=f.right||!1,g.customerId=c,g.listingId=e,b.push(g)}return b.length>0?m(b,0,a):a.resolve("No image"),a.promise}function q(a,b){if(a.$resolved)if(j.listing.id=a.listingId,200===a.operationCode){var d=p();d.then(function(a){b?(g.get(window.apiUrl+"/fcrfeeding?customerId="+j.customer.customerRefNo).then(function(a){o(j.listing.id)},function(a){n(j.listing.id,a)}),g.get(window.apiUrl+"/fcrfeedingbc?customerId="+j.customer.customerRefNo).then(function(a){o(j.listing.id)},function(a){n(j.listing.id,a)})):o(j.listing.id)},function(a){n(j.listing.id,a)})}else{var e=l.result(error,a.operationMessage);c.error(e),setTimeout(function(){listingId?f.location.reload():f.location.href="/"+j.customer.customerRefNo},5e3)}}j.saveOnly=function(b){c.warning("Saving...",{timeOut:0}),j.listing.id?a.update({_id:j.listing.id},j.listingChanges).$promise.then(function(a){q(a,b)},function(a){n(j.listing.id,a)}):a.save(j.listingChanges).$promise.then(function(a){q(a,b)},function(a){n(j.listing.id,a)}),k.close()},j.closeModal=function(){k.close()}}]),angular.module("lmApp").controller("ListingAddonsController",["$scope","$modalInstance","_",function(a,b,c){var d;a.$watch("listing.addons",function(a,b){b&&!c.isEqual(a,b)&&(d=!0)},!0),a.closeAddonsModal=function(){b.close({result:d})}}]),angular.module("lmApp").controller("SocialLinksController",["$scope","$modalInstance","_",function(a,b,c){a.sLinksUpdated=!1,a.changeSocialLink=function(){a.sLinksUpdated=!0},a.dismissSocialLinks=function(){b.close()},a.saveSocialLinks=function(){var d;a.sLinksUpdated&&(d=c.compact(c.map(a.socialLinks,function(a){return a.name?{type:a.type,name:a.name}:void 0}))),b.close(d)}}]),angular.module("lmApp").controller("ListingDeleteController",["Listing","$q","$cookies","$scope","$window","$modalInstance",function(a,b,c,d,e,f){d.Listing=a,d.deleteCheck=function(a){return"DELETE"===a},d.deleteConfirm=function(){a["delete"]({_id:d.listing.id}).$promise.then(function(a){c.put("notify","Listing deleted successfully."),e.location.href="/"+d.customer.customerRefNo},function(a){c.put("notify","Something went wrong!"),console.log(a),e.location.reload()}),f.close()},d.closeDeleteModal=function(){f.close()}}]),angular.module("lmApp").controller("LogoCropController",["$scope","$modalInstance","_",function(a,b,c){var d=Math.max(document.documentElement.clientWidth,window.innerWidth||0);320>=d?a.canvasWidth=200:a.canvasWidth=500,a.cropper={},a.cropper.sourceImage=null,a.cropper.croppedImage=null,a.bounds={},a.bounds.left=0,a.bounds.right=0,a.bounds.top=0,a.bounds.bottom=0,a.saveLogo=function(){b.close({params:angular.copy(a.bounds)})},a.closeLogoCrop=function(){b.close({params:null})}}]),angular.module("lmApp").filter("selectMain",["_",function(a){return function(b){return a.find(b,function(a){return 1===a.ismain})}}]),angular.module("lmApp").filter("capitalize",function(){return function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}}),angular.module("lmApp").directive("combobox",["_",function(a){return{restrict:"A",replace:!0,transclude:!0,link:function(b,c,d){var e,f,g,h={primary_key:"id"};d.comboname?(b.listing?f=a.result(b.listing,d.comboname):b.account&&(f=a.result(b.account,d.comboname)),f&&(e=f.id)):e=parseInt(d.defaultVal),e&&(h.init_record=[e]),"phoneOptions"===d.options&&(h.primary_key="phoneId"),g=angular.copy(a.result(b,d.options)),c.ajaxComboBox(g,h),c.keyup(function(a){13===a.keyCode&&$(".ac_result_area").hide()})}}}]),angular.module("lmApp").directive("daterangepicker",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.dateRangePicker({autoClose:!0,singleMonth:!0,showShortcuts:!0,shortcuts:{"next-days":[3,5,7]},format:"DD-MM-YYYY",setValue:function(b){a.$apply(function(){d.$setViewValue(b),d.$render()})}})}}}),angular.module("lmApp").directive("staticgooglemap",function(){return{template:'<div class="static-map"><img src="{{ gmapStaticUrl }}?{{ urlParams }}" /></div>',restrict:"E",scope:!1,link:function(a,b,c){var d=c.mapCoords,e={center:d,zoom:16,size:"550x300",markers:"color:red%7C"+d,key:"AIzaSyA-BD465yhF0iaxB8fLGLg87GjhU1ksPqQ"};a.gmapStaticUrl="https://maps.googleapis.com/maps/api/staticmap",a.urlParams=decodeURIComponent($.param(e))}}}),angular.module("lmApp").factory("ServiceArea",["$resource",function(a){var b=a(window.apiUrl+"/api/v1/service_areas.json");return b}]),angular.module("lmApp").filter("toDateName",[function(){var a={1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri",6:"Sat",7:"Sun"};return function(b){var c=b.toString();return a[c]}}]),angular.module("lmApp").factory("Coupon",["$http",function(a){return{getListingCoupons:function(b){return a.get("https://customer.getcoupons.ie/api/deals/in?listing="+b)}}}]),angular.module("lmApp").run(["$templateCache",function(a){"use strict";a.put("views/account.html",'<div class="container drawer-overlay dashboard-main"><div class="row bc-main"><form name=accountForm role=form id=myaccount class=form-horizontal><div class=row><div class=col-md-6 br><div class="panel panel-default"><div class=panel-heading>Your Business</div><input name=accountId value="" type=hidden><div class=form-group><label class="col-md-4 control-label">Business Name *</label><div class=col-md-8><div class=row><div class=col-md-12><div class=input-group><input ng-model=account.name.name comboname=name options=customer.nameList ng-keypress=newName($event) ng-blur=newName($event) combobox id=accountName></div></div></div></div></div><div class=form-group><label class="col-md-4 control-label">Main Address *</label><div class=col-md-8><div class=row><div class=col-md-12><div class="input-group input-group-sm"><input ng-click=openAddress(true) class="form-control input-sm addr" name=address id=bc_address readonly placeholder="{{ addressString }}"></div></div></div></div></div><div class=form-group><label class="col-md-4 control-label">Contact Name</label><div class=col-md-8><div class=row><div class=col-md-12><div class=input-group><input ng-model=account.contactPerson.name comboname=contactPerson options=customer.contactPersonList ng-blur=newContactPerson($event) ng-keypress=newContactPerson($event) combobox id=contactPersonName></div></div></div></div></div><div class=form-group><label class="col-md-4 control-label">Job Title</label><div class=col-md-8><div class=row><div class=col-md-12><div class="input-group input-group-sm"><input autocomplete=off class="form-control input-sm addr" ng-model=account.contactPerson.jobTitle placeholder="example (Owner, Manager, Sales Asssitant)"></div></div></div></div></div><div class=form-group><label class="col-md-4 control-label">Contact Email</label><div class=col-md-8><div class=row><div class=col-md-12><div class=input-group><input type=email autocomplete=off name=email class="form-control input-sm addr" ng-model=account.contactPerson.email placeholder="Add your email address"> <span class=form-error ng-show=accountForm.$error.email>Please enter a valid email.</span></div></div></div></div></div><div class="form-group phone-field phone-fields"><label class="col-md-4 control-label">Phone</label><div class=col-md-8><div class=row><div ng-repeat="phoneNumber in account.phoneList" class="col-md-12 phone-number"><div class=input-group><select class="form-control input-sm" ng-model=phoneNumber.intCode ng-options="int_code as int_code for int_code in int_codes" name="code-{{ $index }}"></select><input ng-model=phoneNumber.name default-val="{{ phoneNumber.id }}" options=phoneOptions ng-change="changePhone($index, phoneNumber.id)" ng-keypress=newPhoneNumber($event.keyCode) combobox id="phoneVal_{{ $index }}"> <span class=input-group-btn><a class="btn btn-default" ng-click=deleteNumber($index)><i class="fa fa-trash-o fa-lg"></i></a></span></div></div><div class="col-md-12 add-phone"><a class="btn btn-primary btn-sm" ng-click=addPhoneNumber()><i class="fa fa-plus fa-custom"></i>Add number</a></div></div></div></div><div class="form-group phone-field"><label class="col-md-4 control-label">Fax</label><div class=col-md-8><div class=row><div class=col-md-12><div class="input-group input-group-sm phone-number"><select class="form-control input-sm" ng-model=account.fax.intCode ng-options="int_code as int_code for int_code in int_codes"></select><input ng-model=account.fax.name comboname=fax options=customer.faxList ng-blur=newFaxNumber($event) ng-keypress=newFaxNumber($event) combobox id=faxVal></div></div></div></div></div></div></div><div class=col-md-6><div class="panel panel-default"><div class=panel-heading>Your Account</div></div><div class="form-group meta"><span class="col-md-4 metalabel">Your Account ID</span><div class=col-md-8><div class=row><div class=col-md-12><span class=metadata>{{ account.customerRefNo }}</span></div></div></div></div><div class="form-group meta"><span class="col-md-4 metalabel">Account Created</span><div class=col-md-8><div class=row><div class=col-md-12><span class=metadata>{{ account.createDate | date:"MM/dd/yyyy \'at\' h:mma" }}</span></div></div></div></div><div class="form-group meta"><span class="col-md-4 metalabel">Status (Type)</span><div class=col-md-8><div class=row><div class=col-md-12><span class=metadata>Verified (Starter)</span></div></div></div></div><div class="form-group meta"><span class="col-md-4 metalabel"></span><div class=col-md-8><div class=row><div class=col-md-12><span class=metadata><a href=# ng-click=openDeleteInfo()>delete this account</a></span></div></div></div></div><hr><div class="col-md-8 col-md-offset-4"><p class=small><strong>Support<br></strong> Please call <a href=tel:+35316188000>+353 1 618 8000</a> to chat to one of our team about your account, alternatively you can email <a href=mailto:info@goldenpages.ie>sales@goldenpages.ie</a><br><br><a href=http://goldenpages.ie>Goldenpages.ie</a> is an <a href=http://fcrmedia.ie>FCR Media</a> company, we are a specialised digital agency, sales and marketing company in Ireland providing local search and advertising products for SMEs across mobile, online and print platforms.</p></div></div></div></form></div><div class=panel-footer><div class=row><div class="col-md-2 col-md-offset-4 col-xs-5"></div><div class="col-md-6 col-xs-7"><button class="btn btn-main btn-block btn-disable" type=submit ng-click=saveAccount()>Save Changes</button></div></div></div></div>'),a.put("views/dashboard.html",'<div class="container drawer-overlay dashboard-main"><div class="row bc-main"><div class="panel panel-default listing-panel"><div class="litem litem-{{ listings.length }}" ng-repeat="listing in listings" ng-init="$last ? activateSlider() : angular.noop()"><div class=ldetail><h2>{{ listing.name.name }}</h2><p>{{ listing.addressString }}</p></div><ul class=laction><li><a target=_blank href="{{ listing.listing_view_url }}">view</a></li><li><a href=javascript: ng-click="showSocialButtons=!showSocialButtons">share</a></li><li><a href="/listings/{{ listing.id }}">edit</a></li></ul><div class=socialrow ng-init="showSocialButtons=false"><a ng-show=showSocialButtons href="https://www.facebook.com/sharer/sharer.php?u={{ listing.listing_view_url }}" onclick="window.open(this.href, \'\', \'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600\');return false" target=_blank title="Share on Facebook"><i class="fa fa-facebook fa-2x"></i></a> <a ng-show=showSocialButtons href="https://twitter.com/share?url={{ listing.listing_view_url }}&text={{ listing.name.name }}" onclick="window.open(this.href, \'\', \'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600\');return false" target=_blank title="Share on Twitter"><i class="fa fa-twitter fa-2x"></i></a> <a ng-show=showSocialButtons href="https://plus.google.com/share?url={{ listing.listing_view_url }}" onclick="window.open(this.href, \'\', \'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=350,width=530\');return false" target=_blank title="Share on Google+"><i class="fa fa-google-plus fa-2x"></i></a> <a ng-show=showSocialButtons href="mailto:?&subject={{ listing.name.name }}%20details&body=Here%20are%20the%20details%20for%20{{ listing.name.name }}%3A%20%20{{ listing.listing_view_url }}"><i class="fa fa-envelope-o fa-2x"></i></a></div><div class="lmeta row"><div class=col-xs-4>Categories</div><div class=col-xs-8><span ng-class={latest:$last} class=service ng-repeat="service in listing.classList">{{ service.name }}</span></div><div class=col-xs-4>Status</div><div class=col-xs-8>{{listing.status.name}}</div><div class=col-xs-4>Verified</div><div class=col-xs-8><a ng-show=!listing.verification.verified class=list-group-item-warning href="/listings/{{ listing.id }}">No, Please Verify Listing</a> <span ng-show=listing.verification.verified>Yes</span></div><div class=col-xs-4>Last Edit</div><div class=col-xs-8>{{ listing.status.lastEdit | date:"dd/MM/yyyy \'at\' h:mma" }}</div><div class=col-xs-4><button type=button class="btn btn-xs btn-info" ng-click=openAddonsModal(listing)>Add Ons</button></div><div class=col-xs-8>Location, Opening Hours (<a class=addonS href=# ng-click=openAddonsModal(listing)>6 available</a>)</div></div></div></div><div class=clearfix></div><a class="addmore btn" href=/listings/new><i class="fa fa-plus fa-custom"></i>Add another location to<br>goldenpages.ie</a></div><div class="row bc-main"><h3 class=newfcr><span>What\'s new from FCR Media</span></h3><div class="panel panel-default col-md-4 sponsor-panel"><span><img class=dashlogos src=assets/images/sayhi-logo.png style="margin:0 auto"></span><p class=small>SayHi WiFi is a little box which connects to your business\'s existing broadband, allowing you to offer your customers free WiFi while in your premises. In turn, they share with you their contact information so you can stay in touch with them and \'SayHi\' long after their visit!</p><div class=panel-footer><a class="btn btn-block btn-primary btn-sm" role=button href="http://getcoupons.ie/" target=_blank>more info</a></div></div><div class="panel panel-default col-md-4 sponsor-panel"><span><img class=dashlogos src=assets/images/image001_srcset-large.png style="margin:0 auto"></span><p class=small>SnapSync insures your business information is correctly listed on Ireland\'s top directories and social platforms like goldenpages.ie and Facebook. The SnapSync network includes 14 directories with more to come and it also includes Google Plus and GPS Networks such as Here, NavFree, TomTom in addition to the powerful review site Yelp.</p><div class=panel-footer><a class="btn btn-block btn-primary btn-sm" role=button href="http://getcoupons.ie/" target=_blank>more info</a></div></div><div class="panel panel-default col-md-4 sponsor-panel"><span><img class=dashlogos src=assets/images/sayhi-logo.png style="margin:0 auto"></span><p class=small>SayHi WiFi is a little box which connects to your business\'s existing broadband, allowing you to offer your customers free WiFi while in your premises. In turn, they share with you their contact information so you can stay in touch with them and \'SayHi\' long after their visit!</p><div class=panel-footer><a class="btn btn-block btn-primary btn-sm" role=button href="http://getcoupons.ie/" target=_blank>more info</a></div></div></div></div><script>$(document).ready(function(){\n    $(".drawer").drawer();\n  });</script>'),a.put("views/listing.html",'<div ng-if="!listing.verification.verified && !isNew" class=verify-info><h5>Click <a ng-click=verifiedListing() type=button href=# id=verify-listing class="btn btn-sm btn-warning">Verify</a> To Confirm This Listing Is Correct</h5></div><div ng-class="{notVerified: !listing.verification.verified && !isNew}" class="container drawer-overlay dashboard-main"><div class="row bc-main"><form name=listingForm role=form id=mylisting class=form-horizontal><div class=row><div class=col-md-6 br><div class="panel panel-default"><div class=panel-heading>Your Business</div><input name=listingId value="" type=hidden><div class=form-group><label class="col-md-4 control-label">Business Name *</label><div class=col-md-8><div class=row><div class=col-md-12><div class=input-group><input ng-model=listing.name.name comboname=name options=customer.nameList ng-keypress=newName($event) ng-blur=newName($event) combobox id=listingName></div></div></div></div></div><div class=form-group><label class="col-md-4 control-label">Main Categories *</label><div class=col-md-8><div class=row><div class=col-md-12><div class=input-group><selectize ng-model=categories options=categoriesList config=categoryConfig></selectize></div></div></div></div></div><div class="form-group email-fields phone-field phone-fields"><label class="col-md-4 control-label">Business Email</label><div class=col-md-8><div class=row><div class="col-md-12 phone-number"><div class=input-group><input ng-model=listing.email.name comboname=email options=customer.emailList ng-keypress=newEmail($event) ng-blur=newEmail($event) combobox id=emailVal type=email> <span class=input-group-btn><a class="btn btn-default" ng-click=deleteEmail()><i class="fa fa-trash-o fa-lg"></i></a></span></div></div></div></div></div><div class=form-group><label class="col-md-4 control-label">Logo</label><div class=col-md-8><div class=row><div class=col-md-12><div class="input-group input-group-sm"><div class=file-preview><div ng-show=logo.file class=thumb-view style="width: 50%; height: 100px; line-height: 100px"><img class=img-thumbnail ngf-src=logo.file data-holder-rendered=true style="width: 150px; height: 100px"></div><div ng-show=!logo.file class=thumb-view style="width: 50%; height: 100px; line-height: 100px"><img class=img-thumbnail src="{{ listing.logo.path }}" data-holder-rendered=true style="width: 150px; height: 100px"></div><div class=logo-buttons><span class="btn btn-xs btn-default btn-file"><span ng-hide="logo.file || listing.logo.path">Select image</span> <span ng-show="logo.file || listing.logo.path">Change</span> <input type=file ngf-select="" img-cropper-fileread ng-model=logo.file image=cropImage accept="image/*"></span> <a ng-show=logo.file ng-click=openCrop() href=# class="btn btn-xs btn-default btn-info">Edit</a> <a ng-show="logo.file || listing.logo.path" href=# ng-click=deleteLogo() class="btn btn-xs btn-default btn-danger">X</a></div></div></div></div></div></div></div><div class=form-group><label class="col-md-4 control-label">Website</label><div class=col-md-8><div class=row><div class=col-md-12><div class="input-group input-group-sm"><input ng-model=listing.website.name name=website comboname=website options=customer.websiteList ng-keypress=newWebsite($event) ng-blur=newWebsite($event) combobox id=websiteVal> <span class=input-group-btn><a class="btn btn-default" ng-click=deleteWebsite()><i class="fa fa-trash-o fa-lg"></i></a></span></div><span class=form-error ng-show=listingForm.website.$error.pattern>Please enter a valid URL.</span></div></div></div></div><div class=form-group><label class="col-md-4 control-label">Description</label><div class=col-md-8><div class=row><div class=col-md-12><div class="input-group input-group-sm"><textarea rows=3 ng-model=listing.description.name class="form-control ac_textarea" ng-maxlength=1024 maxlength=1024 placeholder="Add a description"></textarea></div></div></div></div></div><div class="form-group phone-field phone-fields"><label class="col-md-4 control-label">Phone</label><div class=col-md-8><div class=row><div ng-repeat="phoneNumber in listing.phoneList" class="col-md-12 phone-number"><div class=input-group><select class="form-control input-sm" ng-model=phoneNumber.intCode ng-options="int_code as int_code for int_code in int_codes" name="code-{{ $index }}"></select><input ng-model=phoneNumber.name default-val="{{ phoneNumber.id }}" options=phoneOptions ng-change="changePhone($index, phoneNumber.id)" ng-keypress=newPhoneNumber($event.keyCode) combobox id="phoneVal_{{ $index }}"> <span class=input-group-btn><a class="btn btn-default" ng-click=deleteNumber($index)><i class="fa fa-trash-o fa-lg"></i></a></span></div></div><div class="col-md-12 add-phone"><a class="btn btn-primary btn-sm" ng-click=addPhoneNumber()><i class="fa fa-plus fa-custom"></i>Add number</a></div></div></div></div><div class="form-group phone-field"><label class="col-md-4 control-label">Fax</label><div class=col-md-8><div class=row><div class=col-md-12><div class="input-group input-group-sm phone-number"><select class="form-control input-sm" ng-model=listing.fax.intCode ng-options="int_code as int_code for int_code in int_codes"></select><input combobox ng-model=listing.fax.name comboname=fax options=customer.faxList ng-keypress=newFaxNumber($event) ng-blur=newFaxNumber($event) id=faxVal> <span class=input-group-btn><a class="btn btn-default" ng-click=deleteFax()><i class="fa fa-trash-o fa-lg"></i></a></span></div></div></div></div></div><div class=form-group><label class="col-md-4 control-label">Main Address *</label><div class=col-md-8><div class=row><div class=col-md-12><div class="input-group input-group-sm"><a ng-click=openAddress(true) class="form-control input-sm addr" id=bc_address>{{ addressString }}</a></div></div></div></div></div><div class=form-group><label class="col-md-4 control-label">Social Media and Apps</label><div class=col-md-8><div class=row><div class=col-md-12><div class="input-group input-group-sm"><div class="social btn-group" role=group aria-label="apps and social media links"><a ng-click=openSocialLinksEditor() type=button class="btn btn-sm btn-default" ng-repeat="(logo, socialLink) in socialMediaUrlTypes"><i class="fa fa-{{ logo }}"></i></a></div></div></div></div></div></div><div class="form-group listing-map"><div class=col-md-12 ng-if=showMap><div class=panel-heading><span>Add-On -</span> Location &amp; Directions</div><staticgooglemap map-coords="{{ map }}" ng-if=showMap></staticgooglemap><br><a class="btn btn-xs btn-primary" style=margin-bottom:10px ng-click=openAddress(false)>Edit Geo Locations</a></div></div><div class="panel panel-default oh-panel"><div class=panel-heading><span>Add-On -</span> Opening Hours</div><div class=panel-body><table class="hours table" ng-show=showOhEditor><tbody><tr ng-repeat="(day, times) in openingHours" ng-class="{\'status-opened\': currentHours(day)}"><td>{{ day | toDateName | capitalize }}</td><td ng-repeat="time in times.ohHours">{{ time.start | date:"HH:mm" }} - {{ time.end | date:"HH:mm" }}</td><td ng-if="times.isclosed === null || times.isclosed === undefined">No Opening Hours</td><td ng-if="times.isclosed === true">Closed</td><td ng-show="times.ohHours.length < 2"></td></tr></tbody></table><table ng-show=showOhEditor class="hours table" ng-if="listing.closedBetween.start && listing.closedBetween.end"><tbody><tr><td class=col-md-4>Closed Between</td><td class=col-md-8>{{ listing.closedBetween.start}} to {{ listing.closedBetween.end }}</td></tr></tbody></table><div class=edit-hours ng-hide=showOhEditor><div class="row day-row" ng-repeat="(day, time_vals) in openingHours"><div class="col-xs-12 col-sm-12 col-md-3"><div class="input-group input-group-sm"><label for=inlinecheckbox><input type=checkbox ng-model=time_vals.isclosed ng-change="changeOpeningHours(day, time_vals.isclosed)"> {{ day | toDateName | capitalize }} <span ng-if="time_vals.isclosed === false">Open</span></label></div></div><div class="col-xs-12 col-sm-12 col-md-9"><span class=add-oh-label ng-if="time_vals.isclosed === true">Closed</span> <span class=add-oh-label ng-if="time_vals.isclosed === null || time_vals.isclosed === undefined"><a href=# ng-click="changeOpeningHours(day, time_vals.isclosed)">Add Opening Hours</a></span><div class=row ng-repeat="time in time_vals.ohHours"><div class="col-xs-5 col-sm-4 col-md-3"><div class="input-group input-group-sm"><span class=input-group-addon><span ng-click="openCalendar($event, time, \'open_start\')" class="glyphicon glyphicon-time"></span></span> <a type=text ng-click="openCalendar($event, time, \'open_start\')" class="form-control input-sm time-input" datetime-picker="hh:mm a" date-format="hh:mm a" ng-model=time.start is-open=time.open_start enable-date=false show-button-bar=false close-on-selection=true>{{ time.start | date:"hh:mm a" }}</a></div></div><div class="col-xs-2 col-sm-1 col-md-2 to-text"><div class="input-group input-group-sm"><p>to</p></div></div><div class="col-xs-5 col-sm-4 col-md-3"><div class="input-group input-group-sm"><span class=input-group-addon><span ng-click="openCalendar($event, time, \'open_end\')" class="glyphicon glyphicon-time"></span></span> <a type=text ng-click="openCalendar($event, time, \'open_end\')" class="form-control input-sm time-input" datetime-picker="hh:mm a" date-format="hh:mm a" ng-model=time.end is-open=time.open_end enable-date=false show-button-bar=false close-on-selection=true>{{ time.end | date:"hh:mm a" }}</a></div></div><div class="col-xs-12 col-sm-3 col-md-4"><div class="input-group input-group-sm"><p><a href=javascript:void(0) ng-click="" ng-if="$index == 0 && time_vals.ohHours.length > 1">and</a> <a href=javascript:void(0) ng-click="removeOpeningHoursTime(day, $index)" ng-if="$index == 1 && time_vals.ohHours.length > 1">remove</a> <a href=javascript:void(0) ng-click=addOpeningHoursTime(day) ng-if="time_vals.ohHours.length == 1">split hours</a></p></div></div></div></div></div><div class="row holiday-row"><div class="col-xs-12 col-sm-12 col-md-3"><label>Holidays</label></div><div class="col-xs-12 col-sm-12 col-md-9"><div class=input-group><span class=input-group-addon><i class="glyphicon glyphicon-time"></i></span> <input ng-model=holidays daterangepicker id=closedbetween size=40 start-date="{{ closedBetween.start }}" end-date="{{ closedBetween.end }}" name=closedbetween readonly class=form-control> <span class=input-group-btn><a class="btn btn-default" ng-click=deleteHolidays() tooltip="Delete holidays" tooltip-placement=right><i class="fa fa-trash-o fa-lg"></i></a></span></div></div></div></div></div><a class="btn btn-xs btn-primary" style=margin-bottom:10px ng-click="showOhEditor = !showOhEditor" ng-show=showOhEditor ng-init="showOhEditor=true">Edit Opening Hours</a> <a class="btn btn-xs btn-main" style=margin-bottom:10px ng-click="showOhEditor = !showOhEditor" ng-hide=showOhEditor ng-init="showOhEditor=true">Confirm</a></div></div></div><div class=col-md-6><div id=addondiv class="panel panel-default"><p style=text-align:center><strong>Add-on\'s</strong> allow you to enhance your goldenpages.ie listing, showcase your company and improve your searchablity</p><a class="btn btn-addon btn-block" type=button ng-click=openAddonsModal()>View Add-ons</a></div><div ng-show=listing.addons.photoGallery class=addoncontainer id=collapsiblephoto aria-expanded=true><div class=panel-heading><span>Add-On -</span> Photo Gallery</div><div class=form-group><label class="col-md-4 control-label">Album Title</label><div class=col-md-8><div class=row><div class=col-md-12><div class="input-group input-group-sm"><input ng-model=listing.photoGallery.title autocomplete=off class="form-control input-sm" name=photoGallery[title] placeholder="Photo Album Title"></div></div></div></div></div><div class=form-group><div class="photo-box col-sm-4 col-xs-6" ng-repeat="photo in listing.photoGallery.photos"><div class="fileinput fileinput-exists"><div class="fileinput-preview thumbnail" style="width: 100%; height: 100px; line-height: 100px"><img src="{{ photo.path }}"></div><div><a class="btn btn-danger btn-sm" ng-click=deletePhoto(photo.id)><i class="fa fa-trash-o"></i> Delete Photo</a></div></div></div><div class="photo-box col-sm-4 col-xs-6" ng-repeat="photo in photoGallery.photos"><div class=fileinput-preview style="height: 100px; line-height: 100px"><img ng-show=photo.file class=img-thumbnail ngf-src=photo.file data-holder-rendered=true style="width: 150px; height: 100px"> <img ng-hide=photo.file class=img-thumbnail src="" data-holder-rendered=true style="width: 150px; height: 100px"></div><div class=logo-buttons><span ng-hide=photo.file class="btn btn-xs btn-default btn-file"><span>Select image</span> <input type=file ngf-select="" ng-model=photo.file accept="image/*"></span><div ng-show=photo.file><a class="btn btn-danger btn-sm" ng-click=removePhoto($index)><i class="fa fa-trash-o"></i> Delete Photo</a></div></div></div><div class="col-md-12 add-phone"><a class="btn btn-primary btn-sm" ng-click=addPhoto()><i class="fa fa-plus fa-custom"></i>Add photo</a></div></div></div><div ng-show=listing.addons.serviceAreas class=addoncontainer id=collapsiblelockeyword><div class=panel-heading><span>Add-On -</span>All Area\'s You Serve</div><p><small>Make your business visible to more customers searching for your service in their counties, cities, towns, or neighbourhood\'s that you select below</small></p><div class=form-group><label class="col-md-4 control-label">Areas Your Serve</label><div class=col-md-8><div class=row><div class=col-md-12><div class="input-group input-group-sm"><selectize ng-model=serviceAreas options=serviceAreaList config=serviceAreaConfig></selectize></div></div></div></div></div></div><div ng-show=listing.addons.reviews class="panel panel-default" id=collapsiblereview style="border:1px solid #3AABD5; padding:15px"><div class=row><div class=col-sm-4><img class=addonlogo src=assets/images/sayso.png width="100%"></div><p>Reviews are now turned on. Reviews of your services or products will show on your listing when people search and view it online. Research shows that customers are significantly more likely to contact you after reading a review.</p></div><hr><p class=small style=text-align:center;margin-top:5px>Log into your <a href=http://getcoupons.ie>business centre</a> account to see all reviews for your business.</p></div><div ng-show=listing.addons.coupons id=collapsiblecoupon><div class="panel panel-default" style="border:1px solid #F45A31; padding:15px"><div class=row><div class=col-sm-4><img class=addonlogo src="assets/images/getcoupons.png"></div><div class=col-sm-8>Show your active getcoupons when people search and view this listing online.</div></div><hr><div class="form-group coupon"><span class="col-md-4 couponlabel">Currently Active Coupons</span><div class=col-md-8><div class=row><div class=col-md-12><ul><li ng-repeat="coupon in coupons.deals">{{ coupon.title }}</li></ul><a ng-if=coupons.isActive href=http://getcoupons.ie target=_blank>add more coupons</a> <a ng-if=!coupons.isActive class="btn btn-block btn-coupon" role=button href=http://getcoupons.ie target=_blank>View All Coupons</a></div></div></div></div><p class=small style=text-align:center;margin-top:5px>Log into your <a href=http://businesscentre.goldenpages.ie target=_blank>business centre</a> account to create a getcoupon. It will be included on getcoupons.ie, and across the goldenpages.ie platform when people search for your service, product, or company.</p></div></div></div></div></form><div class=panel-footer><div class=row><div class="col-md-3 col-xs-6"><a class="btn btn-delete btn-block delete" type=button ng-click=deleteListing()>Delete Listing</a></div><div class="col-md-6 col-xs-6"><a class="btn btn-main btn-block btn-disable" type=submit ng-click=saveListing()>Save Changes</a></div></div></div></div></div>'),
a.put("views/login.html",""),a.put("views/modals/address.html",'<form id=addressEditor class=form-horizontal><div class=modal-header><button type=button class=close ng-click=dismissChanges() aria-label=Close><span aria-hidden=true>&times;</span></button><div class=modal-title><h4 id=addonslLabel>Address</h4><small>You can create or edit your address and location</small></div></div><div class=modal-body><div class=aditem ng-show=isAdress><div class="row existingaddr"><div class=form-group style=margin-top:20px><label class="col-md-4 control-label">Edit or Choose From An Existing Address</label><div class=col-md-4><div class="input-group input-group-sm"><selectize ng-model=address.id options=addressList config=addressConfig></selectize></div></div><label class="col-md-2 control-label address-create">Or Create New One</label><div class=col-md-2><a class="btn btn-info btn-sm create-button" ng-click=createNewAddress()>Create Address</a></div></div></div><div class="row modalbg enteraddr"><div class=row><div class="col-sm-4 col-md-4"><div class=form-group><label for=housename class="control-label col-sm-12 col-md-4">House#</label><div class="col-sm-12 col-md-8"><input autocomplete=off ng-model=address.housename class="form-control input-sm" value="{{ address.housename }}"></div></div></div><div class="col-sm-8 col-md-8"><div class=form-group><label for=address class="control-label col-sm-12 col-md-2">Address&nbsp;1</label><div class="col-sm-12 col-md-10"><input autocomplete=off ng-model=address.address name=address class="form-control input-sm" value="{{ address.address }}"></div></div></div></div><div class=row><div class="col-sm-4 col-md-4"><div class=form-group><label for=locality class="control-label col-sm-12 col-md-4">Address&nbsp;2</label><div class="col-sm-12 col-md-8"><input autocomplete=off ng-model=address.locality class="form-control input-sm" value="{{ address.locality }}"></div></div></div><div class="col-sm-4 col-md-4"><div class=form-group><label for=city class="control-label col-sm-12 col-md-4">City</label><div class="col-sm-12 col-md-8"><input autocomplete=off ng-model=address.city class="form-control input-sm" value="{{ address.city }}"></div></div></div><div class="col-sm-4 col-md-4"><div class=form-group><label class="control-label col-sm-12 col-md-4">Postal Code</label><div class="col-sm-12 col-md-8"><input autocomplete=off id=postalcode ng-model=address.postalcode name=postalcode class="form-control input-sm" value="{{ address.postalcode }}"></div></div></div></div><div class=row><div class="col-sm-4 col-md-4"><div class=form-group><label class="control-label col-sm-12 col-md-4">County *</label><div class="col-sm-12 col-md-8"><selectize ng-model=address.county.id options=counties config=countyConfig></selectize></div></div></div><div class="col-sm-4 col-md-4"><div class=form-group><label class="control-label col-sm-12 col-md-4">Neighbourhood *</label><div id=neighbourhood class="col-sm-12 col-md-8"><selectize ng-model=address.neighbourhood.id options=selectedNeighbourList config=neighbourhoodConfig></selectize></div></div></div><div class="col-sm-4 col-md-4"><div class=form-group><label class="control-label col-xs-6 col-sm-6">Make Address Public</label><div class="col-xs-6 col-sm-6"><div class="input-group input-group-sm"><div class="radio radio-primary radio-inline"><input id=inlineRadio1 ng-model=address.public ng-value=true value=true name=radioInline type=radio><label for=inlineRadio1>Yes</label></div><div class="radio radio-inline"><input id=inlineRadio2 ng-model=address.public ng-value=false value=false name=radioInline type=radio><label for=inlineRadio2>No</label></div></div></div></div></div></div></div></div><div class=aditem ng-hide=isAdress><div class=row><small>Please reset/confirm your geo-location by dragging the pin and clicking confirm.</small><hr><div class=col-md-12 ng-if=showMap id=mapEditor><ui-gmap-google-map center=map.center zoom=map.zoom draggable=true options=options><ui-gmap-marker coords=marker.coords options=marker.options idkey=marker.id></ui-gmap-marker></ui-gmap-google-map></div><div class=clearfix></div><hr><div class=col-lg-6><div class=input-group><label class=address-content>Address</label><input class="form-control input-sm" name=addressText value="{{ addressString }}" disabled> <span class="input-group-btn find-here"><button tooltip="Find location from address" ng-click=getLatLng() tooltip-placement=bottom class="btn btn-info" type=button><i class="fa fa-crosshairs fa-lg"></i></button></span></div></div><div class=col-md-3><div class=form-group><label class=latitude>Latitude</label><input class="form-control input-sm" name=lat ng-model=address.lat></div></div><div class=col-md-3><div class=form-group><label class=longitude>Longitude</label><input class="form-control input-sm" name=lng ng-model=address.lng></div></div></div></div></div></form><div class="modal-footer text-right"><button class="btn btn-delete pull-left" type=button data-toggle=modal data-dismiss=modal ng-click=dismissChanges()>Cancel</button> <button class="btn btn-success" ng-hide=isAdress store=bc_address ng-click=saveAddress()>Confirm</button> <button class="btn btn-success" store=bc_address ng-show=isAdress ng-click=openLocationEditor()>Next <i class="fa fa-chevron-right"></i></button></div>'),a.put("views/modals/delete.html",'<div class=modal-header><button type=button class=close data-dismiss=modal aria-label=Close><span aria-hidden=true ng-click=closeDeleteModal()>×</span></button><h4 class=modal-title id=myModalLabel>Delete</h4></div><div class=modal-body><div class=form-group><label for=recipient-name class=control-label>Type \'DELETE\' in UPPERCASE in the box below, then click on Delete Listing to confirm your request.</label><input ng-model=deleteValidation class=form-control id=deleteok></div></div><div class=modal-footer><div class=col-md-12><button type=button class="btn btn-default" ng-click=closeDeleteModal() data-dismiss=modal>Cancel</button> <button type=button class="btn btn-danger" ng-click=deleteConfirm() ng-disabled=!deleteCheck(deleteValidation)>Delete Listing</button></div></div>'),a.put("views/modals/delete_info.html","<div class=modal-header><button type=button class=close data-dismiss=modal aria-label=Close><span ng-click=closeDeleteInfoModal() aria-hidden=true>×</span></button><h4 class=modal-title id=myModalLabel>Close Account</h4></div><div class=modal-body><div class=form-group><p style=text-align:center>Please contact <a href=tel:+35316188000>000 0000000</a> to chat to one of our team about closing your account and deleting your listings, alternatively you can email <a href=mailto:sales@goldenpages.ie>sales@goldenpages.ie</a><br></p></div></div>"),a.put("views/modals/listing_addons.html",'<div class=modal-header><button type=button class=close ng-click=closeAddonsModal()><span aria-hidden=true>×</span></button><h4 class=modal-title id=addonslLabel>Goldenpages.ie Listing Add-Ons</h4></div><div class=modal-body><ul class=list-group><li class=list-group-item><span class=switch><div class="btn-group btn-locked-toggle"><input bs-switch type=checkbox switch-active=false ng-model=listing.addons.location switch-size="mini"></div></span> Location / Directions</li><li class=list-group-item><span class=switch><div class="btn-group btn-locked-toggle"><input bs-switch type=checkbox switch-active=false ng-model=listing.addons.openingHours switch-size="mini"></div></span> Opening Hours</li><li class=list-group-item><span class=switch><div class="btn-group btn-locked-toggle"><input bs-switch type=checkbox switch-active="{{ listing.addons.isActive }}" ng-model=listing.addons.photoGallery switch-size="mini"></div></span> Photo Gallery</li><li class=list-group-item><span class=switch><div class="btn-group btn-toggle"><input bs-switch type=checkbox switch-active="{{ listing.addons.isActive }}" ng-model=listing.addons.serviceAreas switch-size="mini"></div></span> All Area\'s You Serve</li><li class=list-group-item><span class=switch><div class="btn-group btn-locked-toggle"><input bs-switch type=checkbox switch-active=false ng-model=listing.addons.reviews switch-size="mini"></div></span> Reviews</li><li class=list-group-item><span class=switch><div class="btn-group btn-toggle"><input bs-switch type=checkbox switch-active="{{ listing.addons.isActive }}" ng-model=listing.addons.coupons switch-size="mini"></div></span> Coupons</li><li class=list-group-item><a role=button target=_blank class="btn btn-block btn-info" href=http://fcrmedia.ie><span aria-hidden=true>See All Add-On\'s From FCR Media</span></a></li></ul><div class=text-right><button type=button ng-click=closeAddonsModal() class="btn btn-success" data-dismiss=modal aria-label=Close><span aria-hidden=true>Done</span></button></div></div>'),a.put("views/modals/location.html",'<div id=editorContent class=modal-content><div id=modal-content class=modal-body><div class="panel panel-default"><div class=litem><div class=panel-heading><h2 class=panel-title>Edit Geo Locations</h2></div><div class=panel-body>Please reset/confirm your geo-location by dragging the pin and clicking confirm.<div id=exp_map></div><input name=isModifyGeo value=false type=hidden></div><table class="table table-condensed table-striped"><thead><th class=address-content>Address</th><th class=latitude>Latitude</th><th class=longitude>Longitude</th></thead><tbody id=addressList><tr><td><input class="form-control input-sm" name=addressText value="2, Brabazon Square, 8, Co. Dublin"></td><td><input class="form-control input-sm geoconfirm" id=lat10 name=lat onkeydown=switchConfirmed(event) value=53.3404416></td><td><input class="form-control input-sm geoconfirm" id=lng10 name=lng onkeydown=switchConfirmed(event) value=-6.280177699999999></td></tr></tbody></table><div class="panel-footer text-right no-gutter"><button class="btn btn-delete pull-left" data-dismiss=modal type=button>Close Editor</button> <button type=button class="btn btn-success geoconfirm" id=confirm10 name=confirm onclick=placeMarker(event) ng-click=close()>Confirm</button></div></div></div></div></div>'),a.put("views/modals/logo_crop.html",'<div class=modal-body><div class=form-group style=text-align:center><canvas width="{{ canvasWidth }}" height=300 image-cropper image=cropImage cropped-image=cropper.croppedImage crop-width=400 crop-height=200 keep-aspect=true></canvas></div></div><div class=modal-footer><div class=col-md-12><button type=button class="btn btn-default" ng-click=closeLogoCrop() data-dismiss=modal>Cancel</button> <button type=button class="btn btn-danger" ng-click=saveLogo()>Save logo</button></div></div>'),a.put("views/modals/name_confirm.html",'<div class=modal-body><h3>Is this a new business?</h3></div><div class=modal-footer><button class="btn btn-primary" ng-click=newName()>Yes</button> <button class="btn btn-warning" ng-click=updateName()>No</button></div>'),a.put("views/modals/save.html",'<div class=modal-header><button type=button class=close aria-label=Close ng-click=closeModal()><span aria-hidden=true>&times;</span></button><h4 class=modal-title id=myModalLabel>Save or Verify and Publish Your Listing</h4></div><div class=modal-body>When you have reviewed your listing informationand wish to queue for publishing on goldenpages.ie please click Verify and Queue button below.<br><br>If you wish to save your edits until your listing is complete and <strong>not</strong> send for publishing then click on Save Only</div><div class=modal-footer><div class=col-md-6><button type=button class="btn btn-default" ng-click=saveOnly(false)>Save Only (not published)</button></div><div class=col-md-6><button type=button class="btn btn-main btn-block" ng-click=saveOnly(true)>Verify and Queue for Publishing</button></div></div>'),a.put("views/modals/social_links.html",'<div class=modal-header><form class=form-horizontal><div class=panel-heading><button type=button class="close pull-right" ng-click=dismissSocialLinks()>×</button><h3 class=panel-title>You can edit your social media links below.</h3></div><div class=panel-body>Please add your social media and applications URLs. If you have none, leave the related field blank.<div class=form-group ng-repeat="socialLink in socialLinks"><label class="col-md-4 control-label">{{ socialLink.title }}</label><div class=col-md-8><div class=row><div class=col-md-12><div class="input-group input-group-sm"><span class=input-group-addon><i class="fa fa-{{ socialLink.type }}"></i></span> <input class="form-control input-sm" autocomplete=off ng-change=changeSocialLink() ng-model=socialLink.name ng-model-options="{ updateOn: \'blur\' }" placeholder="{{ socialLink.url }}"></div></div></div></div></div></div><div class="panel-footer text-right"><button type=button class="btn btn-delete pull-left" data-dismiss=modal aria-label=Close ng-click=dismissSocialLinks()>Cancel</button> <button class="btn btn-success" type=button ng-click=saveSocialLinks();>Confirm</button></div></form></div>')}]);
